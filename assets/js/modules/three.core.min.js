const t="183dev",e={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},i={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},s=0,r=1,n=2,a=3,o=0,h=1,l=2,c=3,u=0,d=1,p=2,m=0,y=1,g=2,f=3,x=4,b=5,v=6,w=100,M=101,S=102,_=103,A=104,T=200,z=201,C=202,I=203,B=204,k=205,O=206,P=207,R=208,N=209,V=210,F=211,E=212,L=213,j=214,D=0,U=1,W=2,q=3,J=4,X=5,Y=6,Z=7,H=0,G=1,$=2,Q=0,K=1,tt=2,et=3,it=4,st=5,rt=6,nt=7,at="attached",ot="detached",ht=300,lt=301,ct=302,ut=303,dt=304,pt=306,mt=1e3,yt=1001,gt=1002,ft=1003,xt=1004,bt=1004,vt=1005,wt=1005,Mt=1006,St=1007,_t=1007,At=1008,Tt=1008,zt=1009,Ct=1010,It=1011,Bt=1012,kt=1013,Ot=1014,Pt=1015,Rt=1016,Nt=1017,Vt=1018,Ft=1020,Et=35902,Lt=35899,jt=1021,Dt=1022,Ut=1023,Wt=1026,qt=1027,Jt=1028,Xt=1029,Yt=1030,Zt=1031,Ht=1032,Gt=1033,$t=33776,Qt=33777,Kt=33778,te=33779,ee=35840,ie=35841,se=35842,re=35843,ne=36196,ae=37492,oe=37496,he=37488,le=37489,ce=37490,ue=37491,de=37808,pe=37809,me=37810,ye=37811,ge=37812,fe=37813,xe=37814,be=37815,ve=37816,we=37817,Me=37818,Se=37819,_e=37820,Ae=37821,Te=36492,ze=36494,Ce=36495,Ie=36283,Be=36284,ke=36285,Oe=36286,Pe=2200,Re=2201,Ne=2202,Ve=2300,Fe=2301,Ee=2302,Le=2400,je=2401,De=2402,Ue=2500,We=2501,qe=0,Je=1,Xe=2,Ye=3200,Ze=3201,He=3202,Ge=3203,$e=0,Qe=1,Ke="",ti="srgb",ei="srgb-linear",ii="linear",si="srgb",ri="",ni="rg",ai="ga",oi=0,hi=7680,li=7681,ci=7682,ui=7683,di=34055,pi=34056,mi=5386,yi=512,gi=513,fi=514,xi=515,bi=516,vi=517,wi=518,Mi=519,Si=512,_i=513,Ai=514,Ti=515,zi=516,Ci=517,Ii=518,Bi=519,ki=35044,Oi=35048,Pi=35040,Ri=35045,Ni=35049,Vi=35041,Fi=35046,Ei=35050,Li=35042,ji="100",Di="300 es",Ui=2e3,Wi=2001,qi={COMPUTE:"compute",RENDER:"render"},Ji={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},Xi={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"},Yi={TEXTURE_COMPARE:"depthTextureCompare"};function Zi(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const Hi={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Gi(e,t){return new Hi[e](t)}function $i(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Qi(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Ki(){const e=Qi("canvas");return e.style.display="block",e}const ts={};let es=null;function is(e){es=e}function ss(){return es}function rs(...e){const t="THREE."+e.shift();es?es("log",t,...e):console.log(t,...e)}function ns(...e){const t="THREE."+e.shift();es?es("warn",t,...e):console.warn(t,...e)}function as(...e){const t="THREE."+e.shift();es?es("error",t,...e):console.error(t,...e)}function os(...e){const t=e.join(" ");t in ts||(ts[t]=!0,ns(...e))}function hs(e,t,n){return new Promise(function(s,o){setTimeout(function i(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:o();break;case e.TIMEOUT_EXPIRED:setTimeout(i,n);break;default:s()}},n)})}class ls{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n&&void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){const s=this._listeners;if(void 0===s)return;const n=s[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const n=t[e.type];if(void 0!==n){e.target=this;const t=n.slice(0);for(let n=0,s=t.length;n<s;n++)t[n].call(this,e);e.target=null}}}const cs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let us=1234567;const ds=Math.PI/180,ps=180/Math.PI;function ms(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(cs[255&e]+cs[e>>8&255]+cs[e>>16&255]+cs[e>>24&255]+"-"+cs[255&t]+cs[t>>8&255]+"-"+cs[t>>16&15|64]+cs[t>>24&255]+"-"+cs[63&n|128]+cs[n>>8&255]+"-"+cs[n>>16&255]+cs[n>>24&255]+cs[255&s]+cs[s>>8&255]+cs[s>>16&255]+cs[s>>24&255]).toLowerCase()}function ys(e,t,n){return Math.max(t,Math.min(n,e))}function gs(e,t){return(e%t+t)%t}function fs(e,t,n){return(1-n)*e+n*t}function xs(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function bs(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const vs={DEG2RAD:ds,RAD2DEG:ps,generateUUID:ms,clamp:ys,euclideanModulo:gs,mapLinear:function(e,t,n,s,o){return s+(e-t)*(o-s)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:fs,damp:function(e,t,n,s){return fs(e,t,1-Math.exp(-n*s))},pingpong:function(e,t=1){return t-Math.abs(gs(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(us=e);let t=us+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*ds},radToDeg:function(e){return e*ps},isPowerOfTwo:function(e){return!(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,s,o){const l=Math.cos,d=Math.sin,i=l(n/2),a=d(n/2),r=l((t+s)/2),c=d((t+s)/2),u=l((t-s)/2),h=d((t-s)/2),m=l((s-t)/2),f=d((s-t)/2);switch(o){case"XYX":e.set(i*c,a*u,a*h,i*r);break;case"YZY":e.set(a*h,i*c,a*u,i*r);break;case"ZXZ":e.set(a*u,a*h,i*c,i*r);break;case"XZX":e.set(i*c,a*f,a*m,i*r);break;case"YXY":e.set(a*m,i*c,a*f,i*r);break;case"ZYZ":e.set(a*f,a*m,i*c,i*r);break;default:ns("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}},normalize:bs,denormalize:xs};class ws{constructor(e=0,t=0){ws.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,s=this.y,t=e.elements;return this.x=t[0]*n+t[3]*s+t[6],this.y=t[1]*n+t[4]*s+t[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=ys(this.x,e.x,t.x),this.y=ys(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=ys(this.x,e,t),this.y=ys(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ys(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ys(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),o=this.x-e.x,i=this.y-e.y;return this.x=o*n-i*s+e.x,this.y=o*s+i*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ms{constructor(e=0,t=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=s}static slerpFlat(e,t,n,s,o,i,a){let r=n[s+0],c=n[s+1],l=n[s+2],d=n[s+3],u=o[i+0],h=o[i+1],m=o[i+2],f=o[i+3];if(d!==f||r!==u||c!==h||l!==m){let t=r*u+c*h+l*m+d*f;t<0&&(u=-u,h=-h,m=-m,f=-f,t=-t);let e=1-a;if(t<.9995){const n=Math.acos(t),s=Math.sin(n);e=Math.sin(e*n)/s,r=r*e+u*(a=Math.sin(a*n)/s),c=c*e+h*a,l=l*e+m*a,d=d*e+f*a}else{r=r*e+u*a,c=c*e+h*a,l=l*e+m*a,d=d*e+f*a;const t=1/Math.sqrt(r*r+c*c+l*l+d*d);r*=t,c*=t,l*=t,d*=t}}e[t]=r,e[t+1]=c,e[t+2]=l,e[t+3]=d}static multiplyQuaternionsFlat(e,t,n,s,o,i){const a=n[s],r=n[s+1],c=n[s+2],l=n[s+3],d=o[i],u=o[i+1],h=o[i+2],m=o[i+3];return e[t]=a*m+l*d+r*h-c*u,e[t+1]=r*m+l*u+c*d-a*h,e[t+2]=c*m+l*h+a*u-r*d,e[t+3]=l*m-a*d-r*u-c*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const d=e._x,u=e._y,h=e._z,m=e._order,c=Math.cos,l=Math.sin,n=c(d/2),s=c(u/2),o=c(h/2),i=l(d/2),a=l(u/2),r=l(h/2);switch(m){case"XYZ":this._x=i*s*o+n*a*r,this._y=n*a*o-i*s*r,this._z=n*s*r+i*a*o,this._w=n*s*o-i*a*r;break;case"YXZ":this._x=i*s*o+n*a*r,this._y=n*a*o-i*s*r,this._z=n*s*r-i*a*o,this._w=n*s*o+i*a*r;break;case"ZXY":this._x=i*s*o-n*a*r,this._y=n*a*o+i*s*r,this._z=n*s*r+i*a*o,this._w=n*s*o-i*a*r;break;case"ZYX":this._x=i*s*o-n*a*r,this._y=n*a*o+i*s*r,this._z=n*s*r-i*a*o,this._w=n*s*o+i*a*r;break;case"YZX":this._x=i*s*o+n*a*r,this._y=n*a*o+i*s*r,this._z=n*s*r-i*a*o,this._w=n*s*o-i*a*r;break;case"XZY":this._x=i*s*o-n*a*r,this._y=n*a*o-i*s*r,this._z=n*s*r+i*a*o,this._w=n*s*o+i*a*r;break;default:ns("Quaternion: .setFromEuler() encountered an unknown order: "+m)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const s=t/2,n=Math.sin(s);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],a=t[8],r=t[1],s=t[5],c=t[9],l=t[2],d=t[6],o=t[10],u=n+s+o;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(d-c)*e,this._y=(a-l)*e,this._z=(r-i)*e}else if(n>s&&n>o){const e=2*Math.sqrt(1+n-s-o);this._w=(d-c)/e,this._x=.25*e,this._y=(i+r)/e,this._z=(a+l)/e}else if(s>o){const e=2*Math.sqrt(1+s-n-o);this._w=(a-l)/e,this._x=(i+r)/e,this._y=.25*e,this._z=(c+d)/e}else{const e=2*Math.sqrt(1+o-n-s);this._w=(r-i)/e,this._x=(a+l)/e,this._y=(c+d)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ys(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,s=e._y,o=e._z,i=e._w,a=t._x,r=t._y,c=t._z,l=t._w;return this._x=n*l+i*a+s*c-o*r,this._y=s*l+i*r+o*a-n*c,this._z=o*l+i*c+n*r-s*a,this._w=i*l-n*a-s*r-o*c,this._onChangeCallback(),this}slerp(e,t){let o=e._x,i=e._y,a=e._z,r=e._w,s=this.dot(e);s<0&&(o=-o,i=-i,a=-a,r=-r,s=-s);let n=1-t;if(s<.9995){const e=Math.acos(s),c=Math.sin(e);n=Math.sin(n*e)/c,t=Math.sin(t*e)/c,this._x=this._x*n+o*t,this._y=this._y*n+i*t,this._z=this._z*n+a*t,this._w=this._w*n+r*t,this._onChangeCallback()}else this._x=this._x*n+o*t,this._y=this._y*n+i*t,this._z=this._z*n+a*t,this._w=this._w*n+r*t,this.normalize();return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),s=Math.sqrt(1-n),o=Math.sqrt(n);return this.set(s*Math.sin(e),s*Math.cos(e),o*Math.sin(t),o*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ss{constructor(e=0,t=0,n=0){Ss.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(As.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(As.setFromAxisAngle(e,t))}applyMatrix3(e){const n=this.x,s=this.y,o=this.z,t=e.elements;return this.x=t[0]*n+t[3]*s+t[6]*o,this.y=t[1]*n+t[4]*s+t[7]*o,this.z=t[2]*n+t[5]*s+t[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,s=this.y,o=this.z,t=e.elements,i=1/(t[3]*n+t[7]*s+t[11]*o+t[15]);return this.x=(t[0]*n+t[4]*s+t[8]*o+t[12])*i,this.y=(t[1]*n+t[5]*s+t[9]*o+t[13])*i,this.z=(t[2]*n+t[6]*s+t[10]*o+t[14])*i,this}applyQuaternion(e){const o=this.x,i=this.y,a=this.z,t=e.x,n=e.y,s=e.z,r=e.w,c=2*(n*a-s*i),l=2*(s*o-t*a),d=2*(t*i-n*o);return this.x=o+r*c+n*d-s*l,this.y=i+r*l+s*c-t*d,this.z=a+r*d+t*l-n*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,s=this.y,o=this.z,t=e.elements;return this.x=t[0]*n+t[4]*s+t[8]*o,this.y=t[1]*n+t[5]*s+t[9]*o,this.z=t[2]*n+t[6]*s+t[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=ys(this.x,e.x,t.x),this.y=ys(this.y,e.y,t.y),this.z=ys(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=ys(this.x,e,t),this.y=ys(this.y,e,t),this.z=ys(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ys(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,s=e.y,o=e.z,i=t.x,a=t.y,r=t.z;return this.x=s*r-o*a,this.y=o*i-n*r,this.z=n*a-s*i,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return _s.copy(this).projectOnVector(e),this.sub(_s)}reflect(e){return this.sub(_s.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ys(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _s=new Ss,As=new Ms;class Ts{constructor(e,t,n,s,o,i,a,r,c){Ts.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,s,o,i,a,r,c)}set(e,t,n,s,o,i,a,r,c){const l=this.elements;return l[0]=e,l[1]=s,l[2]=a,l[3]=t,l[4]=o,l[5]=r,l[6]=n,l[7]=i,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,o=this.elements,i=n[0],a=n[3],r=n[6],c=n[1],l=n[4],d=n[7],u=n[2],h=n[5],m=n[8],f=s[0],p=s[3],g=s[6],v=s[1],b=s[4],j=s[7],y=s[2],_=s[5],w=s[8];return o[0]=i*f+a*v+r*y,o[3]=i*p+a*b+r*_,o[6]=i*g+a*j+r*w,o[1]=c*f+l*v+d*y,o[4]=c*p+l*b+d*_,o[7]=c*g+l*j+d*w,o[2]=u*f+h*v+m*y,o[5]=u*p+h*b+m*_,o[8]=u*g+h*j+m*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],o=e[3],i=e[4],a=e[5],r=e[6],c=e[7],l=e[8];return t*i*l-t*a*c-n*o*l+n*a*r+s*o*c-s*i*r}invert(){const e=this.elements,n=e[0],s=e[1],o=e[2],d=e[3],a=e[4],i=e[5],r=e[6],c=e[7],l=e[8],u=l*a-i*c,h=i*r-l*d,m=c*d-a*r,f=n*u+s*h+o*m;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const t=1/f;return e[0]=u*t,e[1]=(o*c-l*s)*t,e[2]=(i*s-o*a)*t,e[3]=h*t,e[4]=(l*n-o*r)*t,e[5]=(o*d-i*n)*t,e[6]=m*t,e[7]=(s*r-c*n)*t,e[8]=(a*n-s*d)*t,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,o,i,a){const r=Math.cos(o),c=Math.sin(o);return this.set(n*r,n*c,-n*(r*i+c*a)+i+e,-s*c,s*r,-s*(-c*i+r*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(zs.makeScale(e,t)),this}rotate(e){return this.premultiply(zs.makeRotation(-e)),this}translate(e,t){return this.premultiply(zs.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const zs=new Ts,Cs=(new Ts).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Is=(new Ts).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Bs(){const e={enabled:!0,workingColorSpace:ei,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===si&&(e.r=Os(e.r),e.g=Os(e.g),e.b=Os(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===si&&(e.r=Ps(e.r),e.g=Ps(e.g),e.b=Ps(e.b)),e):e},workingToColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},colorSpaceToWorking:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return""===e?ii:this.spaces[e].transfer},getToneMappingMode:function(e){return this.spaces[e].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(t,n){return os("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),e.workingToColorSpace(t,n)},toWorkingColorSpace:function(t,n){return os("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),e.colorSpaceToWorking(t,n)}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],s=[.3127,.329];return e.define({[ei]:{primaries:t,whitePoint:s,transfer:ii,toXYZ:Cs,fromXYZ:Is,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:ti},outputColorSpaceConfig:{drawingBufferColorSpace:ti}},[ti]:{primaries:t,whitePoint:s,transfer:si,toXYZ:Cs,fromXYZ:Is,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:ti}}}),e}const ks=Bs();function Os(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ps(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let Rs;class Ns{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{void 0===Rs&&(Rs=Qi("canvas")),Rs.width=e.width,Rs.height=e.height;const t=Rs.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),n=Rs}return n.toDataURL(t)}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Qi("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const o=n.getImageData(0,0,e.width,e.height),s=o.data;for(let e=0;e<s.length;e++)s[e]=255*Os(s[e]/255);return n.putImageData(o,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Os(t[e]/255)):t[e]=Os(t[e]);return{data:t,width:e.width,height:e.height}}return ns("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Vs=0;class Fs{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Vs++}),this.uuid=ms(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):"undefined"!=typeof VideoFrame&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):null!==t?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const s=void 0===e||"string"==typeof e;if(!s&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},t=this.data;if(null!==t){let e;if(Array.isArray(t)){e=[];for(let n=0,s=t.length;n<s;n++)t[n].isDataTexture?e.push(Es(t[n].image)):e.push(Es(t[n]))}else e=Es(t);n.url=e}return s||(e.images[this.uuid]=n),n}}function Es(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Ns.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(ns("Texture: Unable to serialize Texture."),{})}let Ls=0;const js=new Ss;class Ds extends ls{constructor(e=Ds.DEFAULT_IMAGE,t=Ds.DEFAULT_MAPPING,n=1001,s=1001,o=1006,i=1008,a=1023,r=1009,c=Ds.DEFAULT_ANISOTROPY,l=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Ls++}),this.uuid=ms(),this.name="",this.source=new Fs(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=o,this.minFilter=i,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=r,this.offset=new ws(0,0),this.repeat=new ws(1,1),this.center=new ws(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ts,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(js).x}get height(){return this.source.getSize(js).y}get depth(){return this.source.getSize(js).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const s in e){const t=e[s];if(void 0===t){ns(`Texture.setValues(): parameter '${s}' has value of undefined.`);continue}const n=this[s];void 0!==n?n&&t&&n.isVector2&&t.isVector2||n&&t&&n.isVector3&&t.isVector3||n&&t&&n.isMatrix3&&t.isMatrix3?n.copy(t):this[s]=t:ns(`Texture.setValues(): property '${s}' does not exist.`)}}toJSON(e){const n=void 0===e||"string"==typeof e;if(!n&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const t={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(t.userData=this.userData),n||(e.textures[this.uuid]=t),t}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ht)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case mt:e.x=e.x-Math.floor(e.x);break;case yt:e.x=e.x<0?0:1;break;case gt:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case mt:e.y=e.y-Math.floor(e.y);break;case yt:e.y=e.y<0?0:1;break;case gt:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}Ds.DEFAULT_IMAGE=null,Ds.DEFAULT_MAPPING=ht,Ds.DEFAULT_ANISOTROPY=1;class Us{constructor(e=0,t=0,n=0,s=1){Us.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,s=this.y,o=this.z,i=this.w,t=e.elements;return this.x=t[0]*n+t[4]*s+t[8]*o+t[12]*i,this.y=t[1]*n+t[5]*s+t[9]*o+t[13]*i,this.z=t[2]*n+t[6]*s+t[10]*o+t[14]*i,this.w=t[3]*n+t[7]*s+t[11]*o+t[15]*i,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let v,n,s,o;const a=.01,m=.1,t=e.elements,f=t[0],i=t[4],r=t[8],c=t[1],p=t[5],l=t[9],d=t[2],u=t[6],g=t[10];if(Math.abs(i-c)<a&&Math.abs(r-d)<a&&Math.abs(l-u)<a){if(Math.abs(i+c)<m&&Math.abs(r+d)<m&&Math.abs(l+u)<m&&Math.abs(f+p+g-3)<m)return this.set(1,0,0,0),this;v=Math.PI;const e=(f+1)/2,t=(p+1)/2,h=(g+1)/2,b=(i+c)/4,j=(r+d)/4,y=(l+u)/4;return e>t&&e>h?e<a?(n=0,s=.707106781,o=.707106781):(n=Math.sqrt(e),s=b/n,o=j/n):t>h?t<a?(n=.707106781,s=0,o=.707106781):(s=Math.sqrt(t),n=b/s,o=y/s):h<a?(n=.707106781,s=.707106781,o=0):(o=Math.sqrt(h),n=j/o,s=y/o),this.set(n,s,o,v),this}let h=Math.sqrt((u-l)*(u-l)+(r-d)*(r-d)+(c-i)*(c-i));return Math.abs(h)<.001&&(h=1),this.x=(u-l)/h,this.y=(r-d)/h,this.z=(c-i)/h,this.w=Math.acos((f+p+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=ys(this.x,e.x,t.x),this.y=ys(this.y,e.y,t.y),this.z=ys(this.z,e.z,t.z),this.w=ys(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=ys(this.x,e,t),this.y=ys(this.y,e,t),this.z=ys(this.z,e,t),this.w=ys(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ys(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ws extends ls{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Mt,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new Us(0,0,e,t),this.scissorTest=!1,this.viewport=new Us(0,0,e,t);const s={width:e,height:t,depth:n.depth},o=new Ds(s);this.textures=[];const i=n.count;for(let e=0;e<i;e++)this.textures[e]=o.clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:Mt,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==e.mapping&&(t.mapping=e.mapping),void 0!==e.wrapS&&(t.wrapS=e.wrapS),void 0!==e.wrapT&&(t.wrapT=e.wrapT),void 0!==e.wrapR&&(t.wrapR=e.wrapR),void 0!==e.magFilter&&(t.magFilter=e.magFilter),void 0!==e.minFilter&&(t.minFilter=e.minFilter),void 0!==e.format&&(t.format=e.format),void 0!==e.type&&(t.type=e.type),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.colorSpace&&(t.colorSpace=e.colorSpace),void 0!==e.flipY&&(t.flipY=e.flipY),void 0!==e.generateMipmaps&&(t.generateMipmaps=e.generateMipmaps),void 0!==e.internalFormat&&(t.internalFormat=e.internalFormat);for(let e=0;e<this.textures.length;e++)this.textures[e].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let s=0,o=this.textures.length;s<o;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=n,!0!==this.textures[s].isData3DTexture&&(this.textures[s].isArrayTexture=this.textures[s].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const s=Object.assign({},e.textures[t].image);this.textures[t].source=new Fs(s)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class qs extends Ws{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Js extends Ds{constructor(e=null,t=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=ft,this.minFilter=ft,this.wrapR=yt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Xs extends qs{constructor(e=1,t=1,n=1,s={}){super(e,t,s),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Js(null,e,t,n),this._setTextureOptions(s),this.texture.isRenderTargetTexture=!0}}class Ys extends Ds{constructor(e=null,t=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=ft,this.minFilter=ft,this.wrapR=yt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Zs extends qs{constructor(e=1,t=1,n=1,s={}){super(e,t,s),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Ys(null,e,t,n),this._setTextureOptions(s),this.texture.isRenderTargetTexture=!0}}class Hs{constructor(e=new Ss(1/0,1/0,1/0),t=new Ss(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint($s.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint($s.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=$s.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const s=n.getAttribute("position");if(!0===t&&void 0!==s&&!0!==e.isInstancedMesh)for(let t=0,n=s.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,$s):$s.fromBufferAttribute(s,t),$s.applyMatrix4(e.matrixWorld),this.expandByPoint($s);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Qs.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Qs.copy(n.boundingBox)),Qs.applyMatrix4(e.matrixWorld),this.union(Qs)}const s=e.children;for(let e=0,n=s.length;e<n;e++)this.expandByObject(s[e],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,$s),$s.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(nr),ar.subVectors(this.max,nr),Ks.subVectors(e.a,nr),tr.subVectors(e.b,nr),er.subVectors(e.c,nr),ir.subVectors(tr,Ks),sr.subVectors(er,tr),rr.subVectors(Ks,er);let t=[0,-ir.z,ir.y,0,-sr.z,sr.y,0,-rr.z,rr.y,ir.z,0,-ir.x,sr.z,0,-sr.x,rr.z,0,-rr.x,-ir.y,ir.x,0,-sr.y,sr.x,0,-rr.y,rr.x,0];return!!lr(t,Ks,tr,er,ar)&&(t=[1,0,0,0,1,0,0,0,1],!!lr(t,Ks,tr,er,ar)&&(or.crossVectors(ir,sr),t=[or.x,or.y,or.z],lr(t,Ks,tr,er,ar)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,$s).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize($s).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Gs[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Gs[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Gs[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Gs[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Gs[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Gs[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Gs[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Gs[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Gs)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Gs=[new Ss,new Ss,new Ss,new Ss,new Ss,new Ss,new Ss,new Ss],$s=new Ss,Qs=new Hs,Ks=new Ss,tr=new Ss,er=new Ss,ir=new Ss,sr=new Ss,rr=new Ss,nr=new Ss,ar=new Ss,or=new Ss,hr=new Ss;function lr(e,t,n,s,o){for(let i=0,l=e.length-3;i<=l;i+=3){hr.fromArray(e,i);const d=o.x*Math.abs(hr.x)+o.y*Math.abs(hr.y)+o.z*Math.abs(hr.z),a=t.dot(hr),r=n.dot(hr),c=s.dot(hr);if(Math.max(-Math.max(a,r,c),Math.min(a,r,c))>d)return!1}return!0}const cr=new Hs,ur=new Ss,dr=new Ss;class pr{constructor(e=new Ss,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):cr.setFromPoints(e).getCenter(n);let s=0;for(let t=0,o=e.length;t<o;t++)s=Math.max(s,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ur.subVectors(e,this.center);const t=ur.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(ur,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(dr.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ur.copy(e.center).add(dr)),this.expandByPoint(ur.copy(e.center).sub(dr))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const mr=new Ss,yr=new Ss,gr=new Ss,fr=new Ss,xr=new Ss,br=new Ss,vr=new Ss;class wr{constructor(e=new Ss,t=new Ss(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,mr)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=mr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(mr.copy(this.origin).addScaledVector(this.direction,t),mr.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){yr.copy(e).add(t).multiplyScalar(.5),gr.copy(t).sub(e).normalize(),fr.copy(this.origin).sub(yr);const a=.5*e.distanceTo(t),r=-this.direction.dot(gr),l=fr.dot(this.direction),c=-fr.dot(gr),u=fr.lengthSq(),m=Math.abs(1-r*r);let i,o,d,h;if(m>0)if(i=r*c-l,o=r*l-c,h=a*m,i>=0)if(o>=-h)if(o<=h){const e=1/m;i*=e,o*=e,d=i*(i+r*o+2*l)+o*(r*i+o+2*c)+u}else o=a,i=Math.max(0,-(r*o+l)),d=-i*i+o*(o+2*c)+u;else o=-a,i=Math.max(0,-(r*o+l)),d=-i*i+o*(o+2*c)+u;else o<=-h?(i=Math.max(0,-(-r*a+l)),o=i>0?-a:Math.min(Math.max(-a,-c),a),d=-i*i+o*(o+2*c)+u):o<=h?(i=0,o=Math.min(Math.max(-a,-c),a),d=o*(o+2*c)+u):(i=Math.max(0,-(r*a+l)),o=i>0?a:Math.min(Math.max(-a,-c),a),d=-i*i+o*(o+2*c)+u);else o=r>0?-a:a,i=Math.max(0,-(r*o+l)),d=-i*i+o*(o+2*c)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,i),s&&s.copy(yr).addScaledVector(gr,o),d}intersectSphere(e,t){mr.subVectors(e.center,this.origin);const n=mr.dot(this.direction),s=mr.dot(mr)-n*n,o=e.radius*e.radius;if(s>o)return null;const i=Math.sqrt(o-s),a=n-i,r=n+i;return r<0?null:a<0?this.at(r,t):this.at(a,t)}intersectsSphere(e){return!(e.radius<0)&&this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,i,a,r,c;const l=1/this.direction.x,d=1/this.direction.y,u=1/this.direction.z,o=this.origin;return l>=0?(n=(e.min.x-o.x)*l,s=(e.max.x-o.x)*l):(n=(e.max.x-o.x)*l,s=(e.min.x-o.x)*l),d>=0?(i=(e.min.y-o.y)*d,a=(e.max.y-o.y)*d):(i=(e.max.y-o.y)*d,a=(e.min.y-o.y)*d),n>a||i>s?null:((i>n||isNaN(n))&&(n=i),(a<s||isNaN(s))&&(s=a),u>=0?(r=(e.min.z-o.z)*u,c=(e.max.z-o.z)*u):(r=(e.max.z-o.z)*u,c=(e.min.z-o.z)*u),n>c||r>s?null:((r>n||n!=n)&&(n=r),(c<s||s!=s)&&(s=c),s<0?null:this.at(n>=0?n:s,t)))}intersectsBox(e){return null!==this.intersectBox(e,mr)}intersectTriangle(e,t,n,s,o){xr.subVectors(t,e),br.subVectors(n,e),vr.crossVectors(xr,br);let a,i=this.direction.dot(vr);if(i>0){if(s)return null;a=1}else{if(!(i<0))return null;a=-1,i=-i}fr.subVectors(this.origin,e);const r=a*this.direction.dot(br.crossVectors(fr,br));if(r<0)return null;const c=a*this.direction.dot(xr.cross(fr));if(c<0)return null;if(r+c>i)return null;const l=-a*fr.dot(vr);return l<0?null:this.at(l/i,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Mr{constructor(e,t,n,s,o,i,a,r,c,l,d,u,h,m,f,p){Mr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,s,o,i,a,r,c,l,d,u,h,m,f,p)}set(e,t,n,s,o,i,a,r,c,l,d,u,h,m,f,p){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=s,g[1]=o,g[5]=i,g[9]=a,g[13]=r,g[2]=c,g[6]=l,g[10]=d,g[14]=u,g[3]=h,g[7]=m,g[11]=f,g[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Mr).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return 0===this.determinant()?(e.set(1,0,0),t.set(0,1,0),n.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this)}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){if(0===e.determinant())return this.identity();const t=this.elements,n=e.elements,s=1/Sr.setFromMatrixColumn(e,0).length(),o=1/Sr.setFromMatrixColumn(e,1).length(),i=1/Sr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*o,t[5]=n[5]*o,t[6]=n[6]*o,t[7]=0,t[8]=n[8]*i,t[9]=n[9]*i,t[10]=n[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,c=e.x,l=e.y,d=e.z,i=Math.cos(c),n=Math.sin(c),a=Math.cos(l),s=Math.sin(l),r=Math.cos(d),o=Math.sin(d);if("XYZ"===e.order){const e=i*r,c=i*o,l=n*r,d=n*o;t[0]=a*r,t[4]=-a*o,t[8]=s,t[1]=c+l*s,t[5]=e-d*s,t[9]=-n*a,t[2]=d-e*s,t[6]=l+c*s,t[10]=i*a}else if("YXZ"===e.order){const e=a*r,c=a*o,l=s*r,d=s*o;t[0]=e+d*n,t[4]=l*n-c,t[8]=i*s,t[1]=i*o,t[5]=i*r,t[9]=-n,t[2]=c*n-l,t[6]=d+e*n,t[10]=i*a}else if("ZXY"===e.order){const e=a*r,c=a*o,l=s*r,d=s*o;t[0]=e-d*n,t[4]=-i*o,t[8]=l+c*n,t[1]=c+l*n,t[5]=i*r,t[9]=d-e*n,t[2]=-i*s,t[6]=n,t[10]=i*a}else if("ZYX"===e.order){const e=i*r,c=i*o,l=n*r,d=n*o;t[0]=a*r,t[4]=l*s-c,t[8]=e*s+d,t[1]=a*o,t[5]=d*s+e,t[9]=c*s-l,t[2]=-s,t[6]=n*a,t[10]=i*a}else if("YZX"===e.order){const e=i*a,c=i*s,l=n*a,d=n*s;t[0]=a*r,t[4]=d-e*o,t[8]=l*o+c,t[1]=o,t[5]=i*r,t[9]=-n*r,t[2]=-s*r,t[6]=c*o+l,t[10]=e-d*o}else if("XZY"===e.order){const e=i*a,c=i*s,l=n*a,d=n*s;t[0]=a*r,t[4]=-o,t[8]=s*r,t[1]=e*o+d,t[5]=i*r,t[9]=c*o-l,t[2]=l*o-c,t[6]=n*r,t[10]=d*o+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Ar,e,Tr)}lookAt(e,t,n){const s=this.elements;return Ir.subVectors(e,t),0===Ir.lengthSq()&&(Ir.z=1),Ir.normalize(),zr.crossVectors(n,Ir),0===zr.lengthSq()&&(1===Math.abs(n.z)?Ir.x+=1e-4:Ir.z+=1e-4,Ir.normalize(),zr.crossVectors(n,Ir)),zr.normalize(),Cr.crossVectors(Ir,zr),s[0]=zr.x,s[4]=Cr.x,s[8]=Ir.x,s[1]=zr.y,s[5]=Cr.y,s[9]=Ir.y,s[2]=zr.z,s[6]=Cr.z,s[10]=Ir.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,o=this.elements,i=n[0],a=n[4],r=n[8],c=n[12],l=n[1],d=n[5],u=n[9],h=n[13],m=n[2],f=n[6],p=n[10],g=n[14],v=n[3],b=n[7],j=n[11],y=n[15],_=s[0],w=s[4],O=s[8],x=s[12],C=s[1],E=s[5],k=s[9],A=s[13],S=s[2],M=s[6],F=s[10],T=s[14],z=s[3],D=s[7],N=s[11],L=s[15];return o[0]=i*_+a*C+r*S+c*z,o[4]=i*w+a*E+r*M+c*D,o[8]=i*O+a*k+r*F+c*N,o[12]=i*x+a*A+r*T+c*L,o[1]=l*_+d*C+u*S+h*z,o[5]=l*w+d*E+u*M+h*D,o[9]=l*O+d*k+u*F+h*N,o[13]=l*x+d*A+u*T+h*L,o[2]=m*_+f*C+p*S+g*z,o[6]=m*w+f*E+p*M+g*D,o[10]=m*O+f*k+p*F+g*N,o[14]=m*x+f*A+p*T+g*L,o[3]=v*_+b*C+j*S+y*z,o[7]=v*w+b*E+j*M+y*D,o[11]=v*O+b*k+j*F+y*N,o[15]=v*x+b*A+j*T+y*L,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,y=e[0],_=e[4],j=e[8],w=e[12],i=e[1],a=e[5],r=e[9],c=e[13],n=e[2],t=e[6],o=e[10],s=e[14],l=e[3],h=e[7],u=e[11],d=e[15],m=r*s-c*o,p=a*s-c*t,g=a*o-r*t,v=i*s-c*n,b=i*o-r*n,f=i*t-a*n;return y*(h*m-u*p+d*g)-_*(l*m-u*v+d*b)+j*(l*p-h*v+d*f)-w*(l*g-h*b+u*f)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){const e=this.elements,a=e[0],f=e[1],v=e[2],g=e[3],i=e[4],s=e[5],r=e[6],c=e[7],l=e[8],d=e[9],u=e[10],h=e[11],m=e[12],n=e[13],p=e[14],o=e[15],S=a*s-f*i,O=a*r-v*i,j=a*c-g*i,y=f*r-v*s,_=f*c-g*s,w=v*c-g*r,b=l*n-d*m,x=l*p-u*m,k=l*o-h*m,E=d*p-u*n,C=d*o-h*n,A=u*o-h*p,M=S*A-O*C+j*E+y*k-_*x+w*b;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const t=1/M;return e[0]=(s*A-r*C+c*E)*t,e[1]=(v*C-f*A-g*E)*t,e[2]=(n*w-p*_+o*y)*t,e[3]=(u*_-d*w-h*y)*t,e[4]=(r*k-i*A-c*x)*t,e[5]=(a*A-v*k+g*x)*t,e[6]=(p*j-m*w-o*O)*t,e[7]=(l*w-u*j+h*O)*t,e[8]=(i*C-s*k+c*b)*t,e[9]=(f*k-a*C-g*b)*t,e[10]=(m*_-n*j+o*S)*t,e[11]=(d*j-l*_-h*S)*t,e[12]=(s*x-i*E-r*b)*t,e[13]=(a*E-f*x+v*b)*t,e[14]=(n*O-m*y-p*S)*t,e[15]=(l*y-d*O+u*S)*t,this}scale(e){const t=this.elements,n=e.x,s=e.y,o=e.z;return t[0]*=n,t[4]*=s,t[8]*=o,t[1]*=n,t[5]*=s,t[9]*=o,t[2]*=n,t[6]*=s,t[10]*=o,t[3]*=n,t[7]*=s,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const a=Math.cos(t),s=Math.sin(t),c=1-a,r=e.x,o=e.y,n=e.z,i=c*r,l=c*o;return this.set(i*r+a,i*o-s*n,i*n+s*o,0,i*o+s*n,l*o+a,l*n-s*r,0,i*n-s*o,l*n+s*r,c*n*n+a,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,s,o,i){return this.set(1,n,o,0,e,1,i,0,t,s,1,0,0,0,0,1),this}compose(e,t,n){const s=this.elements,o=t._x,i=t._y,r=t._z,c=t._w,w=o+o,d=i+i,a=r+r,_=o*w,y=o*d,m=o*a,f=i*d,p=i*a,g=r*a,v=c*w,b=c*d,j=c*a,h=n.x,u=n.y,l=n.z;return s[0]=(1-(f+g))*h,s[1]=(y+j)*h,s[2]=(m-b)*h,s[3]=0,s[4]=(y-j)*u,s[5]=(1-(_+g))*u,s[6]=(p+v)*u,s[7]=0,s[8]=(m+b)*l,s[9]=(p-v)*l,s[10]=(1-(_+f))*l,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){const s=this.elements;e.x=s[12],e.y=s[13],e.z=s[14];const c=this.determinant();if(0===c)return n.set(1,1,1),t.identity(),this;let o=Sr.set(s[0],s[1],s[2]).length();const l=Sr.set(s[4],s[5],s[6]).length(),d=Sr.set(s[8],s[9],s[10]).length();c<0&&(o=-o),_r.copy(this);const i=1/o,a=1/l,r=1/d;return _r.elements[0]*=i,_r.elements[1]*=i,_r.elements[2]*=i,_r.elements[4]*=a,_r.elements[5]*=a,_r.elements[6]*=a,_r.elements[8]*=r,_r.elements[9]*=r,_r.elements[10]*=r,t.setFromRotationMatrix(_r),n.x=o,n.y=l,n.z=d,this}makePerspective(e,t,n,s,o,i,a=2e3,r=!1){const c=this.elements,u=2*o/(t-e),h=2*o/(n-s),m=(t+e)/(t-e),f=(n+s)/(n-s);let l,d;if(r)l=o/(i-o),d=i*o/(i-o);else if(a===Ui)l=-(i+o)/(i-o),d=-2*i*o/(i-o);else{if(a!==Wi)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);l=-i/(i-o),d=-i*o/(i-o)}return c[0]=u,c[4]=0,c[8]=m,c[12]=0,c[1]=0,c[5]=h,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=l,c[14]=d,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,n,s,o,i,a=2e3,r=!1){const c=this.elements,u=2/(t-e),h=2/(n-s),m=-(t+e)/(t-e),f=-(n+s)/(n-s);let l,d;if(r)l=1/(i-o),d=i/(i-o);else if(a===Ui)l=-2/(i-o),d=-(i+o)/(i-o);else{if(a!==Wi)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);l=-1/(i-o),d=-o/(i-o)}return c[0]=u,c[4]=0,c[8]=0,c[12]=m,c[1]=0,c[5]=h,c[9]=0,c[13]=f,c[2]=0,c[6]=0,c[10]=l,c[14]=d,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Sr=new Ss,_r=new Mr,Ar=new Ss(0,0,0),Tr=new Ss(1,1,1),zr=new Ss,Cr=new Ss,Ir=new Ss,Br=new Mr,kr=new Ms;class Or{constructor(e=0,t=0,n=0,s=Or.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s=this._order){return this._x=e,this._y=t,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const s=e.elements,o=s[0],r=s[4],c=s[8],l=s[1],i=s[5],d=s[9],u=s[2],h=s[6],a=s[10];switch(t){case"XYZ":this._y=Math.asin(ys(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,a),this._z=Math.atan2(-r,o)):(this._x=Math.atan2(h,i),this._z=0);break;case"YXZ":this._x=Math.asin(-ys(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(c,a),this._z=Math.atan2(l,i)):(this._y=Math.atan2(-u,o),this._z=0);break;case"ZXY":this._x=Math.asin(ys(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,a),this._z=Math.atan2(-r,i)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-ys(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,a),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-r,i));break;case"YZX":this._z=Math.asin(ys(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,i),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(c,a));break;case"XZY":this._z=Math.asin(-ys(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(h,i),this._y=Math.atan2(c,o)):(this._x=Math.atan2(-d,a),this._y=0);break;default:ns("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Br.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Br,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return kr.setFromEuler(this),this.setFromQuaternion(kr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Or.DEFAULT_ORDER="XYZ";class Pr{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let Rr=0;const Nr=new Ss,Vr=new Ms,Fr=new Mr,Er=new Ss,Lr=new Ss,jr=new Ss,Dr=new Ms,Ur=new Ss(1,0,0),Wr=new Ss(0,1,0),qr=new Ss(0,0,1),Jr={type:"added"},Xr={type:"removed"},Yr={type:"childadded",child:null},Zr={type:"childremoved",child:null};class Hr extends ls{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Rr++}),this.uuid=ms(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Hr.DEFAULT_UP.clone();const n=new Ss,e=new Or,t=new Ms,s=new Ss(1,1,1);e._onChange(function(){t.setFromEuler(e,!1)}),t._onChange(function(){e.setFromQuaternion(t,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:n},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:t},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Mr},normalMatrix:{value:new Ts}}),this.matrix=new Mr,this.matrixWorld=new Mr,this.matrixAutoUpdate=Hr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Hr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Pr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Vr.setFromAxisAngle(e,t),this.quaternion.multiply(Vr),this}rotateOnWorldAxis(e,t){return Vr.setFromAxisAngle(e,t),this.quaternion.premultiply(Vr),this}rotateX(e){return this.rotateOnAxis(Ur,e)}rotateY(e){return this.rotateOnAxis(Wr,e)}rotateZ(e){return this.rotateOnAxis(qr,e)}translateOnAxis(e,t){return Nr.copy(e).applyQuaternion(this.quaternion),this.position.add(Nr.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ur,e)}translateY(e){return this.translateOnAxis(Wr,e)}translateZ(e){return this.translateOnAxis(qr,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Fr.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Er.copy(e):Er.set(e,t,n);const s=this.parent;this.updateWorldMatrix(!0,!1),Lr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Fr.lookAt(Lr,Er,this.up):Fr.lookAt(Er,Lr,this.up),this.quaternion.setFromRotationMatrix(Fr),s&&(Fr.extractRotation(s.matrixWorld),Vr.setFromRotationMatrix(Fr),this.quaternion.premultiply(Vr.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(as("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Jr),Yr.child=e,this.dispatchEvent(Yr),Yr.child=null):as("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Xr),Zr.child=e,this.dispatchEvent(Zr),Zr.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Fr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Fr.multiply(e.parent.matrixWorld)),e.applyMatrix4(Fr),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Jr),Yr.child=e,this.dispatchEvent(Yr),Yr.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,o=this.children.length;n<o;n++){const s=this.children[n].getObjectByProperty(e,t);if(void 0!==s)return s}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const s=this.children;for(let o=0,i=s.length;o<i;o++)s[o].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Lr,e,jr),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Lr,Dr,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const i=void 0===e||"string"==typeof e,n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const t={};function o(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),!0===this.castShadow&&(t.castShadow=!0),!0===this.receiveShadow&&(t.receiveShadow=!0),!1===this.visible&&(t.visible=!1),!1===this.frustumCulled&&(t.frustumCulled=!1),0!==this.renderOrder&&(t.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(t.userData=this.userData),t.layers=this.layers.mask,t.matrix=this.matrix.toArray(),t.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(t.matrixAutoUpdate=!1),this.isInstancedMesh&&(t.type="InstancedMesh",t.count=this.count,t.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(t.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(t.type="BatchedMesh",t.perObjectFrustumCulled=this.perObjectFrustumCulled,t.sortObjects=this.sortObjects,t.drawRanges=this._drawRanges,t.reservedRanges=this._reservedRanges,t.geometryInfo=this._geometryInfo.map(e=>({...e,boundingBox:e.boundingBox?e.boundingBox.toJSON():void 0,boundingSphere:e.boundingSphere?e.boundingSphere.toJSON():void 0})),t.instanceInfo=this._instanceInfo.map(e=>({...e})),t.availableInstanceIds=this._availableInstanceIds.slice(),t.availableGeometryIds=this._availableGeometryIds.slice(),t.nextIndexStart=this._nextIndexStart,t.nextVertexStart=this._nextVertexStart,t.geometryCount=this._geometryCount,t.maxInstanceCount=this._maxInstanceCount,t.maxVertexCount=this._maxVertexCount,t.maxIndexCount=this._maxIndexCount,t.geometryInitialized=this._geometryInitialized,t.matricesTexture=this._matricesTexture.toJSON(e),t.indirectTexture=this._indirectTexture.toJSON(e),null!==this._colorsTexture&&(t.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(t.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(t.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?t.background=this.background.toJSON():this.background.isTexture&&(t.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(t.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){t.geometry=o(e.geometries,this.geometry);const n=this.geometry.parameters;if(void 0!==n&&void 0!==n.shapes){const t=n.shapes;if(Array.isArray(t))for(let n=0,s=t.length;n<s;n++){const i=t[n];o(e.shapes,i)}else o(e.shapes,t)}}if(this.isSkinnedMesh&&(t.bindMode=this.bindMode,t.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(e.skeletons,this.skeleton),t.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const n=[];for(let t=0,s=this.material.length;t<s;t++)n.push(o(e.materials,this.material[t]));t.material=n}else t.material=o(e.materials,this.material);if(this.children.length>0){t.children=[];for(let n=0;n<this.children.length;n++)t.children.push(this.children[n].toJSON(e).object)}if(this.animations.length>0){t.animations=[];for(let n=0;n<this.animations.length;n++){const s=this.animations[n];t.animations.push(o(e.animations,s))}}if(i){const t=s(e.geometries),o=s(e.materials),i=s(e.textures),a=s(e.images),r=s(e.shapes),c=s(e.skeletons),l=s(e.animations),d=s(e.nodes);t.length>0&&(n.geometries=t),o.length>0&&(n.materials=o),i.length>0&&(n.textures=i),a.length>0&&(n.images=a),r.length>0&&(n.shapes=r),c.length>0&&(n.skeletons=c),l.length>0&&(n.animations=l),d.length>0&&(n.nodes=d)}return n.object=t,n;function s(e){const t=[];for(const s in e){const n=e[s];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}Hr.DEFAULT_UP=new Ss(0,1,0),Hr.DEFAULT_MATRIX_AUTO_UPDATE=!0,Hr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Gr=new Ss,$r=new Ss,Qr=new Ss,Kr=new Ss,tn=new Ss,en=new Ss,sn=new Ss,rn=new Ss,nn=new Ss,an=new Ss,on=new Us,hn=new Us,ln=new Us;class cn{constructor(e=new Ss,t=new Ss,n=new Ss){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,s){s.subVectors(n,t),Gr.subVectors(e,t),s.cross(Gr);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,t,n,s,o){Gr.subVectors(s,t),$r.subVectors(n,t),Qr.subVectors(e,t);const a=Gr.dot(Gr),i=Gr.dot($r),r=Gr.dot(Qr),c=$r.dot($r),l=$r.dot(Qr),d=a*c-i*i;if(0===d)return o.set(0,0,0),null;const u=1/d,h=(c*r-i*l)*u,m=(a*l-i*r)*u;return o.set(1-h-m,m,h)}static containsPoint(e,t,n,s){return null!==this.getBarycoord(e,t,n,s,Kr)&&Kr.x>=0&&Kr.y>=0&&Kr.x+Kr.y<=1}static getInterpolation(e,t,n,s,o,i,a,r){return null===this.getBarycoord(e,t,n,s,Kr)?(r.x=0,r.y=0,"z"in r&&(r.z=0),"w"in r&&(r.w=0),null):(r.setScalar(0),r.addScaledVector(o,Kr.x),r.addScaledVector(i,Kr.y),r.addScaledVector(a,Kr.z),r)}static getInterpolatedAttribute(e,t,n,s,o,i){return on.setScalar(0),hn.setScalar(0),ln.setScalar(0),on.fromBufferAttribute(e,t),hn.fromBufferAttribute(e,n),ln.fromBufferAttribute(e,s),i.setScalar(0),i.addScaledVector(on,o.x),i.addScaledVector(hn,o.y),i.addScaledVector(ln,o.z),i}static isFrontFacing(e,t,n,s){return Gr.subVectors(n,t),$r.subVectors(e,t),Gr.cross($r).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,n,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Gr.subVectors(this.c,this.b),$r.subVectors(this.a,this.b),.5*Gr.cross($r).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return cn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return cn.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,s,o){return cn.getInterpolation(e,this.a,this.b,this.c,t,n,s,o)}containsPoint(e){return cn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return cn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const o=this.a,d=this.b,h=this.c;let u,i;tn.subVectors(d,o),en.subVectors(h,o),rn.subVectors(e,o);const a=tn.dot(rn),r=en.dot(rn);if(a<=0&&r<=0)return t.copy(o);nn.subVectors(e,d);const n=tn.dot(nn),c=en.dot(nn);if(n>=0&&c<=n)return t.copy(d);const m=a*c-n*r;if(m<=0&&a>=0&&n<=0)return u=a/(a-n),t.copy(o).addScaledVector(tn,u);an.subVectors(e,h);const l=tn.dot(an),s=en.dot(an);if(s>=0&&l<=s)return t.copy(h);const f=l*r-a*s;if(f<=0&&r>=0&&s<=0)return i=r/(r-s),t.copy(o).addScaledVector(en,i);const p=n*s-l*c;if(p<=0&&c-n>=0&&l-s>=0)return sn.subVectors(h,d),i=(c-n)/(c-n+(l-s)),t.copy(d).addScaledVector(sn,i);const g=1/(p+f+m);return u=f*g,i=m*g,t.copy(o).addScaledVector(tn,u).addScaledVector(en,i)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const un={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},dn={h:0,s:0,l:0},pn={h:0,s:0,l:0};function mn(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class yn{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ti){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,ks.colorSpaceToWorking(this,t),this}setRGB(e,t,n,s=ks.workingColorSpace){return this.r=e,this.g=t,this.b=n,ks.colorSpaceToWorking(this,s),this}setHSL(e,t,n,s=ks.workingColorSpace){if(e=gs(e,1),t=ys(t,0,1),n=ys(n,0,1),0===t)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=mn(o,s,e+1/3),this.g=mn(o,s,e),this.b=mn(o,s,e-1/3)}return ks.colorSpaceToWorking(this,s),this}setStyle(e,t=ti){function s(t){void 0!==t&&parseFloat(t)<1&&ns("Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^)]*)\)/.exec(e)){let o;const a=n[1],i=n[2];switch(a){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return s(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return s(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return s(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:ns("Color: Unknown color model "+e)}}else if(n=/^#([A-Fa-f\d]+)$/.exec(e)){const s=n[1],o=s.length;if(3===o)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(6===o)return this.setHex(parseInt(s,16),t);ns("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ti){const n=un[e.toLowerCase()];return void 0!==n?this.setHex(n,t):ns("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Os(e.r),this.g=Os(e.g),this.b=Os(e.b),this}copyLinearToSRGB(e){return this.r=Ps(e.r),this.g=Ps(e.g),this.b=Ps(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ti){return ks.workingToColorSpace(gn.copy(this),e),65536*Math.round(ys(255*gn.r,0,255))+256*Math.round(ys(255*gn.g,0,255))+Math.round(ys(255*gn.b,0,255))}getHexString(e=ti){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ks.workingColorSpace){ks.workingToColorSpace(gn.copy(this),t);const a=gn.r,n=gn.g,s=gn.b,o=Math.max(a,n,s),r=Math.min(a,n,s);let i,c;const l=(r+o)/2;if(r===o)i=0,c=0;else{const e=o-r;switch(c=l<=.5?e/(o+r):e/(2-o-r),o){case a:i=(n-s)/e+(n<s?6:0);break;case n:i=(s-a)/e+2;break;case s:i=(a-n)/e+4}i/=6}return e.h=i,e.s=c,e.l=l,e}getRGB(e,t=ks.workingColorSpace){return ks.workingToColorSpace(gn.copy(this),t),e.r=gn.r,e.g=gn.g,e.b=gn.b,e}getStyle(e=ti){ks.workingToColorSpace(gn.copy(this),e);const t=gn.r,n=gn.g,s=gn.b;return e!==ti?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*s)})`}offsetHSL(e,t,n){return this.getHSL(dn),this.setHSL(dn.h+e,dn.s+t,dn.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(dn),e.getHSL(pn);const n=fs(dn.h,pn.h,t),s=fs(dn.s,pn.s,t),o=fs(dn.l,pn.l,t);return this.setHSL(n,s,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,s=this.g,o=this.b,t=e.elements;return this.r=t[0]*n+t[3]*s+t[6]*o,this.g=t[1]*n+t[4]*s+t[7]*o,this.b=t[2]*n+t[5]*s+t[8]*o,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const gn=new yn;yn.NAMES=un;let fn=0;class xn extends ls{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:fn++}),this.uuid=ms(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new yn(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hi,this.stencilZFail=hi,this.stencilZPass=hi,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const s in e){const n=e[s];if(void 0===n){ns(`Material: parameter '${s}' has value of undefined.`);continue}const t=this[s];void 0!==t?t&&t.isColor?t.set(n):t&&t.isVector3&&n&&n.isVector3?t.copy(n):this[s]=n:ns(`Material: '${s}' is not a property of THREE.${this.type}.`)}}toJSON(e){const n=void 0===e||"string"==typeof e;n&&(e={textures:{},images:{}});const t={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function s(e){const t=[];for(const s in e){const n=e[s];delete n.metadata,t.push(n)}return t}if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),this.color&&this.color.isColor&&(t.color=this.color.getHex()),void 0!==this.roughness&&(t.roughness=this.roughness),void 0!==this.metalness&&(t.metalness=this.metalness),void 0!==this.sheen&&(t.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(t.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(t.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(t.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(t.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(t.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(t.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(t.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(t.shininess=this.shininess),void 0!==this.clearcoat&&(t.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(t.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(t.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(t.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(t.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,t.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(t.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(t.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),void 0!==this.dispersion&&(t.dispersion=this.dispersion),void 0!==this.iridescence&&(t.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(t.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(t.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(t.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(t.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(t.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(t.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(t.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(t.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(t.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(t.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(t.lightMap=this.lightMap.toJSON(e).uuid,t.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(t.aoMap=this.aoMap.toJSON(e).uuid,t.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(t.bumpMap=this.bumpMap.toJSON(e).uuid,t.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(t.normalMap=this.normalMap.toJSON(e).uuid,t.normalMapType=this.normalMapType,t.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(t.displacementMap=this.displacementMap.toJSON(e).uuid,t.displacementScale=this.displacementScale,t.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(t.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(t.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(t.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(t.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(t.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(t.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(t.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(t.combine=this.combine)),void 0!==this.envMapRotation&&(t.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(t.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(t.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(t.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(t.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(t.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(t.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(t.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(t.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(t.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(t.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(t.size=this.size),null!==this.shadowSide&&(t.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(t.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(t.blending=this.blending),0!==this.side&&(t.side=this.side),!0===this.vertexColors&&(t.vertexColors=!0),this.opacity<1&&(t.opacity=this.opacity),!0===this.transparent&&(t.transparent=!0),204!==this.blendSrc&&(t.blendSrc=this.blendSrc),205!==this.blendDst&&(t.blendDst=this.blendDst),100!==this.blendEquation&&(t.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(t.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(t.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(t.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(t.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(t.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(t.depthFunc=this.depthFunc),!1===this.depthTest&&(t.depthTest=this.depthTest),!1===this.depthWrite&&(t.depthWrite=this.depthWrite),!1===this.colorWrite&&(t.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(t.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(t.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(t.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(t.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==hi&&(t.stencilFail=this.stencilFail),this.stencilZFail!==hi&&(t.stencilZFail=this.stencilZFail),this.stencilZPass!==hi&&(t.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(t.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(t.rotation=this.rotation),!0===this.polygonOffset&&(t.polygonOffset=!0),0!==this.polygonOffsetFactor&&(t.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(t.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(t.linewidth=this.linewidth),void 0!==this.dashSize&&(t.dashSize=this.dashSize),void 0!==this.gapSize&&(t.gapSize=this.gapSize),void 0!==this.scale&&(t.scale=this.scale),!0===this.dithering&&(t.dithering=!0),this.alphaTest>0&&(t.alphaTest=this.alphaTest),!0===this.alphaHash&&(t.alphaHash=!0),!0===this.alphaToCoverage&&(t.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(t.premultipliedAlpha=!0),!0===this.forceSinglePass&&(t.forceSinglePass=!0),!1===this.allowOverride&&(t.allowOverride=!1),!0===this.wireframe&&(t.wireframe=!0),this.wireframeLinewidth>1&&(t.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(t.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(t.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(t.flatShading=!0),!1===this.visible&&(t.visible=!1),!1===this.toneMapped&&(t.toneMapped=!1),!1===this.fog&&(t.fog=!1),Object.keys(this.userData).length>0&&(t.userData=this.userData),n){const n=s(e.textures),o=s(e.images);n.length>0&&(t.textures=n),o.length>0&&(t.images=o)}return t}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let s=0;s!==e;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class bn extends xn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new yn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Or,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const vn=wn();function wn(){const o=new ArrayBuffer(4),a=new Float32Array(o),r=new Uint32Array(o),e=new Uint32Array(512),t=new Uint32Array(512);for(let n=0;n<256;++n){const s=n-127;s<-27?(e[n]=0,e[256|n]=32768,t[n]=24,t[256|n]=24):s<-14?(e[n]=1024>>-s-14,e[256|n]=1024>>-s-14|32768,t[n]=-s-1,t[256|n]=-s-1):s<=15?(e[n]=s+15<<10,e[256|n]=s+15<<10|32768,t[n]=13,t[256|n]=13):s<128?(e[n]=31744,e[256|n]=64512,t[n]=24,t[256|n]=24):(e[n]=31744,e[256|n]=64512,t[n]=13,t[256|n]=13)}const s=new Uint32Array(2048),n=new Uint32Array(64),i=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;!(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,s[e]=t|n}for(let e=1024;e<2048;++e)s[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)n[e]=e<<23;n[31]=1199570944,n[32]=2147483648;for(let e=33;e<63;++e)n[e]=2147483648+(e-32<<23);n[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(i[e]=1024);return{floatView:a,uint32View:r,baseTable:e,shiftTable:t,mantissaTable:s,exponentTable:n,offsetTable:i}}function Mn(e){Math.abs(e)>65504&&ns("DataUtils.toHalfFloat(): Value out of range."),e=ys(e,-65504,65504),vn.floatView[0]=e;const t=vn.uint32View[0],n=t>>23&511;return vn.baseTable[n]+((8388607&t)>>vn.shiftTable[n])}function Sn(e){const t=e>>10;return vn.uint32View[0]=vn.mantissaTable[vn.offsetTable[t]+(1023&e)]+vn.exponentTable[t],vn.floatView[0]}class _n{static toHalfFloat(e){return Mn(e)}static fromHalfFloat(e){return Sn(e)}}const An=new Ss,Tn=new ws;let zn=0;class Cn{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:zn++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=ki,this.updateRanges=[],this.gpuType=Pt,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let s=0,o=this.itemSize;s<o;s++)this.array[e+s]=t.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Tn.fromBufferAttribute(this,t),Tn.applyMatrix3(e),this.setXY(t,Tn.x,Tn.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)An.fromBufferAttribute(this,t),An.applyMatrix3(e),this.setXYZ(t,An.x,An.y,An.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)An.fromBufferAttribute(this,t),An.applyMatrix4(e),this.setXYZ(t,An.x,An.y,An.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)An.fromBufferAttribute(this,t),An.applyNormalMatrix(e),this.setXYZ(t,An.x,An.y,An.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)An.fromBufferAttribute(this,t),An.transformDirection(e),this.setXYZ(t,An.x,An.y,An.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=xs(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=bs(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=xs(t,this.array)),t}setX(e,t){return this.normalized&&(t=bs(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=xs(t,this.array)),t}setY(e,t){return this.normalized&&(t=bs(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=xs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=bs(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=xs(t,this.array)),t}setW(e,t){return this.normalized&&(t=bs(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=bs(t,this.array),n=bs(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=bs(t,this.array),n=bs(n,this.array),s=bs(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,t,n,s,o){return e*=this.itemSize,this.normalized&&(t=bs(t,this.array),n=bs(n,this.array),s=bs(s,this.array),o=bs(o,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==ki&&(e.usage=this.usage),e}}class In extends Cn{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Bn extends Cn{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class kn extends Cn{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class On extends Cn{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Pn extends Cn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Rn extends Cn{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Nn extends Cn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Vn extends Cn{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Sn(this.array[e*this.itemSize]);return this.normalized&&(t=xs(t,this.array)),t}setX(e,t){return this.normalized&&(t=bs(t,this.array)),this.array[e*this.itemSize]=Mn(t),this}getY(e){let t=Sn(this.array[e*this.itemSize+1]);return this.normalized&&(t=xs(t,this.array)),t}setY(e,t){return this.normalized&&(t=bs(t,this.array)),this.array[e*this.itemSize+1]=Mn(t),this}getZ(e){let t=Sn(this.array[e*this.itemSize+2]);return this.normalized&&(t=xs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=bs(t,this.array)),this.array[e*this.itemSize+2]=Mn(t),this}getW(e){let t=Sn(this.array[e*this.itemSize+3]);return this.normalized&&(t=xs(t,this.array)),t}setW(e,t){return this.normalized&&(t=bs(t,this.array)),this.array[e*this.itemSize+3]=Mn(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=bs(t,this.array),n=bs(n,this.array)),this.array[e+0]=Mn(t),this.array[e+1]=Mn(n),this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=bs(t,this.array),n=bs(n,this.array),s=bs(s,this.array)),this.array[e+0]=Mn(t),this.array[e+1]=Mn(n),this.array[e+2]=Mn(s),this}setXYZW(e,t,n,s,o){return e*=this.itemSize,this.normalized&&(t=bs(t,this.array),n=bs(n,this.array),s=bs(s,this.array),o=bs(o,this.array)),this.array[e+0]=Mn(t),this.array[e+1]=Mn(n),this.array[e+2]=Mn(s),this.array[e+3]=Mn(o),this}}class Fn extends Cn{constructor(e,t,n){super(new Float32Array(e),t,n)}}let En=0;const Ln=new Mr,jn=new Hr,Dn=new Ss,Un=new Hs,Wn=new Hs,qn=new Ss;class Jn extends ls{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:En++}),this.uuid=ms(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Zi(e)?Nn:Pn)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Ts).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const s=this.attributes.tangent;return void 0!==s&&(s.transformDirection(e),s.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ln.makeRotationFromQuaternion(e),this.applyMatrix4(Ln),this}rotateX(e){return Ln.makeRotationX(e),this.applyMatrix4(Ln),this}rotateY(e){return Ln.makeRotationY(e),this.applyMatrix4(Ln),this}rotateZ(e){return Ln.makeRotationZ(e),this.applyMatrix4(Ln),this}translate(e,t,n){return Ln.makeTranslation(e,t,n),this.applyMatrix4(Ln),this}scale(e,t,n){return Ln.makeScale(e,t,n),this.applyMatrix4(Ln),this}lookAt(e){return jn.lookAt(e),jn.updateMatrix(),this.applyMatrix4(jn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Dn).negate(),this.translate(Dn.x,Dn.y,Dn.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,o=e.length;n<o;n++){const s=e[n];t.push(s.x,s.y,s.z||0)}this.setAttribute("position",new Fn(t,3))}else{const n=Math.min(e.length,t.count);for(let s=0;s<n;s++){const o=e[s];t.setXYZ(s,o.x,o.y,o.z||0)}e.length>t.count&&ns("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Hs);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return as("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Ss(-1/0,-1/0,-1/0),new Ss(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const s=t[e];Un.setFromBufferAttribute(s),this.morphTargetsRelative?(qn.addVectors(this.boundingBox.min,Un.min),this.boundingBox.expandByPoint(qn),qn.addVectors(this.boundingBox.max,Un.max),this.boundingBox.expandByPoint(qn)):(this.boundingBox.expandByPoint(Un.min),this.boundingBox.expandByPoint(Un.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&as('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new pr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return as("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Ss,1/0);if(e){const s=this.boundingSphere.center;if(Un.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const s=t[e];Wn.setFromBufferAttribute(s),this.morphTargetsRelative?(qn.addVectors(Un.min,Wn.min),Un.expandByPoint(qn),qn.addVectors(Un.max,Wn.max),Un.expandByPoint(qn)):(Un.expandByPoint(Wn.min),Un.expandByPoint(Wn.max))}Un.getCenter(s);let n=0;for(let t=0,o=e.count;t<o;t++)qn.fromBufferAttribute(e,t),n=Math.max(n,s.distanceToSquared(qn));if(t)for(let o=0,a=t.length;o<a;o++){const i=t[o],r=this.morphTargetsRelative;for(let t=0,o=i.count;t<o;t++)qn.fromBufferAttribute(i,t),r&&(Dn.fromBufferAttribute(e,t),qn.add(Dn)),n=Math.max(n,s.distanceToSquared(qn))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&as('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(null===e||void 0===n.position||void 0===n.normal||void 0===n.uv)return void as("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=n.position,y=n.normal,v=n.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Cn(new Float32Array(4*i.count),4));const w=this.getAttribute("tangent"),r=[],c=[];for(let e=0;e<i.count;e++)r[e]=new Ss,c[e]=new Ss;const p=new Ss,u=new Ss,d=new Ss,f=new ws,t=new ws,o=new ws,h=new Ss,l=new Ss;function _(e,n,s){p.fromBufferAttribute(i,e),u.fromBufferAttribute(i,n),d.fromBufferAttribute(i,s),f.fromBufferAttribute(v,e),t.fromBufferAttribute(v,n),o.fromBufferAttribute(v,s),u.sub(p),d.sub(p),t.sub(f),o.sub(f);const a=1/(t.x*o.y-o.x*t.y);isFinite(a)&&(h.copy(u).multiplyScalar(o.y).addScaledVector(d,-t.y).multiplyScalar(a),l.copy(d).multiplyScalar(t.x).addScaledVector(u,-o.x).multiplyScalar(a),r[e].add(h),r[n].add(h),r[s].add(h),c[e].add(l),c[n].add(l),c[s].add(l))}let s=this.groups;0===s.length&&(s=[{start:0,count:e.count}]);for(let t=0,i=s.length;t<i;++t){const n=s[t],o=n.start;for(let t=o,s=o+n.count;t<s;t+=3)_(e.getX(t+0),e.getX(t+1),e.getX(t+2))}const a=new Ss,b=new Ss,m=new Ss,j=new Ss;function g(e){m.fromBufferAttribute(y,e),j.copy(m);const t=r[e];a.copy(t),a.sub(m.multiplyScalar(m.dot(t))).normalize(),b.crossVectors(j,t);const n=b.dot(c[e])<0?-1:1;w.setXYZW(e,a.x,a.y,a.z,n)}for(let t=0,i=s.length;t<i;++t){const n=s[t],o=n.start;for(let t=o,s=o+n.count;t<s;t+=3)g(e.getX(t+0)),g(e.getX(t+1)),g(e.getX(t+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let s=this.getAttribute("normal");if(void 0===s)s=new Cn(new Float32Array(3*e.count),3),this.setAttribute("normal",s);else for(let e=0,t=s.count;e<t;e++)s.setXYZ(e,0,0,0);const c=new Ss,o=new Ss,l=new Ss,i=new Ss,a=new Ss,r=new Ss,n=new Ss,d=new Ss;if(t)for(let u=0,p=t.count;u<p;u+=3){const h=t.getX(u+0),m=t.getX(u+1),f=t.getX(u+2);c.fromBufferAttribute(e,h),o.fromBufferAttribute(e,m),l.fromBufferAttribute(e,f),n.subVectors(l,o),d.subVectors(c,o),n.cross(d),i.fromBufferAttribute(s,h),a.fromBufferAttribute(s,m),r.fromBufferAttribute(s,f),i.add(n),a.add(n),r.add(n),s.setXYZ(h,i.x,i.y,i.z),s.setXYZ(m,a.x,a.y,a.z),s.setXYZ(f,r.x,r.y,r.z)}else for(let t=0,i=e.count;t<i;t+=3)c.fromBufferAttribute(e,t+0),o.fromBufferAttribute(e,t+1),l.fromBufferAttribute(e,t+2),n.subVectors(l,o),d.subVectors(c,o),n.cross(d),s.setXYZ(t+0,n.x,n.y,n.z),s.setXYZ(t+1,n.x,n.y,n.z),s.setXYZ(t+2,n.x,n.y,n.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)qn.fromBufferAttribute(e,t),qn.normalize(),e.setXYZ(t,qn.x,qn.y,qn.z)}toNonIndexed(){function t(e,t){const s=e.array,n=e.itemSize,a=e.normalized,o=new s.constructor(t.length*n);let i=0,r=0;for(let a=0,c=t.length;a<c;a++){i=e.isInterleavedBufferAttribute?t[a]*e.data.stride+e.offset:t[a]*n;for(let e=0;e<n;e++)o[r++]=s[i++]}return new Cn(o,n,a)}if(null===this.index)return ns("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Jn,n=this.index.array,s=this.attributes;for(const o in s){const i=t(s[o],n);e.setAttribute(o,i)}const o=this.morphAttributes;for(const s in o){const i=[],a=o[s];for(let e=0,s=a.length;e<s;e++){const o=t(a[e],n);i.push(o)}e.morphAttributes[s]=i}e.morphTargetsRelative=this.morphTargetsRelative;const i=this.groups;for(let t=0,s=i.length;t<s;t++){const n=i[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const s=n[t];e.data.attributes[t]=s.toJSON(e.data)}const s={};let o=!1;for(const n in this.morphAttributes){const i=this.morphAttributes[n],t=[];for(let n=0,s=i.length;n<s;n++){const o=i[n];t.push(o.toJSON(e.data))}t.length>0&&(s[n]=t,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const i=this.groups;i.length>0&&(e.data.groups=JSON.parse(JSON.stringify(i)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere=a.toJSON()),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone());const s=e.attributes;for(const e in s){const n=s[e];this.setAttribute(e,n.clone(t))}const o=e.morphAttributes;for(const e in o){const n=[],s=o[e];for(let e=0,o=s.length;e<o;e++)n.push(s[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const i=e.groups;for(let e=0,n=i.length;e<n;e++){const t=i[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const r=e.boundingSphere;return null!==r&&(this.boundingSphere=r.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Xn=new Mr,Yn=new wr,Zn=new pr,Hn=new Ss,Gn=new Ss,$n=new Ss,Qn=new Ss,Kn=new Ss,ta=new Ss,ea=new Ss,ia=new Ss;class sa extends Hr{constructor(e=new Jn,t=new bn){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const s=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(s&&o){ta.set(0,0,0);for(let n=0,r=s.length;n<r;n++){const i=o[n],c=s[n];0!==i&&(Kn.fromBufferAttribute(c,e),a?ta.addScaledVector(Kn,i):ta.addScaledVector(Kn.sub(t),i))}t.add(ta)}return t}raycast(e,t){const n=this.geometry,o=this.material,s=this.matrixWorld;if(void 0!==o){if(null===n.boundingSphere&&n.computeBoundingSphere(),Zn.copy(n.boundingSphere),Zn.applyMatrix4(s),Yn.copy(e.ray).recast(e.near),!1===Zn.containsPoint(Yn.origin)){if(null===Yn.intersectSphere(Zn,Hn))return;if(Yn.origin.distanceToSquared(Hn)>(e.far-e.near)**2)return}Xn.copy(s).invert(),Yn.copy(e.ray).applyMatrix4(Xn),null!==n.boundingBox&&!1===Yn.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Yn)}}_computeIntersections(e,t,n){let s;const a=this.geometry,r=this.material,i=a.index,h=a.attributes.position,c=a.attributes.uv,l=a.attributes.uv1,d=a.attributes.normal,u=a.groups,o=a.drawRange;if(null!==i)if(Array.isArray(r))for(let h=0,m=u.length;h<m;h++){const a=u[h],f=r[a.materialIndex];for(let r=Math.max(a.start,o.start),u=Math.min(i.count,Math.min(a.start+a.count,o.start+o.count));r<u;r+=3)s=ra(this,f,e,n,c,l,d,i.getX(r),i.getX(r+1),i.getX(r+2)),s&&(s.faceIndex=Math.floor(r/3),s.face.materialIndex=a.materialIndex,t.push(s))}else for(let a=Math.max(0,o.start),u=Math.min(i.count,o.start+o.count);a<u;a+=3)s=ra(this,r,e,n,c,l,d,i.getX(a),i.getX(a+1),i.getX(a+2)),s&&(s.faceIndex=Math.floor(a/3),t.push(s));else if(void 0!==h)if(Array.isArray(r))for(let a=0,m=u.length;a<m;a++){const i=u[a],f=r[i.materialIndex];for(let a=Math.max(i.start,o.start),r=Math.min(h.count,Math.min(i.start+i.count,o.start+o.count));a<r;a+=3)s=ra(this,f,e,n,c,l,d,a,a+1,a+2),s&&(s.faceIndex=Math.floor(a/3),s.face.materialIndex=i.materialIndex,t.push(s))}else for(let i=Math.max(0,o.start),a=Math.min(h.count,o.start+o.count);i<a;i+=3)s=ra(this,r,e,n,c,l,d,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}}function ra(e,t,n,s,o,i,a,r,c,l){e.getVertexPosition(r,Gn),e.getVertexPosition(c,$n),e.getVertexPosition(l,Qn);const d=function(e,t,n,s,o,i,a,r){let l;if(l=1===t.side?s.intersectTriangle(a,i,o,!0,r):s.intersectTriangle(o,i,a,0===t.side,r),null===l)return null;ia.copy(r),ia.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(ia);return c<n.near||c>n.far?null:{distance:c,point:ia.clone(),object:e}}(e,t,n,s,Gn,$n,Qn,ea);if(d){const e=new Ss;cn.getBarycoord(ea,Gn,$n,Qn,e),o&&(d.uv=cn.getInterpolatedAttribute(o,r,c,l,e,new ws)),i&&(d.uv1=cn.getInterpolatedAttribute(i,r,c,l,e,new ws)),a&&(d.normal=cn.getInterpolatedAttribute(a,r,c,l,e,new Ss),d.normal.dot(s.direction)>0&&d.normal.multiplyScalar(-1));const t={a:r,b:c,c:l,normal:new Ss,materialIndex:0};cn.getNormal(Gn,$n,Qn,t.normal),d.face=t,d.barycoord=e}return d}class na extends Jn{constructor(e=1,t=1,n=1,s=1,o=1,i=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:o,depthSegments:i};const m=this;s=Math.floor(s),o=Math.floor(o),i=Math.floor(i);const c=[],d=[],u=[],l=[];let r=0,h=0;function a(e,t,n,s,o,i,a,f,p,g,v){const w=i/p,O=a/g,x=i/2,C=a/2,E=f/2,j=p+1,k=g+1;let _=0,y=0;const b=new Ss;for(let i=0;i<k;i++){const a=i*O-C;for(let r=0;r<j;r++){const c=r*w-x;b[e]=c*s,b[t]=a*o,b[n]=E,d.push(b.x,b.y,b.z),b[e]=0,b[t]=0,b[n]=f>0?1:-1,u.push(b.x,b.y,b.z),l.push(r/p),l.push(1-i/g),_+=1}}for(let e=0;e<g;e++)for(let t=0;t<p;t++){const o=r+t+j*e,n=r+t+j*(e+1),i=r+(t+1)+j*(e+1),s=r+(t+1)+j*e;c.push(o,n,s),c.push(n,i,s),y+=6}m.addGroup(h,y,v),h+=y,r+=_}a("z","y","x",-1,-1,n,t,e,i,o,0),a("z","y","x",1,-1,n,t,-e,i,o,1),a("x","z","y",1,1,e,n,t,s,i,2),a("x","z","y",1,-1,e,n,-t,s,i,3),a("x","y","z",1,-1,e,t,n,s,o,4),a("x","y","z",-1,-1,e,t,-n,s,o,5),this.setIndex(c),this.setAttribute("position",new Fn(d,3)),this.setAttribute("normal",new Fn(u,3)),this.setAttribute("uv",new Fn(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new na(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function aa(e){const t={};for(const n in e){t[n]={};for(const o in e[n]){const s=e[n][o];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(ns("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][o]=null):t[n][o]=s.clone():Array.isArray(s)?t[n][o]=s.slice():t[n][o]=s}}return t}function oa(e){const t={};for(let n=0;n<e.length;n++){const s=aa(e[n]);for(const e in s)t[e]=s[e]}return t}function ha(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:ks.workingColorSpace}const la={clone:aa,merge:oa};class ca extends xn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=aa(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const n=this.uniforms[s].value;n&&n.isTexture?t.uniforms[s]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[s]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[s]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[s]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[s]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[s]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[s]={type:"m4",value:n.toArray()}:t.uniforms[s]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class ua extends Hr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Mr,this.projectionMatrix=new Mr,this.projectionMatrixInverse=new Mr,this.coordinateSystem=Ui,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const da=new Ss,pa=new ws,ma=new ws;class ya extends ua{constructor(e=50,t=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*ps*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*ds*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*ps*Math.atan(Math.tan(.5*ds*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){da.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(da.x,da.y).multiplyScalar(-e/da.z),da.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(da.x,da.y).multiplyScalar(-e/da.z)}getViewSize(e,t){return this.getViewBounds(e,pa,ma),t.subVectors(ma,pa)}setViewOffset(e,t,n,s,o,i){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=o,this.view.height=i,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const i=this.near;let t=i*Math.tan(.5*ds*this.fov)/this.zoom,n=2*t,s=this.aspect*n,o=-.5*s;const e=this.view;if(null!==this.view&&this.view.enabled){const i=e.fullWidth,a=e.fullHeight;o+=e.offsetX*s/i,t-=e.offsetY*n/a,s*=e.width/i,n*=e.height/a}const a=this.filmOffset;0!==a&&(o+=i*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+s,t,t-n,i,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const ga=-90;class fa extends Hr{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new ya(ga,1,e,t);s.layers=this.layers,this.add(s);const o=new ya(ga,1,e,t);o.layers=this.layers,this.add(o);const i=new ya(ga,1,e,t);i.layers=this.layers,this.add(i);const a=new ya(ga,1,e,t);a.layers=this.layers,this.add(a);const r=new ya(ga,1,e,t);r.layers=this.layers,this.add(r);const c=new ya(ga,1,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const a=this.coordinateSystem,r=this.children.concat(),[e,t,n,s,o,i]=r;for(const e of r)this.remove(e);if(a===Ui)e.up.set(0,1,0),e.lookAt(1,0,0),t.up.set(0,1,0),t.lookAt(-1,0,0),n.up.set(0,0,-1),n.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),i.up.set(0,1,0),i.lookAt(0,0,-1);else{if(a!==Wi)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+a);e.up.set(0,-1,0),e.lookAt(-1,0,0),t.up.set(0,-1,0),t.lookAt(1,0,0),n.up.set(0,0,1),n.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),i.up.set(0,-1,0),i.lookAt(0,0,-1)}for(const e of r)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,i,a,r,c,l]=this.children,d=e.getRenderTarget(),u=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,s),e.render(t,o),e.setRenderTarget(n,1,s),e.render(t,i),e.setRenderTarget(n,2,s),e.render(t,a),e.setRenderTarget(n,3,s),e.render(t,r),e.setRenderTarget(n,4,s),e.render(t,c),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,s),e.render(t,l),e.setRenderTarget(d,u,h),e.xr.enabled=m,n.texture.needsPMREMUpdate=!0}}class xa extends Ds{constructor(e=[],t=301,n,s,o,i,a,r,c,l){super(e,t,n,s,o,i,a,r,c,l),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class ba extends qs{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new xa(s),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new na(5,5,5),o=new ca({name:"CubemapFromEquirect",uniforms:aa(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});o.uniforms.tEquirect.value=t;const s=new sa(i,o),a=t.minFilter;return t.minFilter===At&&(t.minFilter=Mt),new fa(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t=!0,n=!0,s=!0){const o=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,s);e.setRenderTarget(o)}}class va extends Hr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const wa={type:"move"};class Ma{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new va,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new va,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ss,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ss),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new va,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ss,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ss),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,a=null,c=null;const s=this._targetRay,o=this._grip,r=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(r&&e.hand){c=!0;for(const i of e.hand.values()){const o=t.getJointPose(i,n),s=this._getHandJoint(r,i);null!==o&&(s.matrix.fromArray(o.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,s.jointRadius=o.radius),s.visible=null!==o}const a=r.joints["index-finger-tip"],l=r.joints["thumb-tip"],s=a.position.distanceTo(l.position),o=.02,i=.005;r.inputState.pinching&&s>o+i?(r.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!r.inputState.pinching&&s<=o-i&&(r.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(a=t.getPose(e.gripSpace,n),null!==a&&(o.matrix.fromArray(a.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,a.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(a.linearVelocity)):o.hasLinearVelocity=!1,a.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(a.angularVelocity)):o.hasAngularVelocity=!1));null!==s&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==a&&(i=a),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(wa)))}return null!==s&&(s.visible=null!==i),null!==o&&(o.visible=null!==a),null!==r&&(r.visible=null!==c),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new va;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Sa{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new yn(e),this.density=t}clone(){return new Sa(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class _a{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new yn(e),this.near=t,this.far=n}clone(){return new _a(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Aa extends Hr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Or,this.environmentIntensity=1,this.environmentRotation=new Or,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Ta{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=ki,this.updateRanges=[],this.version=0,this.uuid=ms()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let s=0,o=this.stride;s<o;s++)this.array[e+s]=t.array[n+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ms()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),t=new this.constructor(n,this.stride);return t.setUsage(this.usage),t}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ms()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const za=new Ss;class Ca{constructor(e,t,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)za.fromBufferAttribute(this,t),za.applyMatrix4(e),this.setXYZ(t,za.x,za.y,za.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)za.fromBufferAttribute(this,t),za.applyNormalMatrix(e),this.setXYZ(t,za.x,za.y,za.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)za.fromBufferAttribute(this,t),za.transformDirection(e),this.setXYZ(t,za.x,za.y,za.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=xs(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=bs(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=bs(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=bs(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=bs(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=bs(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=xs(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=xs(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=xs(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=xs(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=bs(t,this.array),n=bs(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=bs(t,this.array),n=bs(n,this.array),s=bs(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,t,n,s,o){return e=e*this.data.stride+this.offset,this.normalized&&(t=bs(t,this.array),n=bs(n,this.array),s=bs(s,this.array),o=bs(o,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=o,this}clone(e){if(void 0===e){rs("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Cn(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ca(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){rs("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Ia extends xn{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new yn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Ba;const ka=new Ss,Oa=new Ss,Pa=new Ss,Ra=new ws,Na=new ws,Va=new Mr,Fa=new Ss,Ea=new Ss,La=new Ss,ja=new ws,Da=new ws,Ua=new ws;class Wa extends Hr{constructor(e=new Ia){if(super(),this.isSprite=!0,this.type="Sprite",void 0===Ba){Ba=new Jn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new Ta(t,5);Ba.setIndex([0,1,2,0,2,3]),Ba.setAttribute("position",new Ca(e,3,0,!1)),Ba.setAttribute("uv",new Ca(e,2,3,!1))}this.geometry=Ba,this.material=e,this.center=new ws(.5,.5),this.count=1}raycast(e,t){null===e.camera&&as('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Oa.setFromMatrixScale(this.matrixWorld),Va.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Pa.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Oa.multiplyScalar(-Pa.z);const i=this.material.rotation;let n,s;0!==i&&(s=Math.cos(i),n=Math.sin(i));const o=this.center;qa(Fa.set(-.5,-.5,0),Pa,o,Oa,n,s),qa(Ea.set(.5,-.5,0),Pa,o,Oa,n,s),qa(La.set(.5,.5,0),Pa,o,Oa,n,s),ja.set(0,0),Da.set(1,0),Ua.set(1,1);let a=e.ray.intersectTriangle(Fa,Ea,La,!1,ka);if(null===a&&(qa(Ea.set(-.5,.5,0),Pa,o,Oa,n,s),Da.set(0,1),a=e.ray.intersectTriangle(Fa,La,Ea,!1,ka),null===a))return;const r=e.ray.origin.distanceTo(ka);r<e.near||r>e.far||t.push({distance:r,point:ka.clone(),uv:cn.getInterpolation(ka,Fa,Ea,La,ja,Da,Ua,new ws),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function qa(e,t,n,s,o,i){Ra.subVectors(e,n).addScalar(.5).multiply(s),void 0!==o?(Na.x=i*Ra.x-o*Ra.y,Na.y=o*Ra.x+i*Ra.y):Na.copy(Ra),e.copy(t),e.x+=Na.x,e.y+=Na.y,e.applyMatrix4(Va)}const Ja=new Ss,Xa=new Ss;class Ya extends Hr{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,s=t.length;e<s;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const o=this.levels;let s;for(s=0;s<o.length&&!(t<o[s].distance);s++);return o.splice(s,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const e=t.splice(n,1);return this.remove(e[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,s;for(n=1,s=t.length;n<s;n++){let o=t[n].distance;if(t[n].object.visible&&(o-=o*t[n].hysteresis),e<o)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Ja.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Ja);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Ja.setFromMatrixPosition(e.matrixWorld),Xa.setFromMatrixPosition(this.matrixWorld);const o=Ja.distanceTo(Xa)/e.zoom;let n,s;for(t[0].object.visible=!0,n=1,s=t.length;n<s;n++){let e=t[n].distance;if(t[n].object.visible&&(e-=e*t[n].hysteresis),!(o>=e))break;t[n-1].object.visible=!1,t[n].object.visible=!0}for(this._currentLevel=n-1;n<s;n++)t[n].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,o=n.length;e<o;e++){const s=n[e];t.object.levels.push({object:s.object.uuid,distance:s.distance,hysteresis:s.hysteresis})}return t}}const Za=new Ss,Ha=new Us,Ga=new Us,$a=new Ss,Qa=new Mr,Ka=new Ss,to=new pr,eo=new Mr,io=new wr;class so extends sa{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=at,this.bindMatrix=new Mr,this.bindMatrixInverse=new Mr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Hs),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,Ka),this.boundingBox.expandByPoint(Ka)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new pr),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,Ka),this.boundingSphere.expandByPoint(Ka)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const s=this.material,n=this.matrixWorld;void 0!==s&&(null===this.boundingSphere&&this.computeBoundingSphere(),to.copy(this.boundingSphere),to.applyMatrix4(n),!1!==e.ray.intersectsSphere(to)&&(eo.copy(n).invert(),io.copy(e.ray).applyMatrix4(eo),null!==this.boundingBox&&!1===io.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,io)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Us,t=this.geometry.attributes.skinWeight;for(let n=0,o=t.count;n<o;n++){e.fromBufferAttribute(t,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===at?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===ot?this.bindMatrixInverse.copy(this.bindMatrix).invert():ns("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,s=this.geometry;Ha.fromBufferAttribute(s.attributes.skinIndex,e),Ga.fromBufferAttribute(s.attributes.skinWeight,e),Za.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const s=Ga.getComponent(e);if(0!==s){const o=Ha.getComponent(e);Qa.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector($a.copy(Za).applyMatrix4(Qa),s)}}return t.applyMatrix4(this.bindMatrixInverse)}}class ro extends Hr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class no extends Ds{constructor(e=null,t=1,n=1,s,o,i,a,r,c=1003,l=1003,d,u){super(null,i,a,r,c,l,s,o,d,u),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const ao=new Mr,oo=new Mr;class ho{constructor(e=[],t=[]){this.uuid=ms(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.previousBoneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){ns("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Mr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){const t=new Mr;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let t=0,n=this.bones.length;t<n;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const e=this.bones,n=this.boneInverses,s=this.boneMatrices,t=this.boneTexture;for(let t=0,o=e.length;t<o;t++){const i=e[t]?e[t].matrixWorld:oo;ao.multiplyMatrices(i,n[t]),ao.toArray(s,16*t)}null!==t&&(t.needsUpdate=!0)}clone(){return new ho(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new no(t,e,e,Ut,Pt);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,s=this.bones.length;t<s;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const o=e.bones[n];let s=t[o];void 0===s&&(ns("Skeleton: No bone found with UUID:",o),s=new ro),this.bones.push(s),this.boneInverses.push((new Mr).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let s=0,o=t.length;s<o;s++){const i=t[s];e.bones.push(i.uuid);const a=n[s];e.boneInverses.push(a.toArray())}return e}}class lo extends Cn{constructor(e,t,n,s=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const co=new Mr,uo=new Mr,po=[],mo=new Hs,yo=new Mr,go=new sa,fo=new pr;class xo extends sa{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new lo(new Float32Array(16*n),16),this.previousInstanceMatrix=null,this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,yo)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Hs),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,co),mo.copy(e.boundingBox).applyMatrix4(co),this.boundingBox.union(mo)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new pr),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,co),fo.copy(e.boundingSphere).applyMatrix4(co),this.boundingSphere.union(fo)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.previousInstanceMatrix&&(this.previousInstanceMatrix=e.previousInstanceMatrix.clone()),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,s=this.morphTexture.source.data.data,o=e*(n.length+1)+1;for(let e=0;e<n.length;e++)n[e]=s[o+e]}raycast(e,t){const n=this.matrixWorld,s=this.count;if(go.geometry=this.geometry,go.material=this.material,void 0!==go.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),fo.copy(this.boundingSphere),fo.applyMatrix4(n),!1!==e.ray.intersectsSphere(fo)))for(let o=0;o<s;o++){this.getMatrixAt(o,co),uo.multiplyMatrices(n,co),go.matrixWorld=uo,go.raycast(e,po);for(let e=0,s=po.length;e<s;e++){const n=po[e];n.instanceId=o,n.object=this,t.push(n)}po.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new lo(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,s=n.length+1;null===this.morphTexture&&(this.morphTexture=new no(new Float32Array(s*this.count),s,this.count,Jt,Pt));const o=this.morphTexture.source.data.data;let i=0;for(let e=0;e<n.length;e++)i+=n[e];const r=this.geometry.morphTargetsRelative?1:1-i,a=s*e;o[a]=r,o.set(n,a+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const bo=new Ss,vo=new Ss,wo=new Ts;class Mo{constructor(e=new Ss(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const s=bo.subVectors(n,t).cross(vo.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const s=e.delta(bo),o=this.normal.dot(s);if(0===o)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const n=-(e.start.dot(this.normal)+this.constant)/o;return n<0||n>1?null:t.copy(e.start).addScaledVector(s,n)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||wo.getNormalMatrix(e),s=this.coplanarPoint(bo).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const So=new pr,_o=new ws(.5,.5),Ao=new Ss;class To{constructor(e=new Mo,t=new Mo,n=new Mo,s=new Mo,o=new Mo,i=new Mo){this.planes=[e,t,n,s,o,i]}set(e,t,n,s,o,i){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(s),a[4].copy(o),a[5].copy(i),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3,n=!1){const o=this.planes,s=e.elements,y=s[0],v=s[1],d=s[2],c=s[3],f=s[4],m=s[5],l=s[6],r=s[7],p=s[8],g=s[9],u=s[10],a=s[11],b=s[12],j=s[13],h=s[14],i=s[15];if(o[0].setComponents(c-y,r-f,a-p,i-b).normalize(),o[1].setComponents(c+y,r+f,a+p,i+b).normalize(),o[2].setComponents(c+v,r+m,a+g,i+j).normalize(),o[3].setComponents(c-v,r-m,a-g,i-j).normalize(),n)o[4].setComponents(d,l,u,h).normalize(),o[5].setComponents(c-d,r-l,a-u,i-h).normalize();else if(o[4].setComponents(c-d,r-l,a-u,i-h).normalize(),t===Ui)o[5].setComponents(c+d,r+l,a+u,i+h).normalize();else{if(t!==Wi)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);o[5].setComponents(d,l,u,h).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),So.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),So.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(So)}intersectsSprite(e){So.center.set(0,0,0);const t=_o.distanceTo(e.center);return So.radius=.7071067811865476+t,So.applyMatrix4(e.matrixWorld),this.intersectsSphere(So)}intersectsSphere(e){const t=this.planes,n=e.center,s=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let s=0;s<6;s++){const n=t[s];if(Ao.x=n.normal.x>0?e.max.x:e.min.x,Ao.y=n.normal.y>0?e.max.y:e.min.y,Ao.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Ao)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const zo=new Mr,Co=new To;class Io{constructor(){this.coordinateSystem=Ui}intersectsObject(e,t){if(!t.isArrayCamera||0===t.cameras.length)return!1;for(let s=0;s<t.cameras.length;s++){const n=t.cameras[s];if(zo.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Co.setFromProjectionMatrix(zo,n.coordinateSystem,n.reversedDepth),Co.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let s=0;s<t.cameras.length;s++){const n=t.cameras[s];if(zo.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Co.setFromProjectionMatrix(zo,n.coordinateSystem,n.reversedDepth),Co.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let s=0;s<t.cameras.length;s++){const n=t.cameras[s];if(zo.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Co.setFromProjectionMatrix(zo,n.coordinateSystem,n.reversedDepth),Co.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let s=0;s<t.cameras.length;s++){const n=t.cameras[s];if(zo.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Co.setFromProjectionMatrix(zo,n.coordinateSystem,n.reversedDepth),Co.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let s=0;s<t.cameras.length;s++){const n=t.cameras[s];if(zo.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Co.setFromProjectionMatrix(zo,n.coordinateSystem,n.reversedDepth),Co.containsPoint(e))return!0}return!1}clone(){return new Io}}function Bo(e,t){return e-t}function ko(e,t){return e.z-t.z}function Oo(e,t){return t.z-e.z}class Po{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,s){const i=this.pool,a=this.list;this.index>=i.length&&i.push({start:-1,count:-1,z:-1,index:-1});const o=i[this.index];a.push(o),this.index++,o.start=e,o.count=t,o.z=n,o.index=s}reset(){this.list.length=0,this.index=0}}const Ro=new Mr,No=new yn(1,1,1),Vo=new To,Fo=new Io,Eo=new Hs,Lo=new pr,jo=new Ss,Do=new Ss,Uo=new Ss,Wo=new Po,qo=new sa,Jo=[];function Xo(e,t,n=0){const s=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const o=e.count;for(let i=0;i<o;i++)for(let o=0;o<s;o++)t.setComponent(i+n,o,e.getComponent(i,o))}else t.array.set(e.array,n*s);t.needsUpdate=!0}function Yo(e,t){if(e.constructor!==t.constructor){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++)t[s]=e[s]}else{const n=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,n))}}class Zo extends sa{constructor(e,t,n=2*t,s){super(new Jn,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new no(t,e,e,Ut,Pt);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new no(t,e,e,Xt,Ot);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const n=new Float32Array(e*e*4).fill(1),t=new no(n,e,e,Ut,Pt);t.colorSpace=ks.workingColorSpace,this._colorsTexture=t}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,s=this._maxIndexCount;if(!1===this._geometryInitialized){for(const s in e.attributes){const i=e.getAttribute(s),{array:a,itemSize:o,normalized:r}=i,c=new a.constructor(n*o),l=new Cn(c,o,r);t.setAttribute(s,l)}if(null!==e.getIndex()){const e=n>65535?new Uint32Array(s):new Uint16Array(s);t.setIndex(new Cn(e,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const s=e.getAttribute(n),o=t.getAttribute(n);if(s.itemSize!==o.itemSize||s.normalized!==o.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Hs);const t=this.boundingBox,e=this._instanceInfo;t.makeEmpty();for(let n=0,s=e.length;n<s;n++){if(!1===e[n].active)continue;const o=e[n].geometryIndex;this.getMatrixAt(n,Ro),this.getBoundingBoxAt(o,Eo).applyMatrix4(Ro),t.union(Eo)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new pr);const t=this.boundingSphere,e=this._instanceInfo;t.makeEmpty();for(let n=0,s=e.length;n<s;n++){if(!1===e[n].active)continue;const o=e[n].geometryIndex;this.getMatrixAt(n,Ro),this.getBoundingSphereAt(o,Lo).applyMatrix4(Ro),t.union(Lo)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const s={visible:!0,active:!0,geometryIndex:e};let t=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(Bo),t=this._availableInstanceIds.shift(),this._instanceInfo[t]=s):(t=this._instanceInfo.length,this._instanceInfo.push(s));const o=this._matricesTexture;Ro.identity().toArray(o.image.data,16*t),o.needsUpdate=!0;const n=this._colorsTexture;return n&&(No.toArray(n.image.data,4*t),n.needsUpdate=!0),this._visibilityChanged=!0,t}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const s={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},i=this._geometryInfo;s.vertexStart=this._nextVertexStart,s.reservedVertexCount=-1===t?e.getAttribute("position").count:t;const a=e.getIndex();if(null!==a&&(s.indexStart=this._nextIndexStart,s.reservedIndexCount=-1===n?a.count:n),-1!==s.indexStart&&s.indexStart+s.reservedIndexCount>this._maxIndexCount||s.vertexStart+s.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let o;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(Bo),o=this._availableGeometryIds.shift(),i[o]=s):(o=this._geometryCount,this._geometryCount++,i.push(s)),this.setGeometryAt(o,e),this._nextIndexStart=s.indexStart+s.reservedIndexCount,this._nextVertexStart=s.vertexStart+s.reservedVertexCount,o}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const o=this.geometry,i=null!==o.getIndex(),a=o.getIndex(),r=t.getIndex(),n=this._geometryInfo[e];if(i&&r.count>n.reservedIndexCount||t.attributes.position.count>n.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const s=n.vertexStart,c=n.reservedVertexCount;n.vertexCount=t.getAttribute("position").count;for(const a in o.attributes){const n=t.getAttribute(a),e=o.getAttribute(a);Xo(n,e,s);const i=n.itemSize;for(let t=n.count,o=c;t<o;t++){const a=s+t;for(let t=0;t<i;t++)e.setComponent(a,t,0)}e.needsUpdate=!0,e.addUpdateRange(s*i,c*i)}if(i){const e=n.indexStart,o=n.reservedIndexCount;n.indexCount=t.getIndex().count;for(let t=0;t<r.count;t++)a.setX(e+t,s+r.getX(t));for(let t=r.count,n=o;t<n;t++)a.setX(e+t,s);a.needsUpdate=!0,a.addUpdateRange(e,n.reservedIndexCount)}return n.start=i?n.indexStart:n.vertexStart,n.count=i?n.indexCount:n.vertexCount,n.boundingBox=null,null!==t.boundingBox&&(n.boundingBox=t.boundingBox.clone()),n.boundingSphere=null,null!==t.boundingSphere&&(n.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||!1===t[e].active)return this;const n=this._instanceInfo;for(let t=0,s=n.length;t<s;t++)n[t].active&&n[t].geometryIndex===e&&this.deleteInstance(t);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,o=n.map((e,t)=>t).sort((e,t)=>n[e].vertexStart-n[t].vertexStart),s=this.geometry;for(let a=0,r=n.length;a<r;a++){const c=o[a],i=n[c];if(!1!==i.active){if(null!==s.index){if(i.indexStart!==t){const{indexStart:n,vertexStart:c,reservedIndexCount:a}=i,o=s.index,r=o.array,l=e-c;for(let e=n;e<n+a;e++)r[e]=r[e]+l;o.array.copyWithin(t,n,n+a),o.addUpdateRange(t,a),o.needsUpdate=!0,i.indexStart=t}t+=i.reservedIndexCount}if(i.vertexStart!==e){const{vertexStart:t,reservedVertexCount:n}=i,o=s.attributes;for(const a in o){const i=o[a],{array:r,itemSize:s}=i;r.copyWithin(e*s,t*s,(t+n)*s),i.addUpdateRange(e*s,n*s),i.needsUpdate=!0}i.vertexStart=e}e+=i.reservedVertexCount,i.start=s.index?i.indexStart:i.vertexStart,this._nextIndexStart=s.index?i.indexStart+i.reservedIndexCount:0,this._nextVertexStart=i.vertexStart+i.reservedVertexCount}}return this._visibilityChanged=!0,this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const s=this.geometry,n=this._geometryInfo[e];if(null===n.boundingBox){const e=new Hs,t=s.index,o=s.attributes.position;for(let s=n.start,a=n.start+n.count;s<a;s++){let i=s;t&&(i=t.getX(i)),e.expandByPoint(jo.fromBufferAttribute(o,i))}n.boundingBox=e}return t.copy(n.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const s=this.geometry,n=this._geometryInfo[e];if(null===n.boundingSphere){const t=new pr;this.getBoundingBoxAt(e,Eo),Eo.getCenter(t.center);const i=s.index,a=s.attributes.position;let o=0;for(let e=n.start,r=n.start+n.count;e<r;e++){let s=e;i&&(s=i.getX(s)),jo.fromBufferAttribute(a,s),o=Math.max(o,t.center.distanceToSquared(jo))}t.radius=Math.sqrt(o),n.boundingSphere=t}return t.copy(n.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,s=this._matricesTexture.image.data;return t.toArray(s,16*e),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,16*e)}setColorAt(e,t){return this.validateInstanceId(e),null===this._colorsTexture&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,4*e),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,4*e)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t||(this._instanceInfo[e].visible=t,this._visibilityChanged=!0),this}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(Bo);t[t.length-1]===n.length-1;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const o=new Int32Array(e),i=new Int32Array(e);Yo(this._multiDrawCounts,o),Yo(this._multiDrawStarts,i),this._multiDrawCounts=o,this._multiDrawStarts=i,this._maxInstanceCount=e;const a=this._indirectTexture,r=this._matricesTexture,s=this._colorsTexture;a.dispose(),this._initIndirectTexture(),Yo(a.image.data,this._indirectTexture.image.data),r.dispose(),this._initMatricesTexture(),Yo(r.image.data,this._matricesTexture.image.data),s&&(s.dispose(),this._initColorsTexture(),Yo(s.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const s=[...this._geometryInfo].filter(e=>e.active);if(Math.max(...s.map(e=>e.vertexStart+e.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...s.map(e=>e.indexStart+e.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const n=this.geometry;n.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Jn,this._initializeGeometry(n));const o=this.geometry;n.index&&Yo(n.index.array,o.index.array);for(const e in n.attributes)Yo(n.attributes[e].array,o.attributes[e].array)}raycast(e,t){const n=this._instanceInfo,o=this._geometryInfo,i=this.matrixWorld,s=this.geometry;qo.material=this.material,qo.geometry.index=s.index,qo.geometry.attributes=s.attributes,null===qo.geometry.boundingBox&&(qo.geometry.boundingBox=new Hs),null===qo.geometry.boundingSphere&&(qo.geometry.boundingSphere=new pr);for(let s=0,c=n.length;s<c;s++){if(!n[s].visible||!n[s].active)continue;const a=n[s].geometryIndex,r=o[a];qo.geometry.setDrawRange(r.start,r.count),this.getMatrixAt(s,qo.matrixWorld).premultiply(i),this.getBoundingBoxAt(a,qo.geometry.boundingBox),this.getBoundingSphereAt(a,qo.geometry.boundingSphere),qo.raycast(e,Jo);for(let e=0,o=Jo.length;e<o;e++){const n=Jo[e];n.object=this,n.batchId=s,t.push(n)}Jo.length=0}qo.material=null,qo.geometry.index=null,qo.geometry.attributes={},qo.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(e=>({...e,boundingBox:null!==e.boundingBox?e.boundingBox.clone():null,boundingSphere:null!==e.boundingSphere?e.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(e=>({...e})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,s,o){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const c=s.getIndex(),l=null===c?1:c.array.BYTES_PER_ELEMENT,a=this._instanceInfo,d=this._multiDrawStarts,u=this._multiDrawCounts,h=this._geometryInfo,r=this.perObjectFrustumCulled,m=this._indirectTexture,f=m.image.data,p=n.isArrayCamera?Fo:Vo;r&&!n.isArrayCamera&&(Ro.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),Vo.setFromProjectionMatrix(Ro,n.coordinateSystem,n.reversedDepth));let i=0;if(this.sortObjects){Ro.copy(this.matrixWorld).invert(),jo.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Ro),Do.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(Ro);for(let e=0,t=a.length;e<t;e++)if(a[e].visible&&a[e].active){const t=a[e].geometryIndex;this.getMatrixAt(e,Ro),this.getBoundingSphereAt(t,Lo).applyMatrix4(Ro);let s=!1;if(r&&(s=!p.intersectsSphere(Lo,n)),!s){const n=h[t],s=Uo.subVectors(Lo.center,jo).dot(Do);Wo.push(n.start,n.count,s,e)}}const e=Wo.list,t=this.customSort;null===t?e.sort(o.transparent?Oo:ko):t.call(this,e,n);for(let t=0,s=e.length;t<s;t++){const n=e[t];d[i]=n.start*l,u[i]=n.count,f[i]=n.index,i++}Wo.reset()}else for(let e=0,t=a.length;e<t;e++)if(a[e].visible&&a[e].active){const t=a[e].geometryIndex;let s=!1;if(r&&(this.getMatrixAt(e,Ro),this.getBoundingSphereAt(t,Lo).applyMatrix4(Ro),s=!p.intersectsSphere(Lo,n)),!s){const n=h[t];d[i]=n.start*l,u[i]=n.count,f[i]=e,i++}}m.needsUpdate=!0,this._multiDrawCount=i,this._visibilityChanged=!1}onBeforeShadow(e,t,n,s,o,i){this.onBeforeRender(e,null,s,o,i)}}class Ho extends xn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new yn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Go=new Ss,$o=new Ss,Qo=new Mr,Ko=new wr,th=new pr,eh=new Ss,ih=new Ss;class sh extends Hr{constructor(e=new Jn,t=new Ho){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const n=e.attributes.position,t=[0];for(let e=1,s=n.count;e<s;e++)Go.fromBufferAttribute(n,e-1),$o.fromBufferAttribute(n,e),t[e]=t[e-1],t[e]+=Go.distanceTo($o);e.setAttribute("lineDistance",new Fn(t,1))}else ns("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,a=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),th.copy(n.boundingSphere),th.applyMatrix4(a),th.radius+=r,!1===e.ray.intersectsSphere(th))return;Qo.copy(a).invert(),Ko.copy(e.ray).applyMatrix4(Qo);const c=r/((this.scale.x+this.scale.y+this.scale.z)/3),i=c*c,l=this.isLineSegments?2:1,o=n.index,d=n.attributes.position;if(null!==o){{const a=Math.max(0,s.start),n=Math.min(o.count,s.start+s.count);for(let s=a,c=n-1;s<c;s+=l){const d=o.getX(s),u=o.getX(s+1),r=rh(this,e,Ko,i,d,u,s);r&&t.push(r)}if(this.isLineLoop){const r=o.getX(n-1),c=o.getX(a),s=rh(this,e,Ko,i,r,c,n-1);s&&t.push(s)}}}else{const o=Math.max(0,s.start),n=Math.min(d.count,s.start+s.count);for(let s=o,r=n-1;s<r;s+=l){const a=rh(this,e,Ko,i,s,s+1,s);a&&t.push(a)}if(this.isLineLoop){const s=rh(this,e,Ko,i,n-1,o,n-1);s&&t.push(s)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const s=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=e}}}}}function rh(e,t,n,s,o,i,a){const c=e.geometry.attributes.position;if(Go.fromBufferAttribute(c,o),$o.fromBufferAttribute(c,i),n.distanceSqToSegment(Go,$o,eh,ih)>s)return;eh.applyMatrix4(e.matrixWorld);const r=t.ray.origin.distanceTo(eh);return r<t.near||r>t.far?void 0:{distance:r,point:ih.clone().applyMatrix4(e.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:e}}const nh=new Ss,ah=new Ss;class oh extends sh{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const n=e.attributes.position,t=[];for(let e=0,s=n.count;e<s;e+=2)nh.fromBufferAttribute(n,e),ah.fromBufferAttribute(n,e+1),t[e]=0===e?0:t[e-1],t[e+1]=t[e]+nh.distanceTo(ah);e.setAttribute("lineDistance",new Fn(t,1))}else ns("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class hh extends sh{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class lh extends xn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new yn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const ch=new Mr,uh=new wr,dh=new pr,ph=new Ss;class mh extends Hr{constructor(e=new Jn,t=new lh){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,o=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),dh.copy(n.boundingSphere),dh.applyMatrix4(o),dh.radius+=r,!1===e.ray.intersectsSphere(dh))return;ch.copy(o).invert(),uh.copy(e.ray).applyMatrix4(ch);const c=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=c*c,i=n.index,a=n.attributes.position;if(null!==i)for(let n=Math.max(0,s.start),c=Math.min(i.count,s.start+s.count);n<c;n++){const r=i.getX(n);ph.fromBufferAttribute(a,r),yh(ph,r,l,o,e,t,this)}else for(let n=Math.max(0,s.start),i=Math.min(a.count,s.start+s.count);n<i;n++)ph.fromBufferAttribute(a,n),yh(ph,n,l,o,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const s=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=e}}}}}function yh(e,t,n,s,o,i,a){const r=uh.distanceSqToPoint(e);if(r<n){const n=new Ss;uh.closestPointToPoint(e,n),n.applyMatrix4(s);const c=o.ray.origin.distanceTo(n);if(c<o.near||c>o.far)return;i.push({distance:c,distanceToRay:Math.sqrt(r),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}class gh extends Ds{constructor(e,t,n,s,o=1006,i=1006,a,r,c){super(e,t,n,s,o,i,a,r,c),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const l=this;"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(function t(){l.needsUpdate=!0,l._requestVideoFrameCallbackId=e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){0!==this._requestVideoFrameCallbackId&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class fh extends gh{constructor(e,t,n,s,o,i,a,r){super({},e,t,n,s,o,i,a,r),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class xh extends Ds{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=ft,this.minFilter=ft,this.generateMipmaps=!1,this.needsUpdate=!0}}class bh extends Ds{constructor(e,t,n,s,o,i,a,r,c,l,d,u){super(null,i,a,r,c,l,s,o,d,u),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class vh extends bh{constructor(e,t,n,s,o,i){super(e,t,n,o,i),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=yt,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class wh extends bh{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,lt),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class Mh extends Ds{constructor(e,t,n,s,o,i,a,r,c){super(e,t,n,s,o,i,a,r,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Sh extends Ds{constructor(e,t,n=1014,s,o,i,a=1003,r=1003,c,l=1026,d=1){if(l!==Wt&&1027!==l)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:e,height:t,depth:d},s,o,i,a,r,l,n,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Fs(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class _h extends Sh{constructor(e,t=1014,n=301,s,o,i=1003,a=1003,r,c=1026){const l={width:e,height:e,depth:1},d=[l,l,l,l,l,l];super(e,e,t,n,s,o,i,a,r,c),this.image=d,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class Ah extends Ds{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class Th extends Jn{constructor(e=1,t=1,n=4,s=8,o=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:s,heightSegments:o},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),s=Math.max(3,Math.floor(s)),o=Math.max(1,Math.floor(o));const c=[],h=[],m=[],f=[],l=t/2,a=Math.PI/2*e,d=t,g=2*a+d,p=2*n+o,u=s+1,r=new Ss,i=new Ss;for(let v=0;v<=p;v++){let j=0,y=0,b=0,_=0;if(v<=n){const s=v/n,t=s*Math.PI/2;y=-l-e*Math.cos(t),b=e*Math.sin(t),_=-e*Math.cos(t),j=s*a}else if(v<=n+o){const s=(v-n)/o;y=s*t-l,b=e,_=0,j=a+s*d}else{const s=(v-n-o)/n,t=s*Math.PI/2;y=l+e*Math.sin(t),b=e*Math.cos(t),_=e*Math.sin(t),j=a+d+s*a}const O=Math.max(0,Math.min(1,j/g));let w=0;0===v?w=.5/s:v===p&&(w=-.5/s);for(let e=0;e<=s;e++){const t=e/s,n=t*Math.PI*2,o=Math.sin(n),a=Math.cos(n);i.x=-b*a,i.y=y,i.z=b*o,h.push(i.x,i.y,i.z),r.set(-b*a,_,b*o),r.normalize(),m.push(r.x,r.y,r.z),f.push(t+w,O)}if(v>0){const e=(v-1)*u;for(let t=0;t<s;t++){const i=e+t,n=e+t+1,o=v*u+t,a=v*u+t+1;c.push(i,n,o),c.push(n,a,o)}}}this.setIndex(c),this.setAttribute("position",new Fn(h,3)),this.setAttribute("normal",new Fn(m,3)),this.setAttribute("uv",new Fn(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Th(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class zh extends Jn{constructor(e=1,t=32,n=0,s=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:s},t=Math.max(3,t);const l=[],o=[],r=[],c=[],i=new Ss,a=new ws;o.push(0,0,0),r.push(0,0,1),c.push(.5,.5);for(let l=0,d=3;l<=t;l++,d+=3){const u=n+l/t*s;i.x=e*Math.cos(u),i.y=e*Math.sin(u),o.push(i.x,i.y,i.z),r.push(0,0,1),a.x=(o[d]/e+1)/2,a.y=(o[d+1]/e+1)/2,c.push(a.x,a.y)}for(let e=1;e<=t;e++)l.push(e,e+1,0);this.setIndex(l),this.setAttribute("position",new Fn(o,3)),this.setAttribute("normal",new Fn(r,3)),this.setAttribute("uv",new Fn(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zh(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Ch extends Jn{constructor(e=1,t=1,n=1,s=32,o=1,i=!1,a=0,r=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:s,heightSegments:o,openEnded:i,thetaStart:a,thetaLength:r};const g=this;s=Math.floor(s),o=Math.floor(o);const c=[],u=[],h=[],m=[];let l=0;const d=[],p=n/2;let f=0;function v(n){const j=l,d=new ws,o=new Ss;let v=0;const b=!0===n?e:t,i=!0===n?1:-1;for(let e=1;e<=s;e++)u.push(0,p*i,0),h.push(0,i,0),m.push(.5,.5),l++;const y=l;for(let e=0;e<=s;e++){const t=e/s*r+a,n=Math.cos(t),c=Math.sin(t);o.x=b*c,o.y=p*i,o.z=b*n,u.push(o.x,o.y,o.z),h.push(0,i,0),d.x=.5*n+.5,d.y=.5*c*i+.5,m.push(d.x,d.y),l++}for(let e=0;e<s;e++){const o=j+e,t=y+e;!0===n?c.push(t,t+1,o):c.push(t+1,t,o),v+=3}g.addGroup(f,v,!0===n?1:2),f+=v}!function(){const v=new Ss,i=new Ss;let b=0;const j=(t-e)/n;for(let c=0;c<=o;c++){const g=[],f=c/o,b=f*(t-e)+e;for(let e=0;e<=s;e++){const t=e/s,o=t*r+a,c=Math.sin(o),d=Math.cos(o);i.x=b*c,i.y=-f*n+p,i.z=b*d,u.push(i.x,i.y,i.z),v.set(c,j,d).normalize(),h.push(v.x,v.y,v.z),m.push(t,1-f),g.push(l++)}d.push(g)}for(let n=0;n<s;n++)for(let s=0;s<o;s++){const r=d[s][n],i=d[s+1][n],l=d[s+1][n+1],a=d[s][n+1];(e>0||0!==s)&&(c.push(r,i,a),b+=3),(t>0||s!==o-1)&&(c.push(i,l,a),b+=3)}g.addGroup(f,b,0),f+=b}(),!1===i&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Fn(u,3)),this.setAttribute("normal",new Fn(h,3)),this.setAttribute("uv",new Fn(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ch(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ih extends Ch{constructor(e=1,t=1,n=32,s=1,o=!1,i=0,a=2*Math.PI){super(0,e,t,n,s,o,i,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:s,openEnded:o,thetaStart:i,thetaLength:a}}static fromJSON(e){return new Ih(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Bh extends Jn{constructor(e=[],t=[],n=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:s};const o=[],i=[];function d(e,t,n,s){const i=s+1,o=[];for(let s=0;s<=i;s++){o[s]=[];const a=e.clone().lerp(n,s/i),c=t.clone().lerp(n,s/i),r=i-s;for(let e=0;e<=r;e++)o[s][e]=0===e&&s===i?a:a.clone().lerp(c,e/r)}for(let e=0;e<i;e++)for(let n=0;n<2*(i-e)-1;n++){const t=Math.floor(n/2);n%2==0?(a(o[e][t+1]),a(o[e+1][t]),a(o[e][t])):(a(o[e][t+1]),a(o[e+1][t+1]),a(o[e+1][t]))}}function a(e){o.push(e.x,e.y,e.z)}function r(t,n){const s=3*t;n.x=e[s+0],n.y=e[s+1],n.z=e[s+2]}function c(e,t,n,s){s<0&&1===e.x&&(i[t]=e.x-1),0===n.x&&0===n.z&&(i[t]=s/2/Math.PI+.5)}function l(e){return Math.atan2(e.z,-e.x)}function u(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){const n=new Ss,s=new Ss,o=new Ss;for(let i=0;i<t.length;i+=3)r(t[i+0],n),r(t[i+1],s),r(t[i+2],o),d(n,s,o,e)}(s),function(e){const t=new Ss;for(let n=0;n<o.length;n+=3)t.x=o[n+0],t.y=o[n+1],t.z=o[n+2],t.normalize().multiplyScalar(e),o[n+0]=t.x,o[n+1]=t.y,o[n+2]=t.z}(n),function(){const e=new Ss;for(let t=0;t<o.length;t+=3){e.x=o[t+0],e.y=o[t+1],e.z=o[t+2];const n=l(e)/2/Math.PI+.5,s=u(e)/Math.PI+.5;i.push(n,1-s)}(function(){const e=new Ss,t=new Ss,n=new Ss,s=new Ss,a=new ws,r=new ws,d=new ws;for(let u=0,h=0;u<o.length;u+=9,h+=6){e.set(o[u+0],o[u+1],o[u+2]),t.set(o[u+3],o[u+4],o[u+5]),n.set(o[u+6],o[u+7],o[u+8]),a.set(i[h+0],i[h+1]),r.set(i[h+2],i[h+3]),d.set(i[h+4],i[h+5]),s.copy(e).add(t).add(n).divideScalar(3);const m=l(s);c(a,h+0,e,m),c(r,h+2,t,m),c(d,h+4,n,m)}})(),function(){for(let e=0;e<i.length;e+=6){const t=i[e+0],n=i[e+2],s=i[e+4],o=Math.max(t,n,s),a=Math.min(t,n,s);o>.9&&a<.1&&(t<.2&&(i[e+0]+=1),n<.2&&(i[e+2]+=1),s<.2&&(i[e+4]+=1))}}()}(),this.setAttribute("position",new Fn(o,3)),this.setAttribute("normal",new Fn(o.slice(),3)),this.setAttribute("uv",new Fn(i,2)),0===s?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bh(e.vertices,e.indices,e.radius,e.detail)}}class kh extends Bh{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,s=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-n,0,-s,n,0,s,-n,0,s,n,-s,-n,0,-s,n,0,s,-n,0,s,n,0,-n,0,-s,n,0,-s,-n,0,s,n,0,s],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new kh(e.radius,e.detail)}}const Oh=new Ss,Ph=new Ss,Rh=new Ss,Nh=new cn;class Vh extends Jn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const d=4,o=Math.pow(10,d),u=Math.cos(ds*t),a=e.getIndex(),r=e.getAttribute("position"),h=a?a.count:r.count,n=[0,0,0],l=["a","b","c"],s=new Array(3),i={},c=[];for(let e=0;e<h;e+=3){a?(n[0]=a.getX(e),n[1]=a.getX(e+1),n[2]=a.getX(e+2)):(n[0]=e,n[1]=e+1,n[2]=e+2);const{a:t,b:d,c:m}=Nh;if(t.fromBufferAttribute(r,n[0]),d.fromBufferAttribute(r,n[1]),m.fromBufferAttribute(r,n[2]),Nh.getNormal(Rh),s[0]=`${Math.round(t.x*o)},${Math.round(t.y*o)},${Math.round(t.z*o)}`,s[1]=`${Math.round(d.x*o)},${Math.round(d.y*o)},${Math.round(d.z*o)}`,s[2]=`${Math.round(m.x*o)},${Math.round(m.y*o)},${Math.round(m.z*o)}`,s[0]!==s[1]&&s[1]!==s[2]&&s[2]!==s[0])for(let e=0;e<3;e++){const o=(e+1)%3,d=s[e],h=s[o],a=Nh[l[e]],r=Nh[l[o]],m=`${d}_${h}`,t=`${h}_${d}`;t in i&&i[t]?(Rh.dot(i[t].normal)<=u&&(c.push(a.x,a.y,a.z),c.push(r.x,r.y,r.z)),i[t]=null):m in i||(i[m]={index0:n[e],index1:n[o],normal:Rh.clone()})}}for(const e in i)if(i[e]){const{index0:t,index1:n}=i[e];Oh.fromBufferAttribute(r,t),Ph.fromBufferAttribute(r,n),c.push(Oh.x,Oh.y,Oh.z),c.push(Ph.x,Ph.y,Ph.z)}this.setAttribute("position",new Fn(c,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Fh{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){ns("Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,s=this.getPoint(0),o=0;t.push(0);for(let i=1;i<=e;i++)n=this.getPoint(i/e),o+=n.distanceTo(s),t.push(o),s=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const s=this.getLengths();let n=0;const i=s.length;let a;a=t||e*s[i-1];let c,r=0,o=i-1;for(;r<=o;)if(n=Math.floor(r+(o-r)/2),c=s[n]-a,c<0)r=n+1;else{if(!(c>0)){o=n;break}o=n-1}if(n=o,s[n]===a)return n/(i-1);const l=s[n];return(n+(a-l)/(s[n+1]-l))/(i-1)}getTangent(e,t){const o=1e-4;let n=e-o,s=e+o;n<0&&(n=0),s>1&&(s=1);const i=this.getPoint(n),r=this.getPoint(s),a=t||(i.isVector2?new ws:new Ss);return a.copy(r).sub(i).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const r=new Ss,n=[],s=[],o=[],i=new Ss,c=new Mr;for(let t=0;t<=e;t++){const s=t/e;n[t]=this.getTangentAt(s,new Ss)}s[0]=new Ss,o[0]=new Ss;let a=Number.MAX_VALUE;const l=Math.abs(n[0].x),d=Math.abs(n[0].y),u=Math.abs(n[0].z);l<=a&&(a=l,r.set(1,0,0)),d<=a&&(a=d,r.set(0,1,0)),u<=a&&r.set(0,0,1),i.crossVectors(n[0],r).normalize(),s[0].crossVectors(n[0],i),o[0].crossVectors(n[0],s[0]);for(let t=1;t<=e;t++){if(s[t]=s[t-1].clone(),o[t]=o[t-1].clone(),i.crossVectors(n[t-1],n[t]),i.length()>Number.EPSILON){i.normalize();const e=Math.acos(ys(n[t-1].dot(n[t]),-1,1));s[t].applyMatrix4(c.makeRotationAxis(i,e))}o[t].crossVectors(n[t],s[t])}if(!0===t){let t=Math.acos(ys(s[0].dot(s[e]),-1,1));t/=e,n[0].dot(i.crossVectors(s[0],s[e]))>0&&(t=-t);for(let i=1;i<=e;i++)s[i].applyMatrix4(c.makeRotationAxis(n[i],t*i)),o[i].crossVectors(n[i],s[i])}return{tangents:n,normals:s,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Eh extends Fh{constructor(e=0,t=0,n=1,s=1,o=0,i=2*Math.PI,a=!1,r=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=s,this.aStartAngle=o,this.aEndAngle=i,this.aClockwise=a,this.aRotation=r}getPoint(e,t=new ws){const c=t,s=2*Math.PI;let n=this.aEndAngle-this.aStartAngle;const a=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=s;for(;n>s;)n-=s;n<Number.EPSILON&&(n=a?0:s),!0!==this.aClockwise||a||(n===s?n=-s:n-=s);const r=this.aStartAngle+e*n;let o=this.aX+this.xRadius*Math.cos(r),i=this.aY+this.yRadius*Math.sin(r);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=o-this.aX,s=i-this.aY;o=n*e-s*t+this.aX,i=n*t+s*e+this.aY}return c.set(o,i)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Lh extends Eh{constructor(e,t,n,s,o,i){super(e,t,n,n,s,o,i),this.isArcCurve=!0,this.type="ArcCurve"}}function jh(){let e=0,t=0,n=0,s=0;function o(o,i,a,r){e=o,t=a,n=-3*o+3*i-2*a-r,s=2*o-2*i+a+r}return{initCatmullRom:function(e,t,n,s,i){o(t,n,i*(n-e),i*(s-t))},initNonuniformCatmullRom:function(e,t,n,s,i,a,r){let c=(t-e)/i-(n-e)/(i+a)+(n-t)/a,l=(n-t)/a-(s-t)/(a+r)+(s-n)/r;c*=a,l*=a,o(t,n,c,l)},calc:function(o){const i=o*o;return e+t*o+n*i+s*(i*o)}}}const Dh=new Ss,Uh=new jh,Wh=new jh,qh=new jh;class Jh extends Fh{constructor(e=[],t=!1,n="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=s}getPoint(e,t=new Ss){const d=t,o=this.points,n=o.length,u=(n-(this.closed?0:1))*e;let i,a,s=Math.floor(u),l=u-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/n)+1)*n:0===l&&s===n-1&&(s=n-2,l=1),this.closed||s>0?i=o[(s-1)%n]:(Dh.subVectors(o[0],o[1]).add(o[0]),i=Dh);const r=o[s%n],c=o[(s+1)%n];if(this.closed||s+2<n?a=o[(s+2)%n]:(Dh.subVectors(o[n-1],o[n-2]).add(o[n-1]),a=Dh),"centripetal"===this.curveType||"chordal"===this.curveType){const s="chordal"===this.curveType?.5:.25;let t=Math.pow(i.distanceToSquared(r),s),e=Math.pow(r.distanceToSquared(c),s),n=Math.pow(c.distanceToSquared(a),s);e<1e-4&&(e=1),t<1e-4&&(t=e),n<1e-4&&(n=e),Uh.initNonuniformCatmullRom(i.x,r.x,c.x,a.x,t,e,n),Wh.initNonuniformCatmullRom(i.y,r.y,c.y,a.y,t,e,n),qh.initNonuniformCatmullRom(i.z,r.z,c.z,a.z,t,e,n)}else"catmullrom"===this.curveType&&(Uh.initCatmullRom(i.x,r.x,c.x,a.x,this.tension),Wh.initCatmullRom(i.y,r.y,c.y,a.y,this.tension),qh.initCatmullRom(i.z,r.z,c.z,a.z,this.tension));return d.set(Uh.calc(l),Wh.calc(l),qh.calc(l)),d}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push((new Ss).fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Xh(e,t,n,s,o){const i=.5*(s-t),a=.5*(o-n),r=e*e;return(2*n-2*s+i+a)*(e*r)+(-3*n+3*s-2*i-a)*r+i*e+n}function Yh(e,t,n,s){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,s)}function Zh(e,t,n,s,o){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,s)+function(e,t){return e*e*e*t}(e,o)}class Hh extends Fh{constructor(e=new ws,t=new ws,n=new ws,s=new ws){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new ws){const n=t,s=this.v0,o=this.v1,i=this.v2,a=this.v3;return n.set(Zh(e,s.x,o.x,i.x,a.x),Zh(e,s.y,o.y,i.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Gh extends Fh{constructor(e=new Ss,t=new Ss,n=new Ss,s=new Ss){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new Ss){const a=t,n=this.v0,s=this.v1,o=this.v2,i=this.v3;return a.set(Zh(e,n.x,s.x,o.x,i.x),Zh(e,n.y,s.y,o.y,i.y),Zh(e,n.z,s.z,o.z,i.z)),a}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class $h extends Fh{constructor(e=new ws,t=new ws){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ws){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ws){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Qh extends Fh{constructor(e=new Ss,t=new Ss){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Ss){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ss){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Kh extends Fh{constructor(e=new ws,t=new ws,n=new ws){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ws){const n=t,s=this.v0,o=this.v1,i=this.v2;return n.set(Yh(e,s.x,o.x,i.x),Yh(e,s.y,o.y,i.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class tl extends Fh{constructor(e=new Ss,t=new Ss,n=new Ss){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ss){const i=t,n=this.v0,s=this.v1,o=this.v2;return i.set(Yh(e,n.x,s.x,o.x),Yh(e,n.y,s.y,o.y),Yh(e,n.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class el extends Fh{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ws){const o=t,n=this.points,i=(n.length-1)*e,s=Math.floor(i),a=i-s,r=n[0===s?s:s-1],c=n[s],l=n[s>n.length-2?n.length-1:s+1],d=n[s>n.length-3?n.length-1:s+2];return o.set(Xh(a,r.x,c.x,l.x,d.x),Xh(a,r.y,c.y,l.y,d.y)),o}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push((new ws).fromArray(s))}return this}}var il=Object.freeze({__proto__:null,ArcCurve:Lh,CatmullRomCurve3:Jh,CubicBezierCurve:Hh,CubicBezierCurve3:Gh,EllipseCurve:Eh,LineCurve:$h,LineCurve3:Qh,QuadraticBezierCurve:Kh,QuadraticBezierCurve3:tl,SplineCurve:el}),$l;class sl extends Fh{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new il[n](t,e))}return this}getPoint(e,t){const o=e*this.getLength(),s=this.getCurveLengths();let n=0;for(;n<s.length;){if(s[n]>=o){const a=s[n]-o,e=this.curves[n],i=e.getLength(),r=0===i?0:1-a/i;return e.getPointAt(r,t)}n++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,s=this.curves.length;n<s;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let o=0,i=this.curves;o<i.length;o++){const s=i[o],r=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,a=s.getPoints(r);for(let e=0;e<a.length;e++){const s=a[e];n&&n.equals(s)||(t.push(s),n=s)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,s=e.curves.length;t<s;t++){const n=e.curves[t];this.curves.push((new il[n.type]).fromJSON(n))}return this}}class rl extends sl{constructor(e){super(),this.type="Path",this.currentPoint=new ws,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new $h(this.currentPoint.clone(),new ws(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,s){const o=new Kh(this.currentPoint.clone(),new ws(e,t),new ws(n,s));return this.curves.push(o),this.currentPoint.set(n,s),this}bezierCurveTo(e,t,n,s,o,i){const a=new Hh(this.currentPoint.clone(),new ws(e,t),new ws(n,s),new ws(o,i));return this.curves.push(a),this.currentPoint.set(o,i),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new el(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,s,o,i){const a=this.currentPoint.x,r=this.currentPoint.y;return this.absarc(e+a,t+r,n,s,o,i),this}absarc(e,t,n,s,o,i){return this.absellipse(e,t,n,n,s,o,i),this}ellipse(e,t,n,s,o,i,a,r){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+c,t+l,n,s,o,i,a,r),this}absellipse(e,t,n,s,o,i,a,r){const c=new Eh(e,t,n,s,o,i,a,r);if(this.curves.length>0){const e=c.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class nl extends rl{constructor(e){super(e),this.uuid=ms(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,s=this.holes.length;n<s;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push((new rl).fromJSON(s))}return this}}function al(e,t,n=2){const c=t&&t.length,l=c?t[0]*n:e.length;let s=ol(e,0,l,n,!0);const r=[];if(!s||s.next===s.prev)return r;let o,i,a;if(c&&(s=function(e,t,n,s){const o=[];for(let n=0,a=t.length;n<a;n++){const i=ol(e,t[n]*s,n<a-1?t[n+1]*s:e.length,s,!1);i===i.next&&(i.steiner=!0),o.push(xl(i))}o.sort(ml);for(let e=0;e<o.length;e++)n=yl(o[e],n);return n}(e,t,s,n)),e.length>80*n){o=e[0],i=e[1];let t=o,s=i;for(let a=n;a<l;a+=n){const r=e[a],c=e[a+1];r<o&&(o=r),c<i&&(i=c),r>t&&(t=r),c>s&&(s=c)}a=Math.max(t-o,s-i),a=0!==a?32767/a:0}return ll(s,r,n,o,i,a,0),r}function ol(e,t,n,s,o){let i;if(o===function(e,t,n,s){let o=0;for(let i=t,a=n-s;i<n;i+=s)o+=(e[a]-e[i])*(e[i+1]+e[a+1]),a=i;return o}(e,t,n,s)>0)for(let o=t;o<n;o+=s)i=Il(o/s|0,e[o],e[o+1],i);else for(let o=n-s;o>=t;o-=s)i=Il(o/s|0,e[o],e[o+1],i);return i&&Sl(i,i.next)&&(Bl(i),i=i.next),i}function hl(e,t){if(!e)return e;t||(t=e);let s,n=e;do if(s=!1,n.steiner||!Sl(n,n.next)&&0!==Ml(n.prev,n,n.next))n=n.next;else{if(Bl(n),n=t=n.prev,n===n.next)break;s=!0}while(s||n!==t)return t}function ll(e,t,n,s,o,i,a){if(!e)return;!a&&i&&function(e,t,n,s){let o=e;do 0===o.z&&(o.z=fl(o.x,o.y,t,n,s)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e)o.prevZ.nextZ=null,o.prevZ=null,function(e){let t,n=1;do{let o,s=e;e=null;let i=null;for(t=0;s;){t++;let a=s,r=0;for(let e=0;e<n&&(r++,a=a.nextZ,a);e++);let c=n;for(;r>0||c>0&&a;)0!==r&&(0===c||!a||s.z<=a.z)?(o=s,s=s.nextZ,r--):(o=a,a=a.nextZ,c--),i?i.nextZ=o:e=o,o.prevZ=i,i=o;s=a}i.nextZ=null,n*=2}while(t>1)}(o)}(e,s,o,i);let r=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(i?ul(e,s,o,i):cl(e))t.push(l.i,e.i,c.i),Bl(e),e=c.next,r=c.next;else if((e=c)===r){a?1===a?ll(e=dl(hl(e),t),t,n,s,o,i,2):2===a&&pl(e,t,n,s,o,i):ll(hl(e),t,n,s,o,i,1);break}}}function cl(e){const n=e.prev,d=e,s=e.next;if(Ml(n,d,s)>=0)return!1;const r=n.x,i=d.x,a=s.x,o=n.y,c=d.y,l=s.y,u=Math.min(r,i,a),h=Math.min(o,c,l),m=Math.max(r,i,a),f=Math.max(o,c,l);let t=s.next;for(;t!==n;){if(t.x>=u&&t.x<=m&&t.y>=h&&t.y<=f&&vl(r,o,i,c,a,l,t.x,t.y)&&Ml(t.prev,t,t.next)>=0)return!1;t=t.next}return!0}function ul(e,t,n,s){const a=e.prev,b=e,r=e.next;if(Ml(a,b,r)>=0)return!1;const m=a.x,h=b.x,l=r.x,d=a.y,u=b.y,c=r.y,f=Math.min(m,h,l),p=Math.min(d,u,c),g=Math.max(m,h,l),v=Math.max(d,u,c),j=fl(f,p,t,n,s),y=fl(g,v,t,n,s);let i=e.prevZ,o=e.nextZ;for(;i&&i.z>=j&&o&&o.z<=y;){if(i.x>=f&&i.x<=g&&i.y>=p&&i.y<=v&&i!==a&&i!==r&&vl(m,d,h,u,l,c,i.x,i.y)&&Ml(i.prev,i,i.next)>=0)return!1;if(i=i.prevZ,o.x>=f&&o.x<=g&&o.y>=p&&o.y<=v&&o!==a&&o!==r&&vl(m,d,h,u,l,c,o.x,o.y)&&Ml(o.prev,o,o.next)>=0)return!1;o=o.nextZ}for(;i&&i.z>=j;){if(i.x>=f&&i.x<=g&&i.y>=p&&i.y<=v&&i!==a&&i!==r&&vl(m,d,h,u,l,c,i.x,i.y)&&Ml(i.prev,i,i.next)>=0)return!1;i=i.prevZ}for(;o&&o.z<=y;){if(o.x>=f&&o.x<=g&&o.y>=p&&o.y<=v&&o!==a&&o!==r&&vl(m,d,h,u,l,c,o.x,o.y)&&Ml(o.prev,o,o.next)>=0)return!1;o=o.nextZ}return!0}function dl(e,t){let n=e;do{const o=n.prev,s=n.next.next;!Sl(o,s)&&_l(o,n,n.next,s)&&zl(o,s)&&zl(s,o)&&(t.push(o.i,n.i,s.i),Bl(n),Bl(n.next),n=e=s),n=n.next}while(n!==e)return hl(n)}function pl(e,t,n,s,o,i){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&wl(a,e)){let r=Cl(a,e);return a=hl(a,a.next),r=hl(r,r.next),ll(a,t,n,s,o,i,0),void ll(r,t,n,s,o,i,0)}e=e.next}a=a.next}while(a!==e)}function ml(e,t){let n=e.x-t.x;return 0===n&&(n=e.y-t.y,0===n)&&(n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function yl(e,t){const n=function(e,t){let n=t;const i=e.x,o=e.y;let s,a=-1/0;if(Sl(e,n))return n;do{if(Sl(e,n.next))return n.next;if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const e=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>a&&(a=e,s=n.x<n.next.x?n:n.next,e===i))return s}n=n.next}while(n!==t)if(!s)return null;const d=s,l=s.x,r=s.y;let c=1/0;n=s;do{if(i>=n.x&&n.x>=l&&i!==n.x&&bl(o<r?i:a,o,l,r,o<r?a:i,o,n.x,n.y)){const t=Math.abs(o-n.y)/(i-n.x);zl(n,e)&&(t<c||t===c&&(n.x>s.x||n.x===s.x&&gl(s,n)))&&(s=n,c=t)}n=n.next}while(n!==d)return s}(e,t);if(!n)return t;const s=Cl(n,e);return hl(s,s.next),hl(n,n.next)}function gl(e,t){return Ml(e.prev,e,t.prev)<0&&Ml(t.next,e,e.next)<0}function fl(e,t,n,s,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function xl(e){let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e)return n}function bl(e,t,n,s,o,i,a,r){return(o-a)*(t-r)>=(e-a)*(i-r)&&(e-a)*(s-r)>=(n-a)*(t-r)&&(n-a)*(i-r)>=(o-a)*(s-r)}function vl(e,t,n,s,o,i,a,r){return(e!==a||t!==r)&&bl(e,t,n,s,o,i,a,r)}function wl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&_l(n,n.next,e,t))return!0;n=n.next}while(n!==e)return!1}(e,t)&&(zl(e,t)&&zl(t,e)&&function(e,t){let n=e,s=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(s=!s),n=n.next;while(n!==e)return s}(e,t)&&(Ml(e.prev,e,t.prev)||Ml(e,t.prev,t))||Sl(e,t)&&Ml(e.prev,e,e.next)>0&&Ml(t.prev,t,t.next)>0)}function Ml(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Sl(e,t){return e.x===t.x&&e.y===t.y}function _l(e,t,n,s){const o=Tl(Ml(e,t,n)),i=Tl(Ml(e,t,s)),a=Tl(Ml(n,s,e)),r=Tl(Ml(n,s,t));return o!==i&&a!==r||0===o&&!!Al(e,n,t)||0===i&&!!Al(e,s,t)||0===a&&!!Al(n,e,s)||0===r&&!!Al(n,t,s)}function Al(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Tl(e){return e>0?1:e<0?-1:0}function zl(e,t){return Ml(e.prev,e,e.next)<0?Ml(e,t,e.next)>=0&&Ml(e,e.prev,t)>=0:Ml(e,t,e.prev)<0||Ml(e,e.next,t)<0}function Cl(e,t){const s=kl(e.i,e.x,e.y),n=kl(t.i,t.x,t.y),o=e.next,i=t.prev;return e.next=t,t.prev=e,s.next=o,o.prev=s,n.next=s,s.prev=n,i.next=n,n.prev=i,n}function Il(e,t,n,s){const o=kl(e,t,n);return s?(o.next=s.next,o.prev=s,s.next.prev=o,s.next=o):(o.prev=o,o.next=o),o}function Bl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function kl(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ol{static triangulate(e,t,n=2){return al(e,t,n)}}class Pl{static area(e){const t=e.length;let n=0;for(let o=t-1,s=0;s<t;o=s++)n+=e[o].x*e[s].y-e[s].x*e[o].y;return.5*n}static isClockWise(e){return Pl.area(e)<0}static triangulateShape(e,t){const n=[],s=[],o=[];Rl(e),Nl(n,e);let i=e.length;t.forEach(Rl);for(let e=0;e<t.length;e++)s.push(i),i+=t[e].length,Nl(n,t[e]);const a=Ol.triangulate(n,s);for(let e=0;e<a.length;e+=3)o.push(a.slice(e,e+3));return o}}function Rl(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Nl(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Vl extends Jn{constructor(e=new nl([new ws(.5,.5),new ws(-.5,.5),new ws(-.5,-.5),new ws(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const s=this,n=[],o=[];for(let t=0,n=e.length;t<n;t++)i(e[t]);function i(e){const b=[],$=void 0!==t.curveSegments?t.curveSegments:12,c=void 0!==t.steps?t.steps:1,N=void 0!==t.depth?t.depth:1;let y=void 0===t.bevelEnabled||t.bevelEnabled,M=void 0!==t.bevelThickness?t.bevelThickness:.2,E=void 0!==t.bevelSize?t.bevelSize:M-.1,S=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const j=t.extrudePath,R=void 0!==t.UVGenerator?t.UVGenerator:Fl;let w,x,O,_,h,T=!1;if(j){w=j.getSpacedPoints(c),T=!0,y=!1;const e=!!j.isCatmullRomCurve3&&j.closed;x=j.computeFrenetFrames(c,e),O=new Ss,_=new Ss,h=new Ss}y||(p=0,M=0,E=0,S=0);const B=e.extractPoints($);let a=B.shape;const i=B.holes;if(!Pl.isClockWise(a)){a=a.reverse();for(let e=0,n=i.length;e<n;e++){const t=i[e];Pl.isClockWise(t)&&(i[e]=t.reverse())}}function I(e){const n=1e-10*1e-10;let t=e[0];for(let o=1;o<=e.length;o++){const i=o%e.length,s=e[i],a=s.x-t.x,r=s.y-t.y,l=a*a+r*r,c=Math.max(Math.abs(s.x),Math.abs(s.y),Math.abs(t.x),Math.abs(t.y));l<=n*c*c?(e.splice(i,1),o--):t=s}}I(a),i.forEach(I);const D=i.length,r=a;for(let e=0;e<D;e++){const t=i[e];a=a.concat(t)}function v(e,t,n){return t||as("ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const m=a.length;function L(e,t,n){let a,r,l;const s=e.x-t.x,o=e.y-t.y,i=n.x-e.x,c=n.y-e.y,d=s*s+o*o,u=s*c-o*i;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(d),h=Math.sqrt(i*i+c*c),m=t.x-o/u,f=t.y+s/u,p=((n.x-c/h-m)*c-(n.y+i/h-f)*i)/(s*c-o*i);a=m+s*p-e.x,r=f+o*p-e.y;const g=a*a+r*r;if(g<=2)return new ws(a,r);l=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?i>Number.EPSILON&&(e=!0):s<-Number.EPSILON?i<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(a=-o,r=s,l=Math.sqrt(d)):(a=s,r=o,l=Math.sqrt(d/2))}return new ws(a/l,r/l)}const F=[];for(let e=0,t=r.length,n=t-1,s=e+1;e<t;e++,n++,s++)n===t&&(n=0),s===t&&(s=0),F[e]=L(r[e],r[n],r[s]);const z=[];let f,g,A=F.concat();for(let t=0,n=D;t<n;t++){const e=i[t];f=[];for(let t=0,n=e.length,s=n-1,o=t+1;t<n;t++,s++,o++)s===n&&(s=0),o===n&&(o=0),f[t]=L(e[t],e[s],e[o]);z.push(f),A=A.concat(f)}if(0===p)g=Pl.triangulateShape(r,i);else{const e=[],t=[];for(let s=0;s<p;s++){const n=s/p,o=M*Math.cos(n*Math.PI/2),a=E*Math.sin(n*Math.PI/2)+S;for(let t=0,i=r.length;t<i;t++){const s=v(r[t],F[t],a);u(s.x,s.y,-o),0===n&&e.push(s)}for(let e=0,c=D;e<c;e++){const s=i[e];f=z[e];const r=[];for(let e=0,i=s.length;e<i;e++){const t=v(s[e],f[e],a);u(t.x,t.y,-o),0===n&&r.push(t)}0===n&&t.push(r)}}g=Pl.triangulateShape(e,t)}const C=g.length,P=E+S;for(let e=0;e<m;e++){const t=y?v(a[e],A[e],P):a[e];T?(_.copy(x.normals[0]).multiplyScalar(t.x),O.copy(x.binormals[0]).multiplyScalar(t.y),h.copy(w[0]).add(_).add(O),u(h.x,h.y,h.z)):u(t.x,t.y,0)}for(let e=1;e<=c;e++)for(let t=0;t<m;t++){const n=y?v(a[t],A[t],P):a[t];T?(_.copy(x.normals[e]).multiplyScalar(n.x),O.copy(x.binormals[e]).multiplyScalar(n.y),h.copy(w[e]).add(_).add(O),u(h.x,h.y,h.z)):u(n.x,n.y,N/c*e)}for(let e=p-1;e>=0;e--){const n=e/p,t=M*Math.cos(n*Math.PI/2),s=E*Math.sin(n*Math.PI/2)+S;for(let e=0,o=r.length;e<o;e++){const n=v(r[e],F[e],s);u(n.x,n.y,N+t)}for(let e=0,o=i.length;e<o;e++){const n=i[e];f=z[e];for(let e=0,i=n.length;e<i;e++){const o=v(n[e],f[e],s);T?u(o.x,o.y+w[c-1].y,w[c-1].x+t):u(o.x,o.y,N+t)}}}function H(e,t){let n=e.length;for(;--n>=0;){const o=n;let s=n-1;s<0&&(s=e.length-1);for(let e=0,a=c+2*p;e<a;e++){const n=m*e,i=m*(e+1);V(t+o+n,t+s+n,t+s+i,t+o+i)}}}function u(e,t,n){b.push(e),b.push(t),b.push(n)}function k(e,t,o){d(e),d(t),d(o);const i=n.length/3,a=R.generateTopUV(s,n,i-3,i-2,i-1);l(a[0]),l(a[1]),l(a[2])}function V(e,t,o,i){d(e),d(t),d(i),d(t),d(o),d(i);const r=n.length/3,a=R.generateSideWallUV(s,n,r-6,r-3,r-2,r-1);l(a[0]),l(a[1]),l(a[3]),l(a[1]),l(a[2]),l(a[3])}function d(e){n.push(b[3*e+0]),n.push(b[3*e+1]),n.push(b[3*e+2])}function l(e){o.push(e.x),o.push(e.y)}!function(){const e=n.length/3;if(y){let t=0,e=m*t;for(let t=0;t<C;t++){const n=g[t];k(n[2]+e,n[1]+e,n[0]+e)}t=c+2*p,e=m*t;for(let t=0;t<C;t++){const n=g[t];k(n[0]+e,n[1]+e,n[2]+e)}}else{for(let e=0;e<C;e++){const t=g[e];k(t[2],t[1],t[0])}for(let e=0;e<C;e++){const t=g[e];k(t[0]+m*c,t[1]+m*c,t[2]+m*c)}}s.addGroup(e,n.length/3-e,0)}(),function(){const t=n.length/3;let e=0;H(r,e),e+=r.length;for(let t=0,s=i.length;t<s;t++){const n=i[t];H(n,e),e+=n.length}s.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Fn(n,3)),this.setAttribute("uv",new Fn(o,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,s=e.length;t<s;t++){const o=e[t];n.shapes.push(o.uuid)}else n.shapes.push(e.uuid);return n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const s=[];for(let n=0,o=e.shapes.length;n<o;n++){const i=t[e.shapes[n]];s.push(i)}const n=e.options.extrudePath;return void 0!==n&&(e.options.extrudePath=(new il[n.type]).fromJSON(n)),new Vl(s,e.options)}}const Fl={generateTopUV:function(e,t,n,s,o){const i=t[3*n],a=t[3*n+1],r=t[3*s],c=t[3*s+1],l=t[3*o],d=t[3*o+1];return[new ws(i,a),new ws(r,c),new ws(l,d)]},generateSideWallUV:function(e,t,n,s,o,i){const a=t[3*n],r=t[3*n+1],c=t[3*n+2],l=t[3*s],d=t[3*s+1],u=t[3*s+2],f=t[3*o],p=t[3*o+1],h=t[3*o+2],g=t[3*i],v=t[3*i+1],m=t[3*i+2];return Math.abs(r-d)<Math.abs(a-l)?[new ws(a,1-c),new ws(l,1-u),new ws(f,1-h),new ws(g,1-m)]:[new ws(r,1-c),new ws(d,1-u),new ws(p,1-h),new ws(v,1-m)]}};class El extends Bh{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new El(e.radius,e.detail)}}class Ll extends Jn{constructor(e=[new ws(0,-.5),new ws(.5,0),new ws(0,.5)],t=12,n=0,s=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:s},t=Math.floor(t),s=ys(s,0,2*Math.PI);const u=[],p=[],m=[],r=[],h=[],g=1/t,a=new Ss,l=new ws,o=new Ss,f=new Ss,i=new Ss;let d=0,c=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:d=e[t+1].x-e[t].x,c=e[t+1].y-e[t].y,o.x=1*c,o.y=-d,o.z=0*c,i.copy(o),o.normalize(),r.push(o.x,o.y,o.z);break;case e.length-1:r.push(i.x,i.y,i.z);break;default:d=e[t+1].x-e[t].x,c=e[t+1].y-e[t].y,o.x=1*c,o.y=-d,o.z=0*c,f.copy(o),o.x+=i.x,o.y+=i.y,o.z+=i.z,o.normalize(),r.push(o.x,o.y,o.z),i.copy(f)}for(let o=0;o<=t;o++){const i=n+o*g*s,c=Math.sin(i),d=Math.cos(i);for(let n=0;n<=e.length-1;n++){a.x=e[n].x*c,a.y=e[n].y,a.z=e[n].x*d,p.push(a.x,a.y,a.z),l.x=o/t,l.y=n/(e.length-1),m.push(l.x,l.y);const s=r[3*n+0]*c,i=r[3*n+1],u=r[3*n+0]*d;h.push(s,i,u)}}for(let n=0;n<t;n++)for(let s=0;s<e.length-1;s++){const t=s+n*e.length,a=t,o=t+e.length,r=t+e.length+1,i=t+1;u.push(a,o,i),u.push(r,i,o)}this.setIndex(u),this.setAttribute("position",new Fn(p,3)),this.setAttribute("uv",new Fn(m,2)),this.setAttribute("normal",new Fn(h,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ll(e.points,e.segments,e.phiStart,e.phiLength)}}class jl extends Bh{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new jl(e.radius,e.detail)}}class Dl extends Jn{constructor(e=1,t=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};const u=e/2,h=t/2,i=Math.floor(n),a=Math.floor(s),o=i+1,m=a+1,f=e/i,p=t/a,r=[],l=[],d=[],c=[];for(let e=0;e<m;e++){const t=e*p-h;for(let n=0;n<o;n++){const s=n*f-u;l.push(s,-t,0),d.push(0,0,1),c.push(n/i),c.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<i;t++){const a=t+o*e,n=t+o*(e+1),c=t+1+o*(e+1),s=t+1+o*e;r.push(a,n,s),r.push(n,c,s)}this.setIndex(r),this.setAttribute("position",new Fn(l,3)),this.setAttribute("normal",new Fn(d,3)),this.setAttribute("uv",new Fn(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Dl(e.width,e.height,e.widthSegments,e.heightSegments)}}class Ul extends Jn{constructor(e=.5,t=1,n=32,s=1,o=0,i=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:s,thetaStart:o,thetaLength:i},n=Math.max(3,n);const c=[],d=[],u=[],h=[];let l=e;const m=(t-e)/(s=Math.max(1,s)),a=new Ss,r=new ws;for(let e=0;e<=s;e++){for(let e=0;e<=n;e++){const s=o+e/n*i;a.x=l*Math.cos(s),a.y=l*Math.sin(s),d.push(a.x,a.y,a.z),u.push(0,0,1),r.x=(a.x/t+1)/2,r.y=(a.y/t+1)/2,h.push(r.x,r.y)}l+=m}for(let e=0;e<s;e++){const t=e*(n+1);for(let s=0;s<n;s++){const e=s+t,a=e,o=e+n+1,r=e+n+2,i=e+1;c.push(a,o,i),c.push(o,r,i)}}this.setIndex(c),this.setAttribute("position",new Fn(d,3)),this.setAttribute("normal",new Fn(u,3)),this.setAttribute("uv",new Fn(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ul(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Wl extends Jn{constructor(e=new nl([new ws(0,.5),new ws(-.5,-.5),new ws(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const o=[],s=[],i=[],a=[];let r=0,n=0;if(!1===Array.isArray(e))c(e);else for(let t=0;t<e.length;t++)c(e[t]),this.addGroup(r,n,t),r+=n,n=0;function c(e){const l=s.length/3,d=e.extractPoints(t);let r=d.shape;const c=d.holes;!1===Pl.isClockWise(r)&&(r=r.reverse());for(let e=0,n=c.length;e<n;e++){const t=c[e];!0===Pl.isClockWise(t)&&(c[e]=t.reverse())}const u=Pl.triangulateShape(r,c);for(let e=0,t=c.length;e<t;e++){const n=c[e];r=r.concat(n)}for(let t=0,n=r.length;t<n;t++){const e=r[t];s.push(e.x,e.y,0),i.push(0,0,1),a.push(e.x,e.y)}for(let e=0,s=u.length;e<s;e++){const t=u[e],i=t[0]+l,a=t[1]+l,r=t[2]+l;o.push(i,a,r),n+=3}}this.setIndex(o),this.setAttribute("position",new Fn(s,3)),this.setAttribute("normal",new Fn(i,3)),this.setAttribute("uv",new Fn(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,s=e.length;n<s;n++){const o=e[n];t.shapes.push(o.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let s=0,o=e.shapes.length;s<o;s++){const i=t[e.shapes[s]];n.push(i)}return new Wl(n,e.curveSegments)}}class ql extends Jn{constructor(e=1,t=32,n=16,s=0,o=2*Math.PI,i=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:s,phiLength:o,thetaStart:i,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const u=Math.min(i+a,Math.PI);let p=0;const c=[],r=new Ss,l=new Ss,d=[],h=[],m=[],f=[];for(let d=0;d<=n;d++){const b=[],g=d/n;let v=0;0===d&&0===i?v=.5/t:d===n&&u===Math.PI&&(v=-.5/t);for(let n=0;n<=t;n++){const c=n/t;r.x=-e*Math.cos(s+c*o)*Math.sin(i+g*a),r.y=e*Math.cos(i+g*a),r.z=e*Math.sin(s+c*o)*Math.sin(i+g*a),h.push(r.x,r.y,r.z),l.copy(r).normalize(),m.push(l.x,l.y,l.z),f.push(c+v,1-g),b.push(p++)}c.push(b)}for(let e=0;e<n;e++)for(let s=0;s<t;s++){const r=c[e][s+1],o=c[e][s],l=c[e+1][s],a=c[e+1][s+1];(0!==e||i>0)&&d.push(r,o,a),(e!==n-1||u<Math.PI)&&d.push(o,l,a)}this.setIndex(d),this.setAttribute("position",new Fn(h,3)),this.setAttribute("normal",new Fn(m,3)),this.setAttribute("uv",new Fn(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ql(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Jl extends Bh{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Jl(e.radius,e.detail)}}class Xl extends Jn{constructor(e=1,t=.4,n=12,s=48,o=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:s,arc:o},n=Math.floor(n),s=Math.floor(s);const r=[],d=[],u=[],c=[],l=new Ss,i=new Ss,a=new Ss;for(let r=0;r<=n;r++)for(let h=0;h<=s;h++){const m=h/s*o,f=r/n*Math.PI*2;i.x=(e+t*Math.cos(f))*Math.cos(m),i.y=(e+t*Math.cos(f))*Math.sin(m),i.z=t*Math.sin(f),d.push(i.x,i.y,i.z),l.x=e*Math.cos(m),l.y=e*Math.sin(m),a.subVectors(i,l).normalize(),u.push(a.x,a.y,a.z),c.push(h/s),c.push(r/n)}for(let e=1;e<=n;e++)for(let t=1;t<=s;t++){const i=(s+1)*e+t-1,n=(s+1)*(e-1)+t-1,a=(s+1)*(e-1)+t,o=(s+1)*e+t;r.push(i,n,o),r.push(n,a,o)}this.setIndex(r),this.setAttribute("position",new Fn(d,3)),this.setAttribute("normal",new Fn(u,3)),this.setAttribute("uv",new Fn(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xl(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Yl extends Jn{constructor(e=1,t=.4,n=64,s=8,o=2,i=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:s,p:o,q:i},n=Math.floor(n),s=Math.floor(s);const u=[],p=[],g=[],h=[],a=new Ss,d=new Ss,r=new Ss,m=new Ss,l=new Ss,f=new Ss,c=new Ss;for(let u=0;u<=n;++u){const b=u/n*o*Math.PI*2;v(b,o,i,e,r),v(b+.01,o,i,e,m),f.subVectors(m,r),c.addVectors(m,r),l.crossVectors(f,c),c.crossVectors(l,f),l.normalize(),c.normalize();for(let e=0;e<=s;++e){const m=e/s*Math.PI*2,o=-t*Math.cos(m),i=t*Math.sin(m);a.x=r.x+(o*c.x+i*l.x),a.y=r.y+(o*c.y+i*l.y),a.z=r.z+(o*c.z+i*l.z),p.push(a.x,a.y,a.z),d.subVectors(a,r).normalize(),g.push(d.x,d.y,d.z),h.push(u/n),h.push(e/s)}}for(let e=1;e<=n;e++)for(let t=1;t<=s;t++){const i=(s+1)*(e-1)+(t-1),n=(s+1)*e+(t-1),a=(s+1)*e+t,o=(s+1)*(e-1)+t;u.push(i,n,o),u.push(n,a,o)}function v(e,t,n,s,o){const r=Math.cos(e),c=Math.sin(e),i=n/t*e,a=Math.cos(i);o.x=s*(2+a)*.5*r,o.y=s*(2+a)*c*.5,o.z=s*Math.sin(i)*.5}this.setIndex(u),this.setAttribute("position",new Fn(p,3)),this.setAttribute("normal",new Fn(g,3)),this.setAttribute("uv",new Fn(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yl(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Zl extends Jn{constructor(e=new tl(new Ss(-1,-1,0),new Ss(-1,1,0),new Ss(1,1,0)),t=64,n=1,s=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:s,closed:o};const r=e.computeFrenetFrames(t,o);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const a=new Ss,i=new Ss,l=new ws;let c=new Ss;const u=[],h=[],m=[],d=[];function f(o){c=e.getPointAt(o/t,c);const l=r.normals[o],d=r.binormals[o];for(let e=0;e<=s;e++){const r=e/s*Math.PI*2,t=Math.sin(r),o=-Math.cos(r);i.x=o*l.x+t*d.x,i.y=o*l.y+t*d.y,i.z=o*l.z+t*d.z,i.normalize(),h.push(i.x,i.y,i.z),a.x=c.x+n*i.x,a.y=c.y+n*i.y,a.z=c.z+n*i.z,u.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===o?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=s;n++)l.x=e/t,l.y=n/s,m.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=s;t++){const i=(s+1)*(e-1)+(t-1),n=(s+1)*e+(t-1),a=(s+1)*e+t,o=(s+1)*(e-1)+t;d.push(i,n,o),d.push(n,a,o)}}()}(),this.setIndex(d),this.setAttribute("position",new Fn(u,3)),this.setAttribute("normal",new Fn(h,3)),this.setAttribute("uv",new Fn(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Zl((new il[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Hl extends Jn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const s=[],o=new Set,t=new Ss,n=new Ss;if(null!==e.index){const r=e.attributes.position,a=e.index;let i=e.groups;0===i.length&&(i=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,d=i.length;e<d;++e){const c=i[e],l=c.start;for(let e=l,i=l+c.count;e<i;e+=3)for(let i=0;i<3;i++){const c=a.getX(e+i),l=a.getX(e+(i+1)%3);t.fromBufferAttribute(r,c),n.fromBufferAttribute(r,l),!0===Gl(t,n,o)&&(s.push(t.x,t.y,t.z),s.push(n.x,n.y,n.z))}}}else{const i=e.attributes.position;for(let e=0,a=i.count/3;e<a;e++)for(let a=0;a<3;a++){const r=3*e+a,c=3*e+(a+1)%3;t.fromBufferAttribute(i,r),n.fromBufferAttribute(i,c),!0===Gl(t,n,o)&&(s.push(t.x,t.y,t.z),s.push(n.x,n.y,n.z))}}this.setAttribute("position",new Fn(s,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Gl(e,t,n){const s=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,o=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(s)&&!0!==n.has(o)&&(n.add(s),n.add(o),!0)}$l=Object.freeze({__proto__:null,BoxGeometry:na,CapsuleGeometry:Th,CircleGeometry:zh,ConeGeometry:Ih,CylinderGeometry:Ch,DodecahedronGeometry:kh,EdgesGeometry:Vh,ExtrudeGeometry:Vl,IcosahedronGeometry:El,LatheGeometry:Ll,OctahedronGeometry:jl,PlaneGeometry:Dl,PolyhedronGeometry:Bh,RingGeometry:Ul,ShapeGeometry:Wl,SphereGeometry:ql,TetrahedronGeometry:Jl,TorusGeometry:Xl,TorusKnotGeometry:Yl,TubeGeometry:Zl,WireframeGeometry:Hl});class Ql extends xn{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new yn(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Kl extends ca{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class tc extends xn{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new yn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ws(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Or,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ec extends tc{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ws(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ys(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new yn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new yn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new yn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class ic extends xn{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new yn(16777215),this.specular=new yn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ws(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Or,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class sc extends xn{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new yn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ws(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class rc extends xn{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ws(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class nc extends xn{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new yn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ws(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Or,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ac extends xn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class oc extends xn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class hc extends xn{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new yn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ws(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class lc extends Ho{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function cc(e,t){return e&&e.constructor!==t?"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}function uc(e){const n=e.length,t=new Array(n);for(let e=0;e!==n;++e)t[e]=e;return t.sort(function(t,n){return e[t]-e[n]}),t}function dc(e,t,n){const s=e.length,o=new e.constructor(s);for(let i=0,a=0;a!==s;++i){const r=n[i]*t;for(let n=0;n!==t;++n)o[a++]=e[r+n]}return o}function pc(e,t,n,s){let a=1,o=e[0];for(;void 0!==o&&void 0===o[s];)o=e[a++];if(void 0===o)return;let i=o[s];if(void 0!==i)if(Array.isArray(i))do i=o[s],void 0!==i&&(t.push(o.time),n.push(...i)),o=e[a++];while(void 0!==o)else if(void 0!==i.toArray)do i=o[s],void 0!==i&&(t.push(o.time),i.toArray(n,n.length)),o=e[a++];while(void 0!==o)else do i=o[s],void 0!==i&&(t.push(o.time),n.push(i)),o=e[a++];while(void 0!==o)}class mc{static convertArray(e,t){return cc(e,t)}static isTypedArray(e){return $i(e)}static getKeyframeOrder(e){return uc(e)}static sortedArray(e,t,n){return dc(e,t,n)}static flattenJSON(e,t,n,s){pc(e,t,n,s)}static subclip(e,t,n,s,o=30){return function(e,t,n,s,o=30){const i=e.clone();i.name=t;const r=[];for(let t=0;t<i.tracks.length;++t){const e=i.tracks[t],c=e.getValueSize(),a=[],l=[];for(let t=0;t<e.times.length;++t){const i=e.times[t]*o;if(!(i<n||i>=s)){a.push(e.times[t]);for(let n=0;n<c;++n)l.push(e.values[t*c+n])}}0!==a.length&&(e.times=cc(a,e.times.constructor),e.values=cc(l,e.values.constructor),r.push(e))}i.tracks=r;let a=1/0;for(let e=0;e<i.tracks.length;++e)a>i.tracks[e].times[0]&&(a=i.tracks[e].times[0]);for(let e=0;e<i.tracks.length;++e)i.tracks[e].shift(-1*a);return i.resetDuration(),i}(e,t,n,s,o)}static makeClipAdditive(e,t=0,n=e,s=30){return function(e,t=0,n=e,s=30){s<=0&&(s=30);const i=n.tracks.length,o=t/s;for(let d=0;d<i;++d){const t=n.tracks[d],c=t.ValueTypeName;if("bool"===c||"string"===c)continue;const s=e.tracks.find(function(e){return e.name===t.name&&e.ValueTypeName===c});if(void 0===s)continue;let a=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let u=0;const h=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);const m=t.times.length-1;let r;if(o<=t.times[0]){const e=a,n=l-a;r=t.values.slice(e,n)}else if(o>=t.times[m]){const e=m*l+a,n=e+l-a;r=t.values.slice(e,n)}else{const e=t.createInterpolant(),n=a,s=l-a;e.evaluate(o),r=e.resultBuffer.slice(n,s)}"quaternion"===c&&(new Ms).fromArray(r).normalize().conjugate().toArray(r);const f=s.times.length;for(let e=0;e<f;++e){const t=e*h+u;if("quaternion"===c)Ms.multiplyQuaternionsFlat(s.values,t,r,0,s.values,t);else{const e=h-2*u;for(let n=0;n<e;++n)s.values[t+n]-=r[n]}}}return e.blendMode=We,e}(e,t,n,s)}}class yc{constructor(e,t,n,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==s?s:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const s=this.parameterPositions;let t=this._cachedIndex,o=s[t],n=s[t-1];t:{e:{let i;i:{s:if(!(e<o)){for(let i=t+2;;){if(void 0===o){if(e<n)break s;return t=s.length,this._cachedIndex=t,this.copySampleValue_(t-1)}if(t===i)break;if(n=o,o=s[++t],e<o)break e}i=s.length;break i}if(!(e>=n)){const a=s[1];e<a&&(t=2,n=a);for(let i=t-2;;){if(void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(t===i)break;if(o=n,n=s[--t-1],e>=n)break e}i=t,t=0;break i}break t}for(;t<i;){const n=t+i>>>1;e<s[n]?i=n:t=n+1}if(o=s[t],n=s[t-1],void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===o)return t=s.length,this._cachedIndex=t,this.copySampleValue_(t-1)}this._cachedIndex=t,this.intervalChanged_(t,n,o)}return this.interpolate_(t,n,e,o)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,o=e*n;for(let e=0;e!==n;++e)t[e]=s[o+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class gc extends yc{constructor(e,t,n,s){super(e,t,n,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Le,endingEnd:Le}}intervalChanged_(e,t,n){const s=this.parameterPositions;let o=e-2,i=e+1,a=s[o],r=s[i];if(void 0===a)switch(this.getSettings_().endingStart){case je:o=e,a=2*t-n;break;case De:o=s.length-2,a=t+s[o]-s[o+1];break;default:o=e,a=n}if(void 0===r)switch(this.getSettings_().endingEnd){case je:i=e,r=2*n-t;break;case De:i=1,r=n+s[1]-s[0];break;default:i=e-1,r=t}const c=.5*(n-t),l=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(r-n),this._offsetPrev=o*l,this._offsetNext=i*l}interpolate_(e,t,n,s){const h=this.resultBuffer,r=this.sampleValues,d=this.valueSize,u=e*d,m=u-d,p=this._offsetPrev,f=this._offsetNext,i=this._weightPrev,l=this._weightNext,o=(n-t)/(s-t),a=o*o,c=a*o,g=-i*c+2*i*a-i*o,v=(1+i)*c+(-1.5-2*i)*a+(-.5+i)*o+1,b=(-1-l)*c+(1.5+l)*a+.5*o,j=l*c-l*a;for(let e=0;e!==d;++e)h[e]=g*r[p+e]+v*r[m+e]+b*r[u+e]+j*r[f+e];return h}}class fc extends yc{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,r=e*o,l=r-o,c=(n-t)/(s-t),d=1-c;for(let e=0;e!==o;++e)i[e]=a[l+e]*d+a[r+e]*c;return i}}class xc extends yc{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class bc{constructor(e,t,n,s){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=cc(t,this.TimeBufferType),this.values=cc(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const n=e.constructor;let t;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:cc(e.times,Array),values:cc(e.values,Array)};const n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t}InterpolantFactoryMethodDiscrete(e){return new xc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new fc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new gc(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ve:t=this.InterpolantFactoryMethodDiscrete;break;case Fe:t=this.InterpolantFactoryMethodLinear;break;case Ee:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return ns("KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ve;case this.InterpolantFactoryMethodLinear:return Fe;case this.InterpolantFactoryMethodSmooth:return Ee}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]*=e}return this}trim(e,t){const o=this.times,i=o.length;let s=0,n=i-1;for(;s!==i&&o[s]<e;)++s;for(;-1!==n&&o[n]>t;)--n;if(++n,0!==s||n!==i){s>=n&&(n=Math.max(n,1),s=n-1);const e=this.getValueSize();this.times=o.slice(s,n),this.values=this.values.slice(s*e,n*e)}return this}validate(){let e=!0;const s=this.getValueSize();s-Math.floor(s)!==0&&(as("KeyframeTrack: Invalid value size in track.",this),e=!1);const o=this.times,t=this.values,i=o.length;0===i&&(as("KeyframeTrack: Track is empty.",this),e=!1);let n=null;for(let s=0;s!==i;s++){const t=o[s];if("number"==typeof t&&isNaN(t)){as("KeyframeTrack: Time is not a valid number.",this,s,t),e=!1;break}if(null!==n&&n>t){as("KeyframeTrack: Out of order keys.",this,s,t,n),e=!1;break}n=t}if(void 0!==t&&$i(t))for(let n=0,o=t.length;n!==o;++n){const s=t[n];if(isNaN(s)){as("KeyframeTrack: Value is not a valid number.",this,n,s),e=!1;break}}return e}optimize(){const e=this.times.slice(),s=this.values.slice(),t=this.getValueSize(),i=this.getInterpolation()===Ee,o=e.length-1;let n=1;for(let a=1;a<o;++a){let r=!1;const c=e[a];if(c!==e[a+1]&&(1!==a||c!==e[0]))if(i)r=!0;else{const e=a*t,n=e-t,o=e+t;for(let i=0;i!==t;++i){const a=s[e+i];if(a!==s[n+i]||a!==s[o+i]){r=!0;break}}}if(r){if(a!==n){e[n]=e[a];const o=a*t,i=n*t;for(let e=0;e!==t;++e)s[i+e]=s[o+e]}++n}}if(o>0){e[n]=e[o];for(let i=o*t,a=n*t,e=0;e!==t;++e)s[a+e]=s[i+e];++n}return n!==e.length?(this.times=e.slice(0,n),this.values=s.slice(0,n*t)):(this.times=e,this.values=s),this}clone(){const t=this.times.slice(),n=this.values.slice(),e=new(0,this.constructor)(this.name,t,n);return e.createInterpolant=this.createInterpolant,e}}bc.prototype.ValueTypeName="",bc.prototype.TimeBufferType=Float32Array,bc.prototype.ValueBufferType=Float32Array,bc.prototype.DefaultInterpolation=Fe;class vc extends bc{constructor(e,t,n){super(e,t,n)}}vc.prototype.ValueTypeName="bool",vc.prototype.ValueBufferType=Array,vc.prototype.DefaultInterpolation=Ve,vc.prototype.InterpolantFactoryMethodLinear=void 0,vc.prototype.InterpolantFactoryMethodSmooth=void 0;class wc extends bc{constructor(e,t,n,s){super(e,t,n,s)}}wc.prototype.ValueTypeName="color";class Mc extends bc{constructor(e,t,n,s){super(e,t,n,s)}}Mc.prototype.ValueTypeName="number";class Sc extends yc{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const a=this.resultBuffer,r=this.sampleValues,i=this.valueSize,c=(n-t)/(s-t);let o=e*i;for(let e=o+i;o!==e;o+=4)Ms.slerpFlat(a,0,r,o-i,r,o,c);return a}}class _c extends bc{constructor(e,t,n,s){super(e,t,n,s)}InterpolantFactoryMethodLinear(e){return new Sc(this.times,this.values,this.getValueSize(),e)}}_c.prototype.ValueTypeName="quaternion",_c.prototype.InterpolantFactoryMethodSmooth=void 0;class Ac extends bc{constructor(e,t,n){super(e,t,n)}}Ac.prototype.ValueTypeName="string",Ac.prototype.ValueBufferType=Array,Ac.prototype.DefaultInterpolation=Ve,Ac.prototype.InterpolantFactoryMethodLinear=void 0,Ac.prototype.InterpolantFactoryMethodSmooth=void 0;class Tc extends bc{constructor(e,t,n,s){super(e,t,n,s)}}Tc.prototype.ValueTypeName="vector";class zc{constructor(e="",t=-1,n=[],s=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=s,this.uuid=ms(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const n=[],s=e.tracks,o=1/(e.fps||1);for(let e=0,t=s.length;e!==t;++e)n.push(Cc(s[e]).scale(o));const t=new this(e.name,e.duration,n,e.blendMode);return t.uuid=e.uuid,t.userData=JSON.parse(e.userData||"{}"),t}static toJSON(e){const t=[],n=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let e=0,s=n.length;e!==s;++e)t.push(bc.toJSON(n[e]));return s}static CreateFromMorphTargetSequence(e,t,n,s){const o=t.length,i=[];for(let a=0;a<o;a++){let e=[],r=[];e.push((a+o-1)%o,a,(a+1)%o),r.push(0,1,0);const c=uc(e);e=dc(e,1,c),r=dc(r,1,c),s||0!==e[0]||(e.push(o),r.push(r[0])),i.push(new Mc(".morphTargetInfluences["+t[a].name+"]",e,r).scale(1/n))}return new this(e,-1,i)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const s={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,a=e.length;t<a;t++){const o=e[t],n=o.name.match(i);if(n&&n.length>1){const t=n[1];let e=s[t];e||(s[t]=e=[]),e.push(o)}}const o=[];for(const e in s)o.push(this.CreateFromMorphTargetSequence(e,s[e],t,n));return o}static parseAnimation(e,t){if(ns("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return as("AnimationClip: No animation in JSONLoader data."),null;const s=function(e,t,n,s,o){if(0!==n.length){const i=[],a=[];pc(n,i,a,s),0!==i.length&&o.push(new e(t,i,a))}},n=[],a=e.name||"default",r=e.fps||30,c=e.blendMode;let o=e.length||-1;const i=e.hierarchy||[];for(let a=0;a<i.length;a++){const e=i[a].keys;if(e&&0!==e.length)if(e[0].morphTargets){const s={};let t;for(t=0;t<e.length;t++)if(e[t].morphTargets)for(let n=0;n<e[t].morphTargets.length;n++)s[e[t].morphTargets[n]]=-1;for(const o in s){const i=[],a=[];for(let n=0;n!==e[t].morphTargets.length;++n){const s=e[t];i.push(s.time),a.push(s.morphTarget===o?1:0)}n.push(new Mc(".morphTargetInfluence["+o+"]",i,a))}o=s.length*r}else{const o=".bones["+t[a].name+"]";s(Tc,o+".position",e,"pos",n),s(_c,o+".quaternion",e,"rot",n),s(Tc,o+".scale",e,"scl",n)}}return 0===n.length?null:new this(a,o,n,c)}resetDuration(){let e=0;for(let t=0,s=this.tracks.length;t!==s;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function Cc(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Mc;case"vector":case"vector2":case"vector3":case"vector4":return Tc;case"color":return wc;case"quaternion":return _c;case"bool":case"boolean":return vc;case"string":return Ac}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];pc(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Ic={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Bc{constructor(e,t,n){const s=this;let r,c=!1,i=0,a=0;const o=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this._abortController=null,this.itemStart=function(e){a++,!1===c&&void 0!==s.onStart&&s.onStart(e,i,a),c=!0},this.itemEnd=function(e){i++,void 0!==s.onProgress&&s.onProgress(e,i,a),i===a&&(c=!1,void 0!==s.onLoad&&s.onLoad())},this.itemError=function(e){void 0!==s.onError&&s.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return o.push(e,t),this},this.removeHandler=function(e){const t=o.indexOf(e);return-1!==t&&o.splice(t,2),this},this.getHandler=function(e){for(let t=0,s=o.length;t<s;t+=2){const n=o[t],i=o[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const kc=new Bc;class Oc{constructor(e){this.manager=void 0!==e?e:kc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}load(){}loadAsync(e,t){const n=this;return new Promise(function(s,o){n.load(e,s,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}Oc.DEFAULT_MATERIAL_NAME="__DEFAULT";const Pc={};class Rc extends Error{constructor(e,t){super(e),this.response=t}}class Nc extends Oc{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,s){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=Ic.get(`file:${e}`);if(void 0!==o)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(void 0!==Pc[e])return void Pc[e].push({onLoad:t,onProgress:n,onError:s});Pc[e]=[],Pc[e].push({onLoad:t,onProgress:n,onError:s});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:"function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),i=this.mimeType,r=this.responseType;fetch(a).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&ns("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=Pc[e],a=t.body.getReader(),s=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),o=s?parseInt(s):0,r=0!==o;let i=0;const c=new ReadableStream({start(e){!function t(){a.read().then(({done:s,value:a})=>{if(s)e.close();else{i+=a.byteLength;const s=new ProgressEvent("progress",{lengthComputable:r,loaded:i,total:o});for(let e=0,o=n.length;e<o;e++){const t=n[e];t.onProgress&&t.onProgress(s)}e.enqueue(a),t()}},t=>{e.error(t)})}()}});return new Response(c)}throw new Rc(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)}).then(e=>{switch(r){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,i));case"json":return e.json();default:if(""===i)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(i),n=t&&t[1]?t[1].toLowerCase():void 0,s=new TextDecoder(n);return e.arrayBuffer().then(e=>s.decode(e))}}}).then(t=>{Ic.add(`file:${e}`,t);const n=Pc[e];delete Pc[e];for(let e=0,o=n.length;e<o;e++){const s=n[e];s.onLoad&&s.onLoad(t)}}).catch(t=>{const n=Pc[e];if(void 0===n)throw this.manager.itemError(e),t;delete Pc[e];for(let e=0,o=n.length;e<o;e++){const s=n[e];s.onError&&s.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class Vc extends Oc{constructor(e){super(e)}load(e,t,n,s){const i=this,o=new Nc(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(t){s?s(t):as(t),i.manager.itemError(e)}},n,s)}parse(e){const t=[];for(let n=0;n<e.length;n++){const s=zc.parse(e[n]);t.push(s)}return t}}class Fc extends Oc{constructor(e){super(e)}load(e,t,n,s){const r=this,i=[],o=new bh,a=new Nc(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let c=0;function l(l){a.load(e[l],function(e){const n=r.parse(e,!0);i[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},c+=1,6===c&&(1===n.mipmapCount&&(o.minFilter=Mt),o.image=i,o.format=n.format,o.needsUpdate=!0,t&&t(o))},n,s)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)l(t);else a.load(e,function(e){const n=r.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){i[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)i[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),i[t].format=n.format,i[t].width=n.width,i[t].height=n.height}o.image=i}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=Mt),o.format=n.format,o.needsUpdate=!0,t&&t(o)},n,s);return o}}const Ec=new WeakMap;class Lc extends Oc{constructor(e){super(e)}load(e,t,n,s){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=Ic.get(`image:${e}`);if(void 0!==a){if(!0===a.complete)i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0);else{let e=Ec.get(a);void 0===e&&(e=[],Ec.set(a,e)),e.push({onLoad:t,onError:s})}return a}const o=Qi("img");function r(){l(),t&&t(this);const n=Ec.get(this)||[];for(let e=0;e<n.length;e++){const t=n[e];t.onLoad&&t.onLoad(this)}Ec.delete(this),i.manager.itemEnd(e)}function c(t){l(),s&&s(t),Ic.remove(`image:${e}`);const n=Ec.get(this)||[];for(let e=0;e<n.length;e++){const s=n[e];s.onError&&s.onError(t)}Ec.delete(this),i.manager.itemError(e),i.manager.itemEnd(e)}function l(){o.removeEventListener("load",r,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",r,!1),o.addEventListener("error",c,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),Ic.add(`image:${e}`,o),i.manager.itemStart(e),o.src=e,o}}class jc extends Oc{constructor(e){super(e)}load(e,t,n,s){const o=new xa;o.colorSpace=ti;const i=new Lc(this.manager);i.setCrossOrigin(this.crossOrigin),i.setPath(this.path);let a=0;function r(n){i.load(e[n],function(e){o.images[n]=e,a++,6===a&&(o.needsUpdate=!0,t&&t(o))},void 0,s)}for(let t=0;t<e.length;++t)r(t);return o}}class Dc extends Oc{constructor(e){super(e)}load(e,t,n,s){const a=this,o=new no,i=new Nc(this.manager);return i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setPath(this.path),i.setWithCredentials(a.withCredentials),i.load(e,function(e){let n;try{n=a.parse(e)}catch(e){if(void 0===s)return void e(e);s(e)}void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:yt,o.wrapT=void 0!==n.wrapT?n.wrapT:yt,o.magFilter=void 0!==n.magFilter?n.magFilter:Mt,o.minFilter=void 0!==n.minFilter?n.minFilter:Mt,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(o.colorSpace=n.colorSpace),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=At),1===n.mipmapCount&&(o.minFilter=Mt),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,t&&t(o,n)},n,s),o}}class Uc extends Oc{constructor(e){super(e)}load(e,t,n,s){const o=new Ds,i=new Lc(this.manager);return i.setCrossOrigin(this.crossOrigin),i.setPath(this.path),i.load(e,function(e){o.image=e,o.needsUpdate=!0,void 0!==t&&t(o)},n,s),o}}class Wc extends Hr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new yn(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class qc extends Wc{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Hr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new yn(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const Jc=new Mr,Xc=new Ss,Yc=new Ss;class Zc{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ws(512,512),this.mapType=zt,this.map=null,this.mapPass=null,this.matrix=new Mr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new To,this._frameExtents=new ws(1,1),this._viewportCount=1,this._viewports=[new Us(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Xc.setFromMatrixPosition(e.matrixWorld),t.position.copy(Xc),Yc.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Yc),t.updateMatrixWorld(),Jc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jc,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Jc)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Hc extends Zc{constructor(){super(new ya(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=2*ps*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height*this.aspect,o=e.distance||t.far;n===t.fov&&s===t.aspect&&o===t.far||(t.fov=n,t.aspect=s,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Gc extends Wc{constructor(e,t,n=0,s=Math.PI/3,o=0,i=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Hr.DEFAULT_UP),this.updateMatrix(),this.target=new Hr,this.distance=n,this.angle=s,this.penumbra=o,this.decay=i,this.map=null,this.shadow=new Hc}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class $c extends Zc{constructor(){super(new ya(90,1,.5,500)),this.isPointLightShadow=!0}}class Qc extends Wc{constructor(e,t,n=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new $c}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}class Kc extends ua{constructor(e=-1,t=1,n=1,s=-1,o=.1,i=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=s,this.near=o,this.far=i,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,s,o,i){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=o,this.view.height=i,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=(this.right-this.left)/(2*this.zoom),s=(this.top-this.bottom)/(2*this.zoom),o=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let e=o-n,a=o+n,t=i+s,r=i-s;if(null!==this.view&&this.view.enabled){const n=(this.right-this.left)/this.view.fullWidth/this.zoom,s=(this.top-this.bottom)/this.view.fullHeight/this.zoom;e+=n*this.view.offsetX,a=e+n*this.view.width,t-=s*this.view.offsetY,r=t-s*this.view.height}this.projectionMatrix.makeOrthographic(e,a,t,r,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class tu extends Zc{constructor(){super(new Kc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class eu extends Wc{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Hr.DEFAULT_UP),this.updateMatrix(),this.target=new Hr,this.shadow=new tu}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class iu extends Wc{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class su extends Wc{constructor(e,t,n=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class ru{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Ss)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const s=e.x,o=e.y,i=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.282095),t.addScaledVector(n[1],.488603*o),t.addScaledVector(n[2],.488603*i),t.addScaledVector(n[3],.488603*s),t.addScaledVector(n[4],s*o*1.092548),t.addScaledVector(n[5],o*i*1.092548),t.addScaledVector(n[6],.315392*(3*i*i-1)),t.addScaledVector(n[7],s*i*1.092548),t.addScaledVector(n[8],.546274*(s*s-o*o)),t}getIrradianceAt(e,t){const s=e.x,o=e.y,i=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.886227),t.addScaledVector(n[1],1.023328*o),t.addScaledVector(n[2],1.023328*i),t.addScaledVector(n[3],1.023328*s),t.addScaledVector(n[4],.858086*s*o),t.addScaledVector(n[5],.858086*o*i),t.addScaledVector(n[6],.743125*i*i-.247708),t.addScaledVector(n[7],.858086*s*i),t.addScaledVector(n[8],.429043*(s*s-o*o)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(e,t+3*s);return this}toArray(e=[],t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(e,t+3*s);return e}static getBasisAt(e,t){const n=e.x,s=e.y,o=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*o,t[3]=.488603*n,t[4]=1.092548*n*s,t[5]=1.092548*s*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*n*o,t[8]=.546274*(n*n-s*s)}}class nu extends Wc{constructor(e=new ru,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class au extends Oc{constructor(e){super(e),this.textures={}}load(e,t,n,s){const o=this,i=new Nc(o.manager);i.setPath(o.path),i.setRequestHeader(o.requestHeader),i.setWithCredentials(o.withCredentials),i.load(e,function(n){try{t(o.parse(JSON.parse(n)))}catch(t){s?s(t):as(t),o.manager.itemError(e)}},n,s)}parse(e){const s=this.textures;function n(e){return void 0===s[e]&&ns("MaterialLoader: Undefined texture",e),s[e]}const t=this.createMaterialFromType(e.type);if(void 0!==e.uuid&&(t.uuid=e.uuid),void 0!==e.name&&(t.name=e.name),void 0!==e.color&&void 0!==t.color&&t.color.setHex(e.color),void 0!==e.roughness&&(t.roughness=e.roughness),void 0!==e.metalness&&(t.metalness=e.metalness),void 0!==e.sheen&&(t.sheen=e.sheen),void 0!==e.sheenColor&&(t.sheenColor=(new yn).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(t.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==t.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==t.specular&&t.specular.setHex(e.specular),void 0!==e.specularIntensity&&(t.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==t.specularColor&&t.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.clearcoat&&(t.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(t.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(t.dispersion=e.dispersion),void 0!==e.iridescence&&(t.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(t.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(t.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(t.transmission=e.transmission),void 0!==e.thickness&&(t.thickness=e.thickness),void 0!==e.attenuationDistance&&(t.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==t.attenuationColor&&t.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(t.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(t.fog=e.fog),void 0!==e.flatShading&&(t.flatShading=e.flatShading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.combine&&(t.combine=e.combine),void 0!==e.side&&(t.side=e.side),void 0!==e.shadowSide&&(t.shadowSide=e.shadowSide),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.alphaTest&&(t.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(t.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(t.depthFunc=e.depthFunc),void 0!==e.depthTest&&(t.depthTest=e.depthTest),void 0!==e.depthWrite&&(t.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(t.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(t.blendSrc=e.blendSrc),void 0!==e.blendDst&&(t.blendDst=e.blendDst),void 0!==e.blendEquation&&(t.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(t.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(t.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(t.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==t.blendColor&&t.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(t.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(t.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(t.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(t.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(t.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(t.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(t.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(t.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(t.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(t.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(t.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(t.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.linewidth&&(t.linewidth=e.linewidth),void 0!==e.dashSize&&(t.dashSize=e.dashSize),void 0!==e.gapSize&&(t.gapSize=e.gapSize),void 0!==e.scale&&(t.scale=e.scale),void 0!==e.polygonOffset&&(t.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(t.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(t.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(t.dithering=e.dithering),void 0!==e.alphaToCoverage&&(t.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(t.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(t.forceSinglePass=e.forceSinglePass),void 0!==e.allowOverride&&(t.allowOverride=e.allowOverride),void 0!==e.visible&&(t.visible=e.visible),void 0!==e.toneMapped&&(t.toneMapped=e.toneMapped),void 0!==e.userData&&(t.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?t.vertexColors=e.vertexColors>0:t.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const s in e.uniforms){const o=e.uniforms[s];switch(t.uniforms[s]={},o.type){case"t":t.uniforms[s].value=n(o.value);break;case"c":t.uniforms[s].value=(new yn).setHex(o.value);break;case"v2":t.uniforms[s].value=(new ws).fromArray(o.value);break;case"v3":t.uniforms[s].value=(new Ss).fromArray(o.value);break;case"v4":t.uniforms[s].value=(new Us).fromArray(o.value);break;case"m3":t.uniforms[s].value=(new Ts).fromArray(o.value);break;case"m4":t.uniforms[s].value=(new Mr).fromArray(o.value);break;default:t.uniforms[s].value=o.value}}if(void 0!==e.defines&&(t.defines=e.defines),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(t.glslVersion=e.glslVersion),void 0!==e.extensions)for(const n in e.extensions)t.extensions[n]=e.extensions[n];if(void 0!==e.lights&&(t.lights=e.lights),void 0!==e.clipping&&(t.clipping=e.clipping),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(t.map=n(e.map)),void 0!==e.matcap&&(t.matcap=n(e.matcap)),void 0!==e.alphaMap&&(t.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(t.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(t.bumpScale=e.bumpScale),void 0!==e.normalMap&&(t.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(t.normalMapType=e.normalMapType),void 0!==e.normalScale){let n=e.normalScale;!1===Array.isArray(n)&&(n=[n,n]),t.normalScale=(new ws).fromArray(n)}return void 0!==e.displacementMap&&(t.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(t.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(t.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(t.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(t.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(t.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(t.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(t.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(t.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(t.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(t.envMap=n(e.envMap)),void 0!==e.envMapRotation&&t.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(t.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(t.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(t.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(t.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(t.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(t.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(t.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(t.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(t.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(t.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(t.clearcoatNormalScale=(new ws).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(t.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(t.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(t.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(t.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(t.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(t.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(t.sheenRoughnessMap=n(e.sheenRoughnessMap)),t}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return au.createMaterialFromType(e)}static createMaterialFromType(e){return new{ShadowMaterial:Ql,SpriteMaterial:Ia,RawShaderMaterial:Kl,ShaderMaterial:ca,PointsMaterial:lh,MeshPhysicalMaterial:ec,MeshStandardMaterial:tc,MeshPhongMaterial:ic,MeshToonMaterial:sc,MeshNormalMaterial:rc,MeshLambertMaterial:nc,MeshDepthMaterial:ac,MeshDistanceMaterial:oc,MeshBasicMaterial:bn,MeshMatcapMaterial:hc,LineDashedMaterial:lc,LineBasicMaterial:Ho,Material:xn}[e]}}class ou{static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class hu extends Jn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class lu extends Oc{constructor(e){super(e)}load(e,t,n,s){const o=this,i=new Nc(o.manager);i.setPath(o.path),i.setRequestHeader(o.requestHeader),i.setWithCredentials(o.withCredentials),i.load(e,function(n){try{t(o.parse(JSON.parse(n)))}catch(t){s?s(t):as(t),o.manager.itemError(e)}},n,s)}parse(e){const n={},s={};function r(e,t){if(void 0!==n[t])return n[t];const o=e.interleavedBuffers[t],a=function(e,t){if(void 0!==s[t])return s[t];const o=e.arrayBuffers,i=o[t],n=new Uint32Array(i).buffer;return s[t]=n,n}(e,o.buffer),r=Gi(o.type,a),i=new Ta(r,o.stride);return i.uuid=o.uuid,n[t]=i,i}const t=e.isInstancedBufferGeometry?new hu:new Jn,o=e.data.index;if(void 0!==o){const e=Gi(o.type,o.array);t.setIndex(new Cn(e,1))}const c=e.data.attributes;for(const o in c){const n=c[o];let s;if(n.isInterleavedBufferAttribute){const t=r(e.data,n.data);s=new Ca(t,n.itemSize,n.offset,n.normalized)}else{const e=Gi(n.type,n.array);s=new(n.isInstancedBufferAttribute?lo:Cn)(e,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),void 0!==n.usage&&s.setUsage(n.usage),t.setAttribute(o,s)}const i=e.data.morphAttributes;if(i)for(const n in i){const s=i[n],o=[];for(let i=0,a=s.length;i<a;i++){const t=s[i];let n;if(t.isInterleavedBufferAttribute){const s=r(e.data,t.data);n=new Ca(s,t.itemSize,t.offset,t.normalized)}else{const e=Gi(t.type,t.array);n=new Cn(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),o.push(n)}t.morphAttributes[n]=o}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);const a=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==a)for(let e=0,s=a.length;e!==s;++e){const n=a[e];t.addGroup(n.start,n.count,n.materialIndex)}const l=e.data.boundingSphere;return void 0!==l&&(t.boundingSphere=(new pr).fromJSON(l)),e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}}class cu extends Oc{constructor(e){super(e)}load(e,t,n,s){const i=this,a=""===this.path?ou.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new Nc(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(n){let o=null;try{o=JSON.parse(n)}catch(t){return void 0!==s&&s(t),void t("ObjectLoader: Can't parse "+e+".",t.message)}const a=o.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())return void 0!==s&&s(new Error("THREE.ObjectLoader: Can't load "+e)),void as("ObjectLoader: Can't load "+e);i.parse(o,t)},n,s)}async loadAsync(e,t){const i=""===this.path?ou.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const n=new Nc(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const a=await n.loadAsync(e,t),o=JSON.parse(a),s=o.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(o)}parse(e,t){const i=this.parseAnimations(e.animations),a=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,a),s=this.parseImages(e.images,function(){void 0!==t&&t(n)}),o=this.parseTextures(e.textures,s),c=this.parseMaterials(e.materials,o),n=this.parseObject(e.object,r,c,o,i),l=this.parseSkeletons(e.skeletons,n);if(this.bindSkeletons(n,l),this.bindLightTargets(n),void 0!==t){let e=!1;for(const t in s)if(s[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(n)}return n}async parseAsync(e){const s=this.parseAnimations(e.animations),o=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,o),a=await this.parseImagesAsync(e.images),n=this.parseTextures(e.textures,a),r=this.parseMaterials(e.materials,n),t=this.parseObject(e.object,i,r,n,s),c=this.parseSkeletons(e.skeletons,t);return this.bindSkeletons(t,c),this.bindLightTargets(t),t}parseShapes(e){const t={};if(void 0!==e)for(let n=0,o=e.length;n<o;n++){const s=(new nl).fromJSON(e[n]);t[s.uuid]=s}return t}parseSkeletons(e,t){const n={},s={};if(t.traverse(function(e){e.isBone&&(s[e.uuid]=e)}),void 0!==e)for(let t=0,i=e.length;t<i;t++){const o=(new ho).fromJSON(e[t],s);n[o.uuid]=o}return n}parseGeometries(e,t){const n={};if(void 0!==e){const s=new lu;for(let a=0,r=e.length;a<r;a++){let i;const o=e[a];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":i=s.parse(o);break;default:o.type in $l?i=$l[o.type].fromJSON(o,t):ns(`ObjectLoader: Unsupported geometry type "${o.type}"`)}i.uuid=o.uuid,void 0!==o.name&&(i.name=o.name),void 0!==o.userData&&(i.userData=o.userData),n[o.uuid]=i}}return n}parseMaterials(e,t){const n={},s={};if(void 0!==e){const o=new au;o.setTextures(t);for(let i=0,a=e.length;i<a;i++){const t=e[i];void 0===n[t.uuid]&&(n[t.uuid]=o.parse(t)),s[t.uuid]=n[t.uuid]}}return s}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const o=e[n],s=zc.parse(o);t[s.uuid]=s}return t}parseImages(e,t){const n=this,s={};let o;function i(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),o.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemError(e),n.manager.itemEnd(e)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:Gi(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Bc(t);o=new Lc(n),o.setCrossOrigin(this.crossOrigin);for(let n=0,a=e.length;n<a;n++){const t=e[n],o=t.url;if(Array.isArray(o)){const e=[];for(let n=0,s=o.length;n<s;n++){const t=i(o[n]);null!==t&&(t instanceof HTMLImageElement?e.push(t):e.push(new no(t.data,t.width,t.height)))}s[t.uuid]=new Fs(e)}else{const e=i(t.url);s[t.uuid]=new Fs(e)}}}return s}async parseImagesAsync(e){const o=this,t={};let n;async function s(e){if("string"==typeof e){const t=e,s=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:o.resourcePath+t;return await n.loadAsync(s)}return e.data?{data:Gi(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){n=new Lc(this.manager),n.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const n=e[o],i=n.url;if(Array.isArray(i)){const e=[];for(let n=0,o=i.length;n<o;n++){const a=i[n],t=await s(a);null!==t&&(t instanceof HTMLImageElement?e.push(t):e.push(new no(t.data,t.width,t.height)))}t[n.uuid]=new Fs(e)}else{const e=await s(n.url);t[n.uuid]=new Fs(e)}}}return t}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(ns("ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const s={};if(void 0!==e)for(let r=0,l=e.length;r<l;r++){const o=e[r];void 0===o.image&&ns('ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&ns("ObjectLoader: Undefined image",o.image);const c=t[o.image],a=c.data;let i;Array.isArray(a)?(i=new xa,6===a.length&&(i.needsUpdate=!0)):(i=a&&a.data?new no:new Ds,a&&(i.needsUpdate=!0)),i.source=c,i.uuid=o.uuid,void 0!==o.name&&(i.name=o.name),void 0!==o.mapping&&(i.mapping=n(o.mapping,uu)),void 0!==o.channel&&(i.channel=o.channel),void 0!==o.offset&&i.offset.fromArray(o.offset),void 0!==o.repeat&&i.repeat.fromArray(o.repeat),void 0!==o.center&&i.center.fromArray(o.center),void 0!==o.rotation&&(i.rotation=o.rotation),void 0!==o.wrap&&(i.wrapS=n(o.wrap[0],du),i.wrapT=n(o.wrap[1],du)),void 0!==o.format&&(i.format=o.format),void 0!==o.internalFormat&&(i.internalFormat=o.internalFormat),void 0!==o.type&&(i.type=o.type),void 0!==o.colorSpace&&(i.colorSpace=o.colorSpace),void 0!==o.minFilter&&(i.minFilter=n(o.minFilter,pu)),void 0!==o.magFilter&&(i.magFilter=n(o.magFilter,pu)),void 0!==o.anisotropy&&(i.anisotropy=o.anisotropy),void 0!==o.flipY&&(i.flipY=o.flipY),void 0!==o.generateMipmaps&&(i.generateMipmaps=o.generateMipmaps),void 0!==o.premultiplyAlpha&&(i.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(i.unpackAlignment=o.unpackAlignment),void 0!==o.compareFunction&&(i.compareFunction=o.compareFunction),void 0!==o.userData&&(i.userData=o.userData),s[o.uuid]=i}return s}parseObject(e,t,n,s,o){let i,r,c;function l(e){return void 0===t[e]&&ns("ObjectLoader: Undefined geometry",e),t[e]}function a(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let s=0,i=e.length;s<i;s++){const o=e[s];void 0===n[o]&&ns("ObjectLoader: Undefined material",o),t.push(n[o])}return t}return void 0===n[e]&&ns("ObjectLoader: Undefined material",e),n[e]}}function d(e){return void 0===s[e]&&ns("ObjectLoader: Undefined texture",e),s[e]}switch(e.type){case"Scene":i=new Aa,void 0!==e.background&&(Number.isInteger(e.background)?i.background=new yn(e.background):i.background=d(e.background)),void 0!==e.environment&&(i.environment=d(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new _a(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new Sa(e.fog.color,e.fog.density)),""!==e.fog.name&&(i.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(i.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(i.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&i.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(i.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&i.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":i=new ya(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new Kc(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new iu(e.color,e.intensity);break;case"DirectionalLight":i=new eu(e.color,e.intensity),i.target=e.target||"";break;case"PointLight":i=new Qc(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new su(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new Gc(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),i.target=e.target||"";break;case"HemisphereLight":i=new qc(e.color,e.groundColor,e.intensity);break;case"LightProbe":const n=(new ru).fromArray(e.sh);i=new nu(n,e.intensity);break;case"SkinnedMesh":r=l(e.geometry),c=a(e.material),i=new so(r,c),void 0!==e.bindMode&&(i.bindMode=e.bindMode),void 0!==e.bindMatrix&&i.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(i.skeleton=e.skeleton);break;case"Mesh":r=l(e.geometry),c=a(e.material),i=new sa(r,c);break;case"InstancedMesh":r=l(e.geometry),c=a(e.material);const s=e.count,o=e.instanceMatrix,t=e.instanceColor;i=new xo(r,c,s),i.instanceMatrix=new lo(new Float32Array(o.array),16),void 0!==t&&(i.instanceColor=new lo(new Float32Array(t.array),t.itemSize));break;case"BatchedMesh":r=l(e.geometry),c=a(e.material),i=new Zo(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,c),i.geometry=r,i.perObjectFrustumCulled=e.perObjectFrustumCulled,i.sortObjects=e.sortObjects,i._drawRanges=e.drawRanges,i._reservedRanges=e.reservedRanges,i._geometryInfo=e.geometryInfo.map(e=>{let t=null,n=null;return void 0!==e.boundingBox&&(t=(new Hs).fromJSON(e.boundingBox)),void 0!==e.boundingSphere&&(n=(new pr).fromJSON(e.boundingSphere)),{...e,boundingBox:t,boundingSphere:n}}),i._instanceInfo=e.instanceInfo,i._availableInstanceIds=e._availableInstanceIds,i._availableGeometryIds=e._availableGeometryIds,i._nextIndexStart=e.nextIndexStart,i._nextVertexStart=e.nextVertexStart,i._geometryCount=e.geometryCount,i._maxInstanceCount=e.maxInstanceCount,i._maxVertexCount=e.maxVertexCount,i._maxIndexCount=e.maxIndexCount,i._geometryInitialized=e.geometryInitialized,i._matricesTexture=d(e.matricesTexture.uuid),i._indirectTexture=d(e.indirectTexture.uuid),void 0!==e.colorsTexture&&(i._colorsTexture=d(e.colorsTexture.uuid)),void 0!==e.boundingSphere&&(i.boundingSphere=(new pr).fromJSON(e.boundingSphere)),void 0!==e.boundingBox&&(i.boundingBox=(new Hs).fromJSON(e.boundingBox));break;case"LOD":i=new Ya;break;case"Line":i=new sh(l(e.geometry),a(e.material));break;case"LineLoop":i=new hh(l(e.geometry),a(e.material));break;case"LineSegments":i=new oh(l(e.geometry),a(e.material));break;case"PointCloud":case"Points":i=new mh(l(e.geometry),a(e.material));break;case"Sprite":i=new Wa(a(e.material));break;case"Group":i=new va;break;case"Bone":i=new ro;break;default:i=new Hr}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.up&&i.up.fromArray(e.up),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.intensity&&(i.shadow.intensity=e.shadow.intensity),void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children){const a=e.children;for(let e=0;e<a.length;e++)i.add(this.parseObject(a[e],t,n,s,o))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];i.animations.push(o[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],s=i.getObjectByProperty("uuid",n.object);void 0!==s&&i.addLevel(s,n.distance,n.hysteresis)}}return i}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?ns("ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const s=t.target,n=e.getObjectByProperty("uuid",s);t.target=void 0!==n?n:new Hr}})}}const uu={UVMapping:ht,CubeReflectionMapping:lt,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306},du={RepeatWrapping:mt,ClampToEdgeWrapping:yt,MirroredRepeatWrapping:gt},pu={NearestFilter:ft,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:Mt,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:At},mu=new WeakMap;class yu extends Oc{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&ns("ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&ns("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,n,s){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,i=Ic.get(`image-bitmap:${e}`);if(void 0!==i)return o.manager.itemStart(e),i.then?void i.then(n=>{if(!0!==mu.has(i))return t&&t(n),o.manager.itemEnd(e),n;s&&s(mu.get(i)),o.manager.itemError(e),o.manager.itemEnd(e)}):(setTimeout(function(){t&&t(i),o.manager.itemEnd(e)},0),i);const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,a.signal="function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const r=fetch(e,a).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(n){return Ic.add(`image-bitmap:${e}`,n),t&&t(n),o.manager.itemEnd(e),n}).catch(function(t){s&&s(t),mu.set(r,t),Ic.remove(`image-bitmap:${e}`),o.manager.itemError(e),o.manager.itemEnd(e)});Ic.add(`image-bitmap:${e}`,r),o.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let gu;class fu{static getContext(){return void 0===gu&&(gu=new(window.AudioContext||window.webkitAudioContext)),gu}static setContext(e){gu=e}}class xu extends Oc{constructor(e){super(e)}load(e,t,n,s){const a=this,o=new Nc(this.manager);function i(t){s?s(t):as(t),a.manager.itemError(e)}o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(e){try{const n=e.slice(0);fu.getContext().decodeAudioData(n,function(e){t(e)}).catch(i)}catch(e){i(e)}},n,s)}}const bu=new Mr,vu=new Mr,wu=new Mr;class Mu{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ya,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ya,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,wu.copy(e.projectionMatrix);const a=t.eyeSep/2,o=a*t.near/t.focus,i=t.near*Math.tan(ds*t.fov*.5)/t.zoom;let n,s;vu.elements[12]=-a,bu.elements[12]=a,n=-i*t.aspect+o,s=i*t.aspect+o,wu.elements[0]=2*t.near/(s-n),wu.elements[8]=(s+n)/(s-n),this.cameraL.projectionMatrix.copy(wu),n=-i*t.aspect-o,s=i*t.aspect-o,wu.elements[0]=2*t.near/(s-n),wu.elements[8]=(s+n)/(s-n),this.cameraR.projectionMatrix.copy(wu)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(vu),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(bu)}}class Su extends ya{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class _u{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const Au=new Ss,Tu=new Ms,zu=new Ss,Cu=new Ss,Iu=new Ss;class Bu extends Hr{constructor(){super(),this.type="AudioListener",this.context=fu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new _u}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Au,Tu,zu),Cu.set(0,0,-1).applyQuaternion(Tu),Iu.set(0,1,0).applyQuaternion(Tu),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Au.x,e),t.positionY.linearRampToValueAtTime(Au.y,e),t.positionZ.linearRampToValueAtTime(Au.z,e),t.forwardX.linearRampToValueAtTime(Cu.x,e),t.forwardY.linearRampToValueAtTime(Cu.y,e),t.forwardZ.linearRampToValueAtTime(Cu.z,e),t.upX.linearRampToValueAtTime(Iu.x,e),t.upY.linearRampToValueAtTime(Iu.y,e),t.upZ.linearRampToValueAtTime(Iu.z,e)}else t.setPosition(Au.x,Au.y,Au.z),t.setOrientation(Cu.x,Cu.y,Cu.z,Iu.x,Iu.y,Iu.z)}}class ku extends Hr{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void ns("Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void ns("Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;ns("Audio: this Audio has no playback control.")}stop(e=0){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this;ns("Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;ns("Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1===this.hasPlaybackControl?(ns("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;ns("Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),"buffer"!==e.sourceType?(ns("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const Ou=new Ss,Pu=new Ms,Ru=new Ss,Nu=new Ss;class Vu extends ku{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Ou,Pu,Ru),Nu.set(0,0,1).applyQuaternion(Pu);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Ou.x,e),t.positionY.linearRampToValueAtTime(Ou.y,e),t.positionZ.linearRampToValueAtTime(Ou.z,e),t.orientationX.linearRampToValueAtTime(Nu.x,e),t.orientationY.linearRampToValueAtTime(Nu.y,e),t.orientationZ.linearRampToValueAtTime(Nu.z,e)}else t.setPosition(Ou.x,Ou.y,Ou.z),t.setOrientation(Nu.x,Nu.y,Nu.z)}}class Fu{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}class Eu{constructor(e,t,n){let s,o,i;switch(this.binding=e,this.valueSize=n,t){case"quaternion":s=this._slerp,o=this._slerpAdditive,i=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":s=this._select,o=this._select,i=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:s=this._lerp,o=this._lerpAdditive,i=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=o,this._setIdentity=i,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const o=this.buffer,s=this.valueSize,i=e*s+s;let n=this.cumulativeWeight;if(0===n){for(let e=0;e!==s;++e)o[i+e]=o[e];n=t}else{n+=t;const e=t/n;this._mixBufferRegion(o,i,0,e,s)}this.cumulativeWeight=n}accumulateAdditive(e){const n=this.buffer,t=this.valueSize,s=t*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(n,s,0,e,t),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,s=e*t+t,o=this.cumulativeWeight,i=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const e=t*this._origIndex;this._mixBufferRegion(n,s,e,1-o,t)}i>0&&this._mixBufferRegionAdditive(n,s,this._addIndex*t,1,t);for(let e=t,o=t+t;e!==o;++e)if(n[e]!==n[e+t]){a.setValue(n,s);break}}saveOriginalState(){const s=this.binding,e=this.buffer,t=this.valueSize,n=t*this._origIndex;s.getValue(e,n);for(let s=t,o=n;s!==o;++s)e[s]=e[n+s%t];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,s,o){if(s>=.5)for(let s=0;s!==o;++s)e[t+s]=e[n+s]}_slerp(e,t,n,s){Ms.slerpFlat(e,t,e,t,e,n,s)}_slerpAdditive(e,t,n,s,o){const i=this._workIndex*o;Ms.multiplyQuaternionsFlat(e,i,e,t,e,n),Ms.slerpFlat(e,t,e,t,e,i,s)}_lerp(e,t,n,s,o){const i=1-s;for(let a=0;a!==o;++a){const r=t+a;e[r]=e[r]*i+e[n+a]*s}}_lerpAdditive(e,t,n,s,o){for(let i=0;i!==o;++i){const a=t+i;e[a]=e[a]+e[n+i]*s}}}const Lu="\\[\\]\\.:\\/",ju=new RegExp("["+Lu+"]","g"),Du="[^"+Lu+"]",Uu="[^"+Lu.replace("\\.","")+"]",Wu=new RegExp("^"+/((?:WC+[/:])*)/.source.replace("WC",Du)+/(WCOD+)?/.source.replace("WCOD",Uu)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Du)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Du)+"$"),qu=["material","materials","bones","map"];class Ju{constructor(e,t,n){this.path=t,this.parsedPath=n||Ju.parseTrackName(t),this.node=Ju.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Ju.Composite(e,t,n):new Ju(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(ju,"")}static parseTrackName(e){const n=Wu.exec(e);if(null===n)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const t={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},s=t.nodeName&&t.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const e=t.nodeName.substring(s+1);-1!==qu.indexOf(e)&&(t.nodeName=t.nodeName.substring(0,s),t.objectName=e)}if(null===t.propertyName||0===t.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return t}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let o=0;o<e.length;o++){const s=e[o];if(s.name===t||s.uuid===t)return s;const i=n(s.children);if(i)return i}return null},s=n(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)e[t++]=n[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const n=this.parsedPath,i=n.objectName,a=n.propertyName;let s=n.propertyIndex;if(e||(e=Ju.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void ns("PropertyBinding: No target node found for track: "+this.path+".");if(i){let t=n.objectIndex;switch(i){case"materials":if(!e.material)return void as("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void as("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void as("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let n=0;n<e.length;n++)if(e[n].name===t){t=n;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void as("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void as("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[i])return void as("PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==t){if(void 0===e[t])return void as("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[t]}}const t=e[a];if(void 0===t)return void as("PropertyBinding: Trying to update property for track: "+n.nodeName+"."+a+" but it wasn't found.",e);let r=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?r=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(r=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===a){if(!e.geometry)return void as("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void as("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[s]&&(s=e.morphTargetDictionary[s])}o=this.BindingType.ArrayElement,this.resolvedProperty=t,this.propertyIndex=s}else void 0!==t.fromArray&&void 0!==t.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=t):Array.isArray(t)?(o=this.BindingType.EntireArray,this.resolvedProperty=t):this.propertyName=a;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][r]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ju.Composite=class{constructor(e,t,n){const s=n||Ju.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const s=this._targetGroup.nCachedObjects_,n=this._bindings[s];void 0!==n&&n.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,o=n.length;s!==o;++s)n[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Ju.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ju.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ju.prototype.GetterByBindingType=[Ju.prototype._getValue_direct,Ju.prototype._getValue_array,Ju.prototype._getValue_arrayElement,Ju.prototype._getValue_toArray],Ju.prototype.SetterByBindingTypeAndVersioning=[[Ju.prototype._setValue_direct,Ju.prototype._setValue_direct_setNeedsUpdate,Ju.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ju.prototype._setValue_array,Ju.prototype._setValue_array_setNeedsUpdate,Ju.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ju.prototype._setValue_arrayElement,Ju.prototype._setValue_arrayElement_setNeedsUpdate,Ju.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ju.prototype._setValue_fromArray,Ju.prototype._setValue_fromArray_setNeedsUpdate,Ju.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Xu{constructor(){this.isAnimationObjectGroup=!0,this.uuid=ms(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,o=this._paths,i=this._parsedPaths,n=this._bindings,a=n.length;let r,c=e.length,s=this.nCachedObjects_;for(let u=0,m=arguments.length;u!==m;++u){const d=arguments[u],h=d.uuid;let l=t[h];if(void 0===l){l=c++,t[h]=l,e.push(d);for(let e=0,t=a;e!==t;++e)n[e].push(new Ju(d,o[e],i[e]))}else if(l<s){r=e[l];const c=--s,u=e[c];t[u.uuid]=l,e[l]=u,t[h]=c,e[c]=d;for(let e=0,r=a;e!==r;++e){const t=n[e],u=t[c];let s=t[l];t[l]=u,void 0===s&&(s=new Ju(d,o[e],i[e])),t[c]=s}}else e[l]!==r&&as("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=s}remove(){const e=this._objects,t=this._indicesByUUID,s=this._bindings,o=s.length;let n=this.nCachedObjects_;for(let a=0,l=arguments.length;a!==l;++a){const r=arguments[a],c=r.uuid,i=t[c];if(void 0!==i&&i>=n){const a=n++,l=e[a];t[l.uuid]=i,e[i]=l,t[c]=a,e[a]=r;for(let t=0,n=o;t!==n;++t){const e=s[t],r=e[a],c=e[i];e[i]=r,e[a]=c}}}this.nCachedObjects_=n}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,o=n.length;let s=this.nCachedObjects_,i=e.length;for(let r=0,l=arguments.length;r!==l;++r){const c=arguments[r].uuid,a=t[c];if(void 0!==a)if(delete t[c],a<s){const r=--s,c=e[r],l=--i,d=e[l];t[c.uuid]=a,e[a]=c,t[d.uuid]=r,e[r]=d,e.pop();for(let t=0,s=o;t!==s;++t){const e=n[t],i=e[r],c=e[l];e[a]=i,e[r]=c,e.pop()}}else{const s=--i,r=e[s];s>0&&(t[r.uuid]=a),e[a]=r,e.pop();for(let e=0,i=o;e!==i;++e){const t=n[e];t[a]=t[s],t.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const a=this._bindingsIndicesByPath;let n=a[e];const s=this._bindings;if(void 0!==n)return s[n];const r=this._paths,c=this._parsedPaths,o=this._objects,l=o.length,d=this.nCachedObjects_,i=new Array(l);n=s.length,a[e]=n,r.push(e),c.push(t),s.push(i);for(let n=d,s=o.length;n!==s;++n){const a=o[n];i[n]=new Ju(a,e,t)}return i}unsubscribe_(e){const n=this._bindingsIndicesByPath,t=n[e];if(void 0!==t){const i=this._paths,a=this._parsedPaths,s=this._bindings,o=s.length-1,r=s[o];n[e[o]]=t,s[t]=r,s.pop(),a[t]=a[o],a.pop(),i[t]=i[o],i.pop()}}}class Yu{constructor(e,t,n=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=s;const i=t.tracks,o=i.length,a=new Array(o),r={endingStart:Le,endingEnd:Le};for(let e=0;e!==o;++e){const t=i[e].createInterpolant(null);a[e]=t,t.settings=r}this._interpolantSettings=r,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),!0===n){const n=this._clip.duration,s=e._clip.duration,o=s/n,i=n/s;e.warp(1,o,t),this.warp(i,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const o=this._mixer,i=o.time,a=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=o._lendControlInterpolant(),this._timeScaleInterpolant=s);const r=s.parameterPositions,c=s.sampleValues;return r[0]=i,r[1]=i+n,c[0]=e/a,c[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,s){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const s=(e-i)*n;s<0||0===n?t=0:(this._startTime=null,t=n*s)}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===We)for(let n=0,s=e.length;n!==s;++n)e[n].evaluate(a),t[n].accumulateAdditive(o);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(a),t[n].accumulate(s,o)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const s=n.evaluate(e)[0];t*=s,e>n.parameterPositions[1]&&(this.stopFading(),0===s&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const s=this._clip.duration,i=this.loop;let t=this.time+e,n=this._loopCount;const o=2202===i;if(0===e)return-1===n||!o||1&~n?t:s-t;if(2200===i){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(t>=s)t=s;else{if(!(t<0)){this.time=t;break t}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=s||t<0){const i=Math.floor(t/s);t-=s*i,n+=Math.abs(i);const a=this.repetitions-n;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?s:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=t;if(o&&!(1&~n))return s-t}return t}_setEndings(e,t,n){const s=this._interpolantSettings;n?(s.endingStart=je,s.endingEnd=je):(s.endingStart=e?this.zeroSlopeAtStart?je:Le:De,s.endingEnd=t?this.zeroSlopeAtEnd?je:Le:De)}_scheduleFading(e,t,n){const o=this._mixer,i=o.time;let s=this._weightInterpolant;null===s&&(s=o._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,r=s.sampleValues;return a[0]=i,r[0]=t,a[1]=i+e,r[1]=n,this}}const Zu=new Float32Array(1);class Hu extends ls{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}_bindAction(e,t){const i=e._localRoot||this._root,a=e._clip.tracks,c=a.length,o=e._propertyBindings,l=e._interpolants,n=i.uuid,r=this._bindingsByRootAndName;let s=r[n];void 0===s&&(s={},r[n]=s);for(let r=0;r!==c;++r){const u=a[r],d=u.name;let e=s[d];if(void 0!==e)++e.referenceCount,o[r]=e;else{if(e=o[r],void 0!==e){null===e._cacheIndex&&(++e.referenceCount,this._addInactiveBinding(e,n,d));continue}const s=t&&t._propertyBindings[r].binding.parsedPath;e=new Eu(Ju.create(i,d,s),u.ValueTypeName,u.getValueSize()),++e.referenceCount,this._addInactiveBinding(e,n,d),o[r]=e}l[r].resultBuffer=e.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const s=(e._localRoot||this._root).uuid,t=e._clip.uuid,n=this._actionsByClip[t];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,t,s)}const t=e._propertyBindings;for(let e=0,s=t.length;e!==s;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,s=t.length;e!==s;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const o=this._actions,i=this._actionsByClip;let s=i[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=o.length,o.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){const n=this._actions,s=n[n.length-1],o=e._cacheIndex;s._cacheIndex=o,n[o]=s,n.pop(),e._cacheIndex=null;const i=e._clip.uuid,a=this._actionsByClip,r=a[i],t=r.knownActions,c=t[t.length-1],l=e._byClipCacheIndex;c._byClipCacheIndex=l,t[l]=c,t.pop(),e._byClipCacheIndex=null,delete r.actionByRoot[(e._localRoot||this._root).uuid],0===t.length&&delete a[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,s=t.length;e!==s;++e){const n=t[e];0===--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,s=e._cacheIndex,n=this._nActiveActions++,o=t[n];e._cacheIndex=n,t[n]=e,o._cacheIndex=s,t[s]=o}_takeBackAction(e){const t=this._actions,s=e._cacheIndex,n=--this._nActiveActions,o=t[n];e._cacheIndex=n,t[n]=e,o._cacheIndex=s,t[s]=o}_addInactiveBinding(e,t,n){const o=this._bindingsByRootAndName,i=this._bindings;let s=o[t];void 0===s&&(s={},o[t]=s),s[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,s=n.rootNode.uuid,c=n.path,o=this._bindingsByRootAndName,i=o[s],a=t[t.length-1],r=e._cacheIndex;a._cacheIndex=r,t[r]=a,t.pop(),delete i[c],0===Object.keys(i).length&&delete o[s]}_lendBinding(e){const t=this._bindings,s=e._cacheIndex,n=this._nActiveBindings++,o=t[n];e._cacheIndex=n,t[n]=e,o._cacheIndex=s,t[s]=o}_takeBackBinding(e){const t=this._bindings,s=e._cacheIndex,n=--this._nActiveBindings,o=t[n];e._cacheIndex=n,t[n]=e,o._cacheIndex=s,t[s]=o}_lendControlInterpolant(){const n=this._controlInterpolants,t=this._nActiveControlInterpolants++;let e=n[t];return void 0===e&&(e=new fc(new Float32Array(2),new Float32Array(2),1,Zu),e.__cacheIndex=t,n[t]=e),e}_takeBackControlInterpolant(e){const t=this._controlInterpolants,s=e.__cacheIndex,n=--this._nActiveControlInterpolants,o=t[n];e.__cacheIndex=n,t[n]=e,o.__cacheIndex=s,t[s]=o}clipAction(e,t,n){const r=t||this._root,c=r.uuid;let s="string"==typeof e?zc.findByName(r,e):e;const l=null!==s?s.uuid:e,o=this._actionsByClip[l];let i=null;if(void 0===n&&(n=null!==s?s.blendMode:Ue),void 0!==o){const e=o.actionByRoot[c];if(void 0!==e&&e.blendMode===n)return e;i=o.knownActions[0],null===s&&(s=i._clip)}if(null===s)return null;const a=new Yu(this,s,t,n);return this._bindAction(a,i),this._addInactiveAction(a,l,c),a}existingAction(e,t){const n=t||this._root,i=n.uuid,s="string"==typeof e?zc.findByName(n,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const n=this._actions,s=this._nActiveActions,o=this.time+=e,i=Math.sign(e),t=this._accuIndex^=1;for(let a=0;a!==s;++a)n[a]._update(o,e,i,t);const a=this._bindings,r=this._nActiveBindings;for(let e=0;e!==r;++e)a[e].apply(t);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,s=this._actionsByClip,o=s[n];if(void 0!==o){const e=o.knownActions;for(let s=0,a=e.length;s!==a;++s){const n=e[s];this._deactivateAction(n);const o=n._cacheIndex,i=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,i._cacheIndex=o,t[o]=i,t.pop(),this._removeInactiveBindingsForAction(n)}delete s[n]}}uncacheRoot(e){const n=e.uuid,s=this._actionsByClip;for(const t in s){const e=s[t].actionByRoot[n];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const t=this._bindingsByRootAndName[n];if(void 0!==t)for(const n in t){const e=t[n];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Gu extends Ws{constructor(e=1,t=1,n=1,s={}){super(e,t,s),this.isRenderTarget3D=!0,this.depth=n,this.texture=new Ys(null,e,t,n),this._setTextureOptions(s),this.texture.isRenderTargetTexture=!0}}class $u{constructor(e){this.value=e}clone(){return new $u(void 0===this.value.clone?this.value:this.value.clone())}}let Qu=0;class Ku extends ls{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Qu++}),this.name="",this.usage=ki,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let e=0,s=t.length;e<s;e++){const n=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0;e<n.length;e++)this.uniforms.push(n[e].clone())}return this}clone(){return(new this.constructor).copy(this)}}class td extends Ta{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class ed{constructor(e,t,n,s,o,i=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=s,this.count=o,this.normalized=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const id=new Mr;class sd{constructor(e,t,n=0,s=1/0){this.ray=new wr(e,t),this.near=n,this.far=s,this.camera=null,this.layers=new Pr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):as("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return id.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(id),this}intersectObject(e,t=!0,n=[]){return nd(e,this,n,t),n.sort(rd),n}intersectObjects(e,t=!0,n=[]){for(let s=0,o=e.length;s<o;s++)nd(e[s],this,n,t);return n.sort(rd),n}}function rd(e,t){return e.distance-t.distance}function nd(e,t,n,s){let o=!0;if(e.layers.test(t.layers)&&!1===e.raycast(t,n)&&(o=!1),!0===o&&!0===s){const s=e.children;for(let e=0,o=s.length;e<o;e++)nd(s[e],t,n,!0)}}class ad{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,void 0!==e.hidden&&(this._pageVisibilityHandler=od.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){null!==this._pageVisibilityHandler&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return null!==this._pageVisibilityHandler&&!0===this._document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==e?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function od(){!1===this._document.hidden&&this.reset()}class hd{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=ys(this.phi,e,Math.PI-e),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(ys(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class ld{constructor(e=1,t=0,n=0){this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}class cd{constructor(e,t,n,s){cd.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,n,s)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,s){const o=this.elements;return o[0]=e,o[2]=t,o[1]=n,o[3]=s,this}}const ud=new ws;class dd{constructor(e=new ws(1/0,1/0),t=new ws(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ud.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ud).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const pd=new Ss,md=new Ss,yd=new Ss,gd=new Ss,fd=new Ss,xd=new Ss,bd=new Ss;class vd{constructor(e=new Ss,t=new Ss){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){pd.subVectors(e,this.start),md.subVectors(this.end,this.start);const s=md.dot(md);let n=md.dot(pd)/s;return t&&(n=ys(n,0,1)),n}closestPointToPoint(e,t,n){const s=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(s).add(this.start)}distanceSqToLine3(e,t=xd,n=bd){const r=1e-8*1e-8;let o,s;const c=this.start,l=e.start,u=this.end,h=e.end;yd.subVectors(u,c),gd.subVectors(h,l),fd.subVectors(c,l);const i=yd.dot(yd),a=gd.dot(gd),d=gd.dot(fd);if(i<=r&&a<=r)return t.copy(c),n.copy(l),t.sub(n),t.dot(t);if(i<=r)o=0,s=d/a,s=ys(s,0,1);else{const e=yd.dot(fd);if(a<=r)s=0,o=ys(-e/i,0,1);else{const t=yd.dot(gd),n=i*a-t*t;o=0!==n?ys((t*d-e*a)/n,0,1):0,s=(t*o+d)/a,s<0?(s=0,o=ys(-e/i,0,1)):s>1&&(s=1,o=ys((t-e)/i,0,1))}}return t.copy(c).add(yd.multiplyScalar(o)),n.copy(l).add(gd.multiplyScalar(s)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const wd=new Ss;class Md extends Hr{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Jn,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,n=1,t=32;e<t;e++,n++){const o=e/t*Math.PI*2,i=n/t*Math.PI*2;s.push(Math.cos(o),Math.sin(o),1,Math.cos(i),Math.sin(i),1)}n.setAttribute("position",new Fn(s,3));const o=new Ho({fog:!1,toneMapped:!1});this.cone=new oh(n,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),wd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(wd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Sd=new Ss,_d=new Mr,Ad=new Mr;class Td extends oh{constructor(e){const t=zd(e),n=new Jn,s=[],o=[];for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),o.push(0,0,0),o.push(0,0,0))}n.setAttribute("position",new Fn(s,3)),n.setAttribute("color",new Fn(o,3)),super(n,new Ho({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const i=new yn(255),a=new yn(65280);this.setColors(i,a)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,s=n.getAttribute("position");Ad.copy(this.root.matrixWorld).invert();for(let n=0,o=0;n<t.length;n++){const e=t[n];e.parent&&e.parent.isBone&&(_d.multiplyMatrices(Ad,e.matrixWorld),Sd.setFromMatrixPosition(_d),s.setXYZ(o,Sd.x,Sd.y,Sd.z),_d.multiplyMatrices(Ad,e.parent.matrixWorld),Sd.setFromMatrixPosition(_d),s.setXYZ(o+1,Sd.x,Sd.y,Sd.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const n=this.geometry.getAttribute("color");for(let s=0;s<n.count;s+=2)n.setXYZ(s,e.r,e.g,e.b),n.setXYZ(s+1,t.r,t.g,t.b);return n.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function zd(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push(...zd(e.children[n]));return t}class Cd extends sa{constructor(e,t,n){super(new ql(t,4,2),new bn({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Id=new Ss,Bd=new yn,kd=new yn;class Od extends Hr{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const s=new jl(t);s.rotateY(.5*Math.PI),this.material=new bn({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const o=s.getAttribute("position"),i=new Float32Array(3*o.count);s.setAttribute("color",new Cn(i,3)),this.add(new sa(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Bd.copy(this.light.color),kd.copy(this.light.groundColor);for(let e=0,s=t.count;e<s;e++){const n=e<s/2?Bd:kd;t.setXYZ(e,n.r,n.g,n.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Id.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Pd extends oh{constructor(e=10,t=10,n=4473924,s=8947848){n=new yn(n),s=new yn(s);const c=t/2,l=e/t,o=e/2,a=[],i=[];for(let u=0,e=0,r=-o;u<=t;u++,r+=l){a.push(-o,0,r,o,0,r),a.push(r,0,-o,r,0,o);const d=u===c?n:s;d.toArray(i,e),e+=3,d.toArray(i,e),e+=3,d.toArray(i,e),e+=3,d.toArray(i,e),e+=3}const r=new Jn;r.setAttribute("position",new Fn(a,3)),r.setAttribute("color",new Fn(i,3)),super(r,new Ho({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Rd extends oh{constructor(e=10,t=16,n=8,s=64,o=4473924,i=8947848){o=new yn(o),i=new yn(i);const a=[],r=[];if(t>1)for(let s=0;s<t;s++){const c=s/t*(2*Math.PI),l=Math.sin(c)*e,d=Math.cos(c)*e;a.push(0,0,0),a.push(l,0,d);const n=1&s?o:i;r.push(n.r,n.g,n.b),r.push(n.r,n.g,n.b)}for(let c=0;c<n;c++){const t=1&c?o:i,l=e-e/n*c;for(let n=0;n<s;n++){let e=n/s*(2*Math.PI),o=Math.sin(e)*l,i=Math.cos(e)*l;a.push(o,0,i),r.push(t.r,t.g,t.b),e=(n+1)/s*(2*Math.PI),o=Math.sin(e)*l,i=Math.cos(e)*l,a.push(o,0,i),r.push(t.r,t.g,t.b)}}const c=new Jn;c.setAttribute("position",new Fn(a,3)),c.setAttribute("color",new Fn(r,3)),super(c,new Ho({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Nd=new Ss,Vd=new Ss,Fd=new Ss;class Ed extends Hr{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let s=new Jn;s.setAttribute("position",new Fn([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const o=new Ho({fog:!1,toneMapped:!1});this.lightPlane=new sh(s,o),this.add(this.lightPlane),s=new Jn,s.setAttribute("position",new Fn([0,0,0,0,0,1],3)),this.targetLine=new sh(s,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Nd.setFromMatrixPosition(this.light.matrixWorld),Vd.setFromMatrixPosition(this.light.target.matrixWorld),Fd.subVectors(Vd,Nd),this.lightPlane.lookAt(Vd),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Vd),this.targetLine.scale.z=Fd.length()}}const Ld=new Ss,jd=new ua;class Dd extends oh{constructor(e){const s=new Jn,r=new Ho({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],i=[],n={};function t(e,t){a(e),a(t)}function a(e){o.push(0,0,0),i.push(0,0,0),void 0===n[e]&&(n[e]=[]),n[e].push(o.length/3-1)}t("n1","n2"),t("n2","n4"),t("n4","n3"),t("n3","n1"),t("f1","f2"),t("f2","f4"),t("f4","f3"),t("f3","f1"),t("n1","f1"),t("n2","f2"),t("n3","f3"),t("n4","f4"),t("p","n1"),t("p","n2"),t("p","n3"),t("p","n4"),t("u1","u2"),t("u2","u3"),t("u3","u1"),t("c","t"),t("p","c"),t("cn1","cn2"),t("cn3","cn4"),t("cf1","cf2"),t("cf3","cf4"),s.setAttribute("position",new Fn(o,3)),s.setAttribute("color",new Fn(i,3)),super(s,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=n,this.update();const c=new yn(16755200),l=new yn(16711680),d=new yn(43775),u=new yn(16777215),h=new yn(3355443);this.setColors(c,l,d,u,h)}setColors(e,t,n,s,o){const i=this.geometry.getAttribute("color");return i.setXYZ(0,e.r,e.g,e.b),i.setXYZ(1,e.r,e.g,e.b),i.setXYZ(2,e.r,e.g,e.b),i.setXYZ(3,e.r,e.g,e.b),i.setXYZ(4,e.r,e.g,e.b),i.setXYZ(5,e.r,e.g,e.b),i.setXYZ(6,e.r,e.g,e.b),i.setXYZ(7,e.r,e.g,e.b),i.setXYZ(8,e.r,e.g,e.b),i.setXYZ(9,e.r,e.g,e.b),i.setXYZ(10,e.r,e.g,e.b),i.setXYZ(11,e.r,e.g,e.b),i.setXYZ(12,e.r,e.g,e.b),i.setXYZ(13,e.r,e.g,e.b),i.setXYZ(14,e.r,e.g,e.b),i.setXYZ(15,e.r,e.g,e.b),i.setXYZ(16,e.r,e.g,e.b),i.setXYZ(17,e.r,e.g,e.b),i.setXYZ(18,e.r,e.g,e.b),i.setXYZ(19,e.r,e.g,e.b),i.setXYZ(20,e.r,e.g,e.b),i.setXYZ(21,e.r,e.g,e.b),i.setXYZ(22,e.r,e.g,e.b),i.setXYZ(23,e.r,e.g,e.b),i.setXYZ(24,t.r,t.g,t.b),i.setXYZ(25,t.r,t.g,t.b),i.setXYZ(26,t.r,t.g,t.b),i.setXYZ(27,t.r,t.g,t.b),i.setXYZ(28,t.r,t.g,t.b),i.setXYZ(29,t.r,t.g,t.b),i.setXYZ(30,t.r,t.g,t.b),i.setXYZ(31,t.r,t.g,t.b),i.setXYZ(32,n.r,n.g,n.b),i.setXYZ(33,n.r,n.g,n.b),i.setXYZ(34,n.r,n.g,n.b),i.setXYZ(35,n.r,n.g,n.b),i.setXYZ(36,n.r,n.g,n.b),i.setXYZ(37,n.r,n.g,n.b),i.setXYZ(38,s.r,s.g,s.b),i.setXYZ(39,s.r,s.g,s.b),i.setXYZ(40,o.r,o.g,o.b),i.setXYZ(41,o.r,o.g,o.b),i.setXYZ(42,o.r,o.g,o.b),i.setXYZ(43,o.r,o.g,o.b),i.setXYZ(44,o.r,o.g,o.b),i.setXYZ(45,o.r,o.g,o.b),i.setXYZ(46,o.r,o.g,o.b),i.setXYZ(47,o.r,o.g,o.b),i.setXYZ(48,o.r,o.g,o.b),i.setXYZ(49,o.r,o.g,o.b),i.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap;let n,s;if(jd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),!0===this.camera.reversedDepth)n=1,s=0;else if(this.camera.coordinateSystem===Ui)n=-1,s=1;else{if(this.camera.coordinateSystem!==Wi)throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);n=0,s=1}Ud("c",t,e,jd,0,0,n),Ud("t",t,e,jd,0,0,s),Ud("n1",t,e,jd,-1,-1,n),Ud("n2",t,e,jd,1,-1,n),Ud("n3",t,e,jd,-1,1,n),Ud("n4",t,e,jd,1,1,n),Ud("f1",t,e,jd,-1,-1,s),Ud("f2",t,e,jd,1,-1,s),Ud("f3",t,e,jd,-1,1,s),Ud("f4",t,e,jd,1,1,s),Ud("u1",t,e,jd,.7,1.1,n),Ud("u2",t,e,jd,-.7,1.1,n),Ud("u3",t,e,jd,0,2,n),Ud("cf1",t,e,jd,-1,0,s),Ud("cf2",t,e,jd,1,0,s),Ud("cf3",t,e,jd,0,-1,s),Ud("cf4",t,e,jd,0,1,s),Ud("cn1",t,e,jd,-1,0,n),Ud("cn2",t,e,jd,1,0,n),Ud("cn3",t,e,jd,0,-1,n),Ud("cn4",t,e,jd,0,1,n),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ud(e,t,n,s,o,i,a){Ld.set(o,i,a).unproject(s);const r=t[e];if(void 0!==r){const e=n.getAttribute("position");for(let t=0,n=r.length;t<n;t++)e.setXYZ(r[t],Ld.x,Ld.y,Ld.z)}}const Wd=new Hs;class qd extends oh{constructor(e,t=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),n=new Jn;n.setIndex(new Cn(s,1)),n.setAttribute("position",new Cn(o,3)),super(n,new Ho({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&Wd.setFromObject(this.object),Wd.isEmpty())return;const t=Wd.min,n=Wd.max,s=this.geometry.attributes.position,e=s.array;e[0]=n.x,e[1]=n.y,e[2]=n.z,e[3]=t.x,e[4]=n.y,e[5]=n.z,e[6]=t.x,e[7]=t.y,e[8]=n.z,e[9]=n.x,e[10]=t.y,e[11]=n.z,e[12]=n.x,e[13]=n.y,e[14]=t.z,e[15]=t.x,e[16]=n.y,e[17]=t.z,e[18]=t.x,e[19]=t.y,e[20]=t.z,e[21]=n.x,e[22]=t.y,e[23]=t.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Jd extends oh{constructor(e,t=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Jn;n.setIndex(new Cn(s,1)),n.setAttribute("position",new Fn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Ho({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Xd extends sh{constructor(e,t=1,n=16776960){const i=n,s=new Jn;s.setAttribute("position",new Fn([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),s.computeBoundingSphere(),super(s,new Ho({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=new Jn;o.setAttribute("position",new Fn([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),o.computeBoundingSphere(),this.add(new sa(o,new bn({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Yd=new Ss;let Zd,Hd;class Gd extends Hr{constructor(e=new Ss(0,0,1),t=new Ss(0,0,0),n=1,s=16776960,o=.2*n,i=.2*o){super(),this.type="ArrowHelper",void 0===Zd&&(Zd=new Jn,Zd.setAttribute("position",new Fn([0,0,0,0,1,0],3)),Hd=new Ih(.5,1,5,1),Hd.translate(0,-.5,0)),this.position.copy(t),this.line=new sh(Zd,new Ho({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new sa(Hd,new bn({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,o,i)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Yd.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Yd,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class $d extends oh{constructor(e=1){const n=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],t=new Jn;t.setAttribute("position",new Fn(n,3)),t.setAttribute("color",new Fn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(t,new Ho({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const s=new yn,o=this.geometry.attributes.color.array;return s.set(e),s.toArray(o,0),s.toArray(o,3),s.set(t),s.toArray(o,6),s.toArray(o,9),s.set(n),s.toArray(o,12),s.toArray(o,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Qd{constructor(){this.type="ShapePath",this.color=new yn,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new rl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,s){return this.currentPath.quadraticCurveTo(e,t,n,s),this}bezierCurveTo(e,t,n,s,o,i){return this.currentPath.bezierCurveTo(e,t,n,s,o,i),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function f(e,t){const s=t.length;let n=!1;for(let c=s-1,r=0;r<s;c=r++){let o=t[c],i=t[r],l=i.x-o.x,a=i.y-o.y;if(Math.abs(a)>Number.EPSILON){if(a<0&&(o=t[r],l=-l,i=t[c],a=-a),e.y<o.y||e.y>i.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{const t=a*(e.x-o.x)-l*(e.y-o.y);if(0===t)return!0;if(t<0)continue;n=!n}}else{if(e.y!==o.y)continue;if(i.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=i.x)return!0}}return n}const m=Pl.isClockWise,s=this.subPaths;if(0===s.length)return[];let r,i,a;const d=[];if(1===s.length)return i=s[0],a=new nl,a.curves=i.curves,d.push(a),d;let c=!m(s[0].getPoints());c=e?!c:c;const l=[],t=[];let u,h,o=[],n=0;t[n]=void 0,o[n]=[];for(let a=0,l=s.length;a<l;a++)i=s[a],u=i.getPoints(),r=m(u),r=e?!r:r,r?(!c&&t[n]&&n++,t[n]={s:new nl,p:u},t[n].s.curves=i.curves,c&&n++,o[n]=[]):o[n].push({h:i,p:u[0]});if(!t[0])return function(e){const t=[];for(let n=0,o=e.length;n<o;n++){const i=e[n],s=new nl;s.curves=i.curves,t.push(s)}return t}(s);if(t.length>1){let e=!1,n=0;for(let e=0,n=t.length;e<n;e++)l[e]=[];for(let s=0,a=t.length;s<a;s++){const i=o[s];for(let o=0;o<i.length;o++){const a=i[o];let r=!0;for(let o=0;o<t.length;o++)f(a.p,t[o].p)&&(s!==o&&n++,r?(r=!1,l[o].push(a)):e=!0);r&&l[s].push(a)}}n>0&&!1===e&&(o=l)}for(let e=0,n=t.length;e<n;e++){a=t[e].s,d.push(a),h=o[e];for(let e=0,t=h.length;e<t;e++)a.holes.push(h[e].h)}return d}}class Kd extends ls{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){void 0!==e?(null!==this.domElement&&this.disconnect(),this.domElement=e):ns("Controls: connect() now requires an element.")}disconnect(){}dispose(){}update(){}}function tp(e,t,n,s){const o=function(e){switch(e){case zt:case Ct:return{byteLength:1,components:1};case Bt:case It:case Rt:return{byteLength:2,components:1};case Nt:case Vt:return{byteLength:2,components:4};case Ot:case kt:case Pt:return{byteLength:4,components:1};case Et:case Lt:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}(s);switch(n){case 1021:return e*t;case Jt:case Xt:return e*t/o.components*o.byteLength;case 1030:case 1031:return e*t*2/o.components*o.byteLength;case 1022:return e*t*3/o.components*o.byteLength;case Ut:case 1033:return e*t*4/o.components*o.byteLength;case 33776:case 33777:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case 33778:case 33779:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case 35841:case 35843:return Math.max(e,16)*Math.max(t,8)/4;case 35840:case 35842:return Math.max(e,8)*Math.max(t,8)/2;case 36196:case 37492:case 37488:case 37489:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case 37496:case 37490:case 37491:case 37808:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case 37809:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case 37810:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case 37811:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case 37812:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case 37813:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case 37814:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case 37815:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case 37816:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case 37817:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case 37818:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case 37819:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case 37820:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case 37821:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case 36492:case 36494:case 36495:return Math.ceil(e/4)*Math.ceil(t/4)*16;case 36283:case 36284:return Math.ceil(e/4)*Math.ceil(t/4)*8;case 36285:case 36286:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}class ep{static contain(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e}(e,t)}static cover(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e}(e,t)}static fill(e){return function(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e}(e)}static getByteLength(e,t,n,s){return tp(e,t,n,s)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}})),"undefined"!=typeof window&&(window.__THREE__?ns("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=t);export{it as ACESFilmicToneMapping,w as AddEquation,$ as AddOperation,We as AdditiveAnimationBlendMode,g as AdditiveBlending,rt as AgXToneMapping,jt as AlphaFormat,Bi as AlwaysCompare,U as AlwaysDepth,Mi as AlwaysStencilFunc,iu as AmbientLight,Yu as AnimationAction,zc as AnimationClip,Vc as AnimationLoader,Hu as AnimationMixer,Xu as AnimationObjectGroup,mc as AnimationUtils,Lh as ArcCurve,Su as ArrayCamera,Gd as ArrowHelper,at as AttachedBindMode,ku as Audio,Fu as AudioAnalyser,fu as AudioContext,Bu as AudioListener,xu as AudioLoader,$d as AxesHelper,d as BackSide,Ye as BasicDepthPacking,o as BasicShadowMap,Zo as BatchedMesh,ro as Bone,vc as BooleanKeyframeTrack,dd as Box2,Hs as Box3,Jd as Box3Helper,na as BoxGeometry,qd as BoxHelper,Cn as BufferAttribute,Jn as BufferGeometry,lu as BufferGeometryLoader,Ct as ByteType,Ic as Cache,ua as Camera,Dd as CameraHelper,Mh as CanvasTexture,Th as CapsuleGeometry,Jh as CatmullRomCurve3,et as CineonToneMapping,zh as CircleGeometry,yt as ClampToEdgeWrapping,_u as Clock,yn as Color,wc as ColorKeyframeTrack,ks as ColorManagement,Yi as Compatibility,vh as CompressedArrayTexture,wh as CompressedCubeTexture,bh as CompressedTexture,Fc as CompressedTextureLoader,Ih as ConeGeometry,L as ConstantAlphaFactor,F as ConstantColorFactor,Kd as Controls,fa as CubeCamera,_h as CubeDepthTexture,lt as CubeReflectionMapping,ct as CubeRefractionMapping,xa as CubeTexture,jc as CubeTextureLoader,pt as CubeUVReflectionMapping,Hh as CubicBezierCurve,Gh as CubicBezierCurve3,gc as CubicInterpolant,r as CullFaceBack,n as CullFaceFront,a as CullFaceFrontBack,s as CullFaceNone,Fh as Curve,sl as CurvePath,b as CustomBlending,st as CustomToneMapping,Ch as CylinderGeometry,ld as Cylindrical,Ys as Data3DTexture,Js as DataArrayTexture,no as DataTexture,Dc as DataTextureLoader,_n as DataUtils,ui as DecrementStencilOp,pi as DecrementWrapStencilOp,kc as DefaultLoadingManager,Wt as DepthFormat,qt as DepthStencilFormat,Sh as DepthTexture,ot as DetachedBindMode,eu as DirectionalLight,Ed as DirectionalLightHelper,xc as DiscreteInterpolant,kh as DodecahedronGeometry,p as DoubleSide,O as DstAlphaFactor,R as DstColorFactor,Ei as DynamicCopyUsage,Oi as DynamicDrawUsage,Ni as DynamicReadUsage,Vh as EdgesGeometry,Eh as EllipseCurve,Ai as EqualCompare,J as EqualDepth,fi as EqualStencilFunc,ut as EquirectangularReflectionMapping,dt as EquirectangularRefractionMapping,Or as Euler,ls as EventDispatcher,Ah as ExternalTexture,Vl as ExtrudeGeometry,Nc as FileLoader,Vn as Float16BufferAttribute,Fn as Float32BufferAttribute,Pt as FloatType,_a as Fog,Sa as FogExp2,xh as FramebufferTexture,u as FrontSide,To as Frustum,Io as FrustumArray,ed as GLBufferAttribute,ji as GLSL1,Di as GLSL3,zi as GreaterCompare,Y as GreaterDepth,Ii as GreaterEqualCompare,X as GreaterEqualDepth,wi as GreaterEqualStencilFunc,bi as GreaterStencilFunc,Pd as GridHelper,va as Group,Rt as HalfFloatType,qc as HemisphereLight,Od as HemisphereLightHelper,El as IcosahedronGeometry,yu as ImageBitmapLoader,Lc as ImageLoader,Ns as ImageUtils,ci as IncrementStencilOp,di as IncrementWrapStencilOp,lo as InstancedBufferAttribute,hu as InstancedBufferGeometry,td as InstancedInterleavedBuffer,xo as InstancedMesh,On as Int16BufferAttribute,Rn as Int32BufferAttribute,In as Int8BufferAttribute,kt as IntType,Ta as InterleavedBuffer,Ca as InterleavedBufferAttribute,yc as Interpolant,Ve as InterpolateDiscrete,Fe as InterpolateLinear,Ee as InterpolateSmooth,Xi as InterpolationSamplingMode,Ji as InterpolationSamplingType,mi as InvertStencilOp,hi as KeepStencilOp,bc as KeyframeTrack,Ya as LOD,Ll as LatheGeometry,Pr as Layers,_i as LessCompare,W as LessDepth,Ti as LessEqualCompare,q as LessEqualDepth,xi as LessEqualStencilFunc,gi as LessStencilFunc,Wc as Light,nu as LightProbe,sh as Line,vd as Line3,Ho as LineBasicMaterial,$h as LineCurve,Qh as LineCurve3,lc as LineDashedMaterial,hh as LineLoop,oh as LineSegments,Mt as LinearFilter,fc as LinearInterpolant,Tt as LinearMipMapLinearFilter,_t as LinearMipMapNearestFilter,At as LinearMipmapLinearFilter,St as LinearMipmapNearestFilter,ei as LinearSRGBColorSpace,K as LinearToneMapping,ii as LinearTransfer,Oc as Loader,ou as LoaderUtils,Bc as LoadingManager,Pe as LoopOnce,Ne as LoopPingPong,Re as LoopRepeat,e as MOUSE,xn as Material,v as MaterialBlending,au as MaterialLoader,vs as MathUtils,cd as Matrix2,Ts as Matrix3,Mr as Matrix4,A as MaxEquation,sa as Mesh,bn as MeshBasicMaterial,ac as MeshDepthMaterial,oc as MeshDistanceMaterial,nc as MeshLambertMaterial,hc as MeshMatcapMaterial,rc as MeshNormalMaterial,ic as MeshPhongMaterial,ec as MeshPhysicalMaterial,tc as MeshStandardMaterial,sc as MeshToonMaterial,_ as MinEquation,gt as MirroredRepeatWrapping,G as MixOperation,x as MultiplyBlending,H as MultiplyOperation,ft as NearestFilter,wt as NearestMipMapLinearFilter,bt as NearestMipMapNearestFilter,vt as NearestMipmapLinearFilter,xt as NearestMipmapNearestFilter,nt as NeutralToneMapping,Si as NeverCompare,D as NeverDepth,yi as NeverStencilFunc,m as NoBlending,Ke as NoColorSpace,ri as NoNormalPacking,Q as NoToneMapping,Ue as NormalAnimationBlendMode,y as NormalBlending,ai as NormalGAPacking,ni as NormalRGPacking,Ci as NotEqualCompare,Z as NotEqualDepth,vi as NotEqualStencilFunc,Mc as NumberKeyframeTrack,Hr as Object3D,cu as ObjectLoader,Qe as ObjectSpaceNormalMap,jl as OctahedronGeometry,z as OneFactor,j as OneMinusConstantAlphaFactor,E as OneMinusConstantColorFactor,P as OneMinusDstAlphaFactor,N as OneMinusDstColorFactor,k as OneMinusSrcAlphaFactor,I as OneMinusSrcColorFactor,Kc as OrthographicCamera,h as PCFShadowMap,l as PCFSoftShadowMap,rl as Path,ya as PerspectiveCamera,Mo as Plane,Dl as PlaneGeometry,Xd as PlaneHelper,Qc as PointLight,Cd as PointLightHelper,mh as Points,lh as PointsMaterial,Rd as PolarGridHelper,Bh as PolyhedronGeometry,Vu as PositionalAudio,Ju as PropertyBinding,Eu as PropertyMixer,Kh as QuadraticBezierCurve,tl as QuadraticBezierCurve3,Ms as Quaternion,_c as QuaternionKeyframeTrack,Sc as QuaternionLinearInterpolant,he as R11_EAC_Format,ps as RAD2DEG,ke as RED_GREEN_RGTC2_Format,Ie as RED_RGTC1_Format,t as REVISION,ce as RG11_EAC_Format,Ze as RGBADepthPacking,Ut as RGBAFormat,Gt as RGBAIntegerFormat,Se as RGBA_ASTC_10x10_Format,ve as RGBA_ASTC_10x5_Format,we as RGBA_ASTC_10x6_Format,Me as RGBA_ASTC_10x8_Format,_e as RGBA_ASTC_12x10_Format,Ae as RGBA_ASTC_12x12_Format,de as RGBA_ASTC_4x4_Format,pe as RGBA_ASTC_5x4_Format,me as RGBA_ASTC_5x5_Format,ye as RGBA_ASTC_6x5_Format,ge as RGBA_ASTC_6x6_Format,fe as RGBA_ASTC_8x5_Format,xe as RGBA_ASTC_8x6_Format,be as RGBA_ASTC_8x8_Format,Te as RGBA_BPTC_Format,oe as RGBA_ETC2_EAC_Format,re as RGBA_PVRTC_2BPPV1_Format,se as RGBA_PVRTC_4BPPV1_Format,Qt as RGBA_S3TC_DXT1_Format,Kt as RGBA_S3TC_DXT3_Format,te as RGBA_S3TC_DXT5_Format,He as RGBDepthPacking,Dt as RGBFormat,Ht as RGBIntegerFormat,ze as RGB_BPTC_SIGNED_Format,Ce as RGB_BPTC_UNSIGNED_Format,ne as RGB_ETC1_Format,ae as RGB_ETC2_Format,ie as RGB_PVRTC_2BPPV1_Format,ee as RGB_PVRTC_4BPPV1_Format,$t as RGB_S3TC_DXT1_Format,Ge as RGDepthPacking,Yt as RGFormat,Zt as RGIntegerFormat,Kl as RawShaderMaterial,wr as Ray,sd as Raycaster,su as RectAreaLight,Jt as RedFormat,Xt as RedIntegerFormat,tt as ReinhardToneMapping,Ws as RenderTarget,Gu as RenderTarget3D,mt as RepeatWrapping,li as ReplaceStencilOp,S as ReverseSubtractEquation,Ul as RingGeometry,le as SIGNED_R11_EAC_Format,Oe as SIGNED_RED_GREEN_RGTC2_Format,Be as SIGNED_RED_RGTC1_Format,ue as SIGNED_RG11_EAC_Format,ti as SRGBColorSpace,si as SRGBTransfer,Aa as Scene,ca as ShaderMaterial,Ql as ShadowMaterial,nl as Shape,Wl as ShapeGeometry,Qd as ShapePath,Pl as ShapeUtils,It as ShortType,ho as Skeleton,Td as SkeletonHelper,so as SkinnedMesh,Fs as Source,pr as Sphere,ql as SphereGeometry,hd as Spherical,ru as SphericalHarmonics3,el as SplineCurve,Gc as SpotLight,Md as SpotLightHelper,Wa as Sprite,Ia as SpriteMaterial,B as SrcAlphaFactor,V as SrcAlphaSaturateFactor,C as SrcColorFactor,Fi as StaticCopyUsage,ki as StaticDrawUsage,Ri as StaticReadUsage,Mu as StereoCamera,Li as StreamCopyUsage,Pi as StreamDrawUsage,Vi as StreamReadUsage,Ac as StringKeyframeTrack,M as SubtractEquation,f as SubtractiveBlending,i as TOUCH,$e as TangentSpaceNormalMap,Jl as TetrahedronGeometry,Ds as Texture,Uc as TextureLoader,ep as TextureUtils,ad as Timer,qi as TimestampQuery,Xl as TorusGeometry,Yl as TorusKnotGeometry,cn as Triangle,Xe as TriangleFanDrawMode,Je as TriangleStripDrawMode,qe as TrianglesDrawMode,Zl as TubeGeometry,ht as UVMapping,Pn as Uint16BufferAttribute,Nn as Uint32BufferAttribute,Bn as Uint8BufferAttribute,kn as Uint8ClampedBufferAttribute,$u as Uniform,Ku as UniformsGroup,la as UniformsUtils,zt as UnsignedByteType,Lt as UnsignedInt101111Type,Ft as UnsignedInt248Type,Et as UnsignedInt5999Type,Ot as UnsignedIntType,Nt as UnsignedShort4444Type,Vt as UnsignedShort5551Type,Bt as UnsignedShortType,c as VSMShadowMap,ws as Vector2,Ss as Vector3,Us as Vector4,Tc as VectorKeyframeTrack,fh as VideoFrameTexture,gh as VideoTexture,Zs as WebGL3DRenderTarget,Xs as WebGLArrayRenderTarget,Ui as WebGLCoordinateSystem,ba as WebGLCubeRenderTarget,qs as WebGLRenderTarget,Wi as WebGPUCoordinateSystem,Ma as WebXRController,Hl as WireframeGeometry,De as WrapAroundEnding,Le as ZeroCurvatureEnding,T as ZeroFactor,je as ZeroSlopeEnding,oi as ZeroStencilOp,Zi as arrayNeedsUint32,aa as cloneUniforms,Ki as createCanvasElement,Qi as createElementNS,as as error,tp as getByteLength,ss as getConsoleFunction,ha as getUnlitUniformColorSpace,$i as isTypedArray,rs as log,oa as mergeUniforms,hs as probeAsync,is as setConsoleFunction,ns as warn,os as warnOnce}