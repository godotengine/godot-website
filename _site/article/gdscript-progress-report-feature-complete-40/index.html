<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Godot Engine"><meta name=description content="GDScript is now feature-complete for the upcoming Godot 4.0 version. This article goes through the last bits that were added: typed arrays, lambda functions, builtin static methods, plus a few extra changes for optimization and bug-fixing."><meta name=theme-color content="#3d8fcc"><meta property="og:site_name" content="Godot Engine"><meta property="og:url" content="https://godotengine.org/article/gdscript-progress-report-feature-complete-40/"><meta name=twitter:site content="@godotengine"><meta property="og:title" content="GDScript progress report: Feature-complete for 4.0"><meta property="og:description" content="GDScript is now feature-complete for the upcoming Godot 4.0 version. This article goes through the last bits that were added: typed arrays, lambda functions, builtin static methods, plus a few extra changes for optimization and bug-fixing."><meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/60b/4f2/b0a/60b4f2b0a8130694314324.png"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><title>GDScript progress report: Feature-complete for 4.0</title><link rel=alternate type=application/rss+xml title="Godot News" href=/rss.xml><link rel=icon href=/assets/favicon.png sizes=any><link rel=icon href=/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=/assets/css/main.css?111><link rel=stylesheet href=/assets/css/tobii.min.css><link rel=preload as=font href=/assets/fonts/Montserrat-Bold.woff2 crossorigin><link rel=preload as=font href=/assets/fonts/Montserrat-ExtraBold.woff2 crossorigin><link rel=me href=https://mastodon.gamedev.place/@godotengine><input type=checkbox id=nav_toggle_cb><header><div class="container flex align-center"><div id=nav_head><a href=/ id=logo-link><img class=nav-logo src=/assets/logo.svg width=136 height=48 alt="Godot Engine">
<img class="nav-logo dark-logo" src=/assets/logo_dark.svg width=136 height=48 alt="Godot Engine"></a>
<label for=nav_toggle_cb id=nav_toggle_btn><img src=/assets/icons/hamburger.svg width=24 height=24 alt="Main menu"></label></div><nav id=nav><ul class=left><li><a href=/features>Features</a><li class=only-on-mobile><a href=/showcase>Showcase</a><li><a href=/blog>Blog</a><li><a href=/community>Community</a><li><a href=/contact>About</a><li><a href=https://godotengine.org/asset-library/asset>Assets</a></ul><ul class=right><li><a href=/download/windows class=set-os-download-url>Download</a><li><a href=https://docs.godotengine.org>Learn</a><li><a href=https://docs.godotengine.org/en/stable/community/contributing/index.html>Contribute</a><li class=fund><a href=https://fund.godotengine.org>❤&#xFE0E; Donate</a></ul></nav></div></header><main><style>body{background-color:var(--background-color)}h1{margin-bottom:8px;margin-top:32px}:not(pre)>code{background:var(--code-background-color);padding:1px 4px;font-size:.95em;border-radius:3px}pre{background:var(--codeblock-background-color);color:var(--codeblock-color)}pre code{display:block;overflow-x:auto;padding:.5em}.date-big{line-height:2;margin-left:32px}article{background-color:var(--base-color);box-shadow:0 3px 2px rgba(0,0,0,.15)}figure{margin:0}figure img{margin:0}article img,article video{max-width:100%;height:auto;display:block;margin:auto;margin-top:16px;margin-bottom:16px}article h1{margin-top:64px}article h2,article h3,article h4{margin-top:42px}.article-info{display:flex;flex-direction:column;gap:8px}.article-metadata{display:flex;gap:24px;align-items:center;font-family:var(--header-font-family);margin-bottom:12px}@media(max-width:900px){.article-metadata{flex-direction:column;align-items:flex-start;gap:16px}}.article-author{color:var(--base-color-text-subtitle-date);font-weight:700;font-size:18px;flex-grow:1;display:flex;gap:12px;align-items:center}.article-author .avatar{border-radius:100%;margin:0}.article-author .by{color:var(--base-color-text-subtitle)}.article-metadata .date{color:var(--base-color-text-subtitle-date)}.article-metadata .date.post-recent-highlight{color:var(--post-recent-highlight-color);opacity:.8}.article-metadata .date.post-recent-highlight::after{font-size:80%;content:"NEW";border:2px solid var(--post-recent-highlight-color);padding:2px 3px;margin-left:8px}.tag.active{filter:saturate(.75)}@media screen and (min-width:900px){article .content{width:70%;margin:auto}}@media(max-width:900px){body{background-color:var(--base-color)}article{background-color:initial;box-shadow:none}article img:first-child,article video:first-child{max-width:100%}}</style><link rel=stylesheet href=/assets/css/highlight.obsidian.min.css><div class=container><article class=padded><div class="content article-container"><figure class=article-cover><img src=/storage/app/uploads/public/60b/4f2/b0a/60b4f2b0a8130694314324.png title alt=" " class=rounded-lg style=width:100%;height:auto;background-color:initial></figure><div class=article-info><h1>GDScript progress report: Feature-complete for 4.0</h1><div class=article-metadata><div class=article-author><span>By:</span>
<img class=avatar width=25 height=25 src=/assets/images/authors/vnen.webp alt="George Marques" loading=lazy>
<span class=by>George Marques</span></div><span class=date data-post-date="2021-06-02 00:00:00 +0000">2 June 2021</span></div><div class=tags><a href=/blog/progress-report><div class="tag active">Progress Report</div></a></div></div><div class="card card-warning"><p>This article is from <strong>June 2021</strong>, some of its contents might be outdated and no longer accurate.<br>You can find up-to-date information about the engine in the <a href=https://docs.godotengine.org/en/stable/>official documentation</a>.</div><div class=article-body><p>It has been a while since my last report. In my <a href=https://godotengine.org/article/gdscript-progress-report-typed-instructions>last post</a>, I’ve mentioned GDNative, but since I’ve done only a bunch of “boring” stuff, I ended up not writing anything about it. Work on GDNative is not completed yet, so maybe I’ll have something interesting to report later on. For now, let me show what was done on GDScript.<p><em>See other articles in this Godot 4.0 GDScript series:</em><ol><li><a href=https://godotengine.org/article/gdscript-progress-report-writing-tokenizer>GDScript progress report: Writing a tokenizer</a><li><a href=https://godotengine.org/article/gdscript-progress-report-writing-new-parser>GDScript progress report: Writing a new parser</a><li><a href=https://godotengine.org/article/gdscript-progress-report-type-checking-back>GDScript progress report: Type checking is back</a><li><a href=https://godotengine.org/article/gdscript-progress-report-new-gdscript-now-merged>GDScript progress report: New GDScript is now merged</a><li><a href=https://godotengine.org/article/gdscript-progress-report-typed-instructions>GDScript progress report: Typed instructions</a><li>(you are here) <a href=https://godotengine.org/article/gdscript-progress-report-feature-complete-40>GDScript progress report: Feature-complete for 4.0</a></ol><h3 id=typed-arrays>Typed arrays</h3><p>One of the most requested features of GDScript is now implemented: <a href=https://github.com/godotengine/godot/pull/46830>typed arrays</a>. Now you can set the element type and let it be validated by the engine. That allows you to do safe operations with homogeneous arrays and also allow the language to optimize a few more code paths.<p>The syntax is inspired by Python, like most of the type system:<div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>var</span> <span class=n>my_array</span><span class=p>:</span> <span class=kt>Array</span><span class=p>[</span><span class=kt>int</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
</code></pre></div></div><p>This allows you to easily change a regular array to typed and vice-versa without changing much code. You can also rely on type inference. If the array has elements of the same type, it will be inferred as typed:<div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>var</span> <span class=n>inferred_array</span> <span class=p>:</span><span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span> <span class=c1># This is Array[int].</span>
</code></pre></div></div><p>Note that types that can’t be validated at compile-time (when they are dynamic) will be validated at runtime, which might impact performance slightly if done regularly.<h2 id=lambda-functions>Lambda functions</h2><p>Improving the functional side of GDScript, now you can use <a href=https://github.com/godotengine/godot/pull/47454>lambda functions</a> (or, more specifically, <em>function literals</em>). Those are inline functions that are assigned directly to an expression instead of being defined in the class. This is great for functions used only in a small context – like sorting an array or connecting to a signal – without polluting the class scope with those.<p>The syntax is pretty much the same as a regular function, only that it is placed where an expression should be:<div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>func</span> <span class=nf>_ready</span><span class=p>():</span>
    <span class=k>var</span> <span class=n>my_lambda</span> <span class=o>=</span> <span class=k>func</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
    <span class=n>my_lambda</span><span class=o>.</span><span class=n>call</span><span class=p>(</span><span class=s2>"hello"</span><span class=p>)</span>
</code></pre></div></div><p>Note that the <code class="language-plaintext highlighter-rouge">.call()</code> is needed because lambdas are of type Callable.<p>You can also pass them as function arguments:<div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>func</span> <span class=nf>_ready</span><span class=p>():</span>
    <span class=n>button_down</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=k>func</span><span class=p>():</span> <span class=nb>print</span><span class=p>(</span><span class=s2>"button was pressed"</span><span class=p>))</span>
</code></pre></div></div><p>Lambdas can optionally have a name, which is used when viewing stack traces. They are also not limited to a single statement:<div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>func</span> <span class=nf>_ready</span><span class=p>():</span>
    <span class=k>var</span> <span class=n>my_lambda</span> <span class=o>=</span> <span class=k>func</span> <span class=nf>this_is_lambda</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>"Hello"</span><span class=p>)</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>"This is </span><span class=si>%s</span><span class=s2>"</span> <span class=o>%</span> <span class=n>x</span><span class=p>)</span>
</code></pre></div></div><p>Last but not least, lambdas can capture variables from the scope they are defined in. This means you can use variables from the outer function or the outer class inside the lambda. Those will be copied when the lambda is created at runtime and passed to function when it’s called:<div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>func</span> <span class=nf>_ready</span><span class=p>():</span>
    <span class=k>var</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>42</span>
    <span class=k>var</span> <span class=n>my_lambda</span> <span class=o>=</span> <span class=k>func</span><span class=p>():</span> <span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
    <span class=n>my_lambda</span><span class=o>.</span><span class=n>call</span><span class=p>()</span> <span class=c1># Prints "42".</span>
</code></pre></div></div><p>The documentation will be updated to explain this in detail in the future.<h3 id=static-methods-in-built-in-types>Static methods in built-in types</h3><p>A while back, Juan added support for <a href=https://github.com/godotengine/godot/pull/46378>static methods on built-in types</a>. Now I’ve <a href=https://github.com/godotengine/godot/pull/48767>added</a> this change to GDScript so these static methods can actually be called.<p>This is quite interesting because many times, we had to construct a value just to call a function on it. Now, the function can be called directly:<div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>var</span> <span class=n>x</span> <span class=o>=</span> <span class=kt>Color</span><span class=o>.</span><span class=n>html_is_valid</span><span class=p>(</span><span class=s2>"00ffff"</span><span class=p>)</span> <span class=c1># true</span>
</code></pre></div></div><p>Note that in 3.x, you already can use this syntax for some cases (such as <code class="language-plaintext highlighter-rouge">Color.from_hsv()</code>) but it only works with <code class="language-plaintext highlighter-rouge">const</code> functions that return the same type as the base and that is actually constructing a value at runtime. In 4.0, this won’t be valid anymore for these cases, but we can have actual static functions.<h3 id=further-optimizations>Further optimizations</h3><p>I’ve implemented a couple of things that will help improving GDScript performance (not directly, but we still plan to work on the VM performance before 4.0). Those are internal changes that won’t affect the way you code, but I’ll mention them here for completeness.<p>One of those is <a href=https://github.com/godotengine/godot/pull/47727>reducing the number of addressing modes</a>, which will help us eventually have instructions with addressing modes baked in. This will reduce branching in the code which is something CPUs enjoy. Having less modes means we can have less permutations of each instruction, reducing the complexity and code size.<p>The other is <a href=https://github.com/godotengine/godot/pull/47956>using a special stack space for typed temporaries</a>. This means that results of sub-expressions that are typed can be stored on the stack in a Variant without changing its type nor re-initializing it. This is particularly helpful on types that require memory allocation, such as Transform, since the allocation can be done only once per call.<h3 id=test-suite>Test suite</h3><p>To improve the quality of the GDScript code and avoid regressions over time, I’ve <a href=https://github.com/godotengine/godot/pull/47701>added a test runner</a> that verifies if the language code is performing as intended. I’ve had some help from <a href=https://github.com/Xrayez>Andrii Doroshenko</a> who ported my suite to use the new doctest integration, effectively making the tests for GDScript part of the general test for the engine.<p>We don’t have a lot of test cases for now, but the number of tests will increase over time as tests are added together with bug fixes to avoid regressions.<h3 id=bug-fixing>Bug fixing</h3><p>I’ve now shifted the focus to bringing GDScript to a more usable state even before 4.0-alpha, so more users can test it to verify how it’s working. For now, my focus are in the game-breaking bugs that stops people from even using GDScript. The small things can wait a bit longer to when we reach the bugfixing round after alpha is released.</div></div></article></div><link rel=stylesheet href=/assets/css/anchor-link.css?1><link rel=stylesheet href=/assets/css/article-cards.css?2><script src=/assets/js/anchor-link.js></script>
<script>document.addEventListener('DOMContentLoaded',()=>{window.applyAnchorLinks('.article-body'),document.querySelectorAll('.article-cover img, .article-body img').forEach(b=>{if(b.classList.contains('lightbox-ignore'))return;const a=document.createElement('a');a.href=b.src,a.classList.add('lightbox'),a.dataset.group='article',b.parentNode.appendChild(a),a.appendChild(b)})})</script></main><footer><div class="container flex footer-container"><div id=copyright><p>© 2007-2024 Juan Linietsky, Ariel Manzur and <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md target=_blank rel=noopener>contributors</a>.<br>Hosted by the <a href=https://godot.foundation/ target=_blank rel=noopener>Godot Foundation</a>.<br>Website <a href=https://github.com/godotengine/godot-website target=_blank rel=noopener>source code on GitHub</a>.</div><div id=sitemap><ul class=sitemap-group><li><strong>Get Godot</strong><li><a href=/download/windows class=set-os-download-url>Download</a><li><a href=https://editor.godotengine.org/releases/latest/>Web Editor</a><li>&nbsp;<li><strong>Public Relations</strong><li><a href=/blog>Blog</a><li><a href=/community>Communities and Events</a><li><a href=/press>Press Kit</a></ul><ul class=sitemap-group><li><strong>About Godot</strong><li><a href=/features>Features</a><li><a href=/showcase>Showcase</a><li><a href=/education>Education</a><li><a href=/license>License</a><li><a href=/code-of-conduct>Code of Conduct</a><li><a href=/privacy-policy>Privacy Policy</a><li><a href=https://fund.godotengine.org>Donate</a></ul><ul class=sitemap-group><li><strong>Project Team</strong><li><a href=/governance>Governance</a><li><a href=/teams>Teams</a><li>&nbsp;<li><strong>Extra Resources</strong><li><a href=/asset-library/asset>Asset Library</a><li><a href=https://docs.godotengine.org>Documentation</a><li><a href=https://github.com/godotengine>Code Repository</a></ul></div><div id=social class=dark-desaturate><h4 class=text-right><a href=/contact>Contact us</a></h4><div class="flex justify-space-between" style=gap:3px><a href=https://github.com/godotengine target=_blank rel=noopener><img src=/assets/footer/github_logo.svg width=32 height=32 alt=GitHub></a>
<a href=https://mastodon.gamedev.place/@godotengine target=_blank rel=noopener><img src=/assets/footer/mastodon_logo.svg width=32 height=32 alt=Mastodon></a>
<a href=https://twitter.com/godotengine target=_blank rel=noopener><img src=/assets/footer/twitter_logo.svg width=32 height=32 alt=Twitter></a>
<a href=https://www.facebook.com/groups/godotengine/ target=_blank rel=noopener><img src=/assets/footer/facebook_logo.svg width=32 height=32 alt=Facebook></a>
<a href=https://www.reddit.com/r/godot target=_blank rel=noopener><img src=/assets/footer/reddit_logo.svg width=32 height=32 alt=Red​dit></a>
<a href=/rss.xml target=_blank rel=noopener><img src=/assets/footer/feed_logo.svg width=32 height=32 alt="RSS feed"></a></div></div></div></footer><script defer src=/assets/js/tobii.min.js></script>
<script defer src=/assets/js/highlight.min.js?1></script>
<script defer src=/assets/js/highlight.gdscript.min.js?1></script>
<script>document.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('pre code').forEach(a=>{hljs.highlightBlock(a)}),document.querySelectorAll('[data-post-date]').forEach(a=>{Date.parse(a.dataset.postDate)>Date.now()-1e3*60*60*48&&a.classList.add("post-recent-highlight")}),new Tobii({zoom:!1});const a=document.querySelectorAll('.set-os-download-url');for(let b=0;b<a.length;b++){const c=a[b];let e='download';'version'in c.dataset&&c.dataset.version==='3'&&(e='download/3.x');let d='windows';navigator.platform.indexOf('Mac')!==-1?d='macos':navigator.platform.indexOf('Linux')!==-1&&(d='linux'),c.href=`/${e}/${d}`}})</script>