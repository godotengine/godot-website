<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Godot Engine"><meta name=description content="News about running Godot on servers, and hints at upcoming networking changes in Godot 4.0."><meta name=theme-color content="#3d8fcc"><meta property="og:site_name" content="Godot Engine"><meta property="og:url" content="https://godotengine.org/article/multiplayer-changes-godot-4-0-report-1/"><meta name=twitter:site content="@godotengine"><meta property="og:title" content="Multiplayer in Godot 4.0: On servers, RSETs and state updates"><meta property="og:description" content="News about running Godot on servers, and hints at upcoming networking changes in Godot 4.0."><meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/610/918/f3e/610918f3ec53b713518837.png"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><title>Multiplayer in Godot 4.0: On servers, RSETs and state updates</title><link rel=alternate type=application/rss+xml title="Godot News" href=/rss.xml><link rel=icon href=/assets/favicon.png sizes=any><link rel=icon href=/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=/assets/css/main.css?111><link rel=stylesheet href=/assets/css/tobii.min.css><link rel=preload as=font href=/assets/fonts/Montserrat-Bold.woff2 crossorigin><link rel=preload as=font href=/assets/fonts/Montserrat-ExtraBold.woff2 crossorigin><link rel=me href=https://mastodon.gamedev.place/@godotengine><input type=checkbox id=nav_toggle_cb><header><div class="container flex align-center"><div id=nav_head><a href=/ id=logo-link><img class=nav-logo src=/assets/logo.svg width=136 height=48 alt="Godot Engine">
<img class="nav-logo dark-logo" src=/assets/logo_dark.svg width=136 height=48 alt="Godot Engine"></a>
<label for=nav_toggle_cb id=nav_toggle_btn><img src=/assets/icons/hamburger.svg width=24 height=24 alt="Main menu"></label></div><nav id=nav><ul class=left><li><a href=/features>Features</a><li class=only-on-mobile><a href=/showcase>Showcase</a><li><a href=/blog>Blog</a><li><a href=/community>Community</a><li><a href=/contact>About</a><li><a href=https://godotengine.org/asset-library/asset>Assets</a></ul><ul class=right><li><a href=/download/windows class=set-os-download-url>Download</a><li><a href=https://docs.godotengine.org>Learn</a><li><a href=https://docs.godotengine.org/en/stable/community/contributing/index.html>Contribute</a><li class=fund><a href=https://fund.godotengine.org>❤&#xFE0E; Donate</a></ul></nav></div></header><main><style>body{background-color:var(--background-color)}h1{margin-bottom:8px;margin-top:32px}:not(pre)>code{background:var(--code-background-color);padding:1px 4px;font-size:.95em;border-radius:3px}pre{background:var(--codeblock-background-color);color:var(--codeblock-color)}pre code{display:block;overflow-x:auto;padding:.5em}.date-big{line-height:2;margin-left:32px}article{background-color:var(--base-color);box-shadow:0 3px 2px rgba(0,0,0,.15)}figure{margin:0}figure img{margin:0}article img,article video{max-width:100%;height:auto;display:block;margin:auto;margin-top:16px;margin-bottom:16px}article h1{margin-top:64px}article h2,article h3,article h4{margin-top:42px}.article-info{display:flex;flex-direction:column;gap:8px}.article-metadata{display:flex;gap:24px;align-items:center;font-family:var(--header-font-family);margin-bottom:12px}@media(max-width:900px){.article-metadata{flex-direction:column;align-items:flex-start;gap:16px}}.article-author{color:var(--base-color-text-subtitle-date);font-weight:700;font-size:18px;flex-grow:1;display:flex;gap:12px;align-items:center}.article-author .avatar{border-radius:100%;margin:0}.article-author .by{color:var(--base-color-text-subtitle)}.article-metadata .date{color:var(--base-color-text-subtitle-date)}.article-metadata .date.post-recent-highlight{color:var(--post-recent-highlight-color);opacity:.8}.article-metadata .date.post-recent-highlight::after{font-size:80%;content:"NEW";border:2px solid var(--post-recent-highlight-color);padding:2px 3px;margin-left:8px}.tag.active{filter:saturate(.75)}@media screen and (min-width:900px){article .content{width:70%;margin:auto}}@media(max-width:900px){body{background-color:var(--base-color)}article{background-color:initial;box-shadow:none}article img:first-child,article video:first-child{max-width:100%}}</style><link rel=stylesheet href=/assets/css/highlight.obsidian.min.css><div class=container><article class=padded><div class="content article-container"><figure class=article-cover><img src=/storage/app/uploads/public/610/918/f3e/610918f3ec53b713518837.png title alt=" " class=rounded-lg style=width:100%;height:auto;background-color:initial></figure><div class=article-info><h1>Multiplayer in Godot 4.0: On servers, RSETs and state updates</h1><div class=article-metadata><div class=article-author><span>By:</span>
<img class=avatar width=25 height=25 src=/assets/images/authors/faless.webp alt="Fabio Alessandrelli" loading=lazy>
<span class=by>Fabio Alessandrelli</span></div><span class=date data-post-date="2021-08-05 18:00:00 +0000">5 August 2021</span></div><div class=tags><a href=/blog/progress-report><div class="tag active">Progress Report</div></a></div></div><div class="card card-warning"><p>This article is from <strong>August 2021</strong>, some of its contents might be outdated and no longer accurate.<br>You can find up-to-date information about the engine in the <a href=https://docs.godotengine.org/en/stable/>official documentation</a>.</div><div class=article-body><p>Howdy Godotters!<p>It’s time for the first update on Godot 4.0 multiplayer and networking changes.<p>In this post, I’ll focus on the new “headless” display, and the removal of multiplayer RSETs (read below before despairing!), along with keeping you hyped with some of the new features planned or in the work.<p><em>See other articles in this Godot 4.0 networking series:</em><ol><li>(you are here) <a href=https://godotengine.org/article/multiplayer-changes-godot-4-0-report-1>Multiplayer in Godot 4.0: On servers, RSETs and state updates</a><li><a href=https://godotengine.org/article/multiplayer-changes-godot-4-0-report-2>Multiplayer in Godot 4.0: RPC syntax, channels, ordering</a><li><a href=https://godotengine.org/article/multiplayer-changes-godot-4-0-report-3>Multiplayer in Godot 4.0: ENet wrappers, WebRTC</a><li><a href=https://godotengine.org/article/multiplayer-changes-godot-4-0-report-4>Multiplayer in Godot 4.0: Scene Replication (part 1)</a></ol><h3 id=goodbye-server-platform-hello-headless-display>Goodbye <code class="language-plaintext highlighter-rouge">server</code> platform, hello headless display!</h3><p>One of the emergent feature of Godot that users have discovered and really started to like is its ability to run on a headless Linux machine and act as game server.<p>Over time, <a href=https://github.com/godotengine/godot/pull/23279>macOS support</a> was added to the <code class="language-plaintext highlighter-rouge">server</code> platform, and users showed interest in a <a href=https://github.com/godotengine/godot/issues/6059><code class="language-plaintext highlighter-rouge">windows</code> server</a>.<p>Finally, in Godot 4.0, you will be able to run Godot with <a href=https://github.com/godotengine/godot/pull/49074><strong>headless display</strong></a> (no rendering) on any <em>desktop platform</em>.<p>Passing the <strong><code class="language-plaintext highlighter-rouge">--display-driver headless</code></strong> command line argument will start Godot without rendering, like the old <code class="language-plaintext highlighter-rouge">server</code> platform, no matter if you are on Linux, macOS or Windows.<p>Additionally, we are working on a series of <a href=https://github.com/godotengine/godot-proposals/issues/2756>“server” export options</a>, to let developers further reduce the memory and load time footprint by replacing specific assets with “fake” files that only contains metadata. For example, a “fake” audio file will not contain any audio, but will retain informations about length, loops, etc. This means that server-side code relying on audio timing or texture sizes will still work correctly.<h3 id=removing-rsets>Removing RSETs</h3><p>When building the multiplayer API, two forms of network communications were introduced: RPCs to call functions remotely, and RSETs to set variables remotely. This seemed like a good idea at the time: RSETs were a fast way to prototype, and easily make your game networked… or were they?<p>In reality, using RSET proved to be almost always a bad idea:<ul><li>First, you have very little control over who is setting it beside the <code class="language-plaintext highlighter-rouge">master</code> keyword. Anything more complex than that, and you will need a function so you can base your logic on the RPC caller.<li>Second, performances are bad!</ul><p>Take this example from the <a href=https://github.com/godotengine/godot-demo-projects/tree/master/networking/multiplayer_bomber>multiplayer bomber demo</a>:<div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>extends</span> <span class=n>KinematicBody2D</span>

<span class=k>puppet</span> <span class=k>var</span> <span class=n>puppet_pos</span> <span class=o>=</span> <span class=kt>Vector2</span><span class=p>()</span>
<span class=k>puppet</span> <span class=k>var</span> <span class=n>puppet_motion</span> <span class=o>=</span> <span class=kt>Vector2</span><span class=p>()</span>

<span class=k>func</span> <span class=nf>_physics_process</span><span class=p>(</span><span class=n>_delta</span><span class=p>):</span>
    <span class=c1># ...</span>
    <span class=k>if</span> <span class=n>is_network_master</span><span class=p>():</span>
        <span class=n>rset</span><span class=p>(</span><span class=s2>"puppet_motion"</span><span class=p>,</span> <span class=n>motion</span><span class=p>)</span>
        <span class=n>rset</span><span class=p>(</span><span class=s2>"puppet_pos"</span><span class=p>,</span> <span class=n>position</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>position</span> <span class=o>=</span> <span class=n>puppet_pos</span>
        <span class=n>motion</span> <span class=o>=</span> <span class=n>puppet_motion</span>

    <span class=n>move_and_slide</span><span class=p>(</span><span class=n>motion</span> <span class=o>*</span> <span class=n>MOTION_SPEED</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>is_network_master</span><span class=p>():</span>
        <span class=n>puppet_pos</span> <span class=o>=</span> <span class=n>position</span> <span class=c1># To avoid jitter</span>
</code></pre></div></div><p>It’s making 2 separate <code class="language-plaintext highlighter-rouge">rset()</code>s, generating 2 packets, which may arrive each at a different frame under certain conditions. Additionally, while one would think it could use a direct RSET for the <code class="language-plaintext highlighter-rouge">position</code>, it actually can’t. This is because it needs to add some logic to avoid jittering anyway.<p>Compare it with this:<div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>extends</span> <span class=n>KinematicBody2D</span>

<span class=k>var</span> <span class=n>puppet_pos</span> <span class=o>=</span> <span class=kt>Vector2</span><span class=p>()</span>
<span class=k>var</span> <span class=n>puppet_motion</span> <span class=o>=</span> <span class=kt>Vector2</span><span class=p>()</span>

<span class=k>puppet</span> <span class=k>func</span> <span class=nf>_update_state</span><span class=p>(</span><span class=n>p_pos</span><span class=p>,</span> <span class=n>p_motion</span><span class=p>):</span>
    <span class=n>puppet_pos</span> <span class=o>=</span> <span class=n>p_pos</span>
    <span class=n>puppet_motion</span> <span class=o>=</span> <span class=n>p_motion</span>

<span class=k>func</span> <span class=nf>_physics_process</span><span class=p>(</span><span class=n>_delta</span><span class=p>):</span>
    <span class=c1># ...</span>
    <span class=k>if</span> <span class=n>is_network_master</span><span class=p>():</span>
        <span class=n>rpc</span><span class=p>(</span><span class=s2>"_update_state"</span><span class=p>,</span> <span class=n>puppet_pos</span><span class=p>,</span> <span class=n>puppet_motion</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>position</span> <span class=o>=</span> <span class=n>puppet_pos</span>
        <span class=n>motion</span> <span class=o>=</span> <span class=n>puppet_motion</span>

    <span class=n>move_and_slide</span><span class=p>(</span><span class=n>motion</span> <span class=o>*</span> <span class=n>MOTION_SPEED</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>is_network_master</span><span class=p>():</span>
        <span class=n>puppet_pos</span> <span class=o>=</span> <span class=n>position</span> <span class=c1># To avoid jitter</span>
</code></pre></div></div><p>In this example, we only make 1 <code class="language-plaintext highlighter-rouge">rpc()</code>, reducing the network usage and latency. More importantly, we make sure that in each frame, either the client will have the old state, or a fully updated one. This avoids having an inconsistent state where the position is up-to-date but the motion isn’t (or vice versa).<p>This is just one example which shows a common pitfall in networking.<p>So, to avoid tricking developers into these common mistakes (which could be unexpected for newcomers), and given the rarity of <code class="language-plaintext highlighter-rouge">rset()</code> usage in general, we decided to remove <code class="language-plaintext highlighter-rouge">rset()</code>. We really think you won’t miss it in the end, but let us know if you feel you had a strong use case for them. Like most decisions in Godot, this is not set in stone.<h3 id=future-work>Future work</h3><p>If you feel a bit disappointed from this progress update, keep in mind this was just the ground work for more important changes. We have a few surprises in the works!<p>There’s the new GDScript syntax for RPCs to talk about, the newly exposed <code class="language-plaintext highlighter-rouge">ordered</code> transfer mode, channels, ENet and WebRTC improvements, and even some news about the long-awaited <strong>node replication</strong>! So stay tuned for more :)<h3 id=reference-work>Reference work</h3><ul><li><a href=https://github.com/godotengine/godot/pull/49074>Headless DisplayServer</a><li><a href=https://github.com/godotengine/godot/pull/49221>RPC refactor and RSET removal</a></ul></div></div></article></div><link rel=stylesheet href=/assets/css/anchor-link.css?1><link rel=stylesheet href=/assets/css/article-cards.css?2><script src=/assets/js/anchor-link.js></script>
<script>document.addEventListener('DOMContentLoaded',()=>{window.applyAnchorLinks('.article-body'),document.querySelectorAll('.article-cover img, .article-body img').forEach(b=>{if(b.classList.contains('lightbox-ignore'))return;const a=document.createElement('a');a.href=b.src,a.classList.add('lightbox'),a.dataset.group='article',b.parentNode.appendChild(a),a.appendChild(b)})})</script></main><footer><div class="container flex footer-container"><div id=copyright><p>© 2007-2024 Juan Linietsky, Ariel Manzur and <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md target=_blank rel=noopener>contributors</a>.<br>Hosted by the <a href=https://godot.foundation/ target=_blank rel=noopener>Godot Foundation</a>.<br>Website <a href=https://github.com/godotengine/godot-website target=_blank rel=noopener>source code on GitHub</a>.</div><div id=sitemap><ul class=sitemap-group><li><strong>Get Godot</strong><li><a href=/download/windows class=set-os-download-url>Download</a><li><a href=https://editor.godotengine.org/releases/latest/>Web Editor</a><li>&nbsp;<li><strong>Public Relations</strong><li><a href=/blog>Blog</a><li><a href=/community>Communities and Events</a><li><a href=/press>Press Kit</a></ul><ul class=sitemap-group><li><strong>About Godot</strong><li><a href=/features>Features</a><li><a href=/showcase>Showcase</a><li><a href=/education>Education</a><li><a href=/license>License</a><li><a href=/code-of-conduct>Code of Conduct</a><li><a href=/privacy-policy>Privacy Policy</a><li><a href=https://fund.godotengine.org>Donate</a></ul><ul class=sitemap-group><li><strong>Project Team</strong><li><a href=/governance>Governance</a><li><a href=/teams>Teams</a><li>&nbsp;<li><strong>Extra Resources</strong><li><a href=/asset-library/asset>Asset Library</a><li><a href=https://docs.godotengine.org>Documentation</a><li><a href=https://github.com/godotengine>Code Repository</a></ul></div><div id=social class=dark-desaturate><h4 class=text-right><a href=/contact>Contact us</a></h4><div class="flex justify-space-between" style=gap:3px><a href=https://github.com/godotengine target=_blank rel=noopener><img src=/assets/footer/github_logo.svg width=32 height=32 alt=GitHub></a>
<a href=https://mastodon.gamedev.place/@godotengine target=_blank rel=noopener><img src=/assets/footer/mastodon_logo.svg width=32 height=32 alt=Mastodon></a>
<a href=https://twitter.com/godotengine target=_blank rel=noopener><img src=/assets/footer/twitter_logo.svg width=32 height=32 alt=Twitter></a>
<a href=https://www.facebook.com/groups/godotengine/ target=_blank rel=noopener><img src=/assets/footer/facebook_logo.svg width=32 height=32 alt=Facebook></a>
<a href=https://www.reddit.com/r/godot target=_blank rel=noopener><img src=/assets/footer/reddit_logo.svg width=32 height=32 alt=Red​dit></a>
<a href=/rss.xml target=_blank rel=noopener><img src=/assets/footer/feed_logo.svg width=32 height=32 alt="RSS feed"></a></div></div></div></footer><script defer src=/assets/js/tobii.min.js></script>
<script defer src=/assets/js/highlight.min.js?1></script>
<script defer src=/assets/js/highlight.gdscript.min.js?1></script>
<script>document.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('pre code').forEach(a=>{hljs.highlightBlock(a)}),document.querySelectorAll('[data-post-date]').forEach(a=>{Date.parse(a.dataset.postDate)>Date.now()-1e3*60*60*48&&a.classList.add("post-recent-highlight")}),new Tobii({zoom:!1});const a=document.querySelectorAll('.set-os-download-url');for(let b=0;b<a.length;b++){const c=a[b];let e='download';'version'in c.dataset&&c.dataset.version==='3'&&(e='download/3.x');let d='windows';navigator.platform.indexOf('Mac')!==-1?d='macos':navigator.platform.indexOf('Linux')!==-1&&(d='linux'),c.href=`/${e}/${d}`}})</script>