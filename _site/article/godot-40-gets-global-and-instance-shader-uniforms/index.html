<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Godot Engine"><meta name=description content="Work towards the complete 4.0 feature set continues at a vibrant pace (Stay tuned for the progress report at the end of the month!). Today I will discuss a new feature that most likely takes a bit more time to understand than just looking at an image."><meta name=theme-color content="#3d8fcc"><meta property="og:site_name" content="Godot Engine"><meta property="og:url" content="https://godotengine.org/article/godot-40-gets-global-and-instance-shader-uniforms/"><meta name=twitter:site content="@godotengine"><meta property="og:title" content="Godot 4.0 gets global and per-instance shader uniforms"><meta property="og:description" content="Work towards the complete 4.0 feature set continues at a vibrant pace (Stay tuned for the progress report at the end of the month!). Today I will discuss a new feature that most likely takes a bit more time to understand than just looking at an image."><meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/5e9/927/545/5e9927545d809505894099.png"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><title>Godot 4.0 gets global and per-instance shader uniforms</title><link rel=alternate type=application/rss+xml title="Godot News" href=/rss.xml><link rel=icon href=/assets/favicon.png sizes=any><link rel=icon href=/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=/assets/css/main.css?111><link rel=stylesheet href=/assets/css/tobii.min.css><link rel=preload as=font href=/assets/fonts/Montserrat-Bold.woff2 crossorigin><link rel=preload as=font href=/assets/fonts/Montserrat-ExtraBold.woff2 crossorigin><link rel=me href=https://mastodon.gamedev.place/@godotengine><input type=checkbox id=nav_toggle_cb><header><div class="container flex align-center"><div id=nav_head><a href=/ id=logo-link><img class=nav-logo src=/assets/logo.svg width=136 height=48 alt="Godot Engine">
<img class="nav-logo dark-logo" src=/assets/logo_dark.svg width=136 height=48 alt="Godot Engine"></a>
<label for=nav_toggle_cb id=nav_toggle_btn><img src=/assets/icons/hamburger.svg width=24 height=24 alt="Main menu"></label></div><nav id=nav><ul class=left><li><a href=/features>Features</a><li class=only-on-mobile><a href=/showcase>Showcase</a><li><a href=/blog>Blog</a><li><a href=/community>Community</a><li><a href=/contact>About</a><li><a href=https://godotengine.org/asset-library/asset>Assets</a></ul><ul class=right><li><a href=/download/windows class=set-os-download-url>Download</a><li><a href=https://docs.godotengine.org>Learn</a><li><a href=https://docs.godotengine.org/en/stable/community/contributing/index.html>Contribute</a><li class=fund><a href=https://fund.godotengine.org>❤&#xFE0E; Donate</a></ul></nav></div></header><main><style>body{background-color:var(--background-color)}h1{margin-bottom:8px;margin-top:32px}:not(pre)>code{background:var(--code-background-color);padding:1px 4px;font-size:.95em;border-radius:3px}pre{background:var(--codeblock-background-color);color:var(--codeblock-color)}pre code{display:block;overflow-x:auto;padding:.5em}.date-big{line-height:2;margin-left:32px}article{background-color:var(--base-color);box-shadow:0 3px 2px rgba(0,0,0,.15)}figure{margin:0}figure img{margin:0}article img,article video{max-width:100%;height:auto;display:block;margin:auto;margin-top:16px;margin-bottom:16px}article h1{margin-top:64px}article h2,article h3,article h4{margin-top:42px}.article-info{display:flex;flex-direction:column;gap:8px}.article-metadata{display:flex;gap:24px;align-items:center;font-family:var(--header-font-family);margin-bottom:12px}@media(max-width:900px){.article-metadata{flex-direction:column;align-items:flex-start;gap:16px}}.article-author{color:var(--base-color-text-subtitle-date);font-weight:700;font-size:18px;flex-grow:1;display:flex;gap:12px;align-items:center}.article-author .avatar{border-radius:100%;margin:0}.article-author .by{color:var(--base-color-text-subtitle)}.article-metadata .date{color:var(--base-color-text-subtitle-date)}.article-metadata .date.post-recent-highlight{color:var(--post-recent-highlight-color);opacity:.8}.article-metadata .date.post-recent-highlight::after{font-size:80%;content:"NEW";border:2px solid var(--post-recent-highlight-color);padding:2px 3px;margin-left:8px}.tag.active{filter:saturate(.75)}@media screen and (min-width:900px){article .content{width:70%;margin:auto}}@media(max-width:900px){body{background-color:var(--base-color)}article{background-color:initial;box-shadow:none}article img:first-child,article video:first-child{max-width:100%}}</style><link rel=stylesheet href=/assets/css/highlight.obsidian.min.css><div class=container><article class=padded><div class="content article-container"><figure class=article-cover><img src=/storage/app/uploads/public/5e9/927/545/5e9927545d809505894099.png title alt=" " class=rounded-lg style=width:100%;height:auto;background-color:initial></figure><div class=article-info><h1>Godot 4.0 gets global and per-instance shader uniforms</h1><div class=article-metadata><div class=article-author><span>By:</span>
<img class=avatar width=25 height=25 src=/assets/images/authors/reduzio.webp alt="Juan Linietsky" loading=lazy>
<span class=by>Juan Linietsky</span></div><span class=date data-post-date="2020-04-17 00:00:00 +0000">17 April 2020</span></div><div class=tags><a href=/blog/progress-report><div class="tag active">Progress Report</div></a></div></div><div class="card card-warning"><p>This article is from <strong>April 2020</strong>, some of its contents might be outdated and no longer accurate.<br>You can find up-to-date information about the engine in the <a href=https://docs.godotengine.org/en/stable/>official documentation</a>.</div><div class=article-body><p><em><strong>Update (2023-12-16):</strong> Up-to-date instructions on setting up per-instance uniforms can be found in the <a href=https://docs.godotengine.org/en/stable/tutorials/shaders/shader_reference/shading_language.html#per-instance-uniforms>Shading language</a> documentation.</em><hr><p>Work towards the complete 4.0 feature set continues at a vibrant pace (stay tuned for the progress report at the end of the month!). Today I will discuss a new feature that most likely takes a bit more time to understand than just looking at the above image.<h2 id=per-instance-global-what>Per instance global what?</h2><p>Godot shader language is one of the easiest ones to use of any engine. Letting visual shaders aside, the shading language is a very tidy and self-contained version of GLSL ES 3.0, which is presented in an accessible and easy-to-use editor. The editor supports code-completion, real-time errors and real-time update.<p>Shaders can take take inputs, modify them and produce outputs. To control this process, <em>uniforms</em> are used. Here is an example where you can draw a 2D shader with magenta:<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>shader_type canvas_item;

void fragment() {
    COLOR = vec3(1.0, 0.0, 1.0);
}
</code></pre></div></div><p>Simple, right? Now imagine that you want to control the color via code (or via the Inspector in the editor). For this, you define a specialized <em>uniform</em>:<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>shader_type canvas_item;

uniform vec4 my_color : hint_color; // Edit as a color.

void fragment() {
    COLOR = mycolor.rgb;
}
</code></pre></div></div><p>This produces an editable parameter in the <em>material</em>. The material is what you set to 2D nodes or to 3D meshes in order to draw them. Materials can reuse the same shader and use it with different parameters via these same <em>uniforms</em>.<p>Still, as nice as it may be, there are some practical limitations to this whole system in Godot 3.x:<ul><li>Sometimes, you want to modify a parameter in a lot of instances of a material, and this takes a lot of work as all these instances need to be tracked and the uniform needs to be set for each of them.<li>Sometimes, you want to modify a parameter on each node using the material. As an example, a forest full of trees, where you want each tree to have a slightly different color, editable by hand. This would require having a unique material for each tree (each with a slightly different hue).</ul><p>Fortunately, these limitations will no longer apply in Godot 4.0 thanks to two new features!<h2 id=global-uniforms>Global uniforms</h2><p>Global uniforms are immensely useful in games, because they allow you to change the behavior of a lot of shaders at the same time. They are a bit of an advanced technique, but there are some types of effects and game genres you just can’t to do without them.<p>In Godot 4.0, they will work in a very straightforward way. Simply tag a uniform as <code class="language-plaintext highlighter-rouge">global</code> and that’s it:<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>shader_type canvas_item;

global uniform vec4 my_color;

void fragment() {
    COLOR = mycolor.rgb;
}
</code></pre></div></div><p>Of course, before doing this, you need to create this global uniform, with the right type, name and default value, in the <em>Project Settings</em> dialog. Here is how it looks in real-life:<p><img src=/storage/app/uploads/public/5e9/91e/f93/5e991ef93c174195976834.png alt="Global uniforms in Project Settings"><p>And that’s it. You may still be wondering what this is useful for, so I’m going to show how one of my favorite games <em>© Nintendo</em> makes heavy use of global uniforms:<h4 id=1-providing-player-information-to-all-the-relevant-shaders>1. Providing player information to all the relevant shaders</h4><p>You may want to let your shaders know where the player is. As an example, the grass and some bushes will bend when the player is close, simulating being pushed:</p><video controls>
<source src=/storage/app/media/global_uniforms/zelda_grass.mp4 type=video/mp4></video><h4 id=2-modifying-the-world-without-actually-modifying-it>2. Modifying the world without actually modifying it</h4><p>Modern games have so much grass, yet you can do precise cuts to it, burn it, etc. How do they do it? Is every bit of grass a mesh and an object?<p>Not really, games generally just use a texture aligned to the world (that often moves with you), with different colors meaning different things. In this case they can use texture channels to specify that the grass has been cut, burnt, etc. The vertex shader can make the vertices disappear, or change the color based on this global uniform texture.</p><video controls>
<source src=/storage/app/media/global_uniforms/zelda_grass2.mp4 type=video/mp4></video><h4 id=3-controlling-the-weather-and-environment>3. Controlling the weather and environment</h4><p>Nowadays games have realistic weather, with leaves and trees moving with the wind. Do they make animations for each piece of grass? Not really, you can save the wind strength and direction in a global uniform, then procedurally move the foliage with different speed and intensity.<p>This can even affect particle system shaders, making fire and smoke propagate in the direction of the wind.</p><video controls>
<source src=/storage/app/media/global_uniforms/zelda_wind.mp4 type=video/mp4></video><p>Shooters often have what is called a <em>turbulence texture</em>, which is a texture that contains the local wind direction around the player. All relevant shaders can access it and it’s what allows explosions to move trees and grass around.<h4 id=4-making-regular-materials-interact-with-the-environment>4. Making regular materials interact with the environment</h4><p>This is often very overlooked. We think materials are edited and that’s it, but that’s not always the case. Imagine it starts raining and you want your objects to become wet. You need to change the metallic and roughness factors. For floors you want to draw droplets splashing, for walls you want to draw the water pouring down.</p><video controls>
<source src=/storage/app/media/global_uniforms/zelda_wet.mp4 type=video/mp4></video><p>You could control this with regular uniforms, but imagine setting this on every material when it starts raining! Again, this can be easily done with global uniforms.<p>So, to make it short, global uniforms are extremely useful and can help you add a lot of detail to your game. In Godot, they work for every shader type, including the recently introduced <a href=https://godotengine.org/article/custom-sky-shaders-godot-4-0>sky shaders</a>.<h2 id=per-instance-uniforms>Per instance uniforms</h2><p>Users very often request the ability to tweak a shader parameter per each 2D or 3D node, without having to create a new material each time (which is then very difficult to maintain). To solve this, the <code class="language-plaintext highlighter-rouge">instance</code> uniform qualifier has been added. Simply add it to a uniform and it takes effect immediately.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>shader_type canvas_item;

instance uniform vec4 my_color : hint_color; // Edit as a color.

void fragment() {
    COLOR = mycolor.rgb;
}
</code></pre></div></div><p>Head to the relevant node in the Inspector (<code class="language-plaintext highlighter-rouge">CanvasItem</code> for 2D, <code class="language-plaintext highlighter-rouge">GeometryInstance3D</code> for 3D), and you will see this parameter exposed in the node properties, only affecting that single node:<p><img src=/storage/app/uploads/public/5e9/924/8f0/5e99248f0baa6666466843.png alt="Instance uniforms in the Inspector"><p>This is ideal for adding more variety to your graphics, or for creating animations that change the shader but only affect a single node.<p>There are, however, some restrictions that it’s good to be aware of:<ul><li>There is a practical maximum limit of 16 instance uniforms per shader. I think it should be reasonable.<li>It does not support textures, only regular scalar and vector types. Unfortunately there is not a practical way to do this that is portable across different hardware.<li>If your mesh uses multiple materials (for different sections), the parameters for the first mesh found will win over the subsequent ones, unless they have the same name, index and type (then all are affected).<li>You can, however, avoid clashes by manually specifying the index (0-15) of the instance uniform by using the <code class="language-plaintext highlighter-rouge">instance_index</code> hint:</ul><div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>instance uniform vec4 hello : instance_index(5);
</code></pre></div></div><p>For global uniforms there is no limit though, you can have as many as you want.<h2 id=future>Future</h2><p>Hard work and lots of love continues being poured into the <code class="language-plaintext highlighter-rouge">master</code> branch by the project contributors to make Godot 4.0 our best release ever. If you are not yet, please consider <a href=https://www.patreon.com/godotengine>becoming our patron</a>, and helping the project achieve its goals faster and better!</div></div></article></div><link rel=stylesheet href=/assets/css/anchor-link.css?1><link rel=stylesheet href=/assets/css/article-cards.css?2><script src=/assets/js/anchor-link.js></script>
<script>document.addEventListener('DOMContentLoaded',()=>{window.applyAnchorLinks('.article-body'),document.querySelectorAll('.article-cover img, .article-body img').forEach(b=>{if(b.classList.contains('lightbox-ignore'))return;const a=document.createElement('a');a.href=b.src,a.classList.add('lightbox'),a.dataset.group='article',b.parentNode.appendChild(a),a.appendChild(b)})})</script></main><footer><div class="container flex footer-container"><div id=copyright><p>© 2007-2024 Juan Linietsky, Ariel Manzur and <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md target=_blank rel=noopener>contributors</a>.<br>Hosted by the <a href=https://godot.foundation/ target=_blank rel=noopener>Godot Foundation</a>.<br>Website <a href=https://github.com/godotengine/godot-website target=_blank rel=noopener>source code on GitHub</a>.</div><div id=sitemap><ul class=sitemap-group><li><strong>Get Godot</strong><li><a href=/download/windows class=set-os-download-url>Download</a><li><a href=https://editor.godotengine.org/releases/latest/>Web Editor</a><li>&nbsp;<li><strong>Public Relations</strong><li><a href=/blog>Blog</a><li><a href=/community>Communities and Events</a><li><a href=/press>Press Kit</a></ul><ul class=sitemap-group><li><strong>About Godot</strong><li><a href=/features>Features</a><li><a href=/showcase>Showcase</a><li><a href=/education>Education</a><li><a href=/license>License</a><li><a href=/code-of-conduct>Code of Conduct</a><li><a href=/privacy-policy>Privacy Policy</a><li><a href=https://fund.godotengine.org>Donate</a></ul><ul class=sitemap-group><li><strong>Project Team</strong><li><a href=/governance>Governance</a><li><a href=/teams>Teams</a><li>&nbsp;<li><strong>Extra Resources</strong><li><a href=/asset-library/asset>Asset Library</a><li><a href=https://docs.godotengine.org>Documentation</a><li><a href=https://github.com/godotengine>Code Repository</a></ul></div><div id=social class=dark-desaturate><h4 class=text-right><a href=/contact>Contact us</a></h4><div class="flex justify-space-between" style=gap:3px><a href=https://github.com/godotengine target=_blank rel=noopener><img src=/assets/footer/github_logo.svg width=32 height=32 alt=GitHub></a>
<a href=https://mastodon.gamedev.place/@godotengine target=_blank rel=noopener><img src=/assets/footer/mastodon_logo.svg width=32 height=32 alt=Mastodon></a>
<a href=https://twitter.com/godotengine target=_blank rel=noopener><img src=/assets/footer/twitter_logo.svg width=32 height=32 alt=Twitter></a>
<a href=https://www.facebook.com/groups/godotengine/ target=_blank rel=noopener><img src=/assets/footer/facebook_logo.svg width=32 height=32 alt=Facebook></a>
<a href=https://www.reddit.com/r/godot target=_blank rel=noopener><img src=/assets/footer/reddit_logo.svg width=32 height=32 alt=Red​dit></a>
<a href=/rss.xml target=_blank rel=noopener><img src=/assets/footer/feed_logo.svg width=32 height=32 alt="RSS feed"></a></div></div></div></footer><script defer src=/assets/js/tobii.min.js></script>
<script defer src=/assets/js/highlight.min.js?1></script>
<script defer src=/assets/js/highlight.gdscript.min.js?1></script>
<script>document.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('pre code').forEach(a=>{hljs.highlightBlock(a)}),document.querySelectorAll('[data-post-date]').forEach(a=>{Date.parse(a.dataset.postDate)>Date.now()-1e3*60*60*48&&a.classList.add("post-recent-highlight")}),new Tobii({zoom:!1});const a=document.querySelectorAll('.set-os-download-url');for(let b=0;b<a.length;b++){const c=a[b];let e='download';'version'in c.dataset&&c.dataset.version==='3'&&(e='download/3.x');let d='windows';navigator.platform.indexOf('Mac')!==-1?d='macos':navigator.platform.indexOf('Linux')!==-1&&(d='linux'),c.href=`/${e}/${d}`}})</script>