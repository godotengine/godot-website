<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Godot Engine"><meta name=description content="A sneak peak at DTLS support in Godot 4.0 ."><meta name=theme-color content="#3d8fcc"><meta property="og:site_name" content="Godot Engine"><meta property="og:url" content="https://godotengine.org/article/dtls-report-1/"><meta name=twitter:site content="@godotengine"><meta property="og:title" content="DTLS progress report #1"><meta property="og:description" content="A sneak peak at DTLS support in Godot 4.0 ."><meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/5db/87c/7eb/5db87c7eb83ec156927495.png"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><title>DTLS progress report #1</title><link rel=alternate type=application/rss+xml title="Godot News" href=/rss.xml><link rel=icon href=/assets/favicon.png sizes=any><link rel=icon href=/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=/assets/css/main.css?111><link rel=stylesheet href=/assets/css/tobii.min.css><link rel=preload as=font href=/assets/fonts/Montserrat-Bold.woff2 crossorigin><link rel=preload as=font href=/assets/fonts/Montserrat-ExtraBold.woff2 crossorigin><link rel=me href=https://mastodon.gamedev.place/@godotengine><input type=checkbox id=nav_toggle_cb><header><div class="container flex align-center"><div id=nav_head><a href=/ id=logo-link><img class=nav-logo src=/assets/logo.svg width=136 height=48 alt="Godot Engine">
<img class="nav-logo dark-logo" src=/assets/logo_dark.svg width=136 height=48 alt="Godot Engine"></a>
<label for=nav_toggle_cb id=nav_toggle_btn><img src=/assets/icons/hamburger.svg width=24 height=24 alt="Main menu"></label></div><nav id=nav><ul class=left><li><a href=/features>Features</a><li class=only-on-mobile><a href=/showcase>Showcase</a><li><a href=/blog>Blog</a><li><a href=/community>Community</a><li><a href=/contact>About</a><li><a href=https://godotengine.org/asset-library/asset>Assets</a></ul><ul class=right><li><a href=/download/windows class=set-os-download-url>Download</a><li><a href=https://docs.godotengine.org>Learn</a><li><a href=https://docs.godotengine.org/en/stable/community/contributing/index.html>Contribute</a><li class=fund><a href=https://fund.godotengine.org>❤&#xFE0E; Donate</a></ul></nav></div></header><main><style>body{background-color:var(--background-color)}h1{margin-bottom:8px;margin-top:32px}:not(pre)>code{background:var(--code-background-color);padding:1px 4px;font-size:.95em;border-radius:3px}pre{background:var(--codeblock-background-color);color:var(--codeblock-color)}pre code{display:block;overflow-x:auto;padding:.5em}.date-big{line-height:2;margin-left:32px}article{background-color:var(--base-color);box-shadow:0 3px 2px rgba(0,0,0,.15)}figure{margin:0}figure img{margin:0}article img,article video{max-width:100%;height:auto;display:block;margin:auto;margin-top:16px;margin-bottom:16px}article h1{margin-top:64px}article h2,article h3,article h4{margin-top:42px}.article-info{display:flex;flex-direction:column;gap:8px}.article-metadata{display:flex;gap:24px;align-items:center;font-family:var(--header-font-family);margin-bottom:12px}@media(max-width:900px){.article-metadata{flex-direction:column;align-items:flex-start;gap:16px}}.article-author{color:var(--base-color-text-subtitle-date);font-weight:700;font-size:18px;flex-grow:1;display:flex;gap:12px;align-items:center}.article-author .avatar{border-radius:100%;margin:0}.article-author .by{color:var(--base-color-text-subtitle)}.article-metadata .date{color:var(--base-color-text-subtitle-date)}.article-metadata .date.post-recent-highlight{color:var(--post-recent-highlight-color);opacity:.8}.article-metadata .date.post-recent-highlight::after{font-size:80%;content:"NEW";border:2px solid var(--post-recent-highlight-color);padding:2px 3px;margin-left:8px}.tag.active{filter:saturate(.75)}@media screen and (min-width:900px){article .content{width:70%;margin:auto}}@media(max-width:900px){body{background-color:var(--base-color)}article{background-color:initial;box-shadow:none}article img:first-child,article video:first-child{max-width:100%}}</style><link rel=stylesheet href=/assets/css/highlight.obsidian.min.css><div class=container><article class=padded><div class="content article-container"><figure class=article-cover><img src=/storage/app/uploads/public/5db/87c/7eb/5db87c7eb83ec156927495.png title alt=" " class=rounded-lg style=width:100%;height:auto;background-color:initial></figure><div class=article-info><h1>DTLS progress report #1</h1><div class=article-metadata><div class=article-author><span>By:</span>
<img class=avatar width=25 height=25 src=/assets/images/authors/faless.webp alt="Fabio Alessandrelli" loading=lazy>
<span class=by>Fabio Alessandrelli</span></div><span class=date data-post-date="2019-10-29 17:30:00 +0000">29 October 2019</span></div><div class=tags><a href=/blog/progress-report><div class="tag active">Progress Report</div></a></div></div><div class="card card-warning"><p>This article is from <strong>October 2019</strong>, some of its contents might be outdated and no longer accurate.<br>You can find up-to-date information about the engine in the <a href=https://docs.godotengine.org/en/stable/>official documentation</a>.</div><div class=article-body><p>Hello Godotters, as part of my August work (sponsored, as always, <a href=https://godotengine.org/article/godot-engine-awarded-50000-mozilla-open-source-support-program>by Mozilla</a>) I’ve been working on integrating DTLS in Godot.
Sadly, the work is not yet finished (although usable), and since it requires some API changes in <code class="language-plaintext highlighter-rouge">PacketPeerUDP</code> to make it performs well (avoiding extra buffering) it will be pushed to the <code class="language-plaintext highlighter-rouge">4.0</code> release.
But what is DTLS? Why is it important to have? And how will users benefit from it?<h1 id=dtls>DTLS</h1><p>DTLS stands for Datagram Transport Layer Security, you can think of it as TLS/SSL but for UDP packets.
This is very important, because it allows you to use transparent encryption in real-time applications (like fast-paced multiplayer games).<p>It prevents abusers from being able to disrupt your match by claiming to be some other players (which is not easy to do, and not always possible, but is something that needs to be considered when using UDP, and thus the <code class="language-plaintext highlighter-rouge">NetworkedMultiplayerENet</code> class).<p>It also allows you to validate that the user connects to the right server when you use a client/server architecture and thus prevent man-in-the-middle attacks (someone faking to be the server, that replay all the data to the real server, but can read/change everything you send).<h1 id=dtls-in-godot>DTLS in Godot</h1><p>This first part of the work adds three new classes:<ul><li><code class="language-plaintext highlighter-rouge">UDPServer</code>: Yep, you got it right, a “server” for UDP. It’s quite different from a <code class="language-plaintext highlighter-rouge">TCPServer</code>, keep reading for more.<li><code class="language-plaintext highlighter-rouge">DTLSServer</code>: This is a class used to keep the state for DTLS, specifically its cookies (again, keep reading for more).<li><code class="language-plaintext highlighter-rouge">PacketPeerDTLS</code>: The actual DTLS connection peer, that can be used as a regular packet peer (and will in the future be used by <code class="language-plaintext highlighter-rouge">NetworkedMultiplayerENet</code> to provide transparent encryption for the high level multiplayer).</ul><h2 id=udpserver>UDPServer</h2><p><img src=/storage/app/uploads/public/5db/874/2b0/5db8742b093d7752570350.png alt=dtls_udpserver.png><p><code class="language-plaintext highlighter-rouge">UDPServer</code> can listen to a specific port/address and accept “connections” as soon as they arrive.
This can be achieved thanks to the fact that UDP can be, in a way, “connected” to a specific address.
It’s not a connection like a TCP one (where you can potentially know if the other peer exists), this is more like a filter, that tells the operating system to ignore all the packets that do not come from a specific address. Each packet received from a new peer will result in a new connection, from that moment on, all the packets coming from the same source will be received by the “connected” peer and not the server.
Simply call <code class="language-plaintext highlighter-rouge">take_connection()</code> when <code class="language-plaintext highlighter-rouge">is_connection_available()</code> is true to get the connected <code class="language-plaintext highlighter-rouge">PacketPeerUDP</code>.<h2 id=dtlsserver>DTLSServer</h2><p><img src=/storage/app/uploads/public/5db/874/3ca/5db8743ca7056849589724.png alt=dtls_dtlsserver.png><p>As mentioned, the <code class="language-plaintext highlighter-rouge">DTLSServer</code> class is used to store the DTLS state. DTLS must use a thing called cookies, to avoid amplification attacks.<p>In simple terms, for the way UDP works, anyone can send you UDP packets (without the need for a connection), and since one can fake its source (by spoofing, i.e. altering the source filed in the IP protocol), one can force a server to send the reply of the received packet to a different address than the original sender. This is very bad when a protocol has the reply message which is much bigger than the original packet, as this will allow a simple client with low bandwidth to amplify their bandwidth capabilities by exploiting the server.<p>Imagine this:<ul><li><code class="language-plaintext highlighter-rouge">A</code> has limited bandwidth of 1 Mb/s.<li><code class="language-plaintext highlighter-rouge">A</code> sends a spoofed packet (masquerading as <code class="language-plaintext highlighter-rouge">B</code>) to the server <code class="language-plaintext highlighter-rouge">Z</code> (which has a bandwidth of 100Mb/s).<li>The server <code class="language-plaintext highlighter-rouge">Z</code> sends the reply to <code class="language-plaintext highlighter-rouge">B</code>, but the reply is much bigger (e.g. 10 times bigger) than the data sent by <code class="language-plaintext highlighter-rouge">A</code>.<li>Thus <code class="language-plaintext highlighter-rouge">A</code> can, with its 1 Mb/s, force server <code class="language-plaintext highlighter-rouge">Z</code> to flood <code class="language-plaintext highlighter-rouge">B</code> of packets with a 10 Mb/s bandwidth (1 Mb/s from <code class="language-plaintext highlighter-rouge">A</code> times 10 for the reply size).</ul><p>To avoid this, DTLS uses cookies. When the client sends data for the first time to the server, the server will reply with a smaller packet that assigns it a cookie (e.g. a random number) and stores the cookie/client association in a state.<p>Only when the clients sends their requests with the received cookie, will the server start to send bigger packets.<p>This way, when <code class="language-plaintext highlighter-rouge">A</code> sends the spoofed packet, it will not receive the cookie (which <code class="language-plaintext highlighter-rouge">B</code> will receive instead) and will not be able to amplify its bandwidth exploiting <code class="language-plaintext highlighter-rouge">Z</code> (since the cookie packet is smaller than the packet sent by <code class="language-plaintext highlighter-rouge">A</code>).<p>If this seems a bit confusing, it’s because it’s actually a pretty twisted kind of attack. But you don’t have to worry about it, because the <code class="language-plaintext highlighter-rouge">DTLSServer</code> class does the job for you :)<p>This class has 2 interesting methods: <code class="language-plaintext highlighter-rouge">setup</code>, to generate the state (and where you set the RSA key and certificate), and <code class="language-plaintext highlighter-rouge">take_connection</code> that accepts a connected PacketPeerUDP (from <code class="language-plaintext highlighter-rouge">UDPServer</code>) and will return a <code class="language-plaintext highlighter-rouge">PacketPeerDTLS</code> in the “connecting” state when the cookie is correct, or in the “error” state when the cookie is missing or not known.<h2 id=packetpeerdlts>PacketPeerDLTS</h2><p><img src=/storage/app/uploads/public/5db/874/4be/5db8744be52f4536086078.png alt=dtls_packetpeerdtls.png><p><code class="language-plaintext highlighter-rouge">PacketPeerDTLS</code> is the core class of the whole DTLS implementation in Godot, the one that provides access to the actual data transfer functionalities.<p>There are two ways of getting a working <code class="language-plaintext highlighter-rouge">PacketPeerDLTS</code>:<ol><li>Use <code class="language-plaintext highlighter-rouge">DTLSServer</code> as explained above.<li>Call <code class="language-plaintext highlighter-rouge">connect_to_host</code> on a <code class="language-plaintext highlighter-rouge">PacketPeerUDP</code> and then pass it to the <code class="language-plaintext highlighter-rouge">PacketPeerDTLS.connect_to_peer</code>.</ol><p>Remember to call <code class="language-plaintext highlighter-rouge">PacketPeerDTLS.poll</code> frequently, and at some point it will reach the “connected” state. At that point, you can start transfer data and it will be automatically encrypted.<h2 id=consideration-further-work>Consideration, further work</h2><p>First of all, I’m sorry it took me so long to publish this report. It has been a crazy few months between the upcoming <code class="language-plaintext highlighter-rouge">3.2</code> release, the Godot Sprint, GodotCon, and the nerd flu that got us there.<p>I had stopped working on this feature to focus on improvements and fixes for <code class="language-plaintext highlighter-rouge">3.2</code> but I will get on it again in the coming month (November) working on the integration with <code class="language-plaintext highlighter-rouge">NetworkedMultiplayerENet</code> so that the high level multiplayer can benefit from this technology.<p>Stay tuned for more on DTLS, and for the report on September/October work (some merged already, some still in the process of being merged).<p>I will try to speed up my reporting capabilities ;-)<h2 id=references>References</h2><p><a href=https://github.com/godotengine/godot/tree/dtls_report1>DTLS work done so far</a><p><a href=https://github.com/Faless/gd-udp-dtls-example>Small project to demo/test the work done so far</a><p><a href=https://en.wikipedia.org/wiki/Denial-of-service_attack#Amplification>Wiki on amplification attacks</a></div></div></article></div><link rel=stylesheet href=/assets/css/anchor-link.css?1><link rel=stylesheet href=/assets/css/article-cards.css?2><script src=/assets/js/anchor-link.js></script>
<script>document.addEventListener('DOMContentLoaded',()=>{window.applyAnchorLinks('.article-body'),document.querySelectorAll('.article-cover img, .article-body img').forEach(b=>{if(b.classList.contains('lightbox-ignore'))return;const a=document.createElement('a');a.href=b.src,a.classList.add('lightbox'),a.dataset.group='article',b.parentNode.appendChild(a),a.appendChild(b)})})</script></main><footer><div class="container flex footer-container"><div id=copyright><p>© 2007-2024 Juan Linietsky, Ariel Manzur and <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md target=_blank rel=noopener>contributors</a>.<br>Hosted by the <a href=https://godot.foundation/ target=_blank rel=noopener>Godot Foundation</a>.<br>Website <a href=https://github.com/godotengine/godot-website target=_blank rel=noopener>source code on GitHub</a>.</div><div id=sitemap><ul class=sitemap-group><li><strong>Get Godot</strong><li><a href=/download/windows class=set-os-download-url>Download</a><li><a href=https://editor.godotengine.org/releases/latest/>Web Editor</a><li>&nbsp;<li><strong>Public Relations</strong><li><a href=/blog>Blog</a><li><a href=/community>Communities and Events</a><li><a href=/press>Press Kit</a></ul><ul class=sitemap-group><li><strong>About Godot</strong><li><a href=/features>Features</a><li><a href=/showcase>Showcase</a><li><a href=/education>Education</a><li><a href=/license>License</a><li><a href=/code-of-conduct>Code of Conduct</a><li><a href=/privacy-policy>Privacy Policy</a><li><a href=https://fund.godotengine.org>Donate</a></ul><ul class=sitemap-group><li><strong>Project Team</strong><li><a href=/governance>Governance</a><li><a href=/teams>Teams</a><li>&nbsp;<li><strong>Extra Resources</strong><li><a href=/asset-library/asset>Asset Library</a><li><a href=https://docs.godotengine.org>Documentation</a><li><a href=https://github.com/godotengine>Code Repository</a></ul></div><div id=social class=dark-desaturate><h4 class=text-right><a href=/contact>Contact us</a></h4><div class="flex justify-space-between" style=gap:3px><a href=https://github.com/godotengine target=_blank rel=noopener><img src=/assets/footer/github_logo.svg width=32 height=32 alt=GitHub></a>
<a href=https://mastodon.gamedev.place/@godotengine target=_blank rel=noopener><img src=/assets/footer/mastodon_logo.svg width=32 height=32 alt=Mastodon></a>
<a href=https://twitter.com/godotengine target=_blank rel=noopener><img src=/assets/footer/twitter_logo.svg width=32 height=32 alt=Twitter></a>
<a href=https://www.facebook.com/groups/godotengine/ target=_blank rel=noopener><img src=/assets/footer/facebook_logo.svg width=32 height=32 alt=Facebook></a>
<a href=https://www.reddit.com/r/godot target=_blank rel=noopener><img src=/assets/footer/reddit_logo.svg width=32 height=32 alt=Red​dit></a>
<a href=/rss.xml target=_blank rel=noopener><img src=/assets/footer/feed_logo.svg width=32 height=32 alt="RSS feed"></a></div></div></div></footer><script defer src=/assets/js/tobii.min.js></script>
<script defer src=/assets/js/highlight.min.js?1></script>
<script defer src=/assets/js/highlight.gdscript.min.js?1></script>
<script>document.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('pre code').forEach(a=>{hljs.highlightBlock(a)}),document.querySelectorAll('[data-post-date]').forEach(a=>{Date.parse(a.dataset.postDate)>Date.now()-1e3*60*60*48&&a.classList.add("post-recent-highlight")}),new Tobii({zoom:!1});const a=document.querySelectorAll('.set-os-download-url');for(let b=0;b<a.length;b++){const c=a[b];let e='download';'version'in c.dataset&&c.dataset.version==='3'&&(e='download/3.x');let d='windows';navigator.platform.indexOf('Mac')!==-1?d='macos':navigator.platform.indexOf('Linux')!==-1&&(d='linux'),c.href=`/${e}/${d}`}})</script>