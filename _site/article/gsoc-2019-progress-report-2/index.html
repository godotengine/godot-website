<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Godot Engine"><meta name=description content="Godot takes part in the Google Summer of Code for the second year, and this time we have 8 students working on awesome features for the engine. With the programme coming close to an end, they each share their recent progress since the first report with a short devlog. A final report will be posted in coming weeks with an overview of the work done and how to get started using the features they worked on."><meta name=theme-color content="#3d8fcc"><meta property="og:site_name" content="Godot Engine"><meta property="og:url" content="https://godotengine.org/article/gsoc-2019-progress-report-2/"><meta name=twitter:site content="@godotengine"><meta property="og:title" content="GSoC 2019 progress report #2"><meta property="og:description" content="Godot takes part in the Google Summer of Code for the second year, and this time we have 8 students working on awesome features for the engine. With the programme coming close to an end, they each share their recent progress since the first report with a short devlog. A final report will be posted in coming weeks with an overview of the work done and how to get started using the features they worked on."><meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/5d5/d4e/904/5d5d4e9043f37492937462.png"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><title>GSoC 2019 progress report #2</title><link rel=alternate type=application/rss+xml title="Godot News" href=/rss.xml><link rel=icon href=/assets/favicon.png sizes=any><link rel=icon href=/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=/assets/css/main.css?111><link rel=stylesheet href=/assets/css/tobii.min.css><link rel=preload as=font href=/assets/fonts/Montserrat-Bold.woff2 crossorigin><link rel=preload as=font href=/assets/fonts/Montserrat-ExtraBold.woff2 crossorigin><link rel=me href=https://mastodon.gamedev.place/@godotengine><input type=checkbox id=nav_toggle_cb><header><div class="container flex align-center"><div id=nav_head><a href=/ id=logo-link><img class=nav-logo src=/assets/logo.svg width=136 height=48 alt="Godot Engine">
<img class="nav-logo dark-logo" src=/assets/logo_dark.svg width=136 height=48 alt="Godot Engine"></a>
<label for=nav_toggle_cb id=nav_toggle_btn><img src=/assets/icons/hamburger.svg width=24 height=24 alt="Main menu"></label></div><nav id=nav><ul class=left><li><a href=/features>Features</a><li class=only-on-mobile><a href=/showcase>Showcase</a><li><a href=/blog>Blog</a><li><a href=/community>Community</a><li><a href=/contact>About</a><li><a href=https://godotengine.org/asset-library/asset>Assets</a></ul><ul class=right><li><a href=/download/windows class=set-os-download-url>Download</a><li><a href=https://docs.godotengine.org>Learn</a><li><a href=https://docs.godotengine.org/en/stable/community/contributing/index.html>Contribute</a><li class=fund><a href=https://fund.godotengine.org>❤&#xFE0E; Donate</a></ul></nav></div></header><main><style>body{background-color:var(--background-color)}h1{margin-bottom:8px;margin-top:32px}:not(pre)>code{background:var(--code-background-color);padding:1px 4px;font-size:.95em;border-radius:3px}pre{background:var(--codeblock-background-color);color:var(--codeblock-color)}pre code{display:block;overflow-x:auto;padding:.5em}.date-big{line-height:2;margin-left:32px}article{background-color:var(--base-color);box-shadow:0 3px 2px rgba(0,0,0,.15)}figure{margin:0}figure img{margin:0}article img,article video{max-width:100%;height:auto;display:block;margin:auto;margin-top:16px;margin-bottom:16px}article h1{margin-top:64px}article h2,article h3,article h4{margin-top:42px}.article-info{display:flex;flex-direction:column;gap:8px}.article-metadata{display:flex;gap:24px;align-items:center;font-family:var(--header-font-family);margin-bottom:12px}@media(max-width:900px){.article-metadata{flex-direction:column;align-items:flex-start;gap:16px}}.article-author{color:var(--base-color-text-subtitle-date);font-weight:700;font-size:18px;flex-grow:1;display:flex;gap:12px;align-items:center}.article-author .avatar{border-radius:100%;margin:0}.article-author .by{color:var(--base-color-text-subtitle)}.article-metadata .date{color:var(--base-color-text-subtitle-date)}.article-metadata .date.post-recent-highlight{color:var(--post-recent-highlight-color);opacity:.8}.article-metadata .date.post-recent-highlight::after{font-size:80%;content:"NEW";border:2px solid var(--post-recent-highlight-color);padding:2px 3px;margin-left:8px}.tag.active{filter:saturate(.75)}@media screen and (min-width:900px){article .content{width:70%;margin:auto}}@media(max-width:900px){body{background-color:var(--base-color)}article{background-color:initial;box-shadow:none}article img:first-child,article video:first-child{max-width:100%}}</style><link rel=stylesheet href=/assets/css/highlight.obsidian.min.css><div class=container><article class=padded><div class="content article-container"><figure class=article-cover><img src=/storage/app/uploads/public/5d5/d4e/904/5d5d4e9043f37492937462.png title alt=" " class=rounded-lg style=width:100%;height:auto;background-color:initial></figure><div class=article-info><h1>GSoC 2019 progress report #2</h1><div class=article-metadata><div class=article-author><span>By:</span>
<img class=avatar width=25 height=25 src=/assets/images/authors/akien.webp alt="Rémi Verschelde" loading=lazy>
<span class=by>Rémi Verschelde</span></div><span class=date data-post-date="2019-08-21 14:01:20 +0000">21 August 2019</span></div><div class=tags><a href=/blog/progress-report><div class="tag active">Progress Report</div></a></div></div><div class="card card-warning"><p>This article is from <strong>August 2019</strong>, some of its contents might be outdated and no longer accurate.<br>You can find up-to-date information about the engine in the <a href=https://docs.godotengine.org/en/stable/>official documentation</a>.</div><div class=article-body><p><a href=https://godotengine.org/article/godot-google-summer-code-2019>As announced previously</a>, Godot is participating for the second time in the <a href=https://summerofcode.withgoogle.com>Google Summer of Code</a> (GSoC) programme, which lets students from all over the world work for three months on specific projects thanks to a Google stipend.<p>The GSoC coding period is close to the finish line, and our 8 students are hard at work to finalize their projects as best as they can, while writing their final evaluation report. Yet, I’ve asked them for a quick update on what they’ve been working on over the past few weeks since the first progress report (read <a href=/article/gsoc-2019-progress-report-1-part-1>part 1</a> and <a href=/article/gsoc-2019-progress-report-1-part-2>part 2</a>).<p>This second progress report is shorter so we can fit everything in one article. At the end of GSoC, we’ll have a final progress report where each student will outline how to get started using their project, and share their impressions of the experience as a whole.<p>Here is the list of projects and students with links to the relevant sections.<ul><li><a href=#lightmapper>Rewriting Godot’s Light Mapper</a> by Joan Fons Sanchez<li><a href=#static-analyzer>Static Analyzer for GDScript</a> by Suhas Prasanna<li><a href=#visual-scripting>Improvements to the Visual Scripting System</a> by Swarnim Arun<li><a href=#async-file-access>Asynchronous Cached File Access</a> by Raghav Shankar<li><a href=#gdscript-lsp>GDScript Language Server</a> by Ankit Priyarup<li><a href=#interactive-music>Interactive Music</a> by Daniel Matarov<li><a href=#motion-matching>Motion Matching Implementation Using KD Trees</a> by Aditya Abhiram<li><a href=#vcs-integration>Version Control Systems Integration</a> by Twarit Waikar</ul><hr><p><a id=lightmapper></a><h2 id=rewriting-godots-light-mapper--joan-fons-sanchez>Rewriting Godot’s Light Mapper – <em>Joan Fons Sanchez</em></h2><ul><li><strong>Project:</strong> Rewriting Godot’s Light Mapper<li><strong>Student:</strong> Joan Fons Sanchez (<a href=https://github.com/JFonS>JFonS</a>)<li><strong>Mentors:</strong> Juan Linietsky (<a href=https://github.com/reduz>reduz</a>) and Bastiaan Olij (<a href=https://github.com/BastiaanOlij>BastiaanOlij</a>)<li><strong>Repository:</strong> https://github.com/JFonS/godot/tree/lightmapper</ul><h3 id=current-progress>Current progress</h3><p>A lot has happened since the last progress report. I finished integrating <a href=https://www.embree.org>Embree</a> into the engine’s build system and also added a simple ray tracing API that allows for defining a set of meshes and perform ray intersection tests among them.
This API currently uses Embree as a backend, but should allow adding a different backend (GPU-based maybe?) if we ever decide to go down that route.<p>With that new tool, adding occlusion for direct lighting was relatively straightforward:<p><img src=/storage/app/media/gsoc/2019-2/lightmap-001.png alt="Sponza scene without and with occlusion for direct lighting">
<em>Top: direct light without occlusion. Bottom: direct light with occlusion testing.</em><p>Completing that last step meant that we had some really valuable information: which parts of the scene were receiving direct illumination from lights and which parts were in the shadow. But this information alone is not enough, light bounces on objects and tends to fill every possible corner of a scene, with varying intensity, of course. So it was time to add indirect lighting to the mix. Using the new ray tracing API we can randomly throw rays from each surface position and, depending on the surface they hit, get the average amount of light reaching that spot.
Here we can see the difference between having only direct lighting and having direct and indirect lighting combined:<p><img src=/storage/app/media/gsoc/2019-2/lightmap-002.png alt="Sponza scene without and with indirect lighting">
<em>Top: no indirect lighting. Bottom: 2 bounces of indirect light.</em><p>Finally, I can show the current light mapper results in the Sponza demo:<p><img src=/storage/app/media/gsoc/2019-2/lightmap-003.png alt="Sponza scene with both direct and indirect lighting"><p>This image uses real-time direct lighting (regular Godot light nodes) and a light map for the indirect light bounces.<h3 id=next-steps>Next steps</h3><p>The basic structure of the new light mapper is quite settled, but there are still lots of things to work on before it can be merged into Godot. There are three aspects that need to be improved: performance, usability and results quality.
The performance improvements will likely involve adding muti-threading support and some minor improvements here and there. In order to improve user experience, we will restore the previous progress bar display (it was lost during the rewrite). Finally, the light map results will be improved by applying some artifact reduction techniques and also an AI-based denoiser.<hr><p><a id=static-analyzer></a><h2 id=static-analyzer-for-gdscript--suhas-prasanna>Static Analyzer for GDScript – <em>Suhas Prasanna</em></h2><ul><li><strong>Project:</strong> Static Analyzer for GDScript<li><strong>Student:</strong> Suhas Prasanna (<a href=https://github.com/psuhas77>psuhas77</a>)<li><strong>Mentors:</strong> George Marques (<a href=https://github.com/vnen>vnen</a>) and Bojidar Marinov (<a href=https://github.com/bojidar-bg>bojidar-bg</a>)<li><strong>Repository:</strong> https://github.com/psuhas77/godot/tree/gsoc</ul><p>Since the first progress report, I’ve been able to complete the script traversal system and have started working on implementing static checks.
Static checks that are fully finished:<ul><li>Script inherits the Object type that it is attached to.</ul><p>Static checks that work for general use cases:<ul><li>Node referenced in a <code class="language-plaintext highlighter-rouge">get_node()</code> call exists.<li>Function connected to a signal has arguments of correct arity (working on extending this to the type of arguments as well).</ul><p>It’s been a blast working on this project so far. Hopefully by this last week or so, I can implement as many of these static checks as possible.<hr><p><a id=visual-scripting></a><h2 id=improvements-to-the-visual-scripting-system--swarnim-arun>Improvements to the Visual Scripting System – <em>Swarnim Arun</em></h2><ul><li><strong>Project:</strong> Improvements To Visual Scripting System<li><strong>Student:</strong> Swarnim Arun (<a href=https://github.com/swarnimarun>swarnimarun</a>)<li><strong>Mentors:</strong> Ernest Lee (<a href=https://github.com/fire>fire</a>) and Anish Bhobe (<a href=https://github.com/KidRigger>KidRigger</a>)<li><strong>Repositories:</strong><ul><li>https://github.com/swarnimarun/godot/tree/vs-graph-unification and other branches with <code class="language-plaintext highlighter-rouge">vs</code> prefix<li>PRs on upstream repository: <a href=https://github.com/godotengine/godot/pull/29681>PR-29681</a>, <a href=https://github.com/godotengine/godot/pull/30852>PR-30852</a>, <a href=https://github.com/godotengine/godot/pull/31044>PR-31044</a></ul></ul><h3 id=current-progress-1>Current progress</h3><p>It has been a couple of months since I started this project and one since the last update.
This month I worked on features for further refining the Visual Scripting interface to make it more usable while also fixing some old misgivings,
that have been there with the Visual Scripting system.<p>Some of the changes are:<ul><li>Making the search more reliable overall.<li>Improving the usability of dialogs.<li>Use the top bar instead of filling up the left panel.<li>Adding dialog to add functions.<li>Working on the <code class="language-plaintext highlighter-rouge">tool</code> script feature.<li>Adding a Construct / Instance node.<li>Overall fixes for things in Visual Script.</ul><p>The search system is a little more forgiving in terms of allowing for incomplete word matching.<p>The dialogs are made smaller to allow for greater control over them. And make them less intrusive.<p>Using top bar to free up space in the left panel to allow for better use on smaller screens.<p>Adding functions quickly was quite a bit of pain, to help with this we now have a dedicated dialog to add functions.<p>Supporting <code class="language-plaintext highlighter-rouge">tool</code> scripts was an old feature request for the Visual Script and it a bother not have it working until now. This has been now fixed.<p>Construct / Instance is added to allow to create new Objects or Resources of any type which was impossible to do before in Visual Script. This feature is still a work in progress.<p>Other fixes for the Visual Script included minor bugs such as empty NodePath initialization issue when not having a currently active scene, fixing bugs in my current PRs, etc.<p><img src=/storage/app/media/gsoc/2019-2/vs-001.png alt="New Create Function dialog"><p><img src=/storage/app/media/gsoc/2019-2/vs-002.png alt="Improved top bar with new options"><h3 id=whats-next>What’s next?</h3><p>To fix some other long-standing issues with Visual Script, get the current PRs merged or at least most of them.
Also work on the documentation.<hr><p><a id=async-file-access></a><h2 id=asynchronous-cached-file-access--raghav-shankar>Asynchronous Cached File Access – <em>Raghav Shankar</em></h2><ul><li><strong>Project:</strong> Asynchronous Cached File Access<li><strong>Student:</strong> Raghav Shankar (<a href=https://gist.github.com/WarpspeedSCP>WarpspeedSCP</a>)<li><strong>Mentors:</strong> Ariel Manzur (<a href=https://github.com/punto->punto-</a>) and HP van Braam (<a href=https://github.com/hpvb>hpvb</a>)<li><strong>Repository:</strong> https://github.com/WarpspeedSCP/godot/tree/wip-patch</ul><h3 id=current-progress-2>Current progress</h3><p>Since the last update, I’ve fixed a lot of bugs and made a bunch of simplifications to the design of the cache module.<ul><li>Lots of bug fixes.<li>Reduced the use of synchronisation primitives. Greatly reduces the complexity.<li>It’s possible to write to files as well now.</ul><p>I’ve ended up straying from the schedule I set for myself in May in that I haven’t finished implementing all the unbuffered file IO classes I had planned to, but they aren’t strictly necessary for the module to function.<p>I would like to make things nicer by using some of the C++11 features when the engine moves to it for Godot 4.0, but until then, I’ll continue improving things as they currently are.<hr><p><a id=gdscript-lsp></a><h2 id=gdscript-language-server--ankit-priyarup>GDScript Language Server – <em>Ankit Priyarup</em></h2><ul><li><strong>Project:</strong> GDScript Language Server<li><strong>Student:</strong> Ankit Priyarup (<a href=https://github.com/ankitpriyarup>ankitpriyarup</a>)<li><strong>Mentors:</strong> <a href=https://github.com/Geequlim>Geequlim</a> and Lu Jiacheng (<a href=https://github.com/jason0214>Jason0214</a>)<li><strong>Repositories:</strong><ul><li>Student server working branch: https://github.com/ankitpriyarup/godot/tree/update-lsp<li>Mentor server working branch: https://github.com/GodotExplorer/godot/tree/gdscript-lsp<li>Student client working branch: https://github.com/ankitpriyarup/godot-tools/tree/updated-lsp-client<li>Mentor client working branch: https://github.com/GodotExplorer/godot-tools/tree/lsp-client</ul></ul><h3 id=current-progress-3>Current progress</h3><p>Since my first report on the GDScript Language Server, there have been a handful of improvements mostly in the Markdown documentation system.<ul><li>Better doc item indexing which parses the entire class structure and stores it in an <code class="language-plaintext highlighter-rouge">index.json</code> file within the Markdown documentation directory for faster lookups.<li>Hyperlink support in Markdown docs so that by clicking on any link (class or method name) within the doc it will directly open that class or method.<li>Visual improvements in the Markdown doc such as better spacing, indentation & paragraph shifts. Support for bold, italic and underline.<li>Autocompletion for some methods also had an issue with its insert text bracket placement which has been now resolved.<li>Rename symbol feature from before had a huge drawback i.e. it is incapable of renaming symbols found within different classes searching and replacing it won’t be an efficient solution. GDScript is a dynamic typed language so it is hard to track references for symbols. So it’s better to not implement this feature as it may cause bugs randomly. I suggest you use search and replace to do this kind of operations manually to avoid errors.</ul><p>We are currently testing the framework on larger open source GDScript projects. Bugs are regularly being tracked at <a href=https://github.com/ankitpriyarup/godot/issues>ankitpriyarup/godot</a>. Any feedback and issues are welcomed, please feel free to put it on the GitHub issues.<h3 id=coming-up-next>Coming up next</h3><p>Our major task for now is fixing bugs within the current implementation and merging them with Godot’s <em>master</em> branch. Later on we are also planning to port it to more popular editors like Atom and Emacs.<hr><p><a id=interactive-music></a><h2 id=interactive-music--daniel-matarov>Interactive Music – <em>Daniel Matarov</em></h2><ul><li><strong>Project:</strong> Interactive Music for Godot Engine<li><strong>Student:</strong> Daniel Matarov (<a href=https://github.com/DanielMatarov>DanielMatarov</a>)<li><strong>Mentors:</strong> Juan Linietsky (<a href=https://github.com/reduz>reduz</a>)<li><strong>Repository:</strong> https://github.com/DanielMatarov/godot/tree/Interactive-Music/modules/InteractiveMusic</ul><h3 id=current-progress-4>Current progress</h3><p>For those who are not familiar with the project I suggest you check out <a href=/article/gsoc-2019-progress-report-1-part-1>last month’s blog post</a> so you are brought up to speed with what the project entails.<p>First I will begin with an update on how I’ve dealt with some of the issues I mentioned last time, specifically the memory leak crash in <code class="language-plaintext highlighter-rouge">AudioStreamPlaylist</code>, which was causing the preview generator to generate an endless preview.
Thanks to last month’s blog post I got in contact with a game developer who was interested in the feature and we started having a back and forth conversation about the project. I sent him the most current build and after he tested it I got a question about why playlist is looping indefinitely and I realised that it’s not actually meant to do that. After looking at the code, I noticed that the line which updates the current stream did not have a safety check:<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>current = (current + 1) % playlist-&gt;stream_count;
</code></pre></div></div><p>I have now changed this and also added looping and shuffle functionalities and now it looks like this:<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>if ((current+1) &lt; playlist-&gt;stream_count) {
    current = (current + 1) % playlist-&gt;stream_count;
    playback[current]-&gt;start();
} else {
    if (playlist-&gt;loop == true) {
        current = 0;
        if (playlist-&gt;shuffle == true) {
            for (int i; i &lt; playlist-&gt;stream_count; i++) {
                std::swap(playback[i], playback[std::rand() % playlist-&gt;stream_count]);
            }
        }
    } else {
        stop();
    }
}
</code></pre></div></div><p>Apart from fixing this, I have also been implementing <code class="language-plaintext highlighter-rouge">AudioStreamTransitioner</code>. My implementation however is slightly different from what I described last month. Initially I intended to have transitions and clips tied together, however after discussions with my mentor I decided it would be best if they are separate. The way it works now is the following:<ol><li>The user selects the active clip .<li>The user activates the transition they want to use.</ol><p>I managed to fit everything into the inspector and this is what it currently looks like:<p><img src=/storage/app/media/gsoc/2019-2/interactive-music-001.png alt="Empty AudioStreamTransitioner"><p><img src=/storage/app/media/gsoc/2019-2/interactive-music-002.png alt="AudioStreamTransitioner populated with some clips"><p>Transitioner has a default BPM which is used when a clip doesn’t have an imported tempo. The BPM is used when the fading happens, which is based on beats — when a transition is active it fades based on the clips’ BPM — the clip which fades out fades based on it’s own BPM, and the same is for the clip which fades in. That allows the user to have clips with different tempos. Also, unless a transition is activated, a clip will loop indefinitely.
Another feature which I recently added was a transition clip, meaning that when this property is active, a clip set by the user will play in between the clips when transitions are activated.<p>Here is a video of the transitioner in action, showcasing most of its features. The clips which I’m playing are not specifically made for the purpose of this video but it still gives a decent idea of how the feature works:</p><video controls>
<source src=/storage/app/media/gsoc/2019-2/interactive-music-transitioner-demo.mp4 type=video/mp4></video><h3 id=whats-left-to-do>What’s left to do</h3><p>In the next couple of weeks until the deadline I will try to smooth out some of the fades and BPM functionalities in the transitioner, such as potentially having the fades only start on exact beats rather than as soon as a transition is activated, which makes more sense. I will also fix some of the clicks that happen during the fades.<p>Some other things to fix is to figure out why <code class="language-plaintext highlighter-rouge">.ogg</code> files seem to not be importing beat information properly.
Another thing to do is to add documentation for the two classes with brief explanations for the GDScript functions, since most of the in-game implementation will happen through script. And lastly, I would like to potentially make a video tutorial explaining how to use the feature.<p>Apart from this the feature is mostly complete and I am quite happy with the results. If anyone is interested in getting a current build of it, email me at <em>daniel.matarov at gmail · com</em> and I would love to hear your feedback!<hr><p><a id=motion-matching></a><h2 id=motion-matching-implementation-using-kd-trees--aditya-abhiram>Motion Matching Implementation Using KD Trees – <em>Aditya Abhiram</em></h2><ul><li><strong>Project:</strong> Motion Matching Implementation Using KD Trees<li><strong>Student:</strong> Aditya Abhiram (<a href=https://github.com/Aa20475>Aa20475</a>)<li><strong>Mentors:</strong> Juan Linietsky (<a href=https://github.com/reduz>reduz</a>) and <a href=https://github.com/karroffel>karroffel</a><li><strong>Repository:</strong> https://github.com/Aa20475/godot/tree/godot-motion-matching</ul><p>So the final week is here! Some small but crucial things left.
I am currently working to my fullest to complete as much as possible!<h3 id=whats-done>What’s done</h3><ul><li>Basic Motion Matching is working with Pose and Trajectory matching.<li>Exposed controllable variables to user.<li>UI is close to fully done.</ul><h3 id=whats-left>What’s left</h3><ul><li>Adding velocity matching.<li>Replacing Brute force with KDTree for trajectory.<li>Blending between chosen frames.<li>Perfecting prediction mechanism.</ul><h3 id=current-state-of-animationnodemotionmatch>Current state of <code class="language-plaintext highlighter-rouge">AnimationNodeMotionMatch</code></h3><p><img src=/storage/app/media/gsoc/2019-2/motion-matching-001.gif alt="GIF demo of AnimationNodeMotionMatch"><hr><p><a id=vcs-integration></a><h2 id=version-control-systems-integration--twarit-waikar>Version Control Systems Integration – <em>Twarit Waikar</em></h2><ul><li><strong>Project:</strong> Version Control Systems (VCS) editor integration framework and Git plugin<li><strong>Student:</strong> Twarit Waikar (<a href=https://github.com/IronicallySerious>IronicallySerious</a>)<li><strong>Mentors:</strong> Gilles Roudiere (<a href=https://github.com/groud>groud</a>) and Jairo Honorio (<a href=https://github.com/jahd2602>jahd2602</a>)<li><strong>Repositories:</strong><ul><li>Godot’s framework for VCS integration (PR candidate): https://github.com/IronicallySerious/godot/tree/add-vcs-integration<li>Git interaction API plugin: https://github.com/IronicallySerious/godot-git-plugin</ul></ul><h3 id=re-cap-from-progress-report-1>Re-cap from progress report #1</h3><p>The version control systems integration proposes to add a new UI to the editor which lets the user commit, stage, and view file differences from the last version and the current state of the file, in a presentable manner which helps improve the workflow of the user using the editor in terms of managing versions of the source code.<p>The integration mainly required 3 distinct verticals:<ol><li>A version control themed editor plugin to place all the UI elements required.<li>An interface/API for the Godot editor to extract all VCS metadata from.<li>An implementation of the VCS interface for any of the popular VCSs in use.</ol><p>Out of these, only the first and the second verticals are planned to be merged into Godot’s <em>master</em> branch and the third vertical will be kept in a separate repository. The third vertical is a GDNative plugin (referred to as ‘addon’ further) that implements the VCS interface for interacting with Git.<p>Keeping the implementation separated from the interface helps us to create different behaviours of the VCS interface depending on what VCS is at use in the project. I have worked on the Git implementation as a part of GSoC 2019 and for any of the other VCSs, we are depending upon future work by fellow contributors.<h3 id=complications-faced-since-progress-report-1>Complications faced since progress report #1</h3><p>My mentors, Groud and jahd, and I realised the kind of architecture that we were hoping to accomplish was unsuitable for the kind of functionality that the existing engine API has. I have tried to summarise my entire research surrounding the topic of creating a GDNative addon that extends an API which is called to from within the editor, <a href=https://github.com/IronicallySerious/gsoc-godot-vcs-devlogs/blob/master/2019-8-2.md>in this devlog</a>.<p>You can also have a look at the <a href=https://github.com/IronicallySerious/gsoc-godot-vcs-devlogs/blob/master/2019-7-08.md>predecessor of the above-mentioned devlog</a> to know more about what different types of complications we faced while designing the architecture for this sort of an involvement between the editor and the GDNative addons.<h3 id=1-version-control-editor-plugin>1. Version control editor plugin</h3><p>This editor plugin is responsible for providing all VCS integration UI elements to the editor and hands the data extraction and error handling related to the VCS interface/API.<p>The entire VCS interaction is fired off by the <code class="language-plaintext highlighter-rouge">Set Up Version Control</code> dialog (same as previously reported but with an internal working change):<p><img src=/storage/app/media/gsoc/2019-2/vcs-001.png alt="Set Up Version Control dialog"><p>In the above screenshot, the name <code class="language-plaintext highlighter-rouge">GitAPI</code> is coming directly from the GDNative addon that implements the Git interaction. If you’d like to know how we managed to detect addons from the editor and use it to implement an API which is consumed by the editor, you can refer to the devlog links in the previous section. The solution came out to be rather simple but it required some extensive research from both my mentors and me since this use case of GDNative was rather an odd one. Anyway, we are happy to share the results that we have found.<p>When the Git addon is initialized, the addon also initializes a bare <code class="language-plaintext highlighter-rouge">.gitignore</code> file. All these behaviours are handled by the addon so the engine is not required to do any of the VCS specific tasks.<p>Currently, we can expect the Commit panel to look similar to what is shown below (not representative of the final version):<p><img src=/storage/app/media/gsoc/2019-2/vcs-002.png alt="Current state of the Commit panel"><p>You may notice in the panel above that the ‘Refresh’ button has recently been clicked and the ‘New’ section of the tree has been populated.<p><img src=/storage/app/media/gsoc/2019-2/vcs-003.png alt="Commit panel with expanded New tree"><p>Upon opening this tree, you shall see a list of all the new files that have been added to the Git repository. Since the demo project doesn’t come with a pre-initialised Git repository, all the files of the project are currently recognised as newly created files. The checkboxes shall be indicative of whether a file will be added to the stage or not. This is similar to selecting what input we need to provide the <code class="language-plaintext highlighter-rouge">git add</code> command.<p>The next major UI element that the Version Control Editor Plugin provides is the Version Control dock which will likely be placed among the bottom docks likewise:<p><img src=/storage/app/media/gsoc/2019-2/vcs-004.png alt="Version Control bottom dock"><p>The left side will be showing the version of the file in the previous commit, and the right side will be showing the newer changes for the file. The panel UI will remain, however, the logic which displays the difference contents is in works.<h3 id=2-editor-vcs-interface>2. Editor VCS interface</h3><p>As explained earlier, the engine editor is theoretically not allowed to even know the name of the version control system that is in use. This means that the editor needs to consult an API that extracts all such data from the GDNative based VCS addons available to the engine.<p>This interface is functionally complete. It currently defines all methods that the editor requires, which act as proxies to the methods defined in the GDNative addon. Thus, a function like <code class="language-plaintext highlighter-rouge">get_vcs_name()</code> would reply with a “Git” response, which has essentially originated from the GDNative addon.<p>The proxy architecture in play here has particularly helped us to create an API which does not require the implementation addon to implement the entire variety of methods defined in the API. The addon can accomplish far less and still provide enough data for the editor to correctly display the data extracted by the GDNative addon.<h3 id=3-gdnative-based-git-addon>3. GDNative-based Git addon</h3><p>We are using <a href=https://libgit2.org>libgit2</a>, which is a C library described by the libgit2 developers themselves at <a href=https://github.com/libgit2/libgit2>their Github project</a>:<blockquote><p>libgit2 is a portable, pure C implementation of the Git core methods provided as a linkable library with a solid API, allowing to build Git functionality into your application.</blockquote><p>Since it is a C implementation, we have successfully linked libgit2 to the GDNative C++ bindings along with our addon logic for extraction of Git metadata as well as repository data. The architecture being followed to call into libgit2 has been explained in the devlog that I mentioned in the previous section.<p>So far, with the help of libgit2 we have been able to replicate the functionality of Git commands like <code class="language-plaintext highlighter-rouge">git init</code>, <code class="language-plaintext highlighter-rouge">git commit</code>, <code class="language-plaintext highlighter-rouge">git add</code>, and <code class="language-plaintext highlighter-rouge">git diff</code> using libgit2 with the help of their extremely thorough <a href=https://libgit2.org/docs/guides/101-samples/>user guides</a>.<h3 id=closing-notes>Closing notes</h3><p>I am glad to be working on this project idea, and seeing it in its close-to-mature form as it is currently is a delight. I plan to finish the remaining bits in the next week and deliver some instructions to use this feature in the next report.<hr><p>That’s it for this second progress report from our 8 GSoC students.
We hope that you will find good use cases for all the features that are being worked on, and we thank all students and mentors for their dedicated work on these projects!</div></div></article></div><link rel=stylesheet href=/assets/css/anchor-link.css?1><link rel=stylesheet href=/assets/css/article-cards.css?2><script src=/assets/js/anchor-link.js></script>
<script>document.addEventListener('DOMContentLoaded',()=>{window.applyAnchorLinks('.article-body'),document.querySelectorAll('.article-cover img, .article-body img').forEach(b=>{if(b.classList.contains('lightbox-ignore'))return;const a=document.createElement('a');a.href=b.src,a.classList.add('lightbox'),a.dataset.group='article',b.parentNode.appendChild(a),a.appendChild(b)})})</script></main><footer><div class="container flex footer-container"><div id=copyright><p>© 2007-2024 Juan Linietsky, Ariel Manzur and <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md target=_blank rel=noopener>contributors</a>.<br>Hosted by the <a href=https://godot.foundation/ target=_blank rel=noopener>Godot Foundation</a>.<br>Website <a href=https://github.com/godotengine/godot-website target=_blank rel=noopener>source code on GitHub</a>.</div><div id=sitemap><ul class=sitemap-group><li><strong>Get Godot</strong><li><a href=/download/windows class=set-os-download-url>Download</a><li><a href=https://editor.godotengine.org/releases/latest/>Web Editor</a><li>&nbsp;<li><strong>Public Relations</strong><li><a href=/blog>Blog</a><li><a href=/community>Communities and Events</a><li><a href=/press>Press Kit</a></ul><ul class=sitemap-group><li><strong>About Godot</strong><li><a href=/features>Features</a><li><a href=/showcase>Showcase</a><li><a href=/education>Education</a><li><a href=/license>License</a><li><a href=/code-of-conduct>Code of Conduct</a><li><a href=/privacy-policy>Privacy Policy</a><li><a href=https://fund.godotengine.org>Donate</a></ul><ul class=sitemap-group><li><strong>Project Team</strong><li><a href=/governance>Governance</a><li><a href=/teams>Teams</a><li>&nbsp;<li><strong>Extra Resources</strong><li><a href=/asset-library/asset>Asset Library</a><li><a href=https://docs.godotengine.org>Documentation</a><li><a href=https://github.com/godotengine>Code Repository</a></ul></div><div id=social class=dark-desaturate><h4 class=text-right><a href=/contact>Contact us</a></h4><div class="flex justify-space-between" style=gap:3px><a href=https://github.com/godotengine target=_blank rel=noopener><img src=/assets/footer/github_logo.svg width=32 height=32 alt=GitHub></a>
<a href=https://mastodon.gamedev.place/@godotengine target=_blank rel=noopener><img src=/assets/footer/mastodon_logo.svg width=32 height=32 alt=Mastodon></a>
<a href=https://twitter.com/godotengine target=_blank rel=noopener><img src=/assets/footer/twitter_logo.svg width=32 height=32 alt=Twitter></a>
<a href=https://www.facebook.com/groups/godotengine/ target=_blank rel=noopener><img src=/assets/footer/facebook_logo.svg width=32 height=32 alt=Facebook></a>
<a href=https://www.reddit.com/r/godot target=_blank rel=noopener><img src=/assets/footer/reddit_logo.svg width=32 height=32 alt=Red​dit></a>
<a href=/rss.xml target=_blank rel=noopener><img src=/assets/footer/feed_logo.svg width=32 height=32 alt="RSS feed"></a></div></div></div></footer><script defer src=/assets/js/tobii.min.js></script>
<script defer src=/assets/js/highlight.min.js?1></script>
<script defer src=/assets/js/highlight.gdscript.min.js?1></script>
<script>document.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('pre code').forEach(a=>{hljs.highlightBlock(a)}),document.querySelectorAll('[data-post-date]').forEach(a=>{Date.parse(a.dataset.postDate)>Date.now()-1e3*60*60*48&&a.classList.add("post-recent-highlight")}),new Tobii({zoom:!1});const a=document.querySelectorAll('.set-os-download-url');for(let b=0;b<a.length;b++){const c=a[b];let e='download';'version'in c.dataset&&c.dataset.version==='3'&&(e='download/3.x');let d='windows';navigator.platform.indexOf('Mac')!==-1?d='macos':navigator.platform.indexOf('Linux')!==-1&&(d='linux'),c.href=`/${e}/${d}`}})</script>