<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Godot Engine"><meta name=description content="The turn of porting the GPU particle system to Godot 4.0 has arrived. This was the final feature that had to be ported over. Like all the rest of the features ported, it managed to get massive improvements."><meta name=theme-color content="#3d8fcc"><meta property="og:site_name" content="Godot Engine"><meta property="og:url" content="https://godotengine.org/article/improvements-gpuparticles-godot-40/"><meta name=twitter:site content="@godotengine"><meta property="og:title" content="New improvements for GPUParticles in Godot 4.0"><meta property="og:description" content="The turn of porting the GPU particle system to Godot 4.0 has arrived. This was the final feature that had to be ported over. Like all the rest of the features ported, it managed to get massive improvements."><meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/5f7/f4a/c24/5f7f4ac242e0b845845549.png"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><title>New improvements for GPUParticles in Godot 4.0</title><link rel=alternate type=application/rss+xml title="Godot News" href=/rss.xml><link rel=icon href=/assets/favicon.png sizes=any><link rel=icon href=/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=/assets/css/main.css?111><link rel=stylesheet href=/assets/css/tobii.min.css><link rel=preload as=font href=/assets/fonts/Montserrat-Bold.woff2 crossorigin><link rel=preload as=font href=/assets/fonts/Montserrat-ExtraBold.woff2 crossorigin><link rel=me href=https://mastodon.gamedev.place/@godotengine><input type=checkbox id=nav_toggle_cb><header><div class="container flex align-center"><div id=nav_head><a href=/ id=logo-link><img class=nav-logo src=/assets/logo.svg width=136 height=48 alt="Godot Engine">
<img class="nav-logo dark-logo" src=/assets/logo_dark.svg width=136 height=48 alt="Godot Engine"></a>
<label for=nav_toggle_cb id=nav_toggle_btn><img src=/assets/icons/hamburger.svg width=24 height=24 alt="Main menu"></label></div><nav id=nav><ul class=left><li><a href=/features>Features</a><li class=only-on-mobile><a href=/showcase>Showcase</a><li><a href=/blog>Blog</a><li><a href=/community>Community</a><li><a href=/contact>About</a><li><a href=https://godotengine.org/asset-library/asset>Assets</a></ul><ul class=right><li><a href=/download/windows class=set-os-download-url>Download</a><li><a href=https://docs.godotengine.org>Learn</a><li><a href=https://docs.godotengine.org/en/stable/community/contributing/index.html>Contribute</a><li class=fund><a href=https://fund.godotengine.org>❤&#xFE0E; Donate</a></ul></nav></div></header><main><style>body{background-color:var(--background-color)}h1{margin-bottom:8px;margin-top:32px}:not(pre)>code{background:var(--code-background-color);padding:1px 4px;font-size:.95em;border-radius:3px}pre{background:var(--codeblock-background-color);color:var(--codeblock-color)}pre code{display:block;overflow-x:auto;padding:.5em}.date-big{line-height:2;margin-left:32px}article{background-color:var(--base-color);box-shadow:0 3px 2px rgba(0,0,0,.15)}figure{margin:0}figure img{margin:0}article img,article video{max-width:100%;height:auto;display:block;margin:auto;margin-top:16px;margin-bottom:16px}article h1{margin-top:64px}article h2,article h3,article h4{margin-top:42px}.article-info{display:flex;flex-direction:column;gap:8px}.article-metadata{display:flex;gap:24px;align-items:center;font-family:var(--header-font-family);margin-bottom:12px}@media(max-width:900px){.article-metadata{flex-direction:column;align-items:flex-start;gap:16px}}.article-author{color:var(--base-color-text-subtitle-date);font-weight:700;font-size:18px;flex-grow:1;display:flex;gap:12px;align-items:center}.article-author .avatar{border-radius:100%;margin:0}.article-author .by{color:var(--base-color-text-subtitle)}.article-metadata .date{color:var(--base-color-text-subtitle-date)}.article-metadata .date.post-recent-highlight{color:var(--post-recent-highlight-color);opacity:.8}.article-metadata .date.post-recent-highlight::after{font-size:80%;content:"NEW";border:2px solid var(--post-recent-highlight-color);padding:2px 3px;margin-left:8px}.tag.active{filter:saturate(.75)}@media screen and (min-width:900px){article .content{width:70%;margin:auto}}@media(max-width:900px){body{background-color:var(--base-color)}article{background-color:initial;box-shadow:none}article img:first-child,article video:first-child{max-width:100%}}</style><link rel=stylesheet href=/assets/css/highlight.obsidian.min.css><div class=container><article class=padded><div class="content article-container"><figure class=article-cover><img src=/storage/app/uploads/public/5f7/f4a/c24/5f7f4ac242e0b845845549.png title alt=" " class=rounded-lg style=width:100%;height:auto;background-color:initial></figure><div class=article-info><h1>New improvements for GPUParticles in Godot 4.0</h1><div class=article-metadata><div class=article-author><span>By:</span>
<img class=avatar width=25 height=25 src=/assets/images/authors/reduzio.webp alt="Juan Linietsky" loading=lazy>
<span class=by>Juan Linietsky</span></div><span class=date data-post-date="2020-10-08 00:00:00 +0000">8 October 2020</span></div><div class=tags><a href=/blog/progress-report><div class="tag active">Progress Report</div></a></div></div><div class="card card-warning"><p>This article is from <strong>October 2020</strong>, some of its contents might be outdated and no longer accurate.<br>You can find up-to-date information about the engine in the <a href=https://docs.godotengine.org/en/stable/>official documentation</a>.</div><div class=article-body><p>The turn of porting the GPU particle system to Godot 4.0 has arrived. This was the final feature that had to be ported over. Like all the rest of the features ported, it managed to get massive improvements.<h2 id=particles-in-godot-40>Particles in Godot 4.0</h2><p>Since Godot 3.0, Godot has two particle systems for both 2D and 3D.<ul><li><strong>GPUParticles</strong>: Processes particles on GPU, allows very large amount of particles at little cost, and with ability to write custom particle shaders.<li><strong>CPUParticles</strong> Processes lower amount of particles using CPU. Used mostly for compatibility with OpenGL ES 2.0. Less flexible. Allows collisions against the physics world.</ul><p>GPUParticles worked relatively well in Godot 3.x, but lacked several features. Particles in Godot 4.0 are mostly compatible with 3.x and the shader used is almost identical (should be easy to port).<p>Here are some of the most outstanding features coming for Godot 4.0 GPUParticles:<h3 id=manual-emission>Manual Emission</h3><p>In some cases, the particle emission behavior is just too complex to use one of the built-in methods or anything that can go in a particle shader. To solve this, it is now possible to emit particles manually by calling a function from the script API:<p><img src=/storage/app/uploads/public/5f7/f43/bd9/5f7f43bd98b90925234717.png alt=mem.png><h3 id=sub-emitters>Sub-Emitters</h3><p>Emitting particles manually is not only possible from script. It can also be done from within a particle shader itself by chaining another particle system as a sub-emitter.</p><video controls>
<source src=/storage/app/media/4.0/particles/sub_emitter.mp4 type=video/mp4></video><p>The default ParticlesMaterial comes with several sub-emitter modes, otherwise it can be done from a particle shader using the following function:<p><img src=/storage/app/uploads/public/5f7/f44/dc3/5f7f44dc3c34f793434163.jpeg alt=sefunc.jpeg><p>This function allows emitting several particles at once, potentially allowing for sub explosions, fireworks, etc.<h3 id=attractors>Attractors</h3><p>Attractors were supported to some limited extent in Godot 2.x, and we never managed to implement them properly in 3.x. They now fully work in 4.0.</p><video controls>
<source src=/storage/app/media/4.0/particles/attractor.mp4 type=video/mp4></video><p>Sphere and Box attractors are supported. Additionally, a 3D vector field texture can be provided for use with vector fields generated in Maya or other tools.<h3 id=collision>Collision</h3><p>Likewise, Sphere and Box colliders are supported. They are dynamic and can be moved around in real-time, colliding with any particle system which matches the cull mask.</p><video controls>
<source src=/storage/app/media/4.0/particles/pcol.mp4 type=video/mp4></video><h3 id=baked-sdf-collision>Baked SDF Collision</h3><p>Still, for complex interiors, creating all the collisions with boxes and spheres can be a hassle. Additionally, you may want collider objects with more complex shapes to interact with particles.<p>To solve this, the SDF collider was added. It bakes an area of a custom resolution as a signed distance field. This allows approximate complex collisions with geometry (without having to test the actual geometry, which is expensive).</p><video controls>
<source src=/storage/app/media/4.0/particles/sdf_collision.mp4 type=video/mp4></video><p>If more resolution is used, the collision can also work great for interiors:</p><video controls>
<source src=/storage/app/media/4.0/particles/sdf_particles.mp4 type=video/mp4></video><p>Same example, but using a physical particle fog instead:</p><video controls>
<source src=/storage/app/media/4.0/particles/fog.mp4 type=video/mp4></video><h3 id=heightfield-collision>Heightfield Collision</h3><p>While SDF collision works great for certain objects and interiors, it would require too much memory to be used in exteriors. For this, heightfield collision has more advantages.</p><video controls>
<source src=/storage/app/media/4.0/particles/heightmap.mp4 type=video/mp4></video><p>This type of collision works over a large area and is ideal for terrain, as well as for excluding rain, snow, smoke, etc. from interiors.</p><video controls>
<source src=/storage/app/media/4.0/particles/window.mp4 type=video/mp4></video><p>Additionally, heightfield collision can detect the active camera and move along with it, ensuring that nearby terrain always has particle collision information available.<h2 id=future>Future</h2><p>Some extra features (skeletal trails and skeletal deform) are still missing and will eventually be added before 4.0 release date, as they depend on other features (some improvements and rewrite to skeleton handling). Additionaly, GPU particles are not working for 2D yet. They depend on a final rewrite of the 2D engine based on all the feedback received (it was the first feature implemented in Vulkan after all, done with much less experience than now) in the coming weeks.<p>Still, this marks the final feature that had to be ported over from Godot 3 to Godot 4. From now on, my focus over the next months will be on improving, cleaning up and optimizing (including optimization features such as impostors, LOD and occlusion) everything that is there with hopefully an Alpha coming by December or January (can only wish..).<p>As always, remember that Godot is made with love for you and the gamedev community. Help us make the best engine ever and make it free and open source for everyone by <a href=https://www.patreon.com/godotengine>becoming our patron</a>.</div></div></article></div><link rel=stylesheet href=/assets/css/anchor-link.css?1><link rel=stylesheet href=/assets/css/article-cards.css?2><script src=/assets/js/anchor-link.js></script>
<script>document.addEventListener('DOMContentLoaded',()=>{window.applyAnchorLinks('.article-body'),document.querySelectorAll('.article-cover img, .article-body img').forEach(b=>{if(b.classList.contains('lightbox-ignore'))return;const a=document.createElement('a');a.href=b.src,a.classList.add('lightbox'),a.dataset.group='article',b.parentNode.appendChild(a),a.appendChild(b)})})</script></main><footer><div class="container flex footer-container"><div id=copyright><p>© 2007-2024 Juan Linietsky, Ariel Manzur and <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md target=_blank rel=noopener>contributors</a>.<br>Hosted by the <a href=https://godot.foundation/ target=_blank rel=noopener>Godot Foundation</a>.<br>Website <a href=https://github.com/godotengine/godot-website target=_blank rel=noopener>source code on GitHub</a>.</div><div id=sitemap><ul class=sitemap-group><li><strong>Get Godot</strong><li><a href=/download/windows class=set-os-download-url>Download</a><li><a href=https://editor.godotengine.org/releases/latest/>Web Editor</a><li>&nbsp;<li><strong>Public Relations</strong><li><a href=/blog>Blog</a><li><a href=/community>Communities and Events</a><li><a href=/press>Press Kit</a></ul><ul class=sitemap-group><li><strong>About Godot</strong><li><a href=/features>Features</a><li><a href=/showcase>Showcase</a><li><a href=/education>Education</a><li><a href=/license>License</a><li><a href=/code-of-conduct>Code of Conduct</a><li><a href=/privacy-policy>Privacy Policy</a><li><a href=https://fund.godotengine.org>Donate</a></ul><ul class=sitemap-group><li><strong>Project Team</strong><li><a href=/governance>Governance</a><li><a href=/teams>Teams</a><li>&nbsp;<li><strong>Extra Resources</strong><li><a href=/asset-library/asset>Asset Library</a><li><a href=https://docs.godotengine.org>Documentation</a><li><a href=https://github.com/godotengine>Code Repository</a></ul></div><div id=social class=dark-desaturate><h4 class=text-right><a href=/contact>Contact us</a></h4><div class="flex justify-space-between" style=gap:3px><a href=https://github.com/godotengine target=_blank rel=noopener><img src=/assets/footer/github_logo.svg width=32 height=32 alt=GitHub></a>
<a href=https://mastodon.gamedev.place/@godotengine target=_blank rel=noopener><img src=/assets/footer/mastodon_logo.svg width=32 height=32 alt=Mastodon></a>
<a href=https://twitter.com/godotengine target=_blank rel=noopener><img src=/assets/footer/twitter_logo.svg width=32 height=32 alt=Twitter></a>
<a href=https://www.facebook.com/groups/godotengine/ target=_blank rel=noopener><img src=/assets/footer/facebook_logo.svg width=32 height=32 alt=Facebook></a>
<a href=https://www.reddit.com/r/godot target=_blank rel=noopener><img src=/assets/footer/reddit_logo.svg width=32 height=32 alt=Red​dit></a>
<a href=/rss.xml target=_blank rel=noopener><img src=/assets/footer/feed_logo.svg width=32 height=32 alt="RSS feed"></a></div></div></div></footer><script defer src=/assets/js/tobii.min.js></script>
<script defer src=/assets/js/highlight.min.js?1></script>
<script defer src=/assets/js/highlight.gdscript.min.js?1></script>
<script>document.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('pre code').forEach(a=>{hljs.highlightBlock(a)}),document.querySelectorAll('[data-post-date]').forEach(a=>{Date.parse(a.dataset.postDate)>Date.now()-1e3*60*60*48&&a.classList.add("post-recent-highlight")}),new Tobii({zoom:!1});const a=document.querySelectorAll('.set-os-download-url');for(let b=0;b<a.length;b++){const c=a[b];let e='download';'version'in c.dataset&&c.dataset.version==='3'&&(e='download/3.x');let d='windows';navigator.platform.indexOf('Mac')!==-1?d='macos':navigator.platform.indexOf('Linux')!==-1&&(d='linux'),c.href=`/${e}/${d}`}})</script>