<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Godot Engine">
	<meta name="description" content="Up to now, Godot networking was only limited to UDP, TCP and some high level protocols such as SSL and HTTP. However, for games themselves, the key is how to synchronize state between games. Having to do this manually with low level APIs can be an enormous pain, due to the inherent limitations of the protocols...">
	<meta name="theme-color" content="#3d8fcc">
	<meta property="og:site_name" content="Godot Engine">
	<meta property="og:url" content="https://godotengine.org/article/godots-new-high-level-networking-preview/">
	<meta name="twitter:site" content="@godotengine">

	<meta property="og:title" content="Godot's new high level networking preview is up!">
	<meta property="og:description" content="Up to now, Godot networking was only limited to UDP, TCP and some high level protocols such as SSL and HTTP. However, for games themselves, the key is how to synchronize state between games. Having to do this manually with low level APIs can be an enormous pain, due to the inherent limitations of the protocols...">
	<meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/57b/7d4/a03/57b7d4a0368f1273442154.png">
	<meta property="og:type" content="article">
	<meta name="twitter:card" content="summary_large_image">
	<title>Godot's new high level networking preview is up!</title>

	<link rel="alternate" type="application/rss+xml" title="Godot News" href="/rss.xml">
	<link rel="icon" href="/assets/favicon.png" sizes="any">
	<link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
	<link rel="stylesheet" href="/assets/css/main.css?112">
	<link rel="stylesheet" href="/assets/css/tobii.min.css">
	<link rel="preload" as="font" href="/assets/fonts/Montserrat-Bold.woff2" crossorigin>
	<link rel="preload" as="font" href="/assets/fonts/Montserrat-ExtraBold.woff2" crossorigin>
	<link rel="me" href="https://mastodon.gamedev.place/@godotengine">
</head>

<body>
	<input type="checkbox" id="nav_toggle_cb">
<header>
	<div class="container flex align-center">
		<div id="nav_head">
			<a href="/" id="logo-link">
				<img class="nav-logo" src="/assets/logo.svg" width="136" height="48" alt="Godot Engine">
				<img class="nav-logo dark-logo" src="/assets/logo_dark.svg" width="136" height="48" alt="Godot Engine">
			</a>
			<label for="nav_toggle_cb" id="nav_toggle_btn">
				<img src="/assets/icons/hamburger.svg" width="24" height="24" alt="Main menu">
			</label>
		</div>

		<nav id="nav">
			<ul class="left">
				<li><a href="/features/">Features</a></li>
				<li class="only-on-mobile"><a href="/showcase/">Showcase</a></li>
				<li><a href="/blog/">Blog</a></li>
				<li><a href="/community/">Community</a></li>
				<li><a href="/contact/">About</a></li>
				<li><a href="https://godotengine.org/asset-library/asset">Assets</a></li>
			</ul>

			<ul class="right">
				<li><a href="/download/windows/" class="set-os-download-url">Download</a></li>
				<li><a href="https://docs.godotengine.org">Docs</a></li>
				<li><a href="https://docs.godotengine.org/en/stable/community/contributing/index.html">Contribute</a></li>
				
				<li class="fund"><a href="https://fund.godotengine.org">❤&#xFE0E; Donate</a></li>
			</ul>
		</nav>
	</div>
</header>

<main>


<style>
	body {
		background-color: var(--background-color);
	}

	h1 {
		margin-bottom: 8px;
		margin-top: 32px;
	}

	:not(pre)>code {
		background: var(--code-background-color);
		padding: 1px 4px;
		font-size: 0.95em;
		border-radius: 3px;
	}

	pre {
		background: var(--codeblock-background-color);
		color: var(--codeblock-color);
	}

	pre code {
		display: block;
		overflow-x: auto;
		padding: .5em;
	}

	.date-big {
		line-height: 2;
		margin-left: 32px;
	}

	article {
		background-color: var(--base-color);
		box-shadow: 0px 3px 2px 0px rgba(0, 0, 0, 0.15);
	}

	figure {
		margin: 0;
	}

	figure img {
		margin: 0;
	}

	article img,
	article video {
		max-width: 100%;
		height: auto;
		display: block;
		margin: auto;
		margin-top: 16px;
		margin-bottom: 16px;
	}

	article h1 {
		margin-top: 64px;
	}

	article h2,
	article h3,
	article h4 {
		margin-top: 42px;
	}

	.article-info {
		display: flex;
		flex-direction: column;
		gap: 8px;
	}

	.article-metadata {
		display: flex;
		gap: 24px;
		align-items: center;
		font-family: var(--header-font-family);
		margin-bottom: 12px;
	}

	@media (max-width: 900px) {
		.article-metadata {
			flex-direction: column;
			align-items: flex-start;
			gap: 16px;
		}
	}

	.article-author {
		color: var(--base-color-text-subtitle-date);
		font-weight: 700;
		font-size: 18px;
		flex-grow: 1;
		display: flex;
		gap: 12px;
		align-items: center;
	}

	.article-author .avatar {
		border-radius: 100%;
		margin: 0;
	}

	.article-author .by {
		color: var(--base-color-text-subtitle);
	}

	.article-metadata .date {
		color: var(--base-color-text-subtitle-date);
	}

	.article-metadata .date.post-recent-highlight {
		color: var(--post-recent-highlight-color);
		opacity: 0.8;
	}

	.article-metadata .date.post-recent-highlight::after {
		font-size: 80%;
		content: "NEW";
		border: 2px solid var(--post-recent-highlight-color);
		padding: 2px 3px;
		margin-left: 8px;
	}

	.tag.active {
		filter: saturate(0.75);
	}

	@media screen and (min-width: 900px) {
		article .content {
			width: 70%;
			margin: auto;
		}
	}

	@media (max-width: 900px) {
		body {
			background-color: var(--base-color);
		}

		article {
			background-color: transparent;
			box-shadow: none;
		}

		article img:first-child,
		article video:first-child {
			max-width: 100%;
		}
	}
</style>

<link rel="stylesheet" href="/assets/css/highlight.obsidian.min.css">

<div class="container">
	<article class="padded">
		<div class="content article-container">
			<figure class="article-cover">
				

				<img src="/storage/app/uploads/public/57b/7d4/a03/57b7d4a0368f1273442154.png" title=""
					alt=" " class="rounded-lg"
					style="width: 100%; height: auto; background-color: transparent;" />
			</figure>

			<div class="article-info">
				<h1>
					Godot's new high level networking preview is up!
				</h1>
				<div class="article-metadata">
					<div class="article-author">
						<span>By: </span>
						
						
							<img class="avatar" width="25" height="25" src="/assets/images/authors/reduzio.webp" alt="Juan Linietsky" loading="lazy">
						
						<span class="by">Juan Linietsky</span>
					</div>
					<span class="date" data-post-date="2016-08-20 00:00:00 +0000"> 20 August 2016</span>
				</div>

				<div class="tags">
					
					<a href="/blog/progress-report">
						<div class="tag active">Progress Report</div>
					</a>
					
				</div>
			</div>

			



	<div class="card card-warning">
		<p>
		
			This article is from <strong>August 2016</strong>, some of its contents might be outdated and no longer accurate.<br>
			You can find up-to-date information about the engine in the <a href="https://docs.godotengine.org/en/stable/">official documentation</a>.
		
		</p>
	</div>





			<div class="article-body">
				<h3 id="high-level-please">High level please!</h3>

<p>Up to now, Godot networking was only limited to UDP, TCP and some high level protocols such as SSL and HTTP.
However, for games themselves, the key is how to synchronize state between games. Having to do this manually with low level APIs can be an enormous pain, due to the inherent limitations of the protocols:</p>

<ul>
  <li>TCP ensures packets will always arrive, but latency is generally high due to error correction. It’s also quite a complex protocol because it understands what a “connection” is.</li>
  <li>UDP is a simpler protocol which only sends packets (no connection required). The fact it does no error correction makes it pretty quick (low latency), but it has the disadvantage that packets may be lost along the way. Added to that, the MTU (maximum packet size) for UDP is generally low (only a few hundred bytes), so transmitting larger packets means splitting them, reorganizing them, retrying if a part fails, etc.</li>
</ul>

<p>These protocols are also too low level, so using them for creating peers, reliable channels, and network topologies can be a lot of work.</p>

<h3 id="mid-level-abstraction">Mid level abstraction</h3>

<p>Before going into how we would like to synchronize a game across the network, we need to define how our base network API should be. For this, I created <a href="https://github.com/godotengine/godot/blob/master/core/io/networked_multiplayer_peer.h">the following interface</a> that would abstract all the low level work mentioned in the previous point:</p>

<p><img src="/storage/app/media/nmpeer/nmpeer.png" alt="" /></p>

<p>The new object extends from PacketPeer, so it has all the useful methods for serializing data you are used to, thanks to Godot’s beautiful object-oriented design. It adds methods to set a peer, transfer mode, etc. It also includes signals that will let you know when peers connect or disconnect.</p>

<p>The idea is that this class interface can abstract most types of network layers, topologies and libraries. By default Godot will provide an implementation based on <a href="http://enet.bespin.org">ENet</a>, but the plan is that this could support AdHoc WiFi, Bluetooth, custom device/console networking APIs, etc.</p>

<p>For most common cases, using this object directly is discouraged, as Godot provides even higher level networking facilities. Yet it is made available to scripting in case a game has specific needs for a lower level API.</p>

<h3 id="ways-to-synchronize-over-the-network">Ways to synchronize over the network</h3>

<h4 id="early-days">Early days</h4>

<p>The first networked multiplayer games used the modem and LAN. Both provided really low latency and very limited bandwidth. I remember playing Doom 2 and Warcraft a lot in my teenager days, and it worked fantastically over the telephone line. Same thing with the LAN.</p>

<p>As even early games had a lot of things going on, and synchronizing them every frame would mean sending more information than the connection could take, the most common approach was to take advantage of the low latency and simply send the players’ input to each other.</p>

<p>Games were programmed in deterministic ways, so the same input on the same frame would be enough to replicate the state.</p>

<h4 id="enter-internet">Enter Internet</h4>

<p>With Internet, connections became more complex, with more routing steps in the middle and longer distances. The bandwidth allowed to send information grew many orders of magnitude, but the latency was also considerably increased too.</p>

<p>Even if a network was infinitely efficient and multiplayer was done with an optical fiber from home to home, you still can’t beat the speed of light. I know it seems odd, but have you ever thought about this?</p>

<ul>
  <li>The speed of light is 299,792,458 m/s</li>
  <li>The distance between West and East coast of the US is 5,200,000 meters.</li>
</ul>

<p>This means that the minimum time information takes to reach from one end to the other in the US is 0.0173 seconds. At 60 fps, a computer renders a frame in 0.016 seconds. Whoa, light can be pretty slow if you look at it this way…</p>

<h4 id="distributed-simulation">Distributed simulation</h4>

<p>To compensate for this problem, the most common approach nowadays is to “distribute” the simulation between peers. Generally, each peer will simulate the part of the game “closer” to it.</p>

<p>As such, and given the complexity of this problem, magical solutions where networking “auto synchronizes” don’t really exist, or fail to apply to anything but a simple surface of games.</p>

<h3 id="high-level-networking-in-godot">High level networking in Godot</h3>

<p>Godot has a new simple but very powerful high level networking API. To get it to work, you must supply a multiplayer peer object to the SceneTree, like this:</p>

<p><img src="/storage/app/media/nmpeer/nmapi.png" alt="" /></p>

<p>Once this is done, networking layer magically functions.</p>

<p>Godot’s high level networking works on the premise that all peers will have a similar scene layout, so the most important priority is being able to synchronize them efficiently.</p>

<h3 id="synchronizing-scenes">Synchronizing scenes</h3>

<p>The easiest way to synchronize information between different peers is by using the new <code class="language-plaintext highlighter-rouge">rpc()</code> function (RPC means “Remote Procedure Call” – ‘procedure’ is how functions that do not return a value were commonly called in older programming languages).</p>

<p>Simply call <code class="language-plaintext highlighter-rouge">Node.rpc(&lt;method&gt;, &lt;arguments&gt;)</code>, and the function will magically be called in all the other peers. An example, for synchronizing position and velocity across nodes:</p>

<p><img src="/storage/app/media/nmpeer/nmrpc.png" alt="" /></p>

<p>This will call a <code class="language-plaintext highlighter-rouge">set_pos_and_velocity</code> function in all the other connected peers, thus making synchronization easier. The function would look e.g. like this:</p>

<p><img src="/storage/app/media/nmpeer/nmrpc2.png" alt="" /></p>

<p>I’m sure that you have noticed this new keyword <code class="language-plaintext highlighter-rouge">remote</code>. It means that the function can be called from RPC.
Marking this function for RPC has many uses, but the main one is to simply let you know that it can be called.</p>

<p>Giving peers the ability to call functions in other peers can be really dangerous from a security standpoint. Imagine, what if one peer would open a file in another peer to overwrite system files? This should never happen so, to avoid this, functions must be whitelisted for RPC.</p>

<p>With this scheme, security is just reduced to the few arguments received, making validation easier and lot more difficult for an attacker to cause an unwanted behavior.</p>

<h3 id="masterslave-model">Master/Slave model</h3>

<p>Synchronizing is fine but, as mentioned before, we mostly care about which peer controls each part of the game.
In this new high level networking API, any node can have one of three network modes:</p>

<ul>
  <li>Master</li>
  <li>Slave</li>
  <li>Inherit</li>
</ul>

<p>The default one is <code class="language-plaintext highlighter-rouge">Inherit</code>, meaning the same as the parent node until a node with something else is found in the parenthood chain. If nothing is set, the server is the master by default (all nodes master), while clients are slave by default (all nodes slave). To change this in a node (and in consequence all its children using the <code class="language-plaintext highlighter-rouge">Inherit</code> mode), simply use the <code class="language-plaintext highlighter-rouge">Node.set_network_mode()</code> function:</p>

<p><img src="/storage/app/media/nmpeer/nmmode.png" alt="" /></p>

<p>Of course, make sure that there is always one master and that all other same nodes in different peers are slaves.</p>

<p>In the example below, you can see the same scene tree in both client and server. Nodes in red are set to slave, while nodes in green are set to master:</p>

<p><img src="/storage/app/media/nmpeer/nmms.png" alt="" /></p>

<p>For each player we assigned, as their scene names, their unique network ID. This makes it easy to find them (By default, server always has ID=1, while peers have a unique randomly generated ID upon connection). If your game is more advanced, you could use something different such as usernames or something else.</p>

<h3 id="using-the-masterslave-model-efficiently">Using the Master/Slave model efficiently</h3>

<p>The real advantage of this model is when used with the <code class="language-plaintext highlighter-rouge">master</code>/<code class="language-plaintext highlighter-rouge">slave</code> keywords in GDScript (Don’t worry we’ll have something similar in C# and Visual Script). Similar to <code class="language-plaintext highlighter-rouge">remote</code>, functions can also be tagged with them:</p>

<p><img src="/storage/app/media/nmpeer/nmmasterslave.png" alt="" /></p>

<p>In the above example, a bomb explodes somewhere (likely managed by whoever is master). The bomb knows the bodies in the area, so it checks them and checks that they contain an <code class="language-plaintext highlighter-rouge">exploded</code> function.</p>

<p>If they do, the bomb calls <code class="language-plaintext highlighter-rouge">exploded</code> on it. However, the <code class="language-plaintext highlighter-rouge">exploded</code> method in the player has a <code class="language-plaintext highlighter-rouge">master</code> keyword.
This means that only the player who is master for that instance will actually get the function.</p>

<p>This function, then, calls the <code class="language-plaintext highlighter-rouge">stun</code> function in the same instances of that same player (but in different peers), and only those which are set as slave, making the player look stunned in all the peers (as well as the current, master one).</p>

<h3 id="trying-it-out">Trying it out</h3>

<p>As of today, all these new APIs are available on the <a href="github.com/godotengine/godot">GitHub master branch</a>. An example game can be found in the <a href="https://github.com/godotengine/godot-demo-projects">godot-demo-projects</a> repository under <a href="https://github.com/godotengine/godot-demo-projects/tree/master/networking/simple_multiplayer"><code class="language-plaintext highlighter-rouge">networking/simple_multiplayer</code></a>. No binary builds exist yet, so you will have to compile yourself.</p>

<h3 id="conclusion">Conclusion</h3>

<p>From this first insight, it may not seem very obvious how the high level networking works in Godot. You’ll most likely have to try it yourself to completely “get it”.</p>

<p>The huge advantage of this approach is that, once you are used to it, you can make a multiplayer game with almost the same amount of code as a single player game (save for placing <code class="language-plaintext highlighter-rouge">master</code>/<code class="language-plaintext highlighter-rouge">slave</code> keywords and calling some functions as RPC instead of regular call). As a plus, your multiplayer game will run single-player just fine without any changes (all nodes will be master, calls to slaves will be ignored).</p>

<p>Please remember that this is a first implementation of high level networking, and we would love to hear your feedback on how we can improve it! Thanks for reading!</p>

			</div>
		</div>
	</article>
</div>

<link rel="stylesheet" href="/assets/css/anchor-link.css?1">
<link rel="stylesheet" href="/assets/css/article-cards.css?2">
<script src="/assets/js/anchor-link.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		// Add icons to easily copy section links.
		window.applyAnchorLinks('.article-body');

		// Add lightbox elements in blog articles for Tobii.
		document.querySelectorAll('.article-cover img, .article-body img').forEach((articleImg) => {
			if (articleImg.classList.contains('lightbox-ignore')) {
				return;
			}

			const lightbox = document.createElement('a');
			lightbox.href = articleImg.src;
			lightbox.classList.add('lightbox');
			lightbox.dataset.group = 'article';
			articleImg.parentNode.appendChild(lightbox);
			lightbox.appendChild(articleImg);
		});
	});
</script>

</main>

<footer>
	<div class="container flex footer-container">
		<div id="copyright">
			<p>
				© 2007-2024 Juan Linietsky, Ariel Manzur and <a
					href="https://github.com/godotengine/godot/blob/master/AUTHORS.md" target="_blank"
					rel="noopener">contributors</a>.<br>
				Hosted by the <a href="https://godot.foundation/" target="_blank" rel="noopener">Godot Foundation</a>.<br>
				Website <a href="https://github.com/godotengine/godot-website" target="_blank" rel="noopener">source code on  GitHub</a>.
			</p>
		</div>
		<div id="sitemap">
			<ul class="sitemap-group">
				<li><strong>Get Godot</strong></li>
				<li><a href="/download/windows/" class="set-os-download-url">Download</a></li>
				<li><a href="/download/archive/">Release Archive</a></li>
				<li><a href="https://editor.godotengine.org/releases/latest/">Web Editor</a></li>
				<li>&nbsp;</li>
				<li><strong>Public Relations</strong></li>
				<li><a href="/blog/">Blog</a></li>
				<li><a href="/community/">Communities and Events</a></li>
				<li><a href="/press/">Press Kit</a></li>
			</ul>
			<ul class="sitemap-group">
				<li><strong>About Godot</strong></li>
				<li><a href="/features/">Features</a></li>
				<li><a href="/showcase/">Showcase</a></li>
				<li><a href="/education/">Education</a></li>
				<li><a href="/license/">License</a></li>
				<li><a href="/code-of-conduct/">Code of Conduct</a></li>
				<li><a href="/privacy-policy/">Privacy Policy</a></li>
				<li><a href="https://fund.godotengine.org">Donate</a></li>
			</ul>
			<ul class="sitemap-group">
				<li><strong>Project Team</strong></li>
				<li><a href="/governance/">Governance</a></li>
				<li><a href="/teams/">Teams</a></li>
				<li>&nbsp;</li>
				<li><strong>Extra Resources</strong></li>
				<li><a href="https://godotengine.org/asset-library/asset">Asset Library</a></li>
				<li><a href="https://docs.godotengine.org">Documentation</a></li>
				<li><a href="https://github.com/godotengine">Code Repository</a></li>
			</ul>
		</div>
		<div id="social" class="dark-desaturate">
			<h4 class="text-right"><a href="/contact/">Contact us</a></h4>
			<div class="flex justify-space-between" style="gap: 3px;">
				<a href="https://github.com/godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/github_logo.svg" width="32" height="32" alt="GitHub">
				</a>
				<a href="https://mastodon.gamedev.place/@godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/mastodon_logo.svg" width="32" height="32" alt="Mastodon">
				</a>
				<a href="https://twitter.com/godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/twitter_logo.svg" width="32" height="32" alt="Twitter">
				</a>
				<a href="https://www.facebook.com/groups/godotengine/" target="_blank" rel="noopener">
					<img src="/assets/footer/facebook_logo.svg" width="32" height="32" alt="Facebook">
				</a>
				<a href="https://www.reddit.com/r/godot" target="_blank" rel="noopener">
					<!-- Zero-width space in the `alt` text to prevent content blockers from blocking the icon -->
					<img src="/assets/footer/reddit_logo.svg" width="32" height="32" alt="Red​dit">
				</a>
				<a href="/rss.xml" target="_blank" rel="noopener">
					<!-- Icon is called `feed` instead of `rss` to prevent content blockers from blocking the icon -->
					<img src="/assets/footer/feed_logo.svg" width="32" height="32" alt="RSS feed">
				</a>
			</div>
		</div>
	</div>
</footer>

<script defer src="/assets/js/tobii.min.js"></script>
<script defer src="/assets/js/highlight.min.js?1"></script>
<script defer src="/assets/js/highlight.gdscript.min.js?1"></script>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		// This needs to be done on page load but also after page changes,
		// in case a code block appears in an article.
		document.querySelectorAll('pre code').forEach((block) => {
			hljs.highlightBlock(block);
		});

		document.querySelectorAll('[data-post-date]').forEach((postDate) => {
			// Highlight post dates that are less than 48 hours old.
			if (Date.parse(postDate.dataset.postDate) > (Date.now() - 1000 * 60 * 60 * 48)) {
				postDate.classList.add("post-recent-highlight");
			};
		});

		// Initialize lightbox.
		new Tobii({
			zoom: false,
		});

		// Update any download link to point to identified user's OS.
		const links = document.querySelectorAll('.set-os-download-url');
		for (let i = 0; i < links.length; i++) {
			const link = links[i];
			let link_slug = 'download';
			if ('version' in link.dataset && link.dataset['version'] === '3') {
				link_slug = 'download/3.x';
			}

			let link_platform = 'windows';
			if (navigator.platform.indexOf('Mac') !== -1) {
				link_platform = 'macos';
			} else if (navigator.platform.indexOf('Linux') !== -1) {
				link_platform = 'linux';
			}

			link.href = `/${link_slug}/${link_platform}/`;
		}
	});
</script>


</body>

</html>
