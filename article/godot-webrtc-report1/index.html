<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Godot Engine">
	<meta name="description" content="Godot is getting some WebRTC love! Experimental support is available in current master branch, enabling low latency networking in HTML5/WebAssembly exports, and initial desktop platforms support via GDNative. The API is still experimental but will become stable in the next few months.">
	<meta name="theme-color" content="#3d8fcc">
	<meta property="og:site_name" content="Godot Engine">
	<meta property="og:url" content="https://godotengine.org/article/godot-webrtc-report1/">
	<meta name="twitter:site" content="@godotengine">

	<meta property="og:title" content="WebRTC support, progress report #1">
	<meta property="og:description" content="Godot is getting some WebRTC love! Experimental support is available in current master branch, enabling low latency networking in HTML5/WebAssembly exports, and initial desktop platforms support via GDNative. The API is still experimental but will become stable in the next few months.">
	<meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/5cb/9e2/b60/5cb9e2b60bf06285510736.png">
	<meta property="og:type" content="article">
	<meta name="twitter:card" content="summary_large_image">
	<title>WebRTC support, progress report #1</title>

	<link rel="alternate" type="application/rss+xml" title="Godot News" href="/rss.xml">
	<link rel="icon" href="/assets/favicon.png" sizes="any">
	<link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
	<link rel="stylesheet" href="/assets/css/main.css?111">
	<link rel="stylesheet" href="/assets/css/tobii.min.css">
	<link rel="preload" as="font" href="/assets/fonts/Montserrat-Bold.woff2" crossorigin>
	<link rel="preload" as="font" href="/assets/fonts/Montserrat-ExtraBold.woff2" crossorigin>
	<link rel="me" href="https://mastodon.gamedev.place/@godotengine">
</head>

<body>
	<input type="checkbox" id="nav_toggle_cb">
<header>
	<div class="container flex align-center">
		<div id="nav_head">
			<a href="/" id="logo-link">
				<img class="nav-logo" src="/assets/logo.svg" width="136" height="48" alt="Godot Engine">
				<img class="nav-logo dark-logo" src="/assets/logo_dark.svg" width="136" height="48" alt="Godot Engine">
			</a>
			<label for="nav_toggle_cb" id="nav_toggle_btn">
				<img src="/assets/icons/hamburger.svg" width="24" height="24" alt="Main menu">
			</label>
		</div>

		<nav id="nav">
			<ul class="left">
				<li><a href="/features">Features</a></li>
				<li class="only-on-mobile"><a href="/showcase">Showcase</a></li>
				<li><a href="/blog">Blog</a></li>
				<li><a href="/community">Community</a></li>
				<li><a href="/contact">About</a></li>
				<li><a href="https://godotengine.org/asset-library/asset">Assets</a></li>
			</ul>

			<ul class="right">
				<li><a href="/download/windows" class="set-os-download-url">Download</a></li>
				<li><a href="https://docs.godotengine.org">Learn</a></li>
				<li><a href="https://docs.godotengine.org/en/stable/community/contributing/index.html">Contribute</a></li>
				
				<li class="fund"><a href="https://fund.godotengine.org">❤&#xFE0E; Donate</a></li>
			</ul>
		</nav>
	</div>
</header>

<main>


<style>
	body {
		background-color: var(--background-color);
	}

	h1 {
		margin-bottom: 8px;
		margin-top: 32px;
	}

	:not(pre)>code {
		background: var(--code-background-color);
		padding: 1px 4px;
		font-size: 0.95em;
		border-radius: 3px;
	}

	pre {
		background: var(--codeblock-background-color);
		color: var(--codeblock-color);
	}

	pre code {
		display: block;
		overflow-x: auto;
		padding: .5em;
	}

	.date-big {
		line-height: 2;
		margin-left: 32px;
	}

	article {
		background-color: var(--base-color);
		box-shadow: 0px 3px 2px 0px rgba(0, 0, 0, 0.15);
	}

	figure {
		margin: 0;
	}

	figure img {
		margin: 0;
	}

	article img,
	article video {
		max-width: 100%;
		height: auto;
		display: block;
		margin: auto;
		margin-top: 16px;
		margin-bottom: 16px;
	}

	article h1 {
		margin-top: 64px;
	}

	article h2,
	article h3,
	article h4 {
		margin-top: 42px;
	}

	.article-info {
		display: flex;
		flex-direction: column;
		gap: 8px;
	}

	.article-metadata {
		display: flex;
		gap: 24px;
		align-items: center;
		font-family: var(--header-font-family);
		margin-bottom: 12px;
	}

	@media (max-width: 900px) {
		.article-metadata {
			flex-direction: column;
			align-items: flex-start;
			gap: 16px;
		}
	}

	.article-author {
		color: var(--base-color-text-subtitle-date);
		font-weight: 700;
		font-size: 18px;
		flex-grow: 1;
		display: flex;
		gap: 12px;
		align-items: center;
	}

	.article-author .avatar {
		border-radius: 100%;
		margin: 0;
	}

	.article-author .by {
		color: var(--base-color-text-subtitle);
	}

	.article-metadata .date {
		color: var(--base-color-text-subtitle-date);
	}

	.article-metadata .date.post-recent-highlight {
		color: var(--post-recent-highlight-color);
		opacity: 0.8;
	}

	.article-metadata .date.post-recent-highlight::after {
		font-size: 80%;
		content: "NEW";
		border: 2px solid var(--post-recent-highlight-color);
		padding: 2px 3px;
		margin-left: 8px;
	}

	.tag.active {
		filter: saturate(0.75);
	}

	@media screen and (min-width: 900px) {
		article .content {
			width: 70%;
			margin: auto;
		}
	}

	@media (max-width: 900px) {
		body {
			background-color: var(--base-color);
		}

		article {
			background-color: transparent;
			box-shadow: none;
		}

		article img:first-child,
		article video:first-child {
			max-width: 100%;
		}
	}
</style>

<link rel="stylesheet" href="/assets/css/highlight.obsidian.min.css">

<div class="container">
	<article class="padded">
		<div class="content article-container">
			<figure class="article-cover">
				

				<img src="/storage/app/uploads/public/5cb/9e2/b60/5cb9e2b60bf06285510736.png" title=""
					alt=" " class="rounded-lg"
					style="width: 100%; height: auto; background-color: transparent;" />
			</figure>

			<div class="article-info">
				<h1>
					WebRTC support, progress report #1
				</h1>
				<div class="article-metadata">
					<div class="article-author">
						<span>By: </span>
						
						
							<img class="avatar" width="25" height="25" src="/assets/images/authors/faless.webp" alt="Fabio Alessandrelli" loading="lazy">
						
						<span class="by">Fabio Alessandrelli</span>
					</div>
					<span class="date" data-post-date="2019-04-19 14:53:33 +0000"> 19 April 2019</span>
				</div>

				<div class="tags">
					
					<a href="/blog/progress-report">
						<div class="tag active">Progress Report</div>
					</a>
					
				</div>
			</div>

			



	<div class="card card-warning">
		<p>
		
			This article is from <strong>April 2019</strong>, some of its contents might be outdated and no longer accurate.<br>
			You can find up-to-date information about the engine in the <a href="https://docs.godotengine.org/en/stable/">official documentation</a>.
		
		</p>
	</div>





			<div class="article-body">
				<h2 id="presentations">Presentations</h2>

<p>Hello Godotters, my name is Fabio Alessandrelli, you may know me by my handle fales (<a href="https://github.com/Faless">faless</a> on GitHub). Here are a few words about my Godot journey.</p>

<p>I first discovered Godot in 2015 while looking for a good game engine (that would also work on GNU/Linux) to develop a small game for a university project with a friend.</p>

<p>It was the early era of Godot 1.0, which was open sourced just few months before.</p>

<p>It was love at first sight, and since then, I slowly started contributing to its development, proposing small PRs whenever I found something that was missing or not working and I had the time to fix, learning a lot in the process.</p>

<p>Finally, I started specializing in the networking subsystem (again, because I needed it for my projects). I slowly became the “network guy”, so if your networking PR or issue is stalling, yes, it’s my fault, I’ll try to review them soon™.</p>

<h2 id="on-html5-websockets-webrtc">On HTML5, WebSockets, WebRTC</h2>

<p>One of the thing that struck me after some time playing with Godot, was how easily it enables developers to export for different platforms, and among those, <strong>HTML5/WebAssembly</strong> (thanks to the great effort of many developers, especially eska, the current HTML5 platform maintainer). Enabling developers to share their beautiful <strong>games running in browsers</strong> is a great feature for an engine!</p>

<p>Networking trough browsers used to be very limited and originally only <strong>HTTP requests</strong> were possible.</p>

<h3 id="websocket">Websocket</h3>

<p>Then, in December 2011, the <strong>WebSocket protocol</strong> was standardized, allowing browsers to create <strong>bidirectional</strong> channels to a WebSocket server. The protocol is pretty simple, it begins with an HTTP request from the browser with some protocol specific headers. From there, if the server accepts the connection (replying with similar headers), the connection is kept open, and data begins to flow bidirectionally using the quite <strong>simple protocol</strong> message format.</p>

<p>That though, wasn’t enough. WebSockets still uses a <strong>TCP connection</strong>, which is <strong>good for reliability but not for latency</strong>, rendering it useless for real-time applications (e.g. VoIP, fast-paced real-time games).</p>

<h3 id="webrtc">WebRTC</h3>

<p>For this reason, since 2010, Google started working on a new technology called <strong>WebRTC</strong>, which later on, in 2017, became a <strong>W3C candidate recommendation</strong> (i.e. it’s considered quite stable but it’s still being worked on).
WebRTC is a <strong>much more complex</strong> set of specifications and API, and uses a lot of other technology underneath (ICE, DTLS, SDP), to provide fast, real-time, and secure communication between two peers.</p>

<p>The idea, is to <strong>find the fastest route</strong> between the two peers and establish whenever possible a <strong>direct communication</strong> (as in try to avoid a relaying server).</p>

<p>This <strong>comes at a price</strong> though, and the price is that some media information must be exchanged between the two peers before the communication can start (in the form of Session Description Protocol – SDP strings). This usually takes the form of a so-called WebRTC Signaling Server.</p>

<p><img src="/storage/app/uploads/public/5ca/d20/5ae/5cad205ae8405844580807.png" alt="signaling_simple.png" /></p>

<p>A signaling server (for example a WebSocket server) to which peers connects and send their media information. The server then relays those information to other peers, allowing them to establish the desired direct communication. Once this step is done, peers can disconnect from the signaling server and keep the direct P2P connection open.</p>

<hr />

<h2 id="current-work-on-supporting-webrtc-in-godot">Current work on supporting WebRTC in Godot</h2>

<p>During the last month, I’ve spent most of my time (paid by the Software Freedom Conservancy thanks to <a href="/article/mozilla-awards-godot-engine-part-moss-mission-partners-program">a grant by Mozilla Foundation</a>) working on a WebRTC implementation for Godot Engine. Part of the work, was already done by Brandon Makin during <a href="/article/gsoc-2018-progress-report-1">GSoC 2018</a>.</p>

<p>I focused on getting the Javascript version ready, and porting the work of Brandon Makin to GDNative (to support WebRTC in native exports, without having to bundle the huge WebRTC Native Code reference library into Godot sources).
So, while the WebAssembly export will have WebRTC support out of the box, native exports (e.g. GNU/Linux, Windows, macOS, Android, etc.) will need a GDNative library to work.</p>

<p>This is done by having a WebRTCGDNative class, which we then implement via GDNative, and will be released in a <a href="https://github.com/godotengine/webrtc-native">separate repository</a>.</p>

<h3 id="but-how-does-this-work">But how does this work?</h3>

<p>Here are the Godot-exposed functions for the current state in my branch (yes, yes, I will document them, when the work is ready :) ):</p>

<p><img src="/storage/app/uploads/public/5cb/9c4/f57/5cb9c4f5719a8010547417.png" alt="webrtc_docs.png" /></p>

<p>NOTE: The API will slightly change to allow creating multiple data channels.</p>

<p>And here is a simple schema on how to use it:</p>

<p><img src="/storage/app/uploads/public/5cb/9c5/1d2/5cb9c51d2b949452233794.png" alt="webrtc_example.png" /></p>

<p>Wait, that doesn’t look simple! Well, that’s true, WebRTC has a fairly complex setup phase, but it can be boiled down to 4 steps:</p>

<ol>
  <li>The peer that wants to establish a new connection calls <code class="language-plaintext highlighter-rouge">create_offer()</code>.
    <ol>
      <li>A new <code class="language-plaintext highlighter-rouge">offer_created</code> signal is emitted by that same WebRTC peer.</li>
      <li>The signal values need to be passed to <code class="language-plaintext highlighter-rouge">set_local_description</code>.</li>
      <li>The signal values need to also be passed to the remote peer, using any means desired (usually, the Signaling Server).</li>
    </ol>
  </li>
  <li>The remote peer will need to pass the received parameters (<code class="language-plaintext highlighter-rouge">type</code> and <code class="language-plaintext highlighter-rouge">sdp</code>) to its <code class="language-plaintext highlighter-rouge">WebRTCPeer</code> <code class="language-plaintext highlighter-rouge">set_remote_description</code>.
    <ol>
      <li>This will generate an <code class="language-plaintext highlighter-rouge">offer_created</code> signal on that peer.</li>
      <li>The signal values need to be passed to <code class="language-plaintext highlighter-rouge">set_local_description</code>.</li>
      <li>The signal values need to also be passed to the peer that generated the offer in the first place.</li>
    </ol>
  </li>
  <li>The peer that originally generated the offer will pass the received parameters (i.e. the answer from the remote peer) to its own <code class="language-plaintext highlighter-rouge">WebRTCPeer</code> <code class="language-plaintext highlighter-rouge">set_remote_description</code>.</li>
  <li>After calling <code class="language-plaintext highlighter-rouge">set_remote_description</code> on each peer, multiple <code class="language-plaintext highlighter-rouge">new_ice_candidate</code> events will be emitted.
    <ol>
      <li>The values from those events needs to be sent to the other peer (again, via the signaling server).</li>
      <li>Each peer will then pass the candidates received from the signaling server to the <code class="language-plaintext highlighter-rouge">add_ice_candidate</code> function (i.e. each peer must pass to the function the candidate generated by the other peer).</li>
    </ol>
  </li>
</ol>

<p>After that, the connection will be established!</p>

<h3 id="reference-work">Reference work</h3>

<p>You will need a recent build of Godot’s <code class="language-plaintext highlighter-rouge">master</code> branch:
https://github.com/godotengine/godot/tree/master</p>

<p>A compiled version of the WebRTC GDNative library is available at:</p>

<p>https://github.com/godotengine/webrtc-native/releases/tag/0.2</p>

<p>A small demo to test it can be found at:</p>

<p>https://github.com/Faless/webrtc-native-demo/releases/tag/0.2</p>

<p>The work on the reference WebRTC signaling server based on WebSocket is available at:</p>

<p>https://github.com/Faless/gd-webrtc-signalling</p>

<h2 id="additional-resources">Additional resources</h2>

<h3 id="websocket-1">Websocket</h3>

<p>RFC: https://tools.ietf.org/html/rfc6455</p>

<p>JS API: https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API</p>

<h3 id="webrtc-1">WebRTC</h3>

<p>W3C Recommendation: https://www.w3.org/TR/webrtc/</p>

<p>JS API: https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API</p>

			</div>
		</div>
	</article>
</div>

<link rel="stylesheet" href="/assets/css/anchor-link.css?1">
<link rel="stylesheet" href="/assets/css/article-cards.css?2">
<script src="/assets/js/anchor-link.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		// Add icons to easily copy section links.
		window.applyAnchorLinks('.article-body');

		// Add lightbox elements in blog articles for Tobii.
		document.querySelectorAll('.article-cover img, .article-body img').forEach((articleImg) => {
			if (articleImg.classList.contains('lightbox-ignore')) {
				return;
			}

			const lightbox = document.createElement('a');
			lightbox.href = articleImg.src;
			lightbox.classList.add('lightbox');
			lightbox.dataset.group = 'article';
			articleImg.parentNode.appendChild(lightbox);
			lightbox.appendChild(articleImg);
		});
	});
</script>

</main>

<footer>
	<div class="container flex footer-container">
		<div id="copyright">
			<p>
				© 2007-2024 Juan Linietsky, Ariel Manzur and <a
					href="https://github.com/godotengine/godot/blob/master/AUTHORS.md" target="_blank"
					rel="noopener">contributors</a>.<br>
				Hosted by the <a href="https://godot.foundation/" target="_blank" rel="noopener">Godot Foundation</a>.<br>
				Website <a href="https://github.com/godotengine/godot-website" target="_blank" rel="noopener">source code on  GitHub</a>.
			</p>
		</div>
		<div id="sitemap">
			<ul class="sitemap-group">
				<li><strong>Get Godot</strong></li>
				<li><a href="/download/windows" class="set-os-download-url">Download</a></li>
				<li><a href="https://editor.godotengine.org/releases/latest/">Web Editor</a></li>
				<li>&nbsp;</li>
				<li><strong>Public Relations</strong></li>
				<li><a href="/blog">Blog</a></li>
				<li><a href="/community">Communities and Events</a></li>
				<li><a href="/press">Press Kit</a></li>
			</ul>
			<ul class="sitemap-group">
				<li><strong>About Godot</strong></li>
				<li><a href="/features">Features</a></li>
				<li><a href="/showcase">Showcase</a></li>
				<li><a href="/education">Education</a></li>
				<li><a href="/license">License</a></li>
				<li><a href="/code-of-conduct">Code of Conduct</a></li>
				<li><a href="/privacy-policy">Privacy Policy</a></li>
				<li><a href="https://fund.godotengine.org">Donate</a></li>
			</ul>
			<ul class="sitemap-group">
				<li><strong>Project Team</strong></li>
				<li><a href="/governance">Governance</a></li>
				<li><a href="/teams">Teams</a></li>
				<li>&nbsp;</li>
				<li><strong>Extra Resources</strong></li>
				<li><a href="/asset-library/asset">Asset Library</a></li>
				<li><a href="https://docs.godotengine.org">Documentation</a></li>
				<li><a href="https://github.com/godotengine">Code Repository</a></li>
			</ul>
		</div>
		<div id="social" class="dark-desaturate">
			<h4 class="text-right"><a href="/contact">Contact us</a></h4>
			<div class="flex justify-space-between" style="gap: 3px;">
				<a href="https://github.com/godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/github_logo.svg" width="32" height="32" alt="GitHub">
				</a>
				<a href="https://mastodon.gamedev.place/@godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/mastodon_logo.svg" width="32" height="32" alt="Mastodon">
				</a>
				<a href="https://twitter.com/godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/twitter_logo.svg" width="32" height="32" alt="Twitter">
				</a>
				<a href="https://www.facebook.com/groups/godotengine/" target="_blank" rel="noopener">
					<img src="/assets/footer/facebook_logo.svg" width="32" height="32" alt="Facebook">
				</a>
				<a href="https://www.reddit.com/r/godot" target="_blank" rel="noopener">
					<!-- Zero-width space in the `alt` text to prevent content blockers from blocking the icon -->
					<img src="/assets/footer/reddit_logo.svg" width="32" height="32" alt="Red​dit">
				</a>
				<a href="/rss.xml" target="_blank" rel="noopener">
					<!-- Icon is called `feed` instead of `rss` to prevent content blockers from blocking the icon -->
					<img src="/assets/footer/feed_logo.svg" width="32" height="32" alt="RSS feed">
				</a>
			</div>
		</div>
	</div>
</footer>

<script defer src="/assets/js/tobii.min.js"></script>
<script defer src="/assets/js/highlight.min.js?1"></script>
<script defer src="/assets/js/highlight.gdscript.min.js?1"></script>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		// This needs to be done on page load but also after page changes,
		// in case a code block appears in an article.
		document.querySelectorAll('pre code').forEach((block) => {
			hljs.highlightBlock(block);
		});

		document.querySelectorAll('[data-post-date]').forEach((postDate) => {
			// Highlight post dates that are less than 48 hours old.
			if (Date.parse(postDate.dataset.postDate) > (Date.now() - 1000 * 60 * 60 * 48)) {
				postDate.classList.add("post-recent-highlight");
			};
		});

		// Initialize lightbox.
		new Tobii({
			zoom: false,
		});

		// Update any download link to point to identified user's OS.
		const links = document.querySelectorAll('.set-os-download-url');
		for (let i = 0; i < links.length; i++) {
			const link = links[i];
			let link_slug = 'download';
			if ('version' in link.dataset && link.dataset['version'] === '3') {
				link_slug = 'download/3.x';
			}

			let link_platform = 'windows';
			if (navigator.platform.indexOf('Mac') !== -1) {
				link_platform = 'macos';
			} else if (navigator.platform.indexOf('Linux') !== -1) {
				link_platform = 'linux';
			}

			link.href = `/${link_slug}/${link_platform}`;
		}
	});
</script>


</body>

</html>
