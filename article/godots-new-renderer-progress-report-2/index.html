<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Godot Engine">
	<meta name="description" content="It's been a month since the first [progress report](https://godotengine.org/article/godots-new-renderer-progress-report-1), and progress continues towards the new Godot renderer. Little by little every system falls into place, and rendering starts feeling a lot more mature.">
	<meta name="theme-color" content="#3d8fcc">
	<meta property="og:site_name" content="Godot Engine">
	<meta property="og:url" content="https://godotengine.org/article/godots-new-renderer-progress-report-2/">
	<meta name="twitter:site" content="@godotengine">

	<meta property="og:title" content="Godot's new renderer, progress report #2">
	<meta property="og:description" content="It's been a month since the first [progress report](https://godotengine.org/article/godots-new-renderer-progress-report-1), and progress continues towards the new Godot renderer. Little by little every system falls into place, and rendering starts feeling a lot more mature.">
	<meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/584/4da/2c0/5844da2c08826494171869.png">
	<meta property="og:type" content="article">
	<meta name="twitter:card" content="summary_large_image">
	<title>Godot's new renderer, progress report #2</title>

	<link rel="alternate" type="application/rss+xml" title="Godot News" href="/rss.xml">
	<link rel="icon" href="/assets/favicon.png" sizes="any">
	<link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
	<link rel="stylesheet" href="/assets/css/main.css?112">
	<link rel="stylesheet" href="/assets/css/tobii.min.css">
	<link rel="preload" as="font" href="/assets/fonts/Montserrat-Bold.woff2" crossorigin>
	<link rel="preload" as="font" href="/assets/fonts/Montserrat-ExtraBold.woff2" crossorigin>
	<link rel="me" href="https://mastodon.gamedev.place/@godotengine">
</head>

<body>
	<input type="checkbox" id="nav_toggle_cb">
<header>
	<div class="container flex align-center">
		<div id="nav_head">
			<a href="/" id="logo-link">
				<img class="nav-logo" src="/assets/logo.svg" width="136" height="48" alt="Godot Engine">
				<img class="nav-logo dark-logo" src="/assets/logo_dark.svg" width="136" height="48" alt="Godot Engine">
			</a>
			<label for="nav_toggle_cb" id="nav_toggle_btn">
				<img src="/assets/icons/hamburger.svg" width="24" height="24" alt="Main menu">
			</label>
		</div>

		<nav id="nav">
			<ul class="left">
				<li><a href="/features/">Features</a></li>
				<li class="only-on-mobile"><a href="/showcase/">Showcase</a></li>
				<li><a href="/blog/">Blog</a></li>
				<li><a href="/community/">Community</a></li>
				<li><a href="/contact/">About</a></li>
				<li><a href="https://godotengine.org/asset-library/asset">Assets</a></li>
			</ul>

			<ul class="right">
				<li><a href="/download/windows/" class="set-os-download-url">Download</a></li>
				<li><a href="https://docs.godotengine.org">Docs</a></li>
				<li><a href="https://docs.godotengine.org/en/stable/community/contributing/index.html">Contribute</a></li>
				
				<li class="fund"><a href="https://fund.godotengine.org">❤&#xFE0E; Donate</a></li>
			</ul>
		</nav>
	</div>
</header>

<main>


<style>
	body {
		background-color: var(--background-color);
	}

	h1 {
		margin-bottom: 8px;
		margin-top: 32px;
	}

	:not(pre)>code {
		background: var(--code-background-color);
		padding: 1px 4px;
		font-size: 0.95em;
		border-radius: 3px;
	}

	pre {
		background: var(--codeblock-background-color);
		color: var(--codeblock-color);
	}

	pre code {
		display: block;
		overflow-x: auto;
		padding: .5em;
	}

	.date-big {
		line-height: 2;
		margin-left: 32px;
	}

	article {
		background-color: var(--base-color);
		box-shadow: 0px 3px 2px 0px rgba(0, 0, 0, 0.15);
	}

	figure {
		margin: 0;
	}

	figure img {
		margin: 0;
	}

	article img,
	article video {
		max-width: 100%;
		height: auto;
		display: block;
		margin: auto;
		margin-top: 16px;
		margin-bottom: 16px;
	}

	article h1 {
		margin-top: 64px;
	}

	article h2,
	article h3,
	article h4 {
		margin-top: 42px;
	}

	.article-info {
		display: flex;
		flex-direction: column;
		gap: 8px;
	}

	.article-metadata {
		display: flex;
		gap: 24px;
		align-items: center;
		font-family: var(--header-font-family);
		margin-bottom: 12px;
	}

	@media (max-width: 900px) {
		.article-metadata {
			flex-direction: column;
			align-items: flex-start;
			gap: 16px;
		}
	}

	.article-author {
		color: var(--base-color-text-subtitle-date);
		font-weight: 700;
		font-size: 18px;
		flex-grow: 1;
		display: flex;
		gap: 12px;
		align-items: center;
	}

	.article-author .avatar {
		border-radius: 100%;
		margin: 0;
	}

	.article-author .by {
		color: var(--base-color-text-subtitle);
	}

	.article-metadata .date {
		color: var(--base-color-text-subtitle-date);
	}

	.article-metadata .date.post-recent-highlight {
		color: var(--post-recent-highlight-color);
		opacity: 0.8;
	}

	.article-metadata .date.post-recent-highlight::after {
		font-size: 80%;
		content: "NEW";
		border: 2px solid var(--post-recent-highlight-color);
		padding: 2px 3px;
		margin-left: 8px;
	}

	.tag.active {
		filter: saturate(0.75);
	}

	@media screen and (min-width: 900px) {
		article .content {
			width: 70%;
			margin: auto;
		}
	}

	@media (max-width: 900px) {
		body {
			background-color: var(--base-color);
		}

		article {
			background-color: transparent;
			box-shadow: none;
		}

		article img:first-child,
		article video:first-child {
			max-width: 100%;
		}
	}
</style>

<link rel="stylesheet" href="/assets/css/highlight.obsidian.min.css">

<div class="container">
	<article class="padded">
		<div class="content article-container">
			<figure class="article-cover">
				

				<img src="/storage/app/uploads/public/584/4da/2c0/5844da2c08826494171869.png" title=""
					alt=" " class="rounded-lg"
					style="width: 100%; height: auto; background-color: transparent;" />
			</figure>

			<div class="article-info">
				<h1>
					Godot's new renderer, progress report #2
				</h1>
				<div class="article-metadata">
					<div class="article-author">
						<span>By: </span>
						
						
							<img class="avatar" width="25" height="25" src="/assets/images/authors/reduzio.webp" alt="Juan Linietsky" loading="lazy">
						
						<span class="by">Juan Linietsky</span>
					</div>
					<span class="date" data-post-date="2016-12-04 01:00:00 +0000">  4 December 2016</span>
				</div>

				<div class="tags">
					
					<a href="/blog/progress-report">
						<div class="tag active">Progress Report</div>
					</a>
					
				</div>
			</div>

			



	<div class="card card-warning">
		<p>
		
			This article is from <strong>December 2016</strong>, some of its contents might be outdated and no longer accurate.<br>
			You can find up-to-date information about the engine in the <a href="https://docs.godotengine.org/en/stable/">official documentation</a>.
		
		</p>
	</div>





			<div class="article-body">
				<h1 id="introduction">Introduction</h1>

<p>It’s been a month since the first <a href="/article/godots-new-renderer-progress-report-1">progress report</a>, and progress continues towards the new Godot renderer. Little by little every system falls into place, and rendering starts feeling a lot more mature.</p>

<p>That said, there is still a lot missing. Unfortunately, some tasks initially planned for Milestone #2 could not be completed yet, so they will be pushed to the next milestone.</p>

<p>Here’s the list of tasks for the current milestone and the next one:</p>

<h3 id="todo-for-milestone-2-november-2016">TODO for Milestone #2 (November 2016)</h3>

<ul>
  <li><del>Implement ShadowMapping.</del></li>
  <li><del>Implement Environment Probes (research cubemap, dual paraboloid).</del></li>
  <li><del>Implement Environment Probe and/or Skybox dynamic blending.</del></li>
  <li><del>Implement more PBR parameters: Sheen, Clearcoat, Anisotropy.</del></li>
  <li><del>Implement more Material parameters: Displacement, Refraction, Subsurface Scattering.</del></li>
  <li>Implement Post-Processings: Tonemapping, adjustments, Motion Blur, <del>SSAO</del>, DOF Blur, Bloom and <del>Screen Space Reflections</del>.</li>
  <li><del>Implement more types of geometry: Instancing (MultiMesh), Skeletons, and Immediates.</del></li>
  <li>Implement Decals.</li>
</ul>

<p>The remaining post processing tasks and decals will hopefully be done this week, though, so it’s not that bad.</p>

<h3 id="todo-for-milestone-3-december-2016">TODO for Milestone #3 (December 2016)</h3>

<ul>
  <li>Implement the new version of the Godot SVO-based Light Baker.</li>
  <li>Implement Particle Shaders, with support for: Sorting, Collision and Soft Particles.</li>
  <li>Improve Culling: Portals (rewrite as polygon-based) and Rooms.</li>
  <li>Add Clustered lighting (before this all is forward).</li>
  <li>Add Layered/Stencil rendering</li>
</ul>

<p>The new baker will probably take a bit more time, as this is an exciting area of research and a lot of nice ideas are ready to be tested (including the possibility of realtime-GI using an innovative technique).</p>

<h1 id="detail-of-tasks-done-for-milestone-2-november-2016">Detail of tasks done for Milestone #2 (November 2016)</h1>

<p>Following is the detail of everything that was implemented and a little background on how this was done!</p>

<h2 id="implement-shadowmapping">Implement Shadowmapping</h2>

<p>Shadow mapping is implemented in Godot 3.0 using a Shadow Atlas. This allows rendering multiple lights in a single pass, be it using forward or clustered rendering. Shadow atlases exist for Spot and Omni lights (Directional uses its own texture, and multiple directional lights need several passes).</p>

<p>How the atlas texture is organized is up to the user, though the default is sensible enough to work in most cases. Atlas cells are assigned according to their size in pixels on the screen (e.g. if the light is using the whole screen, the biggest cell is assigned, otherwise an intermediary or smaller one will be assigned).</p>

<p>Below is an example of how this process happens:</p>

<p><img src="/storage/app/media/devlog/progress2/pr2-1.png" alt="" /></p>

<h4 id="shadow-caching">Shadow Caching</h4>

<p>As most light shadows will not change unless something moves around that area, Godot will not redraw such shadows unless needed. This ensures that a lot of shadows can be drawn on screen at decent performance. To improve on efficiency, we were contemplating adding some optimizations such as updating farther away shadows at a lower framerate.</p>

<h4 id="point-light-shadows">Point Light Shadows</h4>

<p>One of the big problems with point lights is that, to render them correctly, a depth cubemap must be used. This obviously conflicts with the idea of using an atlas (can’t really store cubemap lights efficiently on it).</p>

<p>Godot 2.x used Dual Paraboloid Shadow Mapping, a technique that is very efficient, but produced deformed shadows (notice the rounded edges and discontinuities). This was the source of complaints from many users.</p>

<p><img src="/storage/app/media/devlog/progress2/pr2-2.png" alt="" /></p>

<p>To fix this, Godot 3.0 provides an extra point light rendering mode where the shadow is rendered to a cubemap, then converted to DPSM. This produces flawless results at a bit higher (but not by much) cost. Users can now choose this mode when correct shadows are desired, or keep using the old method when performance is a priority over quality.</p>

<p><img src="/storage/app/media/devlog/progress2/pr2-3.png" alt="" /></p>

<p>For point and directional lights, everything is more or less the same as before.</p>

<h2 id="implement-reflection-probes">Implement Reflection Probes</h2>

<p>One of the main features of PBR rendering is having all sort of sources for reflections. The most common (and cheapest) one is reflection probes.</p>

<p>These are basically cubemaps which capture a given area, and then everything inside their box uses them as a reflection source. To allow proper roughness, cubemap mipmaps are gradually filtered using the a GGX lobe, which allows quick look-ups.</p>

<p>In Godot, unlike in other engines, probes are also implemented as dual paraboloid. There are two reasons for this, but mainly that Godot 3.0 uses GLES 3.0 as it’s main backend and makes compatibility a priority. This means:</p>

<ul>
  <li>Cubemap arrays are not supported in older hardware, mobile and WebGL2, and reflections need to be put into an atlas (for single-pass forward or clustered).</li>
  <li>Blending of cubemap faces is not supported in mobile and WebGL2, making blurred reflections look terrible. This is not a problem with DP.</li>
</ul>

<p>Dual paraboloid reflections fix this, and have the added advantage of being able to choose cubemap-correct or fast, but incorrect reflections.</p>

<p>Reflection probes are relatively simple to use in Godot. Just instance one, set the bounds and adjust the origin. Everything inside will automatically reflect itself:</p>

<p><img src="/storage/app/media/devlog/progress2/pr2-4.png" alt="" /></p>

<p>As you can see though, the reflection is too broad (there is a giant “lamp” at the bottom). For interiors, there is a “box project” option that will map the reflection to the sides of the probe, improving the reflection quality:</p>

<p><img src="/storage/app/media/devlog/progress2/pr2-5.png" alt="" /></p>

<p>Of course, for a complex interior, several probes must be used to properly map all rooms and passages. This is one of the strong points of Godot implementation, which uses a novel blending algorithm between probes. Other popular game engines present hard edges between one probe and the next.</p>

<p><img src="/storage/app/media/devlog/progress2/pr2-6.png" alt="" /></p>

<p>Godot also provides some nice options per probe, like custom ambient light, and the ability to mark them as “interior”, which changes some options with regard to how they are rendered (such as rendering the skybox and blending to it).</p>

<h2 id="implement-more-pbr-parameters">Implement more PBR parameters</h2>

<p>Several more PBR parameters were implemented. Thanks to Godot’s Forward/Clustered design, the material system is far more advanced than in other popular game engines, requiring no hacks to allow a much larger amount of parameters ready to use for the artists, at no cost.</p>

<h4 id="specular-color-instead-of-metalness">Specular Color instead of Metalness</h4>

<p>Godot uses a specular color instead of metalness. This works as if metalness could be controlled per color channel, allowing a broader range of materials:</p>

<p><img src="/storage/app/media/devlog/progress2/pr2-7.png" alt="" /></p>

<h4 id="rim-lighting">Rim Lighting</h4>

<p>It is possible to set up a special rim lighting parameter. This adds some back-lighting to the contours of objects according to each light. It works well to simulate cloth or Mario-Galaxy style art.</p>

<p><img src="/storage/app/media/devlog/progress2/pr2-8.png" alt="" /></p>

<h4 id="clearcoat">Clearcoat</h4>

<p>This parameter acts like a second specular dot. It works great on objects that have a certain amount of roughness, but that are also covered in some sort of shiny glass, pastic, liquid, etc.</p>

<h4 id="anisotropy">Anisotropy</h4>

<p>Anisotropy works great for materials that distort the specular reflection, such as hair, an LP, brushed metal, etc. A tutorial on how to use this will be eventually uploaded.</p>

<h4 id="ambient-occlusion">Ambient Occlusion</h4>

<p>Materials can provide their own ambient occlusion, overriding global effects such as SSAO.</p>

<h4 id="subsurface-scattering">Subsurface Scattering</h4>

<p>This parameter is used to simulate surfaces that reflect the light internally, such as skin, rubber, marble, milk, soap, wax, etc.</p>

<p><img src="/storage/app/media/devlog/progress2/pr2-9.png" alt="" /></p>

<h2 id="implement-mid-processing">Implement Mid-Processing</h2>

<p>Mid-Processing is the effects that are applied in the middle of rendering, before alpha pass and post-processing.</p>

<h4 id="screen-space-reflections">Screen Space Reflections</h4>

<p>Godot uses it’s own screen-space reflection implementation. This effect allows showing reflections that can be calculated from the same screen-space. It’s meant to be used together with reflection probes, so there is always a fallback when a reflection can’t be found.</p>

<p><img src="/storage/app/media/devlog/progress2/pr2-10.png" alt="" /></p>

<p>Blurring the reflection according to roughness is also supported, using a fast screen-space blur. This technique is not correct per se, but it’s very efficient.</p>

<p><img src="/storage/app/media/devlog/progress2/pr2-11.png" alt="" /></p>

<h4 id="screen-space-ambient-occlusion">Screen Space Ambient Occlusion</h4>

<p>This effect is used and abused by a lot of developers. It obscures parts of the scene where the light should have more difficulty reaching. Godot’s implementation provides a few interesting things:</p>

<ul>
  <li>It uses the Scalable Ambient Obscurance algorithm, which is very, very fast, allows huge radiuses.</li>
  <li>It allows two different radius and intensity settings, to be able to cover large areas and small areas at the same time.</li>
  <li>It allows “bleeding” into direct lighting too, so stuff that is receiving direct light can be obscured to customizable degree.</li>
</ul>

<p><img src="/storage/app/media/devlog/progress2/pr2-12.png" alt="" /></p>

<h2 id="future">FUTURE</h2>

<p>This month has been mostly implementing standard modern engine features, always with a twist to improve them the Godot way. Next month should hopefully be more interesting when work goes towards the new light baker!</p>

<h2 id="seeing-the-code">SEEING THE CODE</h2>

<p>If you are interested in seeing what each feature looks like in the code, you can check the <a href="https://github.com/godotengine/godot/commits/gles3">gles3 branch</a> on GitHub.</p>

			</div>
		</div>
	</article>
</div>

<link rel="stylesheet" href="/assets/css/anchor-link.css?1">
<link rel="stylesheet" href="/assets/css/article-cards.css?2">
<script src="/assets/js/anchor-link.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		// Add icons to easily copy section links.
		window.applyAnchorLinks('.article-body');

		// Add lightbox elements in blog articles for Tobii.
		document.querySelectorAll('.article-cover img, .article-body img').forEach((articleImg) => {
			if (articleImg.classList.contains('lightbox-ignore')) {
				return;
			}

			const lightbox = document.createElement('a');
			lightbox.href = articleImg.src;
			lightbox.classList.add('lightbox');
			lightbox.dataset.group = 'article';
			articleImg.parentNode.appendChild(lightbox);
			lightbox.appendChild(articleImg);
		});
	});
</script>

</main>

<footer>
	<div class="container flex footer-container">
		<div id="copyright">
			<p>
				© 2007-2024 Juan Linietsky, Ariel Manzur and <a
					href="https://github.com/godotengine/godot/blob/master/AUTHORS.md" target="_blank"
					rel="noopener">contributors</a>.<br>
				Hosted by the <a href="https://godot.foundation/" target="_blank" rel="noopener">Godot Foundation</a>.<br>
				Website <a href="https://github.com/godotengine/godot-website" target="_blank" rel="noopener">source code on  GitHub</a>.
			</p>
		</div>
		<div id="sitemap">
			<ul class="sitemap-group">
				<li><strong>Get Godot</strong></li>
				<li><a href="/download/windows/" class="set-os-download-url">Download</a></li>
				<li><a href="/download/archive/">Release Archive</a></li>
				<li><a href="https://editor.godotengine.org/releases/latest/">Web Editor</a></li>
				<li>&nbsp;</li>
				<li><strong>Public Relations</strong></li>
				<li><a href="/blog/">Blog</a></li>
				<li><a href="/community/">Communities and Events</a></li>
				<li><a href="/press/">Press Kit</a></li>
			</ul>
			<ul class="sitemap-group">
				<li><strong>About Godot</strong></li>
				<li><a href="/features/">Features</a></li>
				<li><a href="/showcase/">Showcase</a></li>
				<li><a href="/education/">Education</a></li>
				<li><a href="/license/">License</a></li>
				<li><a href="/code-of-conduct/">Code of Conduct</a></li>
				<li><a href="/privacy-policy/">Privacy Policy</a></li>
				<li><a href="https://fund.godotengine.org">Donate</a></li>
			</ul>
			<ul class="sitemap-group">
				<li><strong>Project Team</strong></li>
				<li><a href="/governance/">Governance</a></li>
				<li><a href="/teams/">Teams</a></li>
				<li>&nbsp;</li>
				<li><strong>Extra Resources</strong></li>
				<li><a href="https://godotengine.org/asset-library/asset">Asset Library</a></li>
				<li><a href="https://docs.godotengine.org">Documentation</a></li>
				<li><a href="https://github.com/godotengine">Code Repository</a></li>
			</ul>
		</div>
		<div id="social" class="dark-desaturate">
			<h4 class="text-right"><a href="/contact/">Contact us</a></h4>
			<div class="flex justify-space-between" style="gap: 3px;">
				<a href="https://github.com/godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/github_logo.svg" width="32" height="32" alt="GitHub">
				</a>
				<a href="https://mastodon.gamedev.place/@godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/mastodon_logo.svg" width="32" height="32" alt="Mastodon">
				</a>
				<a href="https://twitter.com/godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/twitter_logo.svg" width="32" height="32" alt="Twitter">
				</a>
				<a href="https://www.facebook.com/groups/godotengine/" target="_blank" rel="noopener">
					<img src="/assets/footer/facebook_logo.svg" width="32" height="32" alt="Facebook">
				</a>
				<a href="https://www.reddit.com/r/godot" target="_blank" rel="noopener">
					<!-- Zero-width space in the `alt` text to prevent content blockers from blocking the icon -->
					<img src="/assets/footer/reddit_logo.svg" width="32" height="32" alt="Red​dit">
				</a>
				<a href="/rss.xml" target="_blank" rel="noopener">
					<!-- Icon is called `feed` instead of `rss` to prevent content blockers from blocking the icon -->
					<img src="/assets/footer/feed_logo.svg" width="32" height="32" alt="RSS feed">
				</a>
			</div>
		</div>
	</div>
</footer>

<script defer src="/assets/js/tobii.min.js"></script>
<script defer src="/assets/js/highlight.min.js?1"></script>
<script defer src="/assets/js/highlight.gdscript.min.js?1"></script>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		// This needs to be done on page load but also after page changes,
		// in case a code block appears in an article.
		document.querySelectorAll('pre code').forEach((block) => {
			hljs.highlightBlock(block);
		});

		document.querySelectorAll('[data-post-date]').forEach((postDate) => {
			// Highlight post dates that are less than 48 hours old.
			if (Date.parse(postDate.dataset.postDate) > (Date.now() - 1000 * 60 * 60 * 48)) {
				postDate.classList.add("post-recent-highlight");
			};
		});

		// Initialize lightbox.
		new Tobii({
			zoom: false,
		});

		// Update any download link to point to identified user's OS.
		const links = document.querySelectorAll('.set-os-download-url');
		for (let i = 0; i < links.length; i++) {
			const link = links[i];
			let link_slug = 'download';
			if ('version' in link.dataset && link.dataset['version'] === '3') {
				link_slug = 'download/3.x';
			}

			let link_platform = 'windows';
			if (navigator.platform.indexOf('Mac') !== -1) {
				link_platform = 'macos';
			} else if (navigator.platform.indexOf('Linux') !== -1) {
				link_platform = 'linux';
			}

			link.href = `/${link_slug}/${link_platform}/`;
		}
	});
</script>


</body>

</html>
