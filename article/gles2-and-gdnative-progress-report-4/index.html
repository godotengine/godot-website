<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Godot Engine">
	<meta name="description" content="Latest update on the GLES2 and GDNative developments. This month, a lot of time has been spend on refactoring the way materials work together with shaders, but also the C++ bindings got some nice new make-up!">
	<meta name="theme-color" content="#3d8fcc">
	<meta property="og:site_name" content="Godot Engine">
	<meta property="og:url" content="https://godotengine.org/article/gles2-and-gdnative-progress-report-4/">
	<meta name="twitter:site" content="@godotengine">

	<meta property="og:title" content="GLES2 and GDNative, progress report #4">
	<meta property="og:description" content="Latest update on the GLES2 and GDNative developments. This month, a lot of time has been spend on refactoring the way materials work together with shaders, but also the C++ bindings got some nice new make-up!">
	<meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/5ad/505/3b6/5ad5053b6e0ad093497368.png">
	<meta property="og:type" content="article">
	<meta name="twitter:card" content="summary_large_image">
	<title>GLES2 and GDNative, progress report #4</title>

	<link rel="alternate" type="application/rss+xml" title="Godot News" href="/rss.xml">
	<link rel="icon" href="/assets/favicon.png" sizes="any">
	<link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
	<link rel="stylesheet" href="/assets/css/main.css?112">
	<link rel="stylesheet" href="/assets/css/tobii.min.css">
	<link rel="preload" as="font" href="/assets/fonts/Montserrat-Bold.woff2" crossorigin>
	<link rel="preload" as="font" href="/assets/fonts/Montserrat-ExtraBold.woff2" crossorigin>
	<link rel="me" href="https://mastodon.gamedev.place/@godotengine">
</head>

<body>
	<input type="checkbox" id="nav_toggle_cb">
<header>
	<div class="container flex align-center">
		<div id="nav_head">
			<a href="/" id="logo-link">
				<img class="nav-logo" src="/assets/logo.svg" width="136" height="48" alt="Godot Engine">
				<img class="nav-logo dark-logo" src="/assets/logo_dark.svg" width="136" height="48" alt="Godot Engine">
			</a>
			<label for="nav_toggle_cb" id="nav_toggle_btn">
				<img src="/assets/icons/hamburger.svg" width="24" height="24" alt="Main menu">
			</label>
		</div>

		<nav id="nav">
			<ul class="left">
				<li><a href="/features/">Features</a></li>
				<li class="only-on-mobile"><a href="/showcase/">Showcase</a></li>
				<li><a href="/blog/">Blog</a></li>
				<li><a href="/community/">Community</a></li>
				<li><a href="/contact/">About</a></li>
				<li><a href="https://godotengine.org/asset-library/asset">Assets</a></li>
			</ul>

			<ul class="right">
				<li><a href="/download/windows/" class="set-os-download-url">Download</a></li>
				<li><a href="https://docs.godotengine.org">Docs</a></li>
				<li><a href="https://docs.godotengine.org/en/stable/community/contributing/index.html">Contribute</a></li>
				
				<li class="fund"><a href="https://fund.godotengine.org">❤&#xFE0E; Donate</a></li>
			</ul>
		</nav>
	</div>
</header>

<main>


<style>
	body {
		background-color: var(--background-color);
	}

	h1 {
		margin-bottom: 8px;
		margin-top: 32px;
	}

	:not(pre)>code {
		background: var(--code-background-color);
		padding: 1px 4px;
		font-size: 0.95em;
		border-radius: 3px;
	}

	pre {
		background: var(--codeblock-background-color);
		color: var(--codeblock-color);
	}

	pre code {
		display: block;
		overflow-x: auto;
		padding: .5em;
	}

	.date-big {
		line-height: 2;
		margin-left: 32px;
	}

	article {
		background-color: var(--base-color);
		box-shadow: 0px 3px 2px 0px rgba(0, 0, 0, 0.15);
	}

	figure {
		margin: 0;
	}

	figure img {
		margin: 0;
	}

	article img,
	article video {
		max-width: 100%;
		height: auto;
		display: block;
		margin: auto;
		margin-top: 16px;
		margin-bottom: 16px;
	}

	article h1 {
		margin-top: 64px;
	}

	article h2,
	article h3,
	article h4 {
		margin-top: 42px;
	}

	.article-info {
		display: flex;
		flex-direction: column;
		gap: 8px;
	}

	.article-metadata {
		display: flex;
		gap: 24px;
		align-items: center;
		font-family: var(--header-font-family);
		margin-bottom: 12px;
	}

	@media (max-width: 900px) {
		.article-metadata {
			flex-direction: column;
			align-items: flex-start;
			gap: 16px;
		}
	}

	.article-author {
		color: var(--base-color-text-subtitle-date);
		font-weight: 700;
		font-size: 18px;
		flex-grow: 1;
		display: flex;
		gap: 12px;
		align-items: center;
	}

	.article-author .avatar {
		border-radius: 100%;
		margin: 0;
	}

	.article-author .by {
		color: var(--base-color-text-subtitle);
	}

	.article-metadata .date {
		color: var(--base-color-text-subtitle-date);
	}

	.article-metadata .date.post-recent-highlight {
		color: var(--post-recent-highlight-color);
		opacity: 0.8;
	}

	.article-metadata .date.post-recent-highlight::after {
		font-size: 80%;
		content: "NEW";
		border: 2px solid var(--post-recent-highlight-color);
		padding: 2px 3px;
		margin-left: 8px;
	}

	.tag.active {
		filter: saturate(0.75);
	}

	@media screen and (min-width: 900px) {
		article .content {
			width: 70%;
			margin: auto;
		}
	}

	@media (max-width: 900px) {
		body {
			background-color: var(--base-color);
		}

		article {
			background-color: transparent;
			box-shadow: none;
		}

		article img:first-child,
		article video:first-child {
			max-width: 100%;
		}
	}
</style>

<link rel="stylesheet" href="/assets/css/highlight.obsidian.min.css">

<div class="container">
	<article class="padded">
		<div class="content article-container">
			<figure class="article-cover">
				

				<img src="/storage/app/uploads/public/5ad/505/3b6/5ad5053b6e0ad093497368.png" title=""
					alt=" " class="rounded-lg"
					style="width: 100%; height: auto; background-color: transparent;" />
			</figure>

			<div class="article-info">
				<h1>
					GLES2 and GDNative, progress report #4
				</h1>
				<div class="article-metadata">
					<div class="article-author">
						<span>By: </span>
						
						
							<img class="avatar" width="25" height="25" src="/assets/images/authors/default_avatar.svg" alt="karroffel" loading="lazy">
						
						<span class="by">karroffel</span>
					</div>
					<span class="date" data-post-date="2018-04-16 20:19:20 +0000"> 16 April 2018</span>
				</div>

				<div class="tags">
					
					<a href="/blog/progress-report">
						<div class="tag active">Progress Report</div>
					</a>
					
				</div>
			</div>

			



	<div class="card card-warning">
		<p>
		
			This article is from <strong>April 2018</strong>, some of its contents might be outdated and no longer accurate.<br>
			You can find up-to-date information about the engine in the <a href="https://docs.godotengine.org/en/stable/">official documentation</a>.
		
		</p>
	</div>





			<div class="article-body">
				<h2 id="introduction">Introduction</h2>

<p>This project report falls a little bit shorter, as much of the work was less “fruitful” but nonetheless important and a good learning experience. In this case I’m talking about a rather big <em>refactoring</em> of how materials are handled in the GLES2 renderer. Still there were some improvements on the GDNative side of things!</p>

<h2 id="roadmap">Roadmap</h2>

<h4 id="done-march-2018">Done March 2018</h4>

<ul>
  <li>C++ bindings for NativeScript 1.1</li>
  <li>WIP godot-rust low level improvements</li>
  <li>perspective rendering</li>
  <li>material API refactor</li>
  <li>material passes and renderlist</li>
  <li>basics for skeletal animations</li>
</ul>

<h4 id="planned-april-2018">Planned April 2018</h4>

<ul>
  <li>finish up skeletal animations (- blend shapes)</li>
  <li>stabilize 3D rendering (unshaded workflow)</li>
  <li>implement backbuffer copy</li>
  <li>learning about PBR</li>
  <li>cubemap filter</li>
</ul>

<h2 id="details-about-work-in-march-2018">Details about work in March 2018</h2>

<h3 id="c-bindings-for-nativescript-11">C++ bindings for NativeScript 1.1</h3>

<p>As talked about in the <a href="https://godotengine.org/article/gles2-and-gdnative-progress-report-3">last progress report</a>, a new extension to the NativeScript API has been added. Now it was time to make use of those new functions in the <a href="https://github.com/GodotNativeTools/godot-cpp">C++ bindings</a>.</p>

<p>The biggest user-facing change in the bindings is, that user-created classes can now directly inherit from engine types. This is being implemented by facilitating object <em>instance binding data</em>.</p>

<p>Until the new NativeScript 1.1 extension will be more widely used, a system of <a href="https://en.wikipedia.org/wiki/Delegation_(object-oriented_programming)">delegation</a> is used in the bindings to access “parent class” functionality. The <a href="https://github.com/GodotNativeTools/godot-cpp/blob/68ba815bc5c9ffa9494511f9feb8ea36a95369d7/include/core/Godot.hpp#L30-L33"><code class="language-plaintext highlighter-rouge">GodotScript</code> template class</a> includes a field <code class="language-plaintext highlighter-rouge">owner</code>, which refers to the <code class="language-plaintext highlighter-rouge">Object</code> that the current script is attached to.</p>

<p>Even though Godot’s scripting languages try to make you believe that you can “extend” or “inherit” engine types, all that is done is actually <em>delegation</em>. Most GDNative language bindings make that explicit, but after receiving some user feedback it was time to <em>fake inheritance</em> in the C++ bindings as well.</p>

<p>Before, every C++ bindings wrapper class was actually more like a wrapper interface with nice syntactic sugar. (I don’t want to say how it is done, I want to keep the little reputation that I have. If you really want to know, all I’m saying is: you can re-use the this pointer “safely” (putting more quotes looks dumb) as long as you don’t have any virtual methods to call…)</p>

<p>That meant, that you couldn’t inherit directely, but now that it’s possible to create per-object binding data, it is possible to create wrapper classes that are <em>proper classes</em>, which can be inherited!</p>

<p>A lot of text and no code so far, so here you go!</p>

<p>Old way:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MovingSprite</span> <span class="o">:</span> <span class="k">public</span> <span class="n">GodotScript</span><span class="o">&lt;</span><span class="n">Sprite</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">GODOT_CLASS</span><span class="p">(</span><span class="n">MovingSprite</span><span class="p">)</span>

    <span class="n">Vector2</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">speed</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">;</span> <span class="c1">// pixels per second</span>
<span class="nl">public:</span>

    <span class="kt">void</span> <span class="n">_init</span><span class="p">()</span> <span class="p">{}</span>

    <span class="kt">void</span> <span class="n">_process</span><span class="p">(</span><span class="kt">float</span> <span class="n">delta</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Vector2</span> <span class="n">motion</span> <span class="o">=</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">delta</span><span class="p">;</span>
        <span class="n">owner</span><span class="o">-&gt;</span><span class="n">set_position</span><span class="p">(</span><span class="n">owner</span><span class="o">-&gt;</span><span class="n">get_position</span><span class="p">()</span> <span class="o">+</span> <span class="n">motion</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="kt">void</span> <span class="n">_register_methods</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">register_method</span><span class="p">(</span><span class="s">"_process"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MovingSprite</span><span class="o">::</span><span class="n">_process</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>New way:</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MovingSprite</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Sprite</span> <span class="p">{</span>
    <span class="n">GODOT_CLASS</span><span class="p">(</span><span class="n">MovingSprite</span><span class="p">,</span> <span class="n">Sprite</span><span class="p">)</span>

    <span class="n">Vector2</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">speed</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">;</span> <span class="c1">// pixels per second</span>
<span class="nl">public:</span>

    <span class="kt">void</span> <span class="n">_init</span><span class="p">()</span> <span class="p">{}</span>

    <span class="kt">void</span> <span class="n">_process</span><span class="p">(</span><span class="kt">float</span> <span class="n">delta</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Vector2</span> <span class="n">motion</span> <span class="o">=</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">delta</span><span class="p">;</span>
        <span class="n">set_position</span><span class="p">(</span><span class="n">get_position</span><span class="p">()</span> <span class="o">+</span> <span class="n">motion</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="kt">void</span> <span class="n">_register_methods</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">register_method</span><span class="p">(</span><span class="s">"_process"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MovingSprite</span><span class="o">::</span><span class="n">_process</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">};</span>
</code></pre></div></div>

<p>To test those things (and some others, work from April is already available), check out the <code class="language-plaintext highlighter-rouge">nativescript-1.1</code> branch of the C++ bindings <a href="https://github.com/GodotNativeTools/godot-cpp/tree/nativescript-1.1">here</a>, as well as an updated version of the C++ SimpleDemo on the <code class="language-plaintext highlighter-rouge">cpp-nativescript-1.1</code> branch of the GDNative-demos repository <a href="https://github.com/GodotNativeTools/GDNative-demos/tree/cpp-nativescript-1-1/cpp/SimpleDemo">here</a>.</p>

<h3 id="wip-godot-rust-low-level-improvements">WIP godot-rust low level improvements</h3>

<p>Steadily gaining more popularity, the <a href="https://github.com/GodotNativeTools/godot-rust">godot-rust</a> bindings are getting more attention from new contributors. I tried to check out the new bindings and notices some problems in the workflow for testing the bindings, so I added small complete <a href="https://github.com/GodotNativeTools/godot-rust/tree/b707692a63a157b990ccb25371af3160a9be800f/examples">godot projects to the repository</a>, so things can be reasoned about in context, with all the scenes and environment in place.</p>

<p>Further, the Rust bindings make heavy use of macros for the “script-class” definition, some users said that the heavy use of custom syntax can be distracting and makes things less clear. This is tracked in an <a href="https://github.com/GodotNativeTools/godot-rust/issues/49">issue</a>, but I thought it could be a fun way to get more into the current and new codebase.</p>

<p>Most of my efforts have been focused on being able to define script classes without <em>needing</em> macros, while still offering some useful macros that are completely optional.</p>

<p>Here is a <a href="https://github.com/karroffel/godot-rust/blob/0dce8bef80322afcce77abcf8323e9941c3281bc/examples/low_level_registering/src/lib.rs">link</a> to a file to show what “low level class registering” might look like in future (this is already working code).</p>

<p>NativeScript classes expose some function pointers with C linkage with a certain signature. To ease the “connecting” of the C-compatible function and the actual Rust function, a macro has been added that generates said C function which will automatically call the Rust code. This is completely optional, the C function can be created manually, but this is generally not a nice thing to spend your dev-time on. The same has been done for constructors and destructors.</p>

<p>The <em>work-in-progress</em> commit can be found <a href="https://github.com/karroffel/godot-rust/commit/0dce8bef80322afcce77abcf8323e9941c3281bc">here</a>, I plan to open a pull request as soon as I finish up the commits properly.</p>

<h3 id="perspective-rendering">perspective rendering</h3>

<p>Now finally the more visual part of the progress report! Last time I promised more fancy screenshots, here some perspective-correct renderings of some meshes.</p>

<p><img src="/storage/app/uploads/public/5ad/4f8/782/5ad4f87822206976581928.png" alt="Screenshot_2018-03-06_14-35-33.png" /></p>

<p>No color, no grid on the ground…? Yes, some more invalid OpenGL state was fixed and a first attempt to get spatial shaders working and then this could be seen.</p>

<p><img src="/storage/app/uploads/public/5ad/4f9/1b9/5ad4f91b9595d494867993.png" alt="Screenshot from 2018-03-19 11-45-41.png" /></p>

<p>Getting there, slow but steadily :D</p>

<h3 id="material-api-refactor">material API refactor</h3>

<p>This point actually took most of the development time this month, it was a rather frustrating and iterative process to find out how to best handle materials and shaders.</p>

<p>Some background on materials first!</p>

<p>In Godot, a material basically consists of a shader and a list of parameters (<code class="language-plaintext highlighter-rouge">name =&gt; value</code> pairs) that get passed into the shader. Materials also include other things, like blend modes but the problematic part were the material parameters.</p>

<p>Since OpenGL 3.1, <a href="https://www.khronos.org/opengl/wiki/Uniform_Buffer_Object"><em>Uniform Buffer Objects</em></a>, short UBOs, can be used. UBOs are chunks of memory that contain data that is available “globally” and immutably in every shader stage.</p>

<p>The <code class="language-plaintext highlighter-rouge">TIME</code> variable in shaders? <a href="https://github.com/godotengine/godot/blob/7b5703bc41460c5c8b955f879190625da85a2a81/drivers/gles3/shaders/canvas.glsl#L35-L39">Part of a UBO</a>. Texture handles? UBO. Camera projection matrix? Also UBO. Those things don’t change in a single draw pass, so they get grouped into a buffer which can then be updated all at once.</p>

<p>In the GLES3 renderer, material parameters get assigned an offset in a UBO, then that UBO can be <a href="https://github.com/godotengine/godot/blob/7b5703bc41460c5c8b955f879190625da85a2a81/drivers/gles3/rasterizer_storage_gles3.cpp#L2545-L2585">filled</a> and used for a draw call.</p>

<p>In GLES2 however, UBOs do not exist. Every <em>uniform</em> (a “global” value accessible in all shaders) has to be set individually for each shader.</p>

<p>This is where many iteration and refactoring have been focussed on. Do those values get set when the material changes? No, drawing might happen later in time and the uniform value lost. Do the values get saved in the shader and the shader sets them up when needed? This is rather complex when user-defined shaders come into play, it’s possible, but it doesn’t feel right and caused many bugs.</p>

<p>After all those iterations, I settled for an approach where the shader gets a reference to the material that will be used, and then, only when the shader will be used for drawing, the shader will set all uniform values accordingly.</p>

<p>Some type-system hacks are needed because C++ doesn’t like forward declared inner classes (if someone knows how to do it, please, tell me :D ), and I came up with this <a href="https://github.com/karroffel/godot/blob/b1a5ea20a54c9904714218ed21f19be64fca1b5b/drivers/gles2/shader_gles2.cpp#L686">code</a>. There is a lot of <a href="https://github.com/karroffel/godot/blob/b1a5ea20a54c9904714218ed21f19be64fca1b5b/drivers/gles2/shader_gles2.cpp#L709-L895">code</a> that deals with getting and selecting the right uniform type/call, but this way the information from custom shaders can be used more efficiently. With UBOs, this comes natural, and very similar code exists in the <a href="https://github.com/godotengine/godot/blob/7b5703bc41460c5c8b955f879190625da85a2a81/drivers/gles3/rasterizer_storage_gles3.cpp#L2009-L2262">GLES3 renderer</a>.</p>

<p>In the end, this approach works pretty well and seems very clear to me, and after all those refactoring I can safely say: UBOs are missed. :D</p>

<p><img src="/storage/app/uploads/public/5ad/4fe/962/5ad4fe962e4b9850689928.png" alt="Screenshot from 2018-03-29 15-30-10.png" /></p>

<h3 id="material-passes-and-renderlist">material passes and renderlist</h3>

<p>Up until that point (well, the refactorings and this kind of blend together, but I hope it’s clear what I mean) the drawing was very straighforward.</p>

<ul>
  <li>Get the next available thing to draw</li>
  <li>if you can draw it, set the GL state up properly</li>
  <li>render.</li>
</ul>

<p>The code was <a href="https://github.com/karroffel/godot/blob/68d06a1ecc5653f9ceabca10c4a4eb2c2d78134f/drivers/gles2/rasterizer_scene_gles2.cpp#L241">relatively small</a> and rather simple to understand and get an overview over, because it was so straighforward. But as with many things, this simplicity becomes problematic at some point. In this case no optimization was done <em>at all</em>. Material passes weren’t possible and dealing with shader state became a pain, so it was time to move to a more flexible implementation: the <strong>renderlist</strong>!</p>

<p>The RenderList is an <a href="https://github.com/karroffel/godot/blob/29fc8fc9ec9e4cac1a6505914679dee91f83619d/drivers/gles2/rasterizer_scene_gles2.h#L298-L299">array of elements</a> and a list of pointers to those elements which need to be drawn.</p>

<p>The cool thing is, that each element can get an index assigned on which they can be sorted. So things in the front will be drawn before things in the back, that helps to <a href="https://en.wikipedia.org/wiki/Z-buffering">reduce overdraw</a> by making use of the depth-buffer. Meshes with similar shaders can be grouped together so that shaders don’t need to be unloaded and loaded again, and many other cool things.</p>

<p>While filling this list, it is very easy to add in a <a href="https://github.com/karroffel/godot/blob/29fc8fc9ec9e4cac1a6505914679dee91f83619d/drivers/gles2/rasterizer_scene_gles2.cpp#L236-L245">second draw pass</a> for a surface with a different material. This is how the <code class="language-plaintext highlighter-rouge">Next Pass</code> in materials is implemented.</p>

<p>The RenderList gives much flexibility while also making simple optimizations very easy to set up.</p>

<h3 id="basics-for-skeletal-animations">basics for skeletal animations</h3>

<p>Another under-the-hood development was the initial work on Skeleton resources. At that point, a skeleton could not deform a mesh yet and wasn’t very useful, but the basic storage for <a href="https://en.wikipedia.org/wiki/Skeletal_animation">bone transforms</a> was already in place. Depending on the hardware that Godot is running on, the bone information might be stored in different ways, so the skeleton resource might be handled in different ways.</p>

<p>Because the GLES2 renderer will run on a lot of low-end hardware, I chose a more software-oriented than hardware/GPU-oriented approach to store the bone transforms, but more on that in the next</p>

<h2 id="future">Future</h2>

<p>In the next progress report I will talk about how the new renderer handles skeletal animations differently than the 2.1 renderer, also I will share my then newly-gained knowledge of physically based rendering! Interesting times ahead!</p>

<h2 id="seeing-the-code">Seeing the code</h2>

<p>If you are interested in the GLES2 related code, you can see all the commits in my <a href="https://github.com/karroffel/godot/tree/gles2">fork</a> on GitHub. Other contributions are linked in the sections above.</p>

			</div>
		</div>
	</article>
</div>

<link rel="stylesheet" href="/assets/css/anchor-link.css?1">
<link rel="stylesheet" href="/assets/css/article-cards.css?2">
<script src="/assets/js/anchor-link.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		// Add icons to easily copy section links.
		window.applyAnchorLinks('.article-body');

		// Add lightbox elements in blog articles for Tobii.
		document.querySelectorAll('.article-cover img, .article-body img').forEach((articleImg) => {
			if (articleImg.classList.contains('lightbox-ignore')) {
				return;
			}

			const lightbox = document.createElement('a');
			lightbox.href = articleImg.src;
			lightbox.classList.add('lightbox');
			lightbox.dataset.group = 'article';
			articleImg.parentNode.appendChild(lightbox);
			lightbox.appendChild(articleImg);
		});
	});
</script>

</main>

<footer>
	<div class="container flex footer-container">
		<div id="copyright">
			<p>
				© 2007-2024 Juan Linietsky, Ariel Manzur and <a
					href="https://github.com/godotengine/godot/blob/master/AUTHORS.md" target="_blank"
					rel="noopener">contributors</a>.<br>
				Hosted by the <a href="https://godot.foundation/" target="_blank" rel="noopener">Godot Foundation</a>.<br>
				Website <a href="https://github.com/godotengine/godot-website" target="_blank" rel="noopener">source code on  GitHub</a>.
			</p>
		</div>
		<div id="sitemap">
			<ul class="sitemap-group">
				<li><strong>Get Godot</strong></li>
				<li><a href="/download/windows/" class="set-os-download-url">Download</a></li>
				<li><a href="/download/archive/">Release Archive</a></li>
				<li><a href="https://editor.godotengine.org/releases/latest/">Web Editor</a></li>
				<li>&nbsp;</li>
				<li><strong>Public Relations</strong></li>
				<li><a href="/blog/">Blog</a></li>
				<li><a href="/community/">Communities and Events</a></li>
				<li><a href="/press/">Press Kit</a></li>
			</ul>
			<ul class="sitemap-group">
				<li><strong>About Godot</strong></li>
				<li><a href="/features/">Features</a></li>
				<li><a href="/showcase/">Showcase</a></li>
				<li><a href="/education/">Education</a></li>
				<li><a href="/license/">License</a></li>
				<li><a href="/code-of-conduct/">Code of Conduct</a></li>
				<li><a href="/privacy-policy/">Privacy Policy</a></li>
				<li><a href="https://fund.godotengine.org">Donate</a></li>
			</ul>
			<ul class="sitemap-group">
				<li><strong>Project Team</strong></li>
				<li><a href="/governance/">Governance</a></li>
				<li><a href="/teams/">Teams</a></li>
				<li>&nbsp;</li>
				<li><strong>Extra Resources</strong></li>
				<li><a href="https://godotengine.org/asset-library/asset">Asset Library</a></li>
				<li><a href="https://docs.godotengine.org">Documentation</a></li>
				<li><a href="https://github.com/godotengine">Code Repository</a></li>
			</ul>
		</div>
		<div id="social" class="dark-desaturate">
			<h4 class="text-right"><a href="/contact/">Contact us</a></h4>
			<div class="flex justify-space-between" style="gap: 3px;">
				<a href="https://github.com/godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/github_logo.svg" width="32" height="32" alt="GitHub">
				</a>
				<a href="https://mastodon.gamedev.place/@godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/mastodon_logo.svg" width="32" height="32" alt="Mastodon">
				</a>
				<a href="https://twitter.com/godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/twitter_logo.svg" width="32" height="32" alt="Twitter">
				</a>
				<a href="https://www.facebook.com/groups/godotengine/" target="_blank" rel="noopener">
					<img src="/assets/footer/facebook_logo.svg" width="32" height="32" alt="Facebook">
				</a>
				<a href="https://www.reddit.com/r/godot" target="_blank" rel="noopener">
					<!-- Zero-width space in the `alt` text to prevent content blockers from blocking the icon -->
					<img src="/assets/footer/reddit_logo.svg" width="32" height="32" alt="Red​dit">
				</a>
				<a href="/rss.xml" target="_blank" rel="noopener">
					<!-- Icon is called `feed` instead of `rss` to prevent content blockers from blocking the icon -->
					<img src="/assets/footer/feed_logo.svg" width="32" height="32" alt="RSS feed">
				</a>
			</div>
		</div>
	</div>
</footer>

<script defer src="/assets/js/tobii.min.js"></script>
<script defer src="/assets/js/highlight.min.js?1"></script>
<script defer src="/assets/js/highlight.gdscript.min.js?1"></script>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		// This needs to be done on page load but also after page changes,
		// in case a code block appears in an article.
		document.querySelectorAll('pre code').forEach((block) => {
			hljs.highlightBlock(block);
		});

		document.querySelectorAll('[data-post-date]').forEach((postDate) => {
			// Highlight post dates that are less than 48 hours old.
			if (Date.parse(postDate.dataset.postDate) > (Date.now() - 1000 * 60 * 60 * 48)) {
				postDate.classList.add("post-recent-highlight");
			};
		});

		// Initialize lightbox.
		new Tobii({
			zoom: false,
		});

		// Update any download link to point to identified user's OS.
		const links = document.querySelectorAll('.set-os-download-url');
		for (let i = 0; i < links.length; i++) {
			const link = links[i];
			let link_slug = 'download';
			if ('version' in link.dataset && link.dataset['version'] === '3') {
				link_slug = 'download/3.x';
			}

			let link_platform = 'windows';
			if (navigator.platform.indexOf('Mac') !== -1) {
				link_platform = 'macos';
			} else if (navigator.platform.indexOf('Linux') !== -1) {
				link_platform = 'linux';
			}

			link.href = `/${link_slug}/${link_platform}/`;
		}
	});
</script>


</body>

</html>
